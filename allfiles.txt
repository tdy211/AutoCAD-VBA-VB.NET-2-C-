using System.Linq;
using Autodesk.AutoCAD.ApplicationServices;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.EditorInput;
using Autodesk.AutoCAD.Runtime;
using DotNetARX;
namespace AccessCAD
{
    public class AccessCAD
    {
        //各部门的人员用不同颜色表示
        [CommandMethod("ColorDepartment")]
        public void ColorDepartment()
        {
            Database db = HostApplicationServices.WorkingDatabase;
            //新建一个指向db_sample.mdb数据库的数据集
            using (db_samplesDataSet ds=new db_samplesDataSet())
            using (Transaction trans = db.TransactionManager.StartTransaction())
            {
                // 新建一个窗体，以添加表示员工部门的颜色图例
                FormEmployee empForm = new FormEmployee();
                Application.ShowModelessDialog(empForm);// 显示窗体
                // 创建一个用于Employee表的DataAdapter，用于检索数据和填充Employee表
                var empAdapter=new db_samplesDataSetTableAdapters.EmployeeTableAdapter();
                empAdapter.Fill(ds.Employee);// 填充数据集中的Employee表
                // 从数据库中选择Employee表，建立员工姓名和部门(Department)的新序列
                var employeesInDB = from e in ds.Employee
                                    select new { Name = e.First_Name + "\r\n" + e.Last_Name, Department = e.Department };
                // 获取CAD图形中表示员工姓名的多行文本
                var employeesInCAD = db.GetEntsInModelSpace<MText>().Where(e => e.Layer == "EMPLOYEE");
                // 将CAD中的员工（实体）与数据库中的员工（部门）连接成一个大表
                var employees = from emp1 in employeesInCAD
                                join emp2 in employeesInDB on emp1.GetText() equals emp2.Name
                                select new { Entity = emp1, Department = emp2.Department };
                //对员工按照部门(Department)进行分组
                var employeesToGroup = (from emp in employees
                                        group emp by emp.Department into g
                                        select g).ToList();
                // 对部门进行遍历
                for (int i = 0; i < employeesToGroup.Count(); i++)
                {
                    //从员工组成窗体的图表中选择部门的颜色
                    var colorWindows = (from p in empForm.chartEmployee.Series[0].Points
                                        where p.LegendText == employeesToGroup[i].Key
                                        select p.Color).First();
                    //将Windows颜色值转化为AutoCAD颜色值
                    var colorCAD = Autodesk.AutoCAD.Colors.Color.FromColor(colorWindows);
                    //对部门中的员工进行遍历
                    foreach (var employee in employeesToGroup[i])
                    {
                        employee.Entity.UpgradeOpen(); //打开表示员工的实体为写的状态
                        employee.Entity.Color = colorCAD; //设置员工实体的颜色为对应部门的颜色
                    }
                }
                trans.Commit();
            }
        }


        [CommandMethod("ComputerNoRoom")]
        public void ComputerNoRoom()
        {
            Document doc = Application.DocumentManager.MdiActiveDocument;
            Editor ed = doc.Editor;
            //新建一个指向db_sample.mdb数据库的数据集
            using (var ds=new db_samplesDataSet())
            {
                // 创建一个用于Computer表的DataAdapter，用于检索数据和填充Computer表
                var computerAdapter=new db_samplesDataSetTableAdapters.ComputerTableAdapter();
                // 创建一个用于Room表的DataAdapter，用于检索数据和填充Room表
                var roomAdapter=new db_samplesDataSetTableAdapters.RoomTableAdapter();
                //填充数据集中的Computer表
                computerAdapter.Fill(ds.Computer);
                //填充数据集中的Room表
                roomAdapter.Fill(ds.Room);
                //查找Room表中没有的房间号
                var computerNoRoom=(from c in ds.Computer
                                    select c.Room_No).Distinct().Except(
                        from r in ds.Room
                        select r.Room_No);
                foreach (var roomNo in computerNoRoom)
                {
                    var newRoom=ds.Room.NewRoomRow();  //新建一个Room行
                    //房间号设置为Computer表中的房间号
                    newRoom.Room_No = roomNo;
                    ds.Room.AddRoomRow(newRoom); //添加新行到Room表中
                    //在AutoCAD命令行输出添加新行的提示信息
                    ed.WriteMessage("Computer表中的" + roomNo + "被添加到Room表。\n");
                }
                roomAdapter.Update(ds.Room); //提交更新到数据库                
            }
        }
    }
}
﻿using System.Collections.Generic;
using Autodesk.AutoCAD.ApplicationServices;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.EditorInput;
using Autodesk.AutoCAD.Runtime;
using DotNetARX;
namespace AnnoBlock
{
    public class AnnoBlock
    {
        [CommandMethod("AddNewSacle")]
        public void AddNewSacle()
        {
            Database db=HostApplicationServices.WorkingDatabase;
            //为当前图形添加一个新的注释比例，图纸单位为1，图形单位为22
            AnnotationScale scale= db.AddScale("Myscale 1:22", 1, 22);
            db.Cannoscale = scale;//设置图形的默认注释比例
            Application.ShowAlertDialog(scale.CollectionName);
        }

        [CommandMethod("AttachSacle")]
        public void AttachSacle()
        {
            Database db=HostApplicationServices.WorkingDatabase;
            Editor ed=db.GetEditor();
            //提示用户选择需要添加比例的对象
            PromptEntityOptions opt=new PromptEntityOptions("\n请选择需要添加比例的对象：");
            PromptEntityResult result=ed.GetEntity(opt);
            if (result.Status != PromptStatus.OK) return;
            ObjectId id=result.ObjectId;
            using (Transaction trans=db.TransactionManager.StartTransaction())
            {
                //为对象添加“1:1”、“1:2”、“Myscale 1:22”三种比例
                id.AttachScale("1:1", "1:2", "Myscale 1:22");
                trans.Commit();
            }
        }
    }
}
﻿using System.Collections.Generic;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.Internal;
namespace DotNetARX
{
    /// <summary>
    /// 注释缩放操作类
    /// </summary>
    public static class AnnotateTools
    {
        /// <summary>
        /// 为图形添加一个新的注释比例
        /// </summary>
        /// <param name="db">图形数据库对象</param>
        /// <param name="scaleName">缩放比例名</param>
        /// <param name="paperUnits">缩放比例的图纸单位</param>
        /// <param name="drawingUnits">缩放比例的图形单位</param>
        /// <returns>返回添加的注释比例</returns>
        public static AnnotationScale AddScale(this Database db, string scaleName, double paperUnits, double drawingUnits)
        {
            AnnotationScale scale=null;//声明一个注释比例对象
            //获取当前图形的对象比例管理器
            ObjectContextManager ocm=db.ObjectContextManager;
            //获取当前图形的注释比例列表，名为ACDB_ANNOTATIONSCALES
            ObjectContextCollection occ=ocm.GetContextCollection("ACDB_ANNOTATIONSCALES");
            //如果没有名为scaleName的注释比例
            if (!occ.HasContext(scaleName))
            {
                scale = new AnnotationScale();//新建一个注释比例对象
                scale.Name = scaleName;//注释比例名
                scale.PaperUnits = paperUnits;//注释比例的图纸单位
                scale.DrawingUnits = drawingUnits;//注释比例的图形单位
                occ.AddContext(scale);//将scaleName注释比例添加比例列表中                
            }
            return scale;//返回scaleName注释比例对象
        }

        /// <summary>
        /// 为实体添加指定的注释比例
        /// </summary>
        /// <param name="entId">实体的Id</param>
        /// <param name="scaleNames">注释比例名列表</param>
        public static void AttachScale(this ObjectId entId, params string[] scaleNames)
        {
            Database db=entId.Database;
            //获取entId指示的实体对象
            DBObject obj=entId.GetObject(OpenMode.ForRead);
            //如果实体对象支持注释缩放
            if (obj.Annotative != AnnotativeStates.NotApplicable)
            {
                //如果实体为块参照，则需要通过其所属的块表记录来设置可注释缩放
                if (obj is BlockReference)
                {
                    BlockReference br=obj as BlockReference;
                    //打开对应的块表记录
                    BlockTableRecord btr=(BlockTableRecord)br.BlockTableRecord.GetObject(OpenMode.ForWrite);
                    //设置块表记录为可注释缩放
                    btr.Annotative = AnnotativeStates.True;
                }
                //其它可注释缩放的实体，使其可注释缩放
                else if (obj.Annotative == AnnotativeStates.False)
                    obj.Annotative = AnnotativeStates.True;
                obj.UpgradeOpen();//切换实体为写的状态以添加注释比例
                //获取当前图形的对象比例管理器
                ObjectContextManager ocm=db.ObjectContextManager;
                //获取当前图形的注释比例列表，名为ACDB_ANNOTATIONSCALES
                ObjectContextCollection occ=ocm.GetContextCollection("ACDB_ANNOTATIONSCALES");
                //遍历需要设置的注释比例
                foreach (string scaleName in scaleNames)
                {
                    //获取名为scaleName的注释比例
                    ObjectContext scale=occ.GetContext(scaleName);
                    //若不存在scaleName的注释比例，则结束本次循环
                    if (scale == null) continue;
                    //为实体添加名为scaleName的注释比例
                    ObjectContexts.AddContext(obj, scale);
                }
                obj.DowngradeOpen();//为了安全将实体切换为读的状态
            }
        }

        /// <summary>
        /// 获取实体拥有的所有缩放比例
        /// </summary>
        /// <param name="entId">实体的Id</param>
        /// <returns>返回实体的缩放比例列表</returns>
        public static List<ObjectContext> GetAllScales(this ObjectId entId)
        {
            //声明一个列表对象，用于返回实体所拥有的所有的注释比例
            List<ObjectContext> scales=new List<ObjectContext>();
            DBObject obj=entId.GetObject(OpenMode.ForRead);
            if (obj.Annotative != AnnotativeStates.NotApplicable)
            {
                ObjectContextManager ocm=obj.Database.ObjectContextManager;
                ObjectContextCollection occ=ocm.GetContextCollection("ACDB_ANNOTATIONSCALES");
                //遍历注释比例列表
                foreach (ObjectContext oc in occ)
                {
                    //如果实体拥有此注释比例
                    if (ObjectContexts.HasContext(obj, oc))
                    {
                        scales.Add(oc);//将此注释比例添加到返回列表中
                    }
                }
            }
            return scales;//返回实体所拥有的所有的注释比例
        }

        /// <summary>
        /// 删除实体的缩放比例
        /// </summary>
        /// <param name="entId">实体的Id</param>
        /// <param name="scaleNames">缩放比例名列表</param>
        public static void RemoveScale(this ObjectId entId, params string[] scaleNames)
        {
            //获取entId指示的实体对象
            DBObject obj=entId.GetObject(OpenMode.ForRead);
            //如果实体对象支持注释缩放
            if (obj.Annotative != AnnotativeStates.NotApplicable)
            {
                //获得对象所有的注释比例
                List<ObjectContext> scales=entId.GetAllScales();
                obj.UpgradeOpen();//切换实体为写的状态
                //获取当前图形的对象比例管理器
                ObjectContextManager ocm=obj.Database.ObjectContextManager;
                //获取当前图形的注释比例列表，名为ACDB_ANNOTATIONSCALES
                ObjectContextCollection occ=ocm.GetContextCollection("ACDB_ANNOTATIONSCALES");
                //遍历需要设置的注释比例
                foreach (string scaleName in scaleNames)
                {
                    //获取名为scaleName的注释比例
                    ObjectContext scale=occ.GetContext(scaleName);
                    //若不存在scaleName的注释比例，则结束本次循环
                    if (scale == null) continue;
                    //删除名为scaleName的注释比例
                    ObjectContexts.RemoveContext(obj, scale);
                }
                obj.DowngradeOpen();//为了安全将实体切换为读的状态
            }
        }
    }
}
﻿#pragma checksum "..\..\..\App.xaml" "{406ea660-64cf-4c82-b6f0-42d48172a799}" "DEEC666471BB5FA4981C25163CF05B84"
//------------------------------------------------------------------------------
// <auto-generated>
//     此代码由工具生成。
//     运行时版本:4.0.30319.488
//
//     对此文件的更改可能会导致不正确的行为，并且如果
//     重新生成代码，这些更改将会丢失。
// </auto-generated>
//------------------------------------------------------------------------------

using System;
using System.Diagnostics;
using System.Windows;
using System.Windows.Automation;
using System.Windows.Controls;
using System.Windows.Controls.Primitives;
using System.Windows.Data;
using System.Windows.Documents;
using System.Windows.Ink;
using System.Windows.Input;
using System.Windows.Markup;
using System.Windows.Media;
using System.Windows.Media.Animation;
using System.Windows.Media.Effects;
using System.Windows.Media.Imaging;
using System.Windows.Media.Media3D;
using System.Windows.Media.TextFormatting;
using System.Windows.Navigation;
using System.Windows.Shapes;
using System.Windows.Shell;


namespace Wpfs {
    
    
    /// <summary>
    /// App
    /// </summary>
    [System.CodeDom.Compiler.GeneratedCodeAttribute("PresentationBuildTasks", "4.0.0.0")]
    public partial class App : System.Windows.Application {
        
        /// <summary>
        /// InitializeComponent
        /// </summary>
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        public void InitializeComponent() {
            
            #line 4 "..\..\..\App.xaml"
            this.StartupUri = new System.Uri("LayerWindow.xaml", System.UriKind.Relative);
            
            #line default
            #line hidden
        }
        
        /// <summary>
        /// Application Entry Point.
        /// </summary>
        [System.STAThreadAttribute()]
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        public static void Main() {
            Wpfs.App app = new Wpfs.App();
            app.InitializeComponent();
            app.Run();
        }
    }
}

﻿using System;
using System.Windows.Forms;
using Autodesk.AutoCAD.ApplicationServices;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.EditorInput;
using Autodesk.AutoCAD.Runtime;
using DotNetARX;
using AcadApp = Autodesk.AutoCAD.ApplicationServices.Application;
namespace AppAndDocEvent
{
    public class AppAndDocEvent : IExtensionApplication
    {
        ObjectId lineLayerId; // 直线层Id
        ObjectId circleLayerId; // 圆层Id
        ObjectId arcLayerId; // 弧线层Id
        ObjectId polylineLayerId; // 多段线层Id


        public void Initialize()
        {
            Document doc = AcadApp.DocumentManager.MdiActiveDocument;
            Database db = doc.Database;
            DocumentCollection docs = AcadApp.DocumentManager;
            using (Transaction trans = db.TransactionManager.StartTransaction())
            {
                lineLayerId = db.AddLayer("直线");//添加直线层
                circleLayerId = db.AddLayer("圆");//添加圆层
                arcLayerId = db.AddLayer("圆弧");//添加圆弧层
                polylineLayerId = db.AddLayer("多段线");//添加多段线层
                trans.Commit();
            }
            docs.DocumentLockModeChanged += new DocumentLockModeChangedEventHandler(docs_DocumentLockModeChanged);
            doc.BeginDocumentClose += delegate(object sender, DocumentBeginCloseEventArgs e)
            {
                //提示用户是否真的需要关闭文档
                DialogResult result = MessageBox.Show("文档将被关闭\n是否继续？", "关闭文档", MessageBoxButtons.YesNo);
                if (result == DialogResult.No)//如果不选择关闭文档，则放弃文档关闭事件
                    e.Veto();
            };
            AcadApp.SystemVariableChanged += (sender, e) =>
            {
                if (e.Name == "ORTHOMODE")//如果ORTHOMODE系统变量发生变化
                {
                    //获取ORTHOMODE系统变量的值
                    bool isOrtho = Convert.ToBoolean(AcadApp.GetSystemVariable(e.Name));
                    //根据ORTHOMODE系统变量的值，来判断是否启用正交模式
                    if (isOrtho) AcadApp.ShowAlertDialog("启用正交模式！");
                    else AcadApp.ShowAlertDialog("关闭正交模式！");
                }
            };
        }

        void docs_DocumentLockModeChanged(object sender, DocumentLockModeChangedEventArgs e)
        {
            Database db = HostApplicationServices.WorkingDatabase;
            switch (e.GlobalCommandName)//根据命令名执行不同的动作
            {
                case "ERASE"://如果是删除对象
                    e.Veto();//撤销删除动作
                    Editor ed = AcadApp.DocumentManager.MdiActiveDocument.Editor;
                    ed.WriteMessage("\nERASE命令已经被禁止，无法删除对象！");
                    break;
                case "LINE"://如果是绘制直线，则当前图层设为直线层
                    db.Clayer = lineLayerId;
                    break;
                case "CIRCLE"://如果是绘制圆，则当前图层设为圆层
                    db.Clayer = circleLayerId;
                    break;
                case "ARC"://如果是绘制圆弧，则当前图层设为圆弧层
                    db.Clayer = arcLayerId;
                    break;
                case "PLINE"://如果是绘制多段线，则当前图层设为多段线层
                    db.Clayer = polylineLayerId;
                    break;
            }
        }

        public void Terminate()
        {
            DocumentCollection docs = AcadApp.DocumentManager;
            //断开事件处理函数
            docs.DocumentLockModeChanged -= docs_DocumentLockModeChanged;
        }
    }
}
﻿using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.Geometry;

namespace DotNetARX
{
    /// <summary>
    /// 简化圆弧操作类
    /// </summary>
    public static class ArcTools
    {
        /// <summary>
        /// 根据圆心、起点和终点来创建圆弧
        /// </summary>
        /// <param name="arc">圆弧对象</param>
        /// <param name="startPoint">起点</param>
        /// <param name="centerPoint">圆心</param>
        /// <param name="endPoint">终点</param>
        public static void CreateArcSCE(this Arc arc, Point3d startPoint, Point3d centerPoint, Point3d endPoint)
        {
            arc.Center = centerPoint;
            arc.Radius = centerPoint.DistanceTo(startPoint);
            Vector2d startVector=new Vector2d(startPoint.X - centerPoint.X, startPoint.Y - centerPoint.Y);
            Vector2d endVector=new Vector2d(endPoint.X - centerPoint.X, endPoint.Y - centerPoint.Y);
            arc.StartAngle = startVector.Angle;
            arc.EndAngle = endVector.Angle;
        }

        /// <summary>
        /// 根据起点、圆心和圆弧角度创建圆弧
        /// </summary>
        /// <param name="arc">圆弧对象</param>
        /// <param name="startPoint">起点</param>
        /// <param name="centerPoint">圆心</param>
        /// <param name="angle">圆弧角度</param>
        public static void CreateArc(this Arc arc, Point3d startPoint, Point3d centerPoint, double angle)
        {
            arc.Center = centerPoint;
            arc.Radius = centerPoint.DistanceTo(startPoint);
            Vector2d startVector=new Vector2d(startPoint.X - centerPoint.X, startPoint.Y - centerPoint.Y);
            arc.StartAngle = startVector.Angle;
            arc.EndAngle = startVector.Angle + angle;
        }

        /// <summary>
        /// 三点法创建圆弧
        /// </summary>
        /// <param name="arc">圆弧对象</param>
        /// <param name="startPoint">起点</param>
        /// <param name="pointOnArc">圆弧上的点</param>
        /// <param name="endPoint">终点</param>
        public static void CreateArc(this Arc arc, Point3d startPoint, Point3d pointOnArc, Point3d endPoint)
        {
            //创建一个几何类的圆弧对象
            CircularArc3d geArc=new CircularArc3d(startPoint, pointOnArc, endPoint);
            //将几何类圆弧对象的圆心和半径赋值给圆弧
            Point3d centerPoint=geArc.Center;
            arc.Center = centerPoint;
            arc.Radius = geArc.Radius;
            //计算起始和终止角度
            arc.StartAngle = startPoint.AngleFromXAxis(centerPoint);
            arc.EndAngle = endPoint.AngleFromXAxis(centerPoint);
        }
    }
}
﻿using System.Reflection;
using System.Runtime.CompilerServices;
using System.Runtime.InteropServices;

// 有关程序集的常规信息通过以下
// 特性集控制。更改这些特性值可修改
// 与程序集关联的信息。
[assembly: AssemblyTitle("DotNetARX")]
[assembly: AssemblyDescription("")]
[assembly: AssemblyConfiguration("")]
[assembly: AssemblyCompany("")]
[assembly: AssemblyProduct("DotNetARX")]
[assembly: AssemblyCopyright("Copyright ©  2011")]
[assembly: AssemblyTrademark("")]
[assembly: AssemblyCulture("")]

// 将 ComVisible 设置为 false 使此程序集中的类型
// 对 COM 组件不可见。如果需要从 COM 访问此程序集中的类型，
// 则将该类型上的 ComVisible 特性设置为 true。
[assembly: ComVisible(false)]

// 如果此项目向 COM 公开，则下列 GUID 用于类型库的 ID
[assembly: Guid("e8a53985-fd46-4f64-9535-289dd15b781b")]

// 程序集的版本信息由下面四个值组成:
//
//      主版本
//      次版本 
//      内部版本号
//      修订号
//
// 可以指定所有这些值，也可以使用“内部版本号”和“修订号”的默认值，
// 方法是按如下所示使用“*”:
// [assembly: AssemblyVersion("1.0.*")]
[assembly: AssemblyVersion("1.0.0.0")]
[assembly: AssemblyFileVersion("1.0.0.0")]
﻿using System;
using System.Collections.Generic;
using Autodesk.AutoCAD.ApplicationServices;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.EditorInput;
using Autodesk.AutoCAD.Geometry;
using Autodesk.AutoCAD.Runtime;
using DotNetARX;
namespace AttBlock
{
    public class AttBlock
    {
        public ObjectId MakeDoor()
        {
            ObjectId blockId;
            Database db=HostApplicationServices.WorkingDatabase;
            using (Transaction trans=db.TransactionManager.StartTransaction())
            {
                //设置门框的左边线
                Point3d pt1=Point3d.Origin;
                Point3d pt2=new Point3d(0, 1.0, 0);
                Line leftLine=new Line(pt1, pt2);
                //门框的下边线
                Line bottomLine=new Line(pt1, pt1.PolarPoint(0, 0.05));
                //设置表示门面的圆弧
                Arc arc=new Arc();
                arc.CreateArc(pt1.PolarPoint(0, 1), pt1, Math.PI / 2);
                //设置门框的右边线
                Line rightLine=new Line(bottomLine.EndPoint, leftLine.EndPoint.PolarPoint(0, 0.05));
                Point3dCollection pts=new Point3dCollection();
                rightLine.IntersectWith(arc, Intersect.OnBothOperands, pts, 0, 0);
                if (pts.Count == 0) return ObjectId.Null;
                rightLine.EndPoint = pts[0];
                //将表示门的直线和圆弧添加到名为DOOR的块表记录
                blockId = db.AddBlockTableRecord("DOOR", leftLine, bottomLine, rightLine, arc);
                trans.Commit();
            }
            return blockId;
        }

        [CommandMethod("Door")]
        public void AddDoor()
        {
            Database db=HostApplicationServices.WorkingDatabase;
            ObjectId blockId=MakeDoor();//创建表示门的DOOR块定义
            using (Transaction trans=db.TransactionManager.StartTransaction())
            {
                //表示门符号的属性定义
                AttributeDefinition attSYM=new AttributeDefinition(Point3d.Origin, "1", "SYM", "输入门的符号", ObjectId.Null);
                //设置属性定义的通用样式
                SetStyleForAtt(attSYM, false);
                //设置属性的对齐点
                attSYM.AlignmentPoint = new Point3d(0.32, 0.28, 0.0);
                //表示门宽度的属性定义
                AttributeDefinition attWidth=new AttributeDefinition(Point3d.Origin, "1m", "WIDTH", "输入门的宽度", ObjectId.Null);
                SetStyleForAtt(attWidth, true);
                //表示门高度的属性定义
                AttributeDefinition attHeight=new AttributeDefinition(Point3d.Origin, "2m", "HEIGHT", "输入门的高度", ObjectId.Null);
                SetStyleForAtt(attHeight, true);
                //表示门宽式样的属性定义
                AttributeDefinition attStyle=new AttributeDefinition(Point3d.Origin, "TWO PANEL", "STYLE", "输入门的式样", ObjectId.Null);
                SetStyleForAtt(attStyle, true);
                //表示门参考图集编号的属性定义
                AttributeDefinition attRef=new AttributeDefinition(Point3d.Origin, "TS 3010", "REF", "输入门的参考图集编号", ObjectId.Null);
                SetStyleForAtt(attRef, true);
                //表示生产产家的属性定义
                AttributeDefinition attManufacturer=new AttributeDefinition(Point3d.Origin, "TRU STYLE", "MANUFACTURER", "输入生产产家", ObjectId.Null);
                SetStyleForAtt(attManufacturer, true);
                //表示门单价的属性定义
                AttributeDefinition attCost=new AttributeDefinition(Point3d.Origin, "189.00", "COST", "输入门的单价", ObjectId.Null);
                SetStyleForAtt(attCost, true);
                //为DOOR块添加上面定义的属性
                blockId.AddAttsToBlock(attSYM, attWidth, attHeight, attStyle, attRef, attManufacturer, attCost);
                trans.Commit();
            }
        }

        private void SetStyleForAtt(AttributeDefinition att, bool invisible)
        {
            att.Height = 0.15;//属性文字的高度
            //属性文字的水平对齐方式为居中
            att.HorizontalMode = TextHorizontalMode.TextCenter;
            //属性文字的垂直对齐方式为居中
            att.VerticalMode = TextVerticalMode.TextVerticalMid;
            att.Invisible = invisible; //属性文字的可见性
        }

        [CommandMethod("InsertDoor")]
        public void InsertDoor()
        {
            Database db=HostApplicationServices.WorkingDatabase;
            ObjectId spaceId=db.CurrentSpaceId;//获取当前空间（模型空间或图纸空间）
            using (Transaction trans=db.TransactionManager.StartTransaction())
            {
                //表示属性的字典对象
                Dictionary<string,string> atts=new Dictionary<string, string>();
                atts.Add("SYM", "1");//门的符号
                atts.Add("WIDTH", "0.90m");//门的宽度
                atts.Add("HEIGHT", "2.2m");//门的高度
                atts.Add("COST", "200.0");//门的单价
                //在当前空间加入块参照
                spaceId.InsertBlockReference("0", "DOOR", Point3d.Origin, new Scale3d(2), 0, atts);
                trans.Commit();
            }
        }
        [CommandMethod("UpdateDoor")]
        public void UpdateDoor()
        {
            Database db=HostApplicationServices.WorkingDatabase;
            Editor ed=Application.DocumentManager.MdiActiveDocument.Editor;
            //提示用户选择要更新的块
            PromptEntityOptions opt=new PromptEntityOptions("请选择一个块参数");
            opt.SetRejectMessage("你选择的不是块");
            opt.AddAllowedClass(typeof(BlockReference), true);
            PromptEntityResult result=ed.GetEntity(opt);
            if (result.Status != PromptStatus.OK) return;
            using (Transaction trans=db.TransactionManager.StartTransaction())
            {
                //要更新的门属性
                Dictionary<string,string> atts=new Dictionary<string, string>();
                atts.Add("SYM", "2");
                atts.Add("COST", "300");
                //更新门的属性
                result.ObjectId.UpdateAttributesInBlock(atts);
                trans.Commit();
            }
        }
    }
}
﻿using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using Autodesk.AutoCAD.ApplicationServices;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.EditorInput;
using Autodesk.AutoCAD.Geometry;
using Autodesk.AutoCAD.Runtime;
using DotNetARX;
namespace AutoNumBlock
{
    public class AutoNumBlock : IExtensionApplication
    {
        public static NumManager manager;//自动编号管理类
        //设置自动编号的格式
        [CommandMethod("NumOption")]
        public void SetNumOption()
        {
            Editor ed=Application.DocumentManager.MdiActiveDocument.Editor;
            //存储原来的前后缀，用于判断后面的操作是否对其进行了改变
            string oldPrefix=manager.Prefix;
            string oldPostfix=manager.Suffix;
            //定义一个整型交互类，提示用户对编号的格式进行设置
            PromptIntegerOptions opt=new PromptIntegerOptions("\n请输入编号基数或[前缀(P)/后缀(S)/增量(I)/编号方向(D)]<P>");
            //为整型交互类添加关键字
            opt.Keywords.Add("P");
            opt.Keywords.Add("S");
            opt.Keywords.Add("I");
            opt.Keywords.Add("D");
            opt.Keywords.Default = "P";//设置默认的关键字
            opt.AppendKeywordsToMessage = false;// 不将关键字列表添加到提示中
            //提示用户输入表示自动编号的基数
            PromptIntegerResult result=ed.GetInteger(opt);
            //如果用户输入整数或关键字，则一直循环进行编号的格式设置
            while (result.Status == PromptStatus.OK || result.Status == PromptStatus.Keyword)
            {
                //如果用户输入的是关键字集合对象中的关键字
                if (result.Status == PromptStatus.Keyword)
                {
                    switch (result.StringResult)
                    {
                        case "P"://编号的前缀
                            //提示用户输入编号的前缀
                            PromptResult prResult= ed.GetString("请输入前缀");
                            if (prResult.Status != PromptStatus.OK) return;
                            //设置编号的前缀
                            manager.Prefix = prResult.StringResult;
                            break;
                        case "S"://编号的后缀
                            PromptResult poResult= ed.GetString("请输入后缀");
                            if (poResult.Status != PromptStatus.OK) return;
                            manager.Suffix = poResult.StringResult;
                            break;
                        case "I":
                            PromptIntegerResult iResult= ed.GetInteger("编号增量");
                            if (iResult.Status != PromptStatus.OK) return;
                            manager.Increment = iResult.Value;
                            break;
                        case "D"://编号的增量
                            //定义一个关键字交互类，提示用户对编号的方向进行设置
                            PromptKeywordOptions keyOpt=new PromptKeywordOptions("编号方向[行(R)/列(C)]<R>");
                            keyOpt.Keywords.Add("R", "R", "R", false, true);
                            keyOpt.Keywords.Add("C", "C", "C", false, true);
                            keyOpt.Keywords.Default = "R";
                            //提示用户输入关键字以确定是按行还是列进行编号
                            PromptResult keyResult= ed.GetKeywords(keyOpt);
                            if (keyResult.Status != PromptStatus.OK) return;
                            //如果用户输入R关键字，则按行编号，否则按列编号
                            manager.IsRowDirection = keyResult.StringResult == "R" ? true : false;
                            break;
                    }
                }
                else//如果用户输入的整数值
                {
                    manager.BaseNum = result.Value;//设置编号的基数
                }
                result = ed.GetInteger(opt);//提示用户输入新的整数
            }
            //编号的前缀或后缀已经被用户设置成新的值，应更新图形中的编号
            if (manager.Prefix != oldPrefix || manager.Suffix != oldPostfix)
            {
                if (manager.Numbers.Count > 0)//如果图形中存在编号
                {
                    UpdateNumbers();
                }
            }
        }

        public void UpdateNumbers()
        {
            Database db=HostApplicationServices.WorkingDatabase;
            using (Transaction trans=db.TransactionManager.StartTransaction())
            {
                //遍历图形中的编号
                foreach (var dup in manager.Numbers)
                {
                    //定义一个字典，用于编号所表示的块属性及属性值
                    Dictionary<string,string> atts=new Dictionary<string, string>();
                    //对编号进行更新
                    atts.Add(manager.AttName, manager.Prefix + dup.Key + manager.Suffix);
                    //更新编号所表示的块
                    dup.Value.UpdateAttributesInBlock(atts);
                }
                trans.Commit();

            }
        }

        //在指定位置进行自动编号
        [CommandMethod("NumsAtPoints")]
        public void NumsAtPoints()
        {
            Document doc=Application.DocumentManager.MdiActiveDocument;
            using (Transaction trans=doc.Database.TransactionManager.StartTransaction())
            {
                bool isOver=false;//是否结束编号操作
                while (!isOver)//如果没有结束，则一直编号
                {
                    //提示用户输入需要在编号的位置
                    PromptPointOptions opt=new PromptPointOptions("\n请输入点");
                    PromptPointResult res=doc.Editor.GetPoint(opt);
                    //如果用户按Esc键终止操作，则结束循环
                    if (res.Status != PromptStatus.OK) isOver = true;
                    else insertNumBlock(res.Value);//在指定点插入表示编号的块
                }
                trans.Commit();
            }
        }

        //根据选择的圆进行自动编号
        [CommandMethod("NumsInCircles")]
        public void NumsInCircles()
        {
            Database db=HostApplicationServices.WorkingDatabase;
            using (Transaction trans=db.TransactionManager.StartTransaction())
            {
                var cirs=db.GetSelection<Circle>();//用户选择圆
                if (cirs.Count == 0) return;//若未选中圆，则返回
                //如果只选中一个圆，则在该圆的圆心位置插入表示编号的块
                if (cirs.Count == 1) insertNumBlock(cirs.First().Center);
                //获取所选择的最大圆的半径
                double maxRadius=cirs.Max(c => c.Radius);
                //按行自动编号
                if (manager.IsRowDirection)
                {
                    //获取圆心的最小与最大Y值
                    double bottomY=cirs.Min(c => c.Center.Y);
                    double topY=cirs.Max(c => c.Center.Y);
                    //根据最大圆的半径及圆之间的最大竖直间距，计算可以将圆分成几行
                    int row=Convert.ToInt32(Math.Ceiling((topY - bottomY) / maxRadius));
                    for (int i = 0; i < row; i++)
                    {
                        //使用LINQ语句筛选在当前行内的圆
                        var cirPos=from c in cirs
                                   where c.Center.Y > topY - (2 * i + 1) * maxRadius
                                           && c.Center.Y <= topY + (1 - 2 * i) * maxRadius
                                   orderby c.Center.X //根据圆心的X值进行排序
                                   select c.Center;   //返回符合条件的圆心
                        //遍历当前行内的圆
                        foreach (var pos in cirPos)
                        {
                            insertNumBlock(pos);//在圆心位置插入表示编号的块
                        }
                    }
                }
                else //按列自动编号
                {
                    //获取圆心的最小与最大X值
                    double leftX=cirs.Min(c => c.Center.X);
                    double rightY=cirs.Max(c => c.Center.X);
                    //根据最大圆的半径及圆之间的最大水平间距，计算可以将圆分成几列
                    int col=Convert.ToInt32(Math.Ceiling((rightY - leftX) / maxRadius));
                    for (int i = 0; i < col; i++)
                    {
                        //使用LINQ语句筛选在当前列内的圆
                        var cirPos=from c in cirs
                                   where c.Center.X > leftX + (2 * i - 1) * maxRadius
                                           && c.Center.X <= leftX + (2 * i + 1) * maxRadius
                                   orderby c.Center.Y descending //根据圆心的Y值进行倒序排列
                                   select c.Center;   //返回符合条件的圆心
                        //遍历当前列内的圆
                        foreach (var pos in cirPos)
                        {
                            insertNumBlock(pos);//在圆心位置插入表示编号的块
                        }
                    }
                }
                trans.Commit();
            }
        }

        //在指定位置插入表示编号的块
        private void insertNumBlock(Point3d pt)
        {
            Database db=HostApplicationServices.WorkingDatabase;
            ObjectId model=db.GetModelSpaceId();//模型空间的Id
            //获取当前可用的编号，如果最大编号小于基数值，则表示无自动编号，应从基数值开始编号；
            //否则，可用编号应设定为当前最大编号+自动编号增量
            int num=manager.MaxNum < manager.BaseNum ? manager.BaseNum : manager.MaxNum + manager.Increment;
            manager.MaxNum = num;//最大编号已改变，应更新
            //定义一个字典，用于编号所表示的块属性及属性值
            Dictionary<string,string> atts=new Dictionary<string, string>();
            //设置含前后缀的编号值
            atts.Add(manager.AttName, manager.Prefix + num + manager.Suffix);
            //在模型空间插入新编号块
            ObjectId brId=model.InsertBlockReference(manager.LayerName, manager.BlockName, pt, new Scale3d(), 0, atts);
            manager.Numbers.Add(num, brId);//在编号管理器中添加新的编号值及对应的块参照Id
        }

        //将编号及其坐标输出到文本文件
        [CommandMethod("ExportToFile")]
        public void ExportToFile()
        {
            Database db=HostApplicationServices.WorkingDatabase;
            //设置文件名            
            string fileName=Tools.GetCurrentPath() + "\\Points.txt";
            using (Transaction trans=db.TransactionManager.StartTransaction())
            {
                //将点的坐标值遍历进文本文件，若文件不存在则先会创建文件
                foreach (var num in manager.Numbers)
                {
                    BlockReference br=(BlockReference)trans.GetObject(num.Value, OpenMode.ForRead);
                    string numInfo=manager.Prefix + num.Key + manager.Suffix + "," + br.Position.X + "," + br.Position.Y + "," + br.Position.Z;
                    File.AppendAllText(fileName, numInfo + Environment.NewLine);
                }
                trans.Commit();
            }
        }
        public void Initialize()
        {
            //初始化编号管理器，设置编号使用的块名与块属性
            manager = new NumManager { BlockName = "BUBBLE", AttName = "NUMBER" };
        }
        public void Terminate()
        {

        }
    }
}
﻿#pragma checksum "..\..\..\BindingPanel.xaml" "{406ea660-64cf-4c82-b6f0-42d48172a799}" "63ADDAA328379AF9019E2BF11B5F2CE6"
//------------------------------------------------------------------------------
// <auto-generated>
//     此代码由工具生成。
//     运行时版本:4.0.30319.225
//
//     对此文件的更改可能会导致不正确的行为，并且如果
//     重新生成代码，这些更改将会丢失。
// </auto-generated>
//------------------------------------------------------------------------------

using System;
using System.Diagnostics;
using System.Windows;
using System.Windows.Automation;
using System.Windows.Controls;
using System.Windows.Controls.Primitives;
using System.Windows.Data;
using System.Windows.Documents;
using System.Windows.Forms.Integration;
using System.Windows.Ink;
using System.Windows.Input;
using System.Windows.Markup;
using System.Windows.Media;
using System.Windows.Media.Animation;
using System.Windows.Media.Effects;
using System.Windows.Media.Imaging;
using System.Windows.Media.Media3D;
using System.Windows.Media.TextFormatting;
using System.Windows.Navigation;
using System.Windows.Shapes;
using System.Windows.Shell;


namespace Wpfs {
    
    
    /// <summary>
    /// BindingPanel
    /// </summary>
    [System.CodeDom.Compiler.GeneratedCodeAttribute("PresentationBuildTasks", "4.0.0.0")]
    public partial class BindingPanel : System.Windows.Controls.UserControl, System.Windows.Markup.IComponentConnector {
        
        
        #line 10 "..\..\..\BindingPanel.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.ComboBox comboBoxBlocks;
        
        #line default
        #line hidden
        
        
        #line 20 "..\..\..\BindingPanel.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.ListView listViewBlocks;
        
        #line default
        #line hidden
        
        private bool _contentLoaded;
        
        /// <summary>
        /// InitializeComponent
        /// </summary>
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        public void InitializeComponent() {
            if (_contentLoaded) {
                return;
            }
            _contentLoaded = true;
            System.Uri resourceLocater = new System.Uri("/Wpfs;component/bindingpanel.xaml", System.UriKind.Relative);
            
            #line 1 "..\..\..\BindingPanel.xaml"
            System.Windows.Application.LoadComponent(this, resourceLocater);
            
            #line default
            #line hidden
        }
        
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [System.ComponentModel.EditorBrowsableAttribute(System.ComponentModel.EditorBrowsableState.Never)]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Design", "CA1033:InterfaceMethodsShouldBeCallableByChildTypes")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Maintainability", "CA1502:AvoidExcessiveComplexity")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1800:DoNotCastUnnecessarily")]
        void System.Windows.Markup.IComponentConnector.Connect(int connectionId, object target) {
            switch (connectionId)
            {
            case 1:
            
            #line 8 "..\..\..\BindingPanel.xaml"
            ((System.Windows.Controls.Grid)(target)).Loaded += new System.Windows.RoutedEventHandler(this.Grid_Loaded);
            
            #line default
            #line hidden
            return;
            case 2:
            this.comboBoxBlocks = ((System.Windows.Controls.ComboBox)(target));
            
            #line 10 "..\..\..\BindingPanel.xaml"
            this.comboBoxBlocks.DropDownClosed += new System.EventHandler(this.comboBoxBlocks_DropDownClosed);
            
            #line default
            #line hidden
            return;
            case 3:
            this.listViewBlocks = ((System.Windows.Controls.ListView)(target));
            return;
            }
            this._contentLoaded = true;
        }
    }
}

﻿#pragma checksum "..\..\..\BindingPanel.xaml" "{406ea660-64cf-4c82-b6f0-42d48172a799}" "63ADDAA328379AF9019E2BF11B5F2CE6"
//------------------------------------------------------------------------------
// <auto-generated>
//     此代码由工具生成。
//     运行时版本:4.0.30319.225
//
//     对此文件的更改可能会导致不正确的行为，并且如果
//     重新生成代码，这些更改将会丢失。
// </auto-generated>
//------------------------------------------------------------------------------

using Autodesk.AutoCAD.ApplicationServices;
using System;
using System.Diagnostics;
using System.Windows;
using System.Windows.Automation;
using System.Windows.Controls;
using System.Windows.Controls.Primitives;
using System.Windows.Data;
using System.Windows.Documents;
using System.Windows.Forms.Integration;
using System.Windows.Ink;
using System.Windows.Input;
using System.Windows.Markup;
using System.Windows.Media;
using System.Windows.Media.Animation;
using System.Windows.Media.Effects;
using System.Windows.Media.Imaging;
using System.Windows.Media.Media3D;
using System.Windows.Media.TextFormatting;
using System.Windows.Navigation;
using System.Windows.Shapes;
using System.Windows.Shell;


namespace Wpfs {
    
    
    /// <summary>
    /// BindingPanel
    /// </summary>
    [System.CodeDom.Compiler.GeneratedCodeAttribute("PresentationBuildTasks", "4.0.0.0")]
    public partial class BindingPanel : System.Windows.Controls.UserControl, System.Windows.Markup.IComponentConnector {
        
        
        #line 10 "..\..\..\BindingPanel.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.ComboBox comboBoxBlocks;
        
        #line default
        #line hidden
        
        
        #line 20 "..\..\..\BindingPanel.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.ListView listViewBlocks;
        
        #line default
        #line hidden
        
        private bool _contentLoaded;
        
        /// <summary>
        /// InitializeComponent
        /// </summary>
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        public void InitializeComponent() {
            if (_contentLoaded) {
                return;
            }
            _contentLoaded = true;
            System.Uri resourceLocater = new System.Uri("/Wpfs;component/bindingpanel.xaml", System.UriKind.Relative);
            
            #line 1 "..\..\..\BindingPanel.xaml"
            System.Windows.Application.LoadComponent(this, resourceLocater);
            
            #line default
            #line hidden
        }
        
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [System.ComponentModel.EditorBrowsableAttribute(System.ComponentModel.EditorBrowsableState.Never)]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Design", "CA1033:InterfaceMethodsShouldBeCallableByChildTypes")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Maintainability", "CA1502:AvoidExcessiveComplexity")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1800:DoNotCastUnnecessarily")]
        void System.Windows.Markup.IComponentConnector.Connect(int connectionId, object target) {
            switch (connectionId)
            {
            case 1:
            
            #line 8 "..\..\..\BindingPanel.xaml"
            ((System.Windows.Controls.Grid)(target)).Loaded += new System.Windows.RoutedEventHandler(this.Grid_Loaded);
            
            #line default
            #line hidden
            return;
            case 2:
            this.comboBoxBlocks = ((System.Windows.Controls.ComboBox)(target));
            
            #line 10 "..\..\..\BindingPanel.xaml"
            this.comboBoxBlocks.DropDownClosed += new System.EventHandler(this.comboBoxBlocks_DropDownClosed);
            
            #line default
            #line hidden
            return;
            case 3:
            this.listViewBlocks = ((System.Windows.Controls.ListView)(target));
            return;
            }
            this._contentLoaded = true;
        }
    }
}

﻿using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Windows;
using System.Windows.Controls;
using System.Windows.Data;
using System.Windows.Documents;
using System.Windows.Input;
using System.Windows.Media;
using System.Windows.Media.Imaging;
using System.Windows.Navigation;
using System.Windows.Shapes;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.ApplicationServices;
using AcadApp = Autodesk.AutoCAD.ApplicationServices.Application;
using DotNetARX;
using System.Collections.ObjectModel;
using System.ComponentModel;
using Autodesk.AutoCAD.EditorInput;

namespace Wpfs
{
    /// <summary>
    /// WPFBinding.xaml 的交互逻辑
    /// </summary>
    public partial class BindingPanel : UserControl
    {
        ObservableCollection<Block> blocks=new ObservableCollection<Block>();
        public BindingPanel()
        {
            InitializeComponent();
        }
        private void Grid_Loaded(object sender, RoutedEventArgs e)
        {
            GetBlocks();
        }
        private void comboBoxBlocks_DropDownClosed(object sender, EventArgs e)
        {
            GetBlocks();
        }
        void GetBlocks()
        {
            Document doc=AcadApp.DocumentManager.MdiActiveDocument;
            Database db=doc.Database;
            Editor ed=doc.Editor;
            //根据组合框中选中的项设置块名
            string blockName=this.comboBoxBlocks.SelectedIndex == 0 ? "Door" : "Window";
            using (DocumentLock loc=doc.LockDocument())
            using (Transaction trans=db.TransactionManager.StartTransaction())
            {
                //查找当前文档中块名以blockName开头的块参照
                var blocks=from block in db.GetEntsInModelSpace<BlockReference>()
                           //条件：块参照的块名以blockName开头
                           where block.GetBlockName().StartsWith(blockName)
                           //设置一个中间变量，取值为块参照的SYM.属性（即门或窗的符号）
                           let SYM = block.ObjectId.GetAttributeInBlockReference("SYM.")
                           //根据符号对符合条件的块参照进行分组
                           group block by SYM into g
                           orderby g.Key //根据符号对组进行升序排序
                           select new    //创建一个新的匿名类型作为结果
                           {
                               Symbol = g.Key,
                               Width = g.First().ObjectId.GetAttributeInBlockReference("WIDTH"),
                               Height = g.First().ObjectId.GetAttributeInBlockReference("HEIGHT"),
                               Count = g.Count()
                           };
                //设置listViewBlocks的数据源以显示块的分组统计信息
                this.listViewBlocks.ItemsSource = blocks.ToList();
                trans.Commit();
            }
        }
    }
}
﻿using System.Drawing;
using System.IO;
using Autodesk.AutoCAD.ApplicationServices;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.EditorInput;
using Autodesk.AutoCAD.Internal;
using Autodesk.AutoCAD.Runtime;
using DotNetARX;
namespace BlockPreview
{
    public class BlockPreview
    {
        [CommandMethod("GenerateBlockPreview")]
        public void GenerateBlockPreview()
        {
            Database db = HostApplicationServices.WorkingDatabase;
            Editor ed = Application.DocumentManager.MdiActiveDocument.Editor;
            // 提示用户选择文件
            PromptFileNameResult result = ed.GetFileNameForOpen("请选择需要预览的文件");
            if (result.Status != PromptStatus.OK) return; // 如果未选择，则返回
            string filename = result.StringResult; // 获取带有路径的文件名
            // 在C盘根目录下创建一个临时文件夹，用来存放文件中的块预览图标
            string path = "C:\\Temp";
            if (!Directory.Exists(path)) Directory.CreateDirectory(path);
            using (Transaction trans = db.TransactionManager.StartTransaction())
            {
                // 导入外部文件中的块
                db.ImportBlocksFromDwg(filename);
                //打开块表
                BlockTable bt = (BlockTable)trans.GetObject(db.BlockTableId, OpenMode.ForRead);
                // 循环遍历块表中的块表记录
                foreach (ObjectId blockRecordId in bt)
                {
                    // 打开块表记录对象
                    BlockTableRecord btr = (BlockTableRecord)trans.GetObject(blockRecordId, OpenMode.ForRead);
                    // 如果是匿名块、布局块及没有预览图形的块，则返回
                    if (btr.IsAnonymous || btr.IsLayout || !btr.HasPreviewIcon) continue;
                    // 获取块预览图案（适用于AutoCAD 2008及以下版本）
                    Bitmap preview = BlockThumbnailHelper.GetBlockThumbanail(btr.ObjectId);
                    // Bitmap preview = btr.PreviewIcon; // 适用于AutoCAD 2009及以上版本
                    preview.Save(path + "\\" + btr.Name + ".bmp"); // 保存块预览图案
                }
                trans.Commit();
            }
        }
    }
}
﻿using System;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.Geometry;
using Autodesk.AutoCAD.Runtime;
using DotNetARX;
namespace Blocks
{
    public class Blocks
    {
        [CommandMethod("Door")]
        public void MakeDoor()
        {
            Database db=HostApplicationServices.WorkingDatabase;
            using (Transaction trans=db.TransactionManager.StartTransaction())
            {
                //设置门框的左边线
                Point3d pt1=Point3d.Origin;
                Point3d pt2=new Point3d(0, 1.0, 0);
                Line leftLine=new Line(pt1, pt2);
                //门框的下边线
                Line bottomLine=new Line(pt1, pt1.PolarPoint(0, 0.05));
                //设置表示门面的圆弧
                Arc arc=new Arc();
                arc.CreateArc(pt1.PolarPoint(0, 1), pt1, Math.PI / 2);
                //设置门框的右边线
                Line rightLine=new Line(bottomLine.EndPoint, leftLine.EndPoint.PolarPoint(0, 0.05));
                Point3dCollection pts=new Point3dCollection();
                rightLine.IntersectWith(arc, Intersect.OnBothOperands, pts, 0, 0);
                if (pts.Count == 0) return;
                rightLine.EndPoint = pts[0];
                //将表示门的直线和圆弧添加到名为DOOR的块表记录
                db.AddBlockTableRecord("DOOR", leftLine, bottomLine, rightLine, arc);
                trans.Commit();
            }
        }

        [CommandMethod("InsertDoor")]
        public void InsertDoor()
        {
            Database db=HostApplicationServices.WorkingDatabase;
            ObjectId spaceId=db.CurrentSpaceId;//获取当前空间（模型空间或图纸空间）
            using (Transaction trans=db.TransactionManager.StartTransaction())
            {
                //在当前空间加入块参照
                spaceId.InsertBlockReference("0", "DOOR", Point3d.Origin, new Scale3d(2), 0);
                trans.Commit();
            }
        }
    }
}
﻿using System;
using System.Collections.Generic;
using System.Linq;
using Autodesk.AutoCAD.ApplicationServices;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.EditorInput;
using Autodesk.AutoCAD.Geometry;
using Autodesk.AutoCAD.Internal;

namespace DotNetARX
{
    /// <summary>
    /// 动态块的动态属性类型
    /// </summary>
    public enum DynBlockPropTypeCode
    {
        /// <summary>
        /// 字符串
        /// </summary>
        String = 1,
        /// <summary>
        /// 实数
        /// </summary>
        Real = 40,
        /// <summary>
        /// 短整型
        /// </summary>
        Short = 70,
        /// <summary>
        /// 长整型
        /// </summary>
        Long = 90
    }

    /// <summary>
    /// 块操作类
    /// </summary>
    public static partial class BlockTools
    {
        /// <summary>
        /// 创建一个块表记录并添加到数据库中
        /// </summary>
        /// <param name="db">数据库对象</param>
        /// <param name="blockName">块名</param>
        /// <param name="ents">加入块中的实体列表</param>
        /// <returns>返回块表记录的Id</returns>
        public static ObjectId AddBlockTableRecord(this Database db, string blockName, List<Entity> ents)
        {
            //打开块表
            BlockTable bt = (BlockTable)db.BlockTableId.GetObject(OpenMode.ForRead);
            if (!bt.Has(blockName)) //判断是否存在名为blockName的块
            {
                //创建一个BlockTableRecord类的对象，表示所要创建的块
                BlockTableRecord btr = new BlockTableRecord();
                btr.Name = blockName;//设置块名                
                //将列表中的实体加入到新建的BlockTableRecord对象
                ents.ForEach(ent => btr.AppendEntity(ent));
                bt.UpgradeOpen();//切换块表为写的状态
                bt.Add(btr);//在块表中加入blockName块
                db.TransactionManager.AddNewlyCreatedDBObject(btr, true);//通知事务处理
                bt.DowngradeOpen();//为了安全，将块表状态改为读
            }
            return bt[blockName];//返回块表记录的Id
        }

        /// <summary>
        /// 创建一个块表记录并添加到数据库中
        /// </summary>
        /// <param name="db">数据库对象</param>
        /// <param name="blockName">块名</param>
        /// <param name="ents">加入块中的实体列表</param>
        /// <returns>返回块表记录的Id</returns>
        public static ObjectId AddBlockTableRecord(this Database db, string blockName, params Entity[] ents)
        {
            return AddBlockTableRecord(db, blockName, ents.ToList());
        }

        /// <summary>
        /// 在AutoCAD图形中插入块参照
        /// </summary>
        /// <param name="spaceId">块参照要加入的模型空间或图纸空间的Id</param>
        /// <param name="layer">块参照要加入的图层名</param>
        /// <param name="blockName">块参照所属的块名</param>
        /// <param name="position">插入点</param>
        /// <param name="scale">缩放比例</param>
        /// <param name="rotateAngle">旋转角度</param>
        /// <returns>返回块参照的Id</returns>
        public static ObjectId InsertBlockReference(this ObjectId spaceId, string layer, string blockName, Point3d position, Scale3d scale, double rotateAngle)
        {
            ObjectId blockRefId;//存储要插入的块参照的Id
            Database db = spaceId.Database;//获取数据库对象
            //以读的方式打开块表
            BlockTable bt = (BlockTable)db.BlockTableId.GetObject(OpenMode.ForRead);
            //如果没有blockName表示的块，则程序返回
            if (!bt.Has(blockName)) return ObjectId.Null;
            //以写的方式打开空间（模型空间或图纸空间）
            BlockTableRecord space = (BlockTableRecord)spaceId.GetObject(OpenMode.ForWrite);
            //创建一个块参照并设置插入点
            BlockReference br = new BlockReference(position, bt[blockName]);
            br.ScaleFactors = scale;//设置块参照的缩放比例
            br.Layer = layer;//设置块参照的层名
            br.Rotation = rotateAngle;//设置块参照的旋转角度
            ObjectId btrId = bt[blockName];//获取块表记录的Id
            //打开块表记录
            BlockTableRecord record = (BlockTableRecord)btrId.GetObject(OpenMode.ForRead);
            //添加可缩放性支持
            if (record.Annotative == AnnotativeStates.True)
            {
                ObjectContextCollection contextCollection = db.ObjectContextManager.GetContextCollection("ACDB_ANNOTATIONSCALES");
                ObjectContexts.AddContext(br, contextCollection.GetContext("1:1"));
            }
            blockRefId = space.AppendEntity(br);//在空间中加入创建的块参照
            db.TransactionManager.AddNewlyCreatedDBObject(br, true);//通知事务处理加入创建的块参照
            space.DowngradeOpen();//为了安全，将块表状态改为读
            return blockRefId;//返回添加的块参照的Id
        }

        /// <summary>
        /// 在AutoCAD图形中插入块参照
        /// </summary>
        /// <param name="spaceId">块参照要加入的模型空间或图纸空间的Id</param>
        /// <param name="layer">块参照要加入的图层名</param>
        /// <param name="blockName">块参照所属的块名</param>
        /// <param name="position">插入点</param>
        /// <param name="scale">缩放比例</param>
        /// <param name="rotateAngle">旋转角度</param>
        /// <param name="attNameValues">属性的名称与取值</param>
        /// <returns>返回块参照的Id</returns>
        public static ObjectId InsertBlockReference(this ObjectId spaceId, string layer, string blockName, Point3d position, Scale3d scale, double rotateAngle, Dictionary<string, string> attNameValues)
        {
            Database db = spaceId.Database;//获取数据库对象
            //以读的方式打开块表
            BlockTable bt = (BlockTable)db.BlockTableId.GetObject(OpenMode.ForRead);
            //如果没有blockName表示的块，则程序返回
            if (!bt.Has(blockName)) return ObjectId.Null;
            //以写的方式打开空间（模型空间或图纸空间）
            BlockTableRecord space = (BlockTableRecord)spaceId.GetObject(OpenMode.ForWrite);
            ObjectId btrId = bt[blockName];//获取块表记录的Id
            //打开块表记录
            BlockTableRecord record = (BlockTableRecord)btrId.GetObject(OpenMode.ForRead);
            //创建一个块参照并设置插入点
            BlockReference br = new BlockReference(position, bt[blockName]);
            br.ScaleFactors = scale;//设置块参照的缩放比例
            br.Layer = layer;//设置块参照的层名
            br.Rotation = rotateAngle;//设置块参照的旋转角度
            space.AppendEntity(br);//为了安全，将块表状态改为读 
            //判断块表记录是否包含属性定义
            if (record.HasAttributeDefinitions)
            {
                //若包含属性定义，则遍历属性定义
                foreach (ObjectId id in record)
                {
                    //检查是否是属性定义
                    AttributeDefinition attDef = id.GetObject(OpenMode.ForRead) as AttributeDefinition;
                    if (attDef != null)
                    {
                        //创建一个新的属性对象
                        AttributeReference attribute = new AttributeReference();
                        //从属性定义获得属性对象的对象特性
                        attribute.SetAttributeFromBlock(attDef, br.BlockTransform);
                        //设置属性对象的其它特性
                        attribute.Position = attDef.Position.TransformBy(br.BlockTransform);
                        attribute.Rotation = attDef.Rotation;
                        attribute.AdjustAlignment(db);
                        //判断是否包含指定的属性名称
                        if (attNameValues.ContainsKey(attDef.Tag.ToUpper()))
                        {
                            //设置属性值
                            attribute.TextString = attNameValues[attDef.Tag.ToUpper()].ToString();
                        }
                        //向块参照添加属性对象
                        br.AttributeCollection.AppendAttribute(attribute);
                        db.TransactionManager.AddNewlyCreatedDBObject(attribute, true);
                    }
                }
            }
            db.TransactionManager.AddNewlyCreatedDBObject(br, true);
            return br.ObjectId;//返回添加的块参照的Id
        }

        /// <summary>
        /// 更新块参照中的属性值
        /// </summary>
        /// <param name="blockRefId">块参照的Id</param>
        /// <param name="attNameValues">需要更新的属性名称与取值</param>
        public static void UpdateAttributesInBlock(this ObjectId blockRefId, Dictionary<string, string> attNameValues)
        {
            //获取块参照对象
            BlockReference blockRef = blockRefId.GetObject(OpenMode.ForRead) as BlockReference;
            if (blockRef != null)
            {
                //遍历块参照中的属性
                foreach (ObjectId id in blockRef.AttributeCollection)
                {
                    //获取属性
                    AttributeReference attref = id.GetObject(OpenMode.ForRead) as AttributeReference;
                    //判断是否包含指定的属性名称
                    if (attNameValues.ContainsKey(attref.Tag.ToUpper()))
                    {
                        attref.UpgradeOpen();//切换属性对象为写的状态
                        //设置属性值
                        attref.TextString = attNameValues[attref.Tag.ToUpper()].ToString();
                        attref.DowngradeOpen();//为了安全，将属性对象的状态改为读
                    }
                }
            }
        }

        /// <summary>
        /// 获取指定名称的块参照的属性名和属性值
        /// </summary>
        /// <param name="db">数据库对象</param>
        /// <param name="blockName">块名</param>
        /// <returns>返回块参照的属性名和属性值</returns>
        public static SortedDictionary<string, string> GetAttributesInBlock(this Database db, string blockName)
        {
            SortedDictionary<string, string> attributes = new SortedDictionary<string, string>();
            // 筛选指定名称的块参照
            TypedValue[] values = { new TypedValue((int)DxfCode.Start, "INSERT"),
                                    new TypedValue((int)DxfCode.BlockName, blockName),
                                    };
            var filter = new SelectionFilter(values);
            Editor ed = Application.DocumentManager.GetDocument(db).Editor;
            var entSelected = ed.SelectAll(filter);
            // 如果数据库不存在指定名称的块参照，则返回
            if (entSelected.Status != PromptStatus.OK) return null;
            using (Transaction trans = db.TransactionManager.StartTransaction())
            {
                // 遍历块参照
                foreach (var id in entSelected.Value.GetObjectIds())
                {
                    BlockReference bref = (BlockReference)trans.GetObject(id, OpenMode.ForRead);
                    // 遍历块参照中的属性
                    foreach (ObjectId attId in bref.AttributeCollection)
                    {
                        AttributeReference attRef = (AttributeReference)trans.GetObject(attId, OpenMode.ForRead);
                        // 将块参照的属性名和属性值添加到字典中
                        attributes.Add(attRef.Tag, attRef.TextString);
                    }
                }
                trans.Commit();
            }
            return attributes; // 返回指定名称的块参照的属性名和属性值
        }

        /// <summary>
        /// 获取块参照的属性名和属性值
        /// </summary>
        /// <param name="blockReferenceId">块参照的Id</param>
        /// <returns>返回块参照的属性名和属性值</returns>
        public static SortedDictionary<string, string> GetAttributesInBlockReference(this ObjectId blockReferenceId)
        {
            SortedDictionary<string, string> attributes = new SortedDictionary<string, string>();
            Database db = blockReferenceId.Database;
            using (Transaction trans = db.TransactionManager.StartTransaction())
            {
                // 获取块参照
                BlockReference bref = (BlockReference)trans.GetObject(blockReferenceId, OpenMode.ForRead);
                // 遍历块参照的属性，并将其属性名和属性值添加到字典中
                foreach (ObjectId attId in bref.AttributeCollection)
                {
                    AttributeReference attRef = (AttributeReference)trans.GetObject(attId, OpenMode.ForRead);
                    attributes.Add(attRef.Tag, attRef.TextString);
                }
                trans.Commit();
            }
            return attributes; // 返回块参照的属性名和属性值
        }

        /// <summary>
        /// 获取指定名称的块属性值
        /// </summary>
        /// <param name="blockReferenceId">块参照的Id</param>
        /// <param name="attributeName">属性名</param>
        /// <returns>返回指定名称的块属性值</returns>
        public static string GetAttributeInBlockReference(this ObjectId blockReferenceId, string attributeName)
        {
            string attributeValue = string.Empty; // 属性值
            Database db = blockReferenceId.Database;
            using (Transaction trans = db.TransactionManager.StartTransaction())
            {
                // 获取块参照
                BlockReference bref = (BlockReference)trans.GetObject(blockReferenceId, OpenMode.ForRead);
                // 遍历块参照的属性
                foreach (ObjectId attId in bref.AttributeCollection)
                {
                    // 获取块参照属性对象
                    AttributeReference attRef = (AttributeReference)trans.GetObject(attId, OpenMode.ForRead);
                    //判断属性名是否为指定的属性名
                    if (attRef.Tag.ToUpper() == attributeName.ToUpper())
                    {
                        attributeValue = attRef.TextString;//获取属性值
                        break;
                    }
                }
                trans.Commit();
            }
            return attributeValue; //返回块属性值
        }

        /// <summary>
        /// 获取指定块名的块参照
        /// </summary>
        /// <param name="db">数据库对象</param>
        /// <param name="blockName">块名</param>
        /// <returns>返回指定块名的块参照</returns>
        public static List<BlockReference> GetAllBlockReferences(this Database db, string blockName)
        {
            List<BlockReference> blocks = new List<BlockReference>();
            using (Transaction trans = db.TransactionManager.StartTransaction())
            {
                //打开块表
                BlockTable bt = (BlockTable)trans.GetObject(db.BlockTableId, OpenMode.ForRead);
                //打开指定块名的块表记录
                BlockTableRecord btr = (BlockTableRecord)trans.GetObject(bt[blockName], OpenMode.ForRead);
                //获取指定块名的块参照集合的Id
                ObjectIdCollection blockIds = btr.GetBlockReferenceIds(true, true);
                foreach (ObjectId id in blockIds) // 遍历块参照的Id
                {
                    //获取块参照
                    BlockReference block = (BlockReference)trans.GetObject(id, OpenMode.ForRead);
                    blocks.Add(block); // 将块参照添加到返回列表 
                }
                trans.Commit();
            }
            return blocks; //返回块参照列表
        }

        /// <summary>
        /// 返回指定块名的动态块参照
        /// </summary>
        /// <param name="db">数据库对象</param>
        /// <param name="blockName">动态块的块名</param>
        /// <returns>返回指定块名的动态块参照</returns>
        public static List<BlockReference> GetAllDynBlockReferences(this Database db, string blockName)
        {
            List<BlockReference> blocks = new List<BlockReference>();
            var trans = db.TransactionManager;
            BlockTable bt = (BlockTable)trans.GetObject(db.BlockTableId, OpenMode.ForRead);
            BlockTableRecord btr = (BlockTableRecord)trans.GetObject(bt[blockName], OpenMode.ForRead);
            blocks = (from b in db.GetEntsInDatabase<BlockReference>()
                      where b.GetBlockName() == blockName
                      select b).ToList();
            return blocks;
        }

        /// <summary>
        /// 导入外部文件中的块
        /// </summary>
        /// <param name="destDb">目标数据库</param>
        /// <param name="sourceFileName">包含完整路径的外部文件名</param>
        public static void ImportBlocksFromDwg(this Database destDb, string sourceFileName)
        {
            //创建一个新的数据库对象，作为源数据库，以读入外部文件中的对象
            Database sourceDb = new Database(false, true);
            try
            {
                //把DWG文件读入到一个临时的数据库中
                sourceDb.ReadDwgFile(sourceFileName, System.IO.FileShare.Read, true, null);
                //创建一个变量用来存储块的ObjectId列表
                ObjectIdCollection blockIds = new ObjectIdCollection();
                //获取源数据库的事务处理管理器
                Autodesk.AutoCAD.DatabaseServices.TransactionManager tm = sourceDb.TransactionManager;
                //在源数据库中开始事务处理
                using (Transaction myT = tm.StartTransaction())
                {
                    //打开源数据库中的块表
                    BlockTable bt = (BlockTable)tm.GetObject(sourceDb.BlockTableId, OpenMode.ForRead, false);
                    //遍历每个块
                    foreach (ObjectId btrId in bt)
                    {
                        BlockTableRecord btr = (BlockTableRecord)tm.GetObject(btrId, OpenMode.ForRead, false);
                        //只加入命名块和非布局块到复制列表中
                        if (!btr.IsAnonymous && !btr.IsLayout)
                        {
                            blockIds.Add(btrId);
                        }
                        btr.Dispose();
                    }
                    bt.Dispose();
                }
                //定义一个IdMapping对象
                IdMapping mapping = new IdMapping();
                //从源数据库向目标数据库复制块表记录
                sourceDb.WblockCloneObjects(blockIds, destDb.BlockTableId, mapping, DuplicateRecordCloning.Replace, false);
            }
            catch (Autodesk.AutoCAD.Runtime.Exception ex)
            {
                Application.ShowAlertDialog("复制错误: " + ex.Message);
            }
            //操作完成，销毁源数据库
            sourceDb.Dispose();
        }

        /// <summary>
        /// 获取块参照的块名（包括动态块）
        /// </summary>
        /// <param name="id">块参照的Id</param>
        /// <returns>返回块名</returns>
        public static string GetBlockName(this ObjectId id)
        {
            //获取块参照
            BlockReference bref = id.GetObject(OpenMode.ForRead) as BlockReference;
            if (bref != null)//如果是块参照
                return GetBlockName(bref);
            else
                return null;
        }

        /// <summary>
        /// 获取块参照的块名（包括动态块）
        /// </summary>
        /// <param name="bref">块参照</param>
        /// <returns>返回块名</returns>
        public static string GetBlockName(this BlockReference bref)
        {
            string blockName;//存储块名
            if (bref == null) return null;//如果块参照不存在，则返回
            if (bref.IsDynamicBlock) //如果是动态块
            {
                //获取动态块所属的动态块表记录
                ObjectId idDyn = bref.DynamicBlockTableRecord;
                //打开动态块表记录
                BlockTableRecord btr = (BlockTableRecord)idDyn.GetObject(OpenMode.ForRead);
                blockName = btr.Name;//获取块名
            }
            else //非动态块
                blockName = bref.Name; //获取块名
            return blockName;//返回块名
        }

        /// <summary>
        /// 为块表记录添加属性
        /// </summary>
        /// <param name="blockId">块表记录的Id</param>
        /// <param name="atts">要加入的块属性列表</param>
        public static void AddAttsToBlock(this ObjectId blockId, List<AttributeDefinition> atts)
        {
            Database db = blockId.Database;//获取数据库对象
            //打开块表记录为写的状态
            BlockTableRecord btr = (BlockTableRecord)blockId.GetObject(OpenMode.ForWrite);
            //遍历属性定义对象列表
            foreach (AttributeDefinition att in atts)
            {
                btr.AppendEntity(att);//为块表记录添加属性
                db.TransactionManager.AddNewlyCreatedDBObject(att, true);//通知事务处理
            }
            btr.DowngradeOpen();//为了安全，将块表记录的状态改为读
        }

        /// <summary>
        /// 为块表记录添加属性
        /// </summary>
        /// <param name="blockId">块表记录的Id</param>
        /// <param name="atts">要加入的块属性列表</param>
        public static void AddAttsToBlock(this ObjectId blockId, params AttributeDefinition[] atts)
        {
            blockId.AddAttsToBlock(atts.ToList());
        }

        #region 动态块
        /// <summary>
        /// 获取动态块的动态属性值
        /// </summary>
        /// <param name="blockId">动态块的Id</param>
        /// <param name="propName">需要查找的动态属性名</param>
        /// <returns>返回指定动态属性的值</returns>
        public static string GetDynBlockValue(this ObjectId blockId, string propName)
        {
            string propValue = null;//用于返回动态属性值的变量
            var props = blockId.GetDynProperties();//获得动态块的所有动态属性
            //遍历动态属性
            foreach (DynamicBlockReferenceProperty prop in props)
            {
                //如果动态属性的名称与输入的名称相同
                if (prop.PropertyName == propName)
                {
                    //获取动态属性值并结束遍历
                    propValue = prop.Value.ToString();
                    break;
                }
            }
            return propValue;//返回动态属性值
        }

        /// <summary>
        /// 获得动态块的所有动态属性
        /// </summary>
        /// <param name="blockId">动态块的Id</param>
        /// <returns>返回动态块的所有属性</returns>
        public static DynamicBlockReferencePropertyCollection GetDynProperties(this ObjectId blockId)
        {
            //获取块参照
            BlockReference br = blockId.GetObject(OpenMode.ForRead) as BlockReference;
            //如果不是动态块，则返回
            if (br == null && !br.IsDynamicBlock) return null;
            //返回动态块的动态属性
            return br.DynamicBlockReferencePropertyCollection;
        }

        /// <summary>
        /// 设置动态块的动态属性
        /// </summary>
        /// <param name="blockId">动态块的ObjectId</param>
        /// <param name="propName">动态属性的名称</param>
        /// <param name="value">动态属性的值</param>
        public static void SetDynBlockValue(this ObjectId blockId, string propName, object value)
        {
            var props = blockId.GetDynProperties();//获得动态块的所有动态属性
            //遍历动态属性
            foreach (DynamicBlockReferenceProperty prop in props)
            {
                //如果动态属性的名称与输入的名称相同且为可读
                if (prop.ReadOnly == false && prop.PropertyName == propName)
                {
                    //判断动态属性的类型并通过类型转化设置正确的动态属性值
                    switch (prop.PropertyTypeCode)
                    {
                        case (short)DynBlockPropTypeCode.Short://短整型
                            prop.Value = Convert.ToInt16(value);
                            break;
                        case (short)DynBlockPropTypeCode.Long://长整型
                            prop.Value = Convert.ToInt64(value);
                            break;
                        case (short)DynBlockPropTypeCode.Real://实型
                            prop.Value = Convert.ToDouble(value);
                            break;
                        default://其它
                            prop.Value = value;
                            break;
                    }
                    break;
                }
            }
        }

        #endregion
    }
}
﻿using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using Autodesk.AutoCAD.Runtime;
using Autodesk.AutoCAD.ApplicationServices;

namespace CADDialog
{
    public class CADDialog
    {
        [CommandMethod("CADDialog")]
        public void ShowCADDialog()
        {
            //显示自定义的图层特性管理器模态对话框
            FormLayer form=new FormLayer();
            Application.ShowModalDialog(form);
        }
    }
}
﻿//------------------------------------------------------------------------------
// <auto-generated>
//     此代码由工具生成。
//     运行时版本:4.0.30319.488
//
//     对此文件的更改可能会导致不正确的行为，并且如果
//     重新生成代码，这些更改将会丢失。
// </auto-generated>
//------------------------------------------------------------------------------

namespace CADDialog {
    using System;
    
    
    /// <summary>
    ///   一个强类型的资源类，用于查找本地化的字符串等。
    /// </summary>
    // 此类是由 StronglyTypedResourceBuilder
    // 类通过类似于 ResGen 或 Visual Studio 的工具自动生成的。
    // 若要添加或移除成员，请编辑 .ResX 文件，然后重新运行 ResGen
    // (以 /str 作为命令选项)，或重新生成 VS 项目。
    [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Resources.Tools.StronglyTypedResourceBuilder", "4.0.0.0")]
    [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
    [global::System.Runtime.CompilerServices.CompilerGeneratedAttribute()]
    internal class CADResource {
        
        private static global::System.Resources.ResourceManager resourceMan;
        
        private static global::System.Globalization.CultureInfo resourceCulture;
        
        [global::System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1811:AvoidUncalledPrivateCode")]
        internal CADResource() {
        }
        
        /// <summary>
        ///   返回此类使用的缓存的 ResourceManager 实例。
        /// </summary>
        [global::System.ComponentModel.EditorBrowsableAttribute(global::System.ComponentModel.EditorBrowsableState.Advanced)]
        internal static global::System.Resources.ResourceManager ResourceManager {
            get {
                if (object.ReferenceEquals(resourceMan, null)) {
                    global::System.Resources.ResourceManager temp = new global::System.Resources.ResourceManager("CADDialog.CADResource", typeof(CADResource).Assembly);
                    resourceMan = temp;
                }
                return resourceMan;
            }
        }
        
        /// <summary>
        ///   使用此强类型资源类，为所有资源查找
        ///   重写当前线程的 CurrentUICulture 属性。
        /// </summary>
        [global::System.ComponentModel.EditorBrowsableAttribute(global::System.ComponentModel.EditorBrowsableState.Advanced)]
        internal static global::System.Globalization.CultureInfo Culture {
            get {
                return resourceCulture;
            }
            set {
                resourceCulture = value;
            }
        }
        
        internal static System.Drawing.Bitmap ButtonDelete {
            get {
                object obj = ResourceManager.GetObject("ButtonDelete", resourceCulture);
                return ((System.Drawing.Bitmap)(obj));
            }
        }
        
        internal static System.Drawing.Bitmap ButtonNew {
            get {
                object obj = ResourceManager.GetObject("ButtonNew", resourceCulture);
                return ((System.Drawing.Bitmap)(obj));
            }
        }
        
        internal static System.Drawing.Bitmap ButtonNewFreeze {
            get {
                object obj = ResourceManager.GetObject("ButtonNewFreeze", resourceCulture);
                return ((System.Drawing.Bitmap)(obj));
            }
        }
        
        internal static System.Drawing.Bitmap IsCurrentFalse {
            get {
                object obj = ResourceManager.GetObject("IsCurrentFalse", resourceCulture);
                return ((System.Drawing.Bitmap)(obj));
            }
        }
        
        internal static System.Drawing.Bitmap IsCurrentTrue {
            get {
                object obj = ResourceManager.GetObject("IsCurrentTrue", resourceCulture);
                return ((System.Drawing.Bitmap)(obj));
            }
        }
        
        internal static System.Drawing.Bitmap IsFrozenFalse {
            get {
                object obj = ResourceManager.GetObject("IsFrozenFalse", resourceCulture);
                return ((System.Drawing.Bitmap)(obj));
            }
        }
        
        internal static System.Drawing.Bitmap IsFrozenTrue {
            get {
                object obj = ResourceManager.GetObject("IsFrozenTrue", resourceCulture);
                return ((System.Drawing.Bitmap)(obj));
            }
        }
        
        internal static System.Drawing.Bitmap IsLockedFalse {
            get {
                object obj = ResourceManager.GetObject("IsLockedFalse", resourceCulture);
                return ((System.Drawing.Bitmap)(obj));
            }
        }
        
        internal static System.Drawing.Bitmap IsLockedTrue {
            get {
                object obj = ResourceManager.GetObject("IsLockedTrue", resourceCulture);
                return ((System.Drawing.Bitmap)(obj));
            }
        }
        
        internal static System.Drawing.Bitmap IsOffFalse {
            get {
                object obj = ResourceManager.GetObject("IsOffFalse", resourceCulture);
                return ((System.Drawing.Bitmap)(obj));
            }
        }
        
        internal static System.Drawing.Bitmap IsOffTrue {
            get {
                object obj = ResourceManager.GetObject("IsOffTrue", resourceCulture);
                return ((System.Drawing.Bitmap)(obj));
            }
        }
        
        internal static System.Drawing.Bitmap IsPlottableFalse {
            get {
                object obj = ResourceManager.GetObject("IsPlottableFalse", resourceCulture);
                return ((System.Drawing.Bitmap)(obj));
            }
        }
        
        internal static System.Drawing.Bitmap IsPlottableTrue {
            get {
                object obj = ResourceManager.GetObject("IsPlottableTrue", resourceCulture);
                return ((System.Drawing.Bitmap)(obj));
            }
        }
        
        internal static System.Drawing.Bitmap ViewportVisibilityDefaultFalse {
            get {
                object obj = ResourceManager.GetObject("ViewportVisibilityDefaultFalse", resourceCulture);
                return ((System.Drawing.Bitmap)(obj));
            }
        }
        
        internal static System.Drawing.Bitmap ViewportVisibilityDefaultTrue {
            get {
                object obj = ResourceManager.GetObject("ViewportVisibilityDefaultTrue", resourceCulture);
                return ((System.Drawing.Bitmap)(obj));
            }
        }
    }
}
﻿using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.Geometry;
using Autodesk.AutoCAD.Runtime;
using DotNetARX;
namespace CircleAndArc
{
    public class CircleAndArc
    {
        [CommandMethod("Fan")]
        public static void Fan()
        {
            Database db=HostApplicationServices.WorkingDatabase;
            using (Transaction trans=db.TransactionManager.StartTransaction())
            {
                //定义圆弧上的三个点
                Point3d startPoint=new Point3d(100, 0, 0);
                Point3d pointOnArc=new Point3d(50, 25, 0);
                Point3d endPoint=new Point3d();
                //调用三点法画圆弧的扩展函数创建扇形的圆弧
                Arc arc=new Arc();
                arc.CreateArc(startPoint, pointOnArc, endPoint);
                //创建扇形的两条半径
                Line line1= new Line(arc.Center, startPoint);
                Line line2= new Line(arc.Center, endPoint);
                //一次性添加实体到模型空间，完成扇形的创建
                db.AddToModelSpace(line1, line2, arc);
                trans.Commit();
            }
        }
    }
}
﻿using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.EditorInput;
using Autodesk.AutoCAD.Geometry;

namespace UseEntityJig
{
    class CircleJig : EntityJig
    {
        private Point3d m_CenterPt;
        public double m_Radius = 100.0;

        // 派生类的构造函数.
        public CircleJig(Vector3d normal)
            : base(new Circle())
        {
            ((Circle)Entity).Center = m_CenterPt;
            ((Circle)Entity).Normal = normal;
            ((Circle)Entity).Radius = m_Radius;
        }

        protected override bool Update()
        {
            ((Circle)Entity).Center = m_CenterPt;
            ((Circle)Entity).Radius = m_Radius;
            return true;
        }

        protected override SamplerStatus Sampler(JigPrompts prompts)
        {
            // 定义一个点拖动交互类.
            JigPromptPointOptions optJig = new JigPromptPointOptions
                ("\n请指定圆的圆心或用右键修改半径");
         
            optJig.Keywords.Add("100");
            optJig.Keywords.Add("200");
            optJig.Keywords.Add("300");
            optJig.UserInputControls = UserInputControls.Accept3dCoordinates;

            // 用AcquirePoint函数得到用户输入的点.
            PromptPointResult resJigDis = prompts.AcquirePoint(optJig);
            Point3d curPt = resJigDis.Value;

            if (resJigDis.Status == PromptStatus.Cancel)
            {
                return SamplerStatus.Cancel;
            }

            if (resJigDis.Status == PromptStatus.Keyword)
            {
                switch (resJigDis.StringResult)
                {
                    case "100":
                        m_Radius = 100;
                        return SamplerStatus.NoChange;
                    case "200":
                        m_Radius = 200;
                        return SamplerStatus.NoChange;
                    case "300":
                        m_Radius = 300;
                        return SamplerStatus.NoChange;
                }
            }

            if (m_CenterPt != curPt)
            {
                // 保存当前点.
                m_CenterPt = curPt;
                return SamplerStatus.OK;
            }
            else
            {
                return SamplerStatus.NoChange;
            }
        }

        // GetEntity函数用于得到派生类的实体.
        public Entity GetEntity()
        {
            return Entity;
        }
    }
}

﻿using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.Geometry;

namespace DotNetARX
{
    /// <summary>
    /// 简化圆操作类
    /// </summary>
    public static class CircleTools
    {
        /// <summary>
        /// 两点创建圆
        /// </summary>
        /// <param name="circle">圆对象</param>
        /// <param name="startPoint">起点</param>
        /// <param name="endPoint">终点</param>
        public static void CreateCircle(this Circle circle, Point3d startPoint, Point3d endPoint)
        {
            circle.Center = GeTools.MidPoint(startPoint, endPoint);
            circle.Radius = startPoint.DistanceTo(endPoint) / 2;
        }
        
        /// <summary>
        /// 三点法创建圆
        /// </summary>
        /// <param name="circle">圆对象</param>
        /// <param name="pt1">第一点</param>
        /// <param name="pt2">第二点</param>
        /// <param name="pt3">第三点</param>
        /// <returns>若成功创建圆，则返回true，否则返回false</returns>
        public static bool CreateCircle(this Circle circle, Point3d pt1, Point3d pt2, Point3d pt3)
        {
            //先判断三点是否共线,得到pt1点指向pt2、pt2点的矢量
            Vector3d va = pt1.GetVectorTo(pt2);
            Vector3d vb = pt1.GetVectorTo(pt3);
            //如两矢量夹角为0或180度（π弧度),则三点共线.
            if (va.GetAngleTo(vb) == 0 | va.GetAngleTo(vb) == Math.PI)
            {
                return false;
            }
            else
            {
                //创建一个几何类的圆弧对象
                CircularArc3d geArc = new CircularArc3d(pt1, pt2, pt3);
                //将圆弧对象的圆心和半径赋值给圆
                circle.Center = geArc.Center;
                circle.Radius = geArc.Radius;
                return true;
            }
        }
    }
}
﻿using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using Autodesk.AutoCAD.GraphicsInterface;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.Colors;
using Autodesk.AutoCAD.Runtime;
using Autodesk.AutoCAD.ApplicationServices;
using Autodesk.AutoCAD.EditorInput;
using DotNetARX;

namespace HighlightBlock
{
    using Autodesk.AutoCAD.Runtime;
    using Autodesk.AutoCAD.ApplicationServices;
    using Autodesk.AutoCAD.DatabaseServices;
    using Autodesk.AutoCAD.Geometry;

    namespace HighlightOverruleSample
    {
        public class EmployeeOverrule : HighlightOverrule
        {
            private int _colorIndex = 1;
            private int _oldColorIndex;
            public static EmployeeOverrule theOverrule = new EmployeeOverrule();
            const string regAppName="EMPLOYEE";
            public EmployeeOverrule()
            {
                SetXDataFilter(regAppName);
            }
            public static string GetXData(ObjectId id)
            {
                string position=string.Empty;
                TypedValueList xdata= id.GetXData(regAppName);
                if (xdata != null)
                {
                    position = xdata[2].Value.ToString();
                }
                return position;
            }
            public int ColorIndex
            {
                set { _colorIndex = value; }
                get { return _colorIndex; }
            }

            public override void Highlight(
                Entity entity, FullSubentityPath subId, bool highlightAll)
            {
                Database db= entity.Database;
                Document doc=Application.DocumentManager.MdiActiveDocument;
                Editor ed=doc.Editor;
                string position=GetXData(entity.ObjectId);
                MText txt = entity as MText;
                if (txt == null || position.IsNullOrWhiteSpace()) return;                
                using (Transaction trans = db.TransactionManager.StartTransaction())
                {
                    txt.UpgradeOpen();
                    _oldColorIndex = txt.ColorIndex;
                    txt.ColorIndex = _colorIndex;
                    //trans.Commit();
                }
                base.Highlight(entity, subId, highlightAll);                
            }

            public override void Unhighlight(
                Entity entity, FullSubentityPath subId, bool highlightAll)
            {
                string position=GetXData(entity.ObjectId);
                MText txt = entity as MText;
                if (txt == null && position.IsNullOrWhiteSpace()) return;
                Database db= entity.Database;
                Document doc=Application.DocumentManager.MdiActiveDocument;
                using (Transaction trans = db.TransactionManager.StartTransaction())
                {
                    txt.UpgradeOpen();
                    txt.ColorIndex = _oldColorIndex;
                    //trans.Commit();
                }
                base.Unhighlight(entity, subId, highlightAll);
            }
        }
        public class Command
        {
            [CommandMethod("Overrule1")]
            public void StartOverrule()
            {
                ObjectOverrule.AddOverrule(RXClass.GetClass(typeof(MText)), EmployeeOverrule.theOverrule, true);
            }
            [CommandMethod("Overrule0")]
            public void EndOverrule()
            {
                ObjectOverrule.RemoveOverrule(RXClass.GetClass(typeof(MText)), EmployeeOverrule.theOverrule);
                Document doc = Application.DocumentManager.MdiActiveDocument;
                doc.SendStringToExecute("REGEN3\n", true, false, false);
                doc.Editor.Regen();
            }
            [CommandMethod("Employee", CommandFlags.UsePickSet)]
            public void SetHighlightColor()
            {
                Document dwg = Autodesk.AutoCAD.ApplicationServices.
                    Application.DocumentManager.MdiActiveDocument;

                Editor ed = dwg.Editor;

                PromptIntegerOptions opt = new PromptIntegerOptions(
                    "\nEnter color index (a number form 0 to 7):");

                PromptIntegerResult res = ed.GetInteger(opt);

                if (res.Status == PromptStatus.OK)
                {
                    EmployeeOverrule.theOverrule.ColorIndex = res.Value;
                }
            }
            [CommandMethod("AddX")]
            public static void AddX()
            {
                Document doc=Application.DocumentManager.MdiActiveDocument;
                Database db=doc.Database;
                Editor ed=doc.Editor;
                //提示用户选择一个表示董事长的多行文本
                PromptEntityOptions opt=new PromptEntityOptions("\n请选择表示董事长的多行文本");
                opt.SetRejectMessage("\n您选择的不是多行文本，请重新选择");
                opt.AddAllowedClass(typeof(MText), true);
                PromptEntityResult entResult=ed.GetEntity(opt);
                if (entResult.Status != PromptStatus.OK) return;
                ObjectId id=entResult.ObjectId;//用户选择的多行文本的ObjectId
                using (Transaction trans=db.TransactionManager.StartTransaction())
                {
                    TypedValueList values=new TypedValueList();//定义一个TypedValue列表
                    //添加整型（表示员工编号）和字符串（表示职位）扩展数据项
                    values.Add(DxfCode.ExtendedDataInteger32, 1002);
                    values.Add(DxfCode.ExtendedDataAsciiString, "董事长");
                    //为实体添加应用程序名为"EMPLOYEE"的扩展数据
                    id.AddXData("EMPLOYEE", values);
                    trans.Commit();
                }
            }
        }
        //public class MyHighlightOverrule : HighlightOverrule
        //{
        //    private int _colorIndex = 1;
        //    private int _oldColorIndex;

        //    public MyHighlightOverrule()
        //    {
        //        AddOverrule(RXClass.GetClass(typeof(MText)), this, true);
        //    }

        //    public int ColorIndex
        //    {
        //        set { _colorIndex = value; }
        //        get { return _colorIndex; }
        //    }

        //    public override void Highlight(
        //        Entity entity, FullSubentityPath subId, bool highlightAll)
        //    {
        //        Polyline pline = entity as Polyline;
        //        if (pline == null) return;

        //        Database db= entity.Database;
        //        Document dwg=Application.DocumentManager.MdiActiveDocument;

        //        using (DocumentLock dl = dwg.LockDocument())
        //        {
        //            using (Transaction tran = db.TransactionManager.StartTransaction())
        //            {
        //                pline.UpgradeOpen();
        //                _oldColorIndex = pline.ColorIndex;
        //                pline.ColorIndex = _colorIndex;
        //                pline.DowngradeOpen();
        //            }
        //        }

        //        base.Highlight(entity, subId, highlightAll);
        //    }

        //    public override void Unhighlight(
        //        Entity entity, FullSubentityPath subId, bool highlightAll)
        //    {
        //        Polyline pline = entity as Polyline;
        //        if (pline == null) return;

        //        Database db = entity.Database;
        //        Document dwg=Application.DocumentManager.MdiActiveDocument;

        //        using (DocumentLock dl = dwg.LockDocument())
        //        {
        //            using (Transaction tran = db.TransactionManager.StartTransaction())
        //            {
        //                pline.UpgradeOpen();
        //                pline.ColorIndex = _oldColorIndex;
        //                pline.DowngradeOpen();
        //            }
        //        }

        //        base.Unhighlight(entity, subId, highlightAll);
        //    }
        //}
    }

}
﻿#pragma checksum "..\..\..\CollapsePanel.xaml" "{406ea660-64cf-4c82-b6f0-42d48172a799}" "5FCEDC82DD984E5EA38FA8184268F7BC"
//------------------------------------------------------------------------------
// <auto-generated>
//     此代码由工具生成。
//     运行时版本:4.0.30319.225
//
//     对此文件的更改可能会导致不正确的行为，并且如果
//     重新生成代码，这些更改将会丢失。
// </auto-generated>
//------------------------------------------------------------------------------

using System;
using System.Diagnostics;
using System.Windows;
using System.Windows.Automation;
using System.Windows.Controls;
using System.Windows.Controls.Primitives;
using System.Windows.Data;
using System.Windows.Documents;
using System.Windows.Forms.Integration;
using System.Windows.Ink;
using System.Windows.Input;
using System.Windows.Markup;
using System.Windows.Media;
using System.Windows.Media.Animation;
using System.Windows.Media.Effects;
using System.Windows.Media.Imaging;
using System.Windows.Media.Media3D;
using System.Windows.Media.TextFormatting;
using System.Windows.Navigation;
using System.Windows.Shapes;
using System.Windows.Shell;


namespace Wpfs {
    
    
    /// <summary>
    /// CollapsePanel
    /// </summary>
    [System.CodeDom.Compiler.GeneratedCodeAttribute("PresentationBuildTasks", "4.0.0.0")]
    public partial class CollapsePanel : System.Windows.Controls.UserControl, System.Windows.Markup.IComponentConnector, System.Windows.Markup.IStyleConnector {
        
        
        #line 23 "..\..\..\CollapsePanel.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.Button buttonLine;
        
        #line default
        #line hidden
        
        
        #line 27 "..\..\..\CollapsePanel.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.Button buttonPolyline;
        
        #line default
        #line hidden
        
        
        #line 31 "..\..\..\CollapsePanel.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.Button buttonRectangle;
        
        #line default
        #line hidden
        
        
        #line 35 "..\..\..\CollapsePanel.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.Button buttonCircle;
        
        #line default
        #line hidden
        
        
        #line 43 "..\..\..\CollapsePanel.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.Button buttonCopy;
        
        #line default
        #line hidden
        
        
        #line 47 "..\..\..\CollapsePanel.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.Button buttonErase;
        
        #line default
        #line hidden
        
        
        #line 51 "..\..\..\CollapsePanel.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.Button buttonMove;
        
        #line default
        #line hidden
        
        
        #line 55 "..\..\..\CollapsePanel.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.Button buttonRotate;
        
        #line default
        #line hidden
        
        private bool _contentLoaded;
        
        /// <summary>
        /// InitializeComponent
        /// </summary>
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        public void InitializeComponent() {
            if (_contentLoaded) {
                return;
            }
            _contentLoaded = true;
            System.Uri resourceLocater = new System.Uri("/Wpfs;component/collapsepanel.xaml", System.UriKind.Relative);
            
            #line 1 "..\..\..\CollapsePanel.xaml"
            System.Windows.Application.LoadComponent(this, resourceLocater);
            
            #line default
            #line hidden
        }
        
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [System.ComponentModel.EditorBrowsableAttribute(System.ComponentModel.EditorBrowsableState.Never)]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Design", "CA1033:InterfaceMethodsShouldBeCallableByChildTypes")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Maintainability", "CA1502:AvoidExcessiveComplexity")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1800:DoNotCastUnnecessarily")]
        void System.Windows.Markup.IComponentConnector.Connect(int connectionId, object target) {
            switch (connectionId)
            {
            case 2:
            this.buttonLine = ((System.Windows.Controls.Button)(target));
            return;
            case 3:
            this.buttonPolyline = ((System.Windows.Controls.Button)(target));
            return;
            case 4:
            this.buttonRectangle = ((System.Windows.Controls.Button)(target));
            return;
            case 5:
            this.buttonCircle = ((System.Windows.Controls.Button)(target));
            return;
            case 6:
            this.buttonCopy = ((System.Windows.Controls.Button)(target));
            return;
            case 7:
            this.buttonErase = ((System.Windows.Controls.Button)(target));
            return;
            case 8:
            this.buttonMove = ((System.Windows.Controls.Button)(target));
            return;
            case 9:
            this.buttonRotate = ((System.Windows.Controls.Button)(target));
            return;
            }
            this._contentLoaded = true;
        }
        
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [System.ComponentModel.EditorBrowsableAttribute(System.ComponentModel.EditorBrowsableState.Never)]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Design", "CA1033:InterfaceMethodsShouldBeCallableByChildTypes")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1800:DoNotCastUnnecessarily")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Maintainability", "CA1502:AvoidExcessiveComplexity")]
        void System.Windows.Markup.IStyleConnector.Connect(int connectionId, object target) {
            System.Windows.EventSetter eventSetter;
            switch (connectionId)
            {
            case 1:
            eventSetter = new System.Windows.EventSetter();
            eventSetter.Event = System.Windows.Controls.Primitives.ButtonBase.ClickEvent;
            
            #line 11 "..\..\..\CollapsePanel.xaml"
            eventSetter.Handler = new System.Windows.RoutedEventHandler(this.executeCommand);
            
            #line default
            #line hidden
            ((System.Windows.Style)(target)).Setters.Add(eventSetter);
            break;
            }
        }
    }
}

﻿#pragma checksum "..\..\..\CollapsePanel.xaml" "{406ea660-64cf-4c82-b6f0-42d48172a799}" "5FCEDC82DD984E5EA38FA8184268F7BC"
//------------------------------------------------------------------------------
// <auto-generated>
//     此代码由工具生成。
//     运行时版本:4.0.30319.225
//
//     对此文件的更改可能会导致不正确的行为，并且如果
//     重新生成代码，这些更改将会丢失。
// </auto-generated>
//------------------------------------------------------------------------------

using System;
using System.Diagnostics;
using System.Windows;
using System.Windows.Automation;
using System.Windows.Controls;
using System.Windows.Controls.Primitives;
using System.Windows.Data;
using System.Windows.Documents;
using System.Windows.Forms.Integration;
using System.Windows.Ink;
using System.Windows.Input;
using System.Windows.Markup;
using System.Windows.Media;
using System.Windows.Media.Animation;
using System.Windows.Media.Effects;
using System.Windows.Media.Imaging;
using System.Windows.Media.Media3D;
using System.Windows.Media.TextFormatting;
using System.Windows.Navigation;
using System.Windows.Shapes;
using System.Windows.Shell;


namespace Wpfs {
    
    
    /// <summary>
    /// CollapsePanel
    /// </summary>
    [System.CodeDom.Compiler.GeneratedCodeAttribute("PresentationBuildTasks", "4.0.0.0")]
    public partial class CollapsePanel : System.Windows.Controls.UserControl, System.Windows.Markup.IComponentConnector, System.Windows.Markup.IStyleConnector {
        
        
        #line 23 "..\..\..\CollapsePanel.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.Button buttonLine;
        
        #line default
        #line hidden
        
        
        #line 27 "..\..\..\CollapsePanel.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.Button buttonPolyline;
        
        #line default
        #line hidden
        
        
        #line 31 "..\..\..\CollapsePanel.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.Button buttonRectangle;
        
        #line default
        #line hidden
        
        
        #line 35 "..\..\..\CollapsePanel.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.Button buttonCircle;
        
        #line default
        #line hidden
        
        
        #line 43 "..\..\..\CollapsePanel.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.Button buttonCopy;
        
        #line default
        #line hidden
        
        
        #line 47 "..\..\..\CollapsePanel.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.Button buttonErase;
        
        #line default
        #line hidden
        
        
        #line 51 "..\..\..\CollapsePanel.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.Button buttonMove;
        
        #line default
        #line hidden
        
        
        #line 55 "..\..\..\CollapsePanel.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.Button buttonRotate;
        
        #line default
        #line hidden
        
        private bool _contentLoaded;
        
        /// <summary>
        /// InitializeComponent
        /// </summary>
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        public void InitializeComponent() {
            if (_contentLoaded) {
                return;
            }
            _contentLoaded = true;
            System.Uri resourceLocater = new System.Uri("/Wpfs;component/collapsepanel.xaml", System.UriKind.Relative);
            
            #line 1 "..\..\..\CollapsePanel.xaml"
            System.Windows.Application.LoadComponent(this, resourceLocater);
            
            #line default
            #line hidden
        }
        
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [System.ComponentModel.EditorBrowsableAttribute(System.ComponentModel.EditorBrowsableState.Never)]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Design", "CA1033:InterfaceMethodsShouldBeCallableByChildTypes")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Maintainability", "CA1502:AvoidExcessiveComplexity")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1800:DoNotCastUnnecessarily")]
        void System.Windows.Markup.IComponentConnector.Connect(int connectionId, object target) {
            switch (connectionId)
            {
            case 2:
            this.buttonLine = ((System.Windows.Controls.Button)(target));
            return;
            case 3:
            this.buttonPolyline = ((System.Windows.Controls.Button)(target));
            return;
            case 4:
            this.buttonRectangle = ((System.Windows.Controls.Button)(target));
            return;
            case 5:
            this.buttonCircle = ((System.Windows.Controls.Button)(target));
            return;
            case 6:
            this.buttonCopy = ((System.Windows.Controls.Button)(target));
            return;
            case 7:
            this.buttonErase = ((System.Windows.Controls.Button)(target));
            return;
            case 8:
            this.buttonMove = ((System.Windows.Controls.Button)(target));
            return;
            case 9:
            this.buttonRotate = ((System.Windows.Controls.Button)(target));
            return;
            }
            this._contentLoaded = true;
        }
        
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [System.ComponentModel.EditorBrowsableAttribute(System.ComponentModel.EditorBrowsableState.Never)]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Design", "CA1033:InterfaceMethodsShouldBeCallableByChildTypes")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1800:DoNotCastUnnecessarily")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Maintainability", "CA1502:AvoidExcessiveComplexity")]
        void System.Windows.Markup.IStyleConnector.Connect(int connectionId, object target) {
            System.Windows.EventSetter eventSetter;
            switch (connectionId)
            {
            case 1:
            eventSetter = new System.Windows.EventSetter();
            eventSetter.Event = System.Windows.Controls.Primitives.ButtonBase.ClickEvent;
            
            #line 11 "..\..\..\CollapsePanel.xaml"
            eventSetter.Handler = new System.Windows.RoutedEventHandler(this.executeCommand);
            
            #line default
            #line hidden
            ((System.Windows.Style)(target)).Setters.Add(eventSetter);
            break;
            }
        }
    }
}

﻿using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Windows;
using System.Windows.Controls;
using System.Windows.Data;
using System.Windows.Documents;
using System.Windows.Input;
using System.Windows.Media;
using System.Windows.Media.Imaging;
using System.Windows.Navigation;
using System.Windows.Shapes;
using Autodesk.AutoCAD.ApplicationServices;
using AcadApp = Autodesk.AutoCAD.ApplicationServices.Application;
namespace Wpfs
{
    /// <summary>
    /// WpfPanel.xaml 的交互逻辑
    /// </summary>
    public partial class CollapsePanel : UserControl
    {
        public CollapsePanel()
        {
            InitializeComponent();
        }
        private void executeCommand(object sender, RoutedEventArgs e)
        {
            Document doc = AcadApp.DocumentManager.MdiActiveDocument;
            Button button=sender as Button;
            string content=button.Content.ToString();
            switch (content)
            {
                case "直线":
                    doc.SendStringToExecute("_Line ", true, false, true);
                    break;
                case "多段线":
                    doc.SendStringToExecute("_PLine ", true, false, true);
                    break;
                case "矩形":
                    doc.SendStringToExecute("_Rectangle ", true, false, true);
                    break;
                case "圆":
                    doc.SendStringToExecute("_Circle ", true, false, true);
                    break;
                case "复制":
                    doc.SendStringToExecute("_Copy ", true, false, true);
                    break;
                case "删除":
                    doc.SendStringToExecute("_Erase ", true, false, true);
                    break;
                case "移动":
                    doc.SendStringToExecute("_Move ", true, false, true);
                    break;
                case "旋转":
                    doc.SendStringToExecute("_Rotate ", true, false, true);
                    break;
            }
        }
    }
}
﻿using System;
using System.Windows.Forms;
using System.Windows.Forms.Integration;
using Autodesk.AutoCAD.Runtime;
using Autodesk.AutoCAD.Windows;
using AcadApp = Autodesk.AutoCAD.ApplicationServices.Application;
namespace Wpfs
{
    public class Command
    {
        internal static PaletteSet ps=null;
        [CommandMethod("ShowPalette")]
        public void ShowPalette()
        {
            if (ps == null)//如果面板没有被创建
            {
                //新建一个面板集对象
                ps = new PaletteSet("WPF面板示例", typeof(Command).GUID);
                //添加标题为“绑定”的面板项
                ps.AddVisual("绑定", new BindingPanel()); 
                //声明一个可以承载WPF元素的WinForm控件
                ElementHost host=new ElementHost();
                host.AutoSize = true;//WinForm控件可以自动调整大小
                host.Dock = DockStyle.Fill;//WinForm控件充满其容器窗口
                host.Child = new CollapsePanel();//设置要承载的WPF元素
                ps.Add("抽屉式面板", host);//添加标题为“抽屉式面板”的面板项
            }
            ps.Visible = true;//面板可见
        }
        [CommandMethod("ShowLayerWindow")]
        public static void ShowLayerWindow()
        {
            //新建一个WPF形式的自定义图层窗口
            LayerWindow dlg = new LayerWindow();
            //以非模式形式显示窗口
            AcadApp.ShowModelessWindow(dlg);            
        }        
    }
}
﻿using System.Collections.Generic;
using Autodesk.AutoCAD.ApplicationServices;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.EditorInput;
using Autodesk.AutoCAD.Runtime;
using DotNetARX;
namespace XDataFilter
{
    public class Commands : IExtensionApplication
    {
        private static DrawRule theOverrule;//重定义对象        
        public static readonly string appName="Door";//扩展数据应用程序名
        //定义门的类型和价格
        public static Dictionary<string,double> doors=new Dictionary<string, double>();
        [CommandMethod("Door")]
        public static void DrawDoor()
        {
            Document doc=Application.DocumentManager.MdiActiveDocument;
            Database db=doc.Database;
            Editor ed=doc.Editor;
            using (Transaction trans=db.TransactionManager.StartTransaction())
            {
                string doorType="木门";//门类型
                //提示用户输入表示门类型的关键字
                PromptKeywordOptions opt=new PromptKeywordOptions("\n请输入门的类型[木门(M)/铁门(T)/铝合金门(L)]<M>");
                opt.Keywords.Add("M");
                opt.Keywords.Add("T");
                opt.Keywords.Add("L");
                opt.Keywords.Default = "M";//缺省关键字
                opt.AppendKeywordsToMessage = false; //不将关键字列表添加到提示信息
                PromptResult result=ed.GetKeywords(opt);
                //根据用户输入的关键字，设置门的类型
                if (result.Status == PromptStatus.OK)
                {
                    switch (result.StringResult)
                    {
                        case "M":
                            break;
                        case "T":
                            doorType = "铁门";
                            break;
                        case "L":
                            doorType = "铝合金门";
                            break;
                    }
                }
                //选择需要转化门的直线
                ed.WriteMessage("\n请选择要转化为门的直线");
                var lines=db.GetSelection<Line>();
                if (lines.Count == 0) return;
                //遍历选择的直线，为其添加Door扩展数据
                foreach (var line in lines)
                {
                    TypedValueList values=new TypedValueList();
                    values.Add(DxfCode.ExtendedDataAsciiString, doorType);//门类型
                    values.Add(DxfCode.ExtendedDataReal, doors[doorType]);//门价格
                    line.ObjectId.AddXData(appName, values);//添加扩展数据
                }
                trans.Commit();
            }
        }
        public void Initialize()
        {
            //为直线类型添加OPM支持，以在属性面板上显示其扩展数据
            Masterhe.OPM.OPMManager.Add(typeof(Line), new DoorAtt());
            //添加各种类型的门及其价格
            doors.Add("木门", 1000);
            doors.Add("铁门", 2000);
            doors.Add("铝合金门", 3000);
            //初始化重定义对象
            if (theOverrule == null)
            {
                theOverrule = new DrawRule();
                //为直线类添加显示重定义
                Overrule.AddOverrule(RXObject.GetClass(typeof(Line)), theOverrule, false);
                //添加扩展数据过滤，只重定义有Door扩展数据的直线
                theOverrule.SetXDataFilter(appName);
            }
            Overrule.Overruling = true;//开启规则重定义
            //刷新屏幕，直线被更新为门
            Application.DocumentManager.MdiActiveDocument.Editor.Regen();
        }
        public void Terminate()
        {

        }
    }
}
﻿using System;
using System.Reflection;
using System.Runtime.InteropServices;
using Autodesk.AutoCAD.ApplicationServices;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.EditorInput;

namespace DotNetARX
{
    /// <summary>
    /// 用于ADSRX库函数（如acedCmd）输入参数的类型
    /// </summary>
    public enum ResBufCode
    {
        /// <summary>
        /// 用户输入值有效
        /// </summary>
        Norm = 5100,
        /// <summary>
        /// 没有结果
        /// </summary>
        None = 5000,
        /// <summary>
        /// 实数
        /// </summary>
        Real = 5001,
        /// <summary>
        /// 2维点
        /// </summary>
        Point2d = 5002,
        /// <summary>
        /// 短整型
        /// </summary>
        Short = 5003,
        /// <summary>
        /// 角度
        /// </summary>
        Angle = 5004,
        /// <summary>
        /// 字符串
        /// </summary>
        String = 5005,
        /// <summary>
        /// 实体Id
        /// </summary>
        ObjectId = 5006,
        /// <summary>
        /// 选择集名
        /// </summary>
        PickSet = 5007,
        /// <summary>
        /// 方向
        /// </summary>
        Orientation = 5008,
        /// <summary>
        /// 三维点
        /// </summary>
        Point3d = 5009,
        /// <summary>
        /// 长整数
        /// </summary>
        Long = 5010,
        /// <summary>
        /// 空白符号
        /// </summary>
        Void = 5014,
        /// <summary>
        /// 列表开始
        /// </summary>
        ListBegin = 5016,
        /// <summary>
        /// 列表结束
        /// </summary>
        ListEnd = 5017,
        /// <summary>
        /// 点对
        /// </summary>
        DottedPair = 5018,
        /// <summary>
        /// 空
        /// </summary>
        Nil = 5019,
        /// <summary>
        /// DXF为的0的组码
        /// </summary>
        DXF0 = 5020,
        /// <summary>
        /// T atom 
        /// </summary>
        TAtom = 5021,
        /// <summary>
        /// resbuf
        /// </summary>
        Resbuf = 5023,
        /// <summary>
        /// 无模式对话框
        /// </summary>
        Modeless = 5027,
    }

    /// <summary>
    ///  命令工具类，用来封装COM、C++中的调用AutoCAD命令的函数。
    /// </summary>
    public static class CommandTools
    {
        /// <summary>
        /// 调用COM的SendCommand函数
        /// </summary>
        /// <param name="doc">文档对象</param>
        /// <param name="args">命令参数列表</param>
        public static void SendCommand(this Document doc, params string[] args)
        {
            Type AcadDocument = Type.GetTypeFromHandle(Type.GetTypeHandle(doc.AcadDocument));
            try
            {
                // 通过后期绑定的方式调用SendCommand命令
                AcadDocument.InvokeMember("SendCommand", BindingFlags.InvokeMethod, null, doc.AcadDocument, args);
            }
            catch // 捕获异常
            {
                return;
            }
        }

        [DllImport("acad.exe", CharSet = CharSet.Auto, CallingConvention = CallingConvention.Cdecl, EntryPoint = "?acedPostCommand@@YAHPB_W@Z")]
        extern static private int acedPostCommand(string strExpr);
        /// <summary>
        /// 调用C++的acedPostCommand函数
        /// </summary>
        /// <param name="ed">无意义，只是为了定义扩展函数</param>
        /// <param name="expression">要执行的命令字符串</param>
        public static void PostCommand(this Editor ed, string expression)
        {
            acedPostCommand(expression);
        }

        [DllImport("acad.exe", CharSet = CharSet.Auto, CallingConvention = CallingConvention.Cdecl)]
        extern static private int ads_queueexpr(string strExpr);
        /// <summary>
        /// 调用C++的ads_queueexpr函数
        /// </summary>
        /// <param name="ed">无意义，只是为了定义扩展函数</param>
        /// <param name="expression">要执行的命令字符串</param>
        public static void QueueExpression(this Editor ed, string expression)
        {
            ads_queueexpr(expression);
        }

        //调用AutoCAD命令，ARX原型：int acedCmd(const struct resbuf * rbp);
        [DllImport("acad.exe", EntryPoint = "acedCmd", CharSet = CharSet.Auto, CallingConvention = CallingConvention.Cdecl)]
        private extern static int acedCmd(IntPtr rbp);
        /// <summary>
        /// 调用C++的acedCmd函数
        /// </summary>
        /// <param name="ed">无意义，只是为了定义扩展函数</param>
        /// <param name="args">命令参数列表</param>
        /// <returns>返回命令执行的状态</returns>
        public static int AcedCmd(this Editor ed, ResultBuffer args)
        {
            //由于acedCmd只能在程序环境下运行，因此需调用此语句
            if (!Application.DocumentManager.IsApplicationContext)
                return acedCmd(args.UnmanagedObject);
            else
                return 0;
        }
    }
}
﻿using System;
using Autodesk.AutoCAD.ApplicationServices;
using Autodesk.AutoCAD.Geometry;
using Autodesk.AutoCAD.Interop;
using Autodesk.AutoCAD.Runtime;
using System.Reflection;
namespace COMTest
{
    public class COMTest
    {
        [CommandMethod("ComMethod1")]
        public void ComMethod1()
        {
            //获取Application的COM对象
            AcadApplication appCom= Application.AcadApplication as AcadApplication;
            //定义缩放窗口的两个点
            Point3d pt1=Point3d.Origin;
            Point3d pt2=new Point3d(100, 100, 0);
            //调用ZoomWindow函数缩放窗口
            appCom.ZoomWindow(pt1.ToArray(), pt2.ToArray());
        }
        [CommandMethod("ComMethod2")]
        public void ComMethod2()
        {
            //获取Application的COM对象
            Type comType = Type.GetTypeFromHandle(Type.GetTypeHandle(Application.AcadApplication));
            Point3d pt1=Point3d.Origin;
            Point3d pt2=new Point3d(100, 100, 0);
            //通过后期绑定的方式调用ZoomWindow函数缩放窗口
            comType.InvokeMember("ZoomWindow", BindingFlags.InvokeMethod,
                null, Application.AcadApplication, new object[] { pt1.ToArray(), pt2.ToArray() });
        }
        [CommandMethod("ComProp1")]
        public void ComProp1()
        {
            //获取Application的COM对象
            AcadApplication appCom= Application.AcadApplication as AcadApplication;
            //获取Preferences对象
            AcadPreferences Preferences=appCom.Preferences;
            //获取光标大小
            int cursorSize=Preferences.Display.CursorSize;
            Application.ShowAlertDialog("当前光标大小为:" + cursorSize);
            Preferences.Display.CursorSize = 10;//设置光标大小
        }
        [CommandMethod("ComProp2")]
        public void ComProp2()
        {
            //获取光标大小
            int cursorSize=(int)GetProperties("Display", "CursorSize");
            Application.ShowAlertDialog("当前光标大小为:" + cursorSize);
            SetProperties("Display", "CursorSize", 5);//设置光标大小
        }
        public object GetProperties(string projectName, string propertyName)
        {
            try
            {
                //获取Preferences对象(COM类）
                Type AcadPreferences = Type.GetTypeFromHandle(Type.GetTypeHandle(Application.Preferences));
                //通过后期绑定的方式调用Preferences对象的projectName属性
                object obj = AcadPreferences.InvokeMember(projectName, BindingFlags.GetProperty, null, Application.Preferences, null);
                //获取ProjectName属性对应的COM类
                Type AcadPreferencesUnknown = Type.GetTypeFromHandle(Type.GetTypeHandle(obj));
                //获取ProjectName属性对应的COM类的propertyName属性
                return (object)AcadPreferencesUnknown.InvokeMember(propertyName, BindingFlags.GetProperty, null, obj, null);
            }
            catch
            {
                return null;
            }
        }
        public bool SetProperties(string projectName, string propertyName, object Value)
        {
            try
            {
                //获取Preferences对象(COM类）
                Type AcadPreferences = Type.GetTypeFromHandle(Type.GetTypeHandle(Application.Preferences));
                //通过后期绑定的方式调用Preferences对象的projectName属性
                object obj = AcadPreferences.InvokeMember(projectName, BindingFlags.GetProperty, null, Application.Preferences, null);
                //获取ProjectName属性对应的COM类
                Type AcadPreferencesUnknown = Type.GetTypeFromHandle(Type.GetTypeHandle(obj));
                //设置projectName属性对应的COM类的propertyName属性
                AcadPreferencesUnknown.InvokeMember(propertyName, BindingFlags.SetProperty, null, obj, new object[1] { Value });
                return true;
            }
            catch
            {
                return false;
            }
        }
    }
}
﻿using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using Autodesk.AutoCAD.ApplicationServices;
using System.Reflection;
using System.Drawing;

namespace DotNetARX
{
    /// <summary>
    /// 文字的字体样式
    /// </summary>
    public enum FontStyle
    {
        /// <summary>
        /// 常规
        /// </summary>
        Regular,
        /// <summary>
        /// 斜体
        /// </summary>
        Italic,
        /// <summary>
        /// 加粗
        /// </summary>
        Bold,
        /// <summary>
        /// 加粗斜体
        /// </summary>
        BoldItalic
    }

    /// <summary>
    /// 如何获取自动对齐点
    /// </summary>
    public enum AlignmentPointAcquisition
    {
        /// <summary>
        /// 自动获取自动对齐点
        /// </summary>
        Automatic,
        /// <summary>
        /// 用户必须使用shift键获取自动对齐点
        /// </summary>
        ShiftToAcquire
    }

    /// <summary>
    /// 指定若图形包含第三方应用程序所创建的自定义对象时，是否以及何时由 AutoCAD 按需加载该应用程序
    /// </summary>
    public enum ARXDemandLoad
    {
        /// <summary>
        /// 关闭按需加载
        /// </summary>
        Disabled,
        /// <summary>
        /// 在打开包含自定义对象的图形时按需加载源应用程序
        /// </summary>
        OnObjectDetect,
        /// <summary>
        /// 在调用应用程序的某个命令时按需加载源应用程序
        /// </summary>
        CmdInvoke
    }

    /// <summary>
    /// 指定外部参照对象的按需加载性能
    /// </summary>
    public enum XRefDemandLoad
    {
        /// <summary>
        /// 关闭按需加载，加载整个参照图形
        /// </summary>
        Disabled,
        /// <summary>
        /// 打开按需加载来提高AutoCAD性能
        /// </summary>
        LoadEnabled,
        /// <summary>
        /// 打开按需加载但使用参照图形的临时副本
        /// </summary>
        EnabledWithCopy
    }

    /// <summary>
    /// 控制图形中由第三方应用程序所创建对象的显示
    /// </summary>
    public enum ProxyImage
    {
        /// <summary>
        /// 不显示代理对象
        /// </summary>
        NotShow,
        /// <summary>
        /// 显示所有代理对象的图形图像
        /// </summary>
        Show,
        /// <summary>
        /// 仅显示所有代理对象的边框
        /// </summary>
        BoundingBox
    }

    /// <summary>
    /// 指定图形的保存类型
    /// </summary>
    public enum SaveAsType
    {
        /// <summary>
        /// AutoCAD R14 DWG (*.dwg)
        /// </summary>
        acR14_dwg = 8,
        /// <summary>
        /// AutoCAD 2000 DWG (*.dwg)
        /// </summary>
        ac2000_dwg = 12,
        /// <summary>
        /// AutoCAD 2000 DXF (*.dxf)
        /// </summary>
        ac2000_dxf = 13,
        /// <summary>
        /// AutoCAD 2000 图形样板文件 (*.dwt)
        /// </summary>
        ac2000_Template = 14,
        /// <summary>
        /// AutoCAD 2004 DWG (*.dwg)
        /// </summary>
        ac2004_dwg = 24,
        /// <summary>
        /// AutoCAD 2004 DXF (*.dxf)
        /// </summary>
        ac2004_dxf = 25,
        /// <summary>
        /// AutoCAD 2004 图形样板文件 (*.dwt)
        /// </summary>
        ac2004_Template = 26,
        /// <summary>
        /// AutoCAD 2007 DWG (*.dwg)
        /// </summary>
        ac2007_dwg = 36,
        /// <summary>
        /// AutoCAD 2007 DXF (*.dxf)
        /// </summary>
        ac2007_dxf = 37,
        /// <summary>
        /// AutoCAD 2007 图形样板文件 (*.dwt)
        /// </summary>
        ac2007_Template = 38,
        /// <summary>
        /// AutoCAD 2010 DWG (*.dwg)
        /// </summary>
        ac2010_dwg = 48,
        /// <summary>
        /// AutoCAD 2010 DXF (*.dxf)
        /// </summary>
        ac2010_dxf,
        /// <summary>
        /// AutoCAD 2010 图形样板文件 (*.dwt)
        /// </summary>
        ac2010_Template,
        /// <summary>
        /// 与当前图形版本格式相同
        /// </summary>
        acNative = 36,
        /// <summary>
        /// 图形类型未知或无效
        /// </summary>
        acUnknown = -1,
    }

    /// <summary>
    /// 指定OLE对象的打印质量 
    /// </summary>
    public enum OleQuality
    {
        /// <summary>
        /// 线条
        /// </summary>
        LineArt,
        /// <summary>
        /// 文字
        /// </summary>
        Text,
        /// <summary>
        /// 图形
        /// </summary>
        Graphics,
        /// <summary>
        /// 照片
        /// </summary>
        Photo,
        /// <summary>
        /// 高质量照片
        /// </summary>
        HighPhoto
    }

    /// <summary>
    /// 确定在创建新图形时对象颜色属性是否与打印样式名称关联
    /// </summary>
    public enum PlotPolicy
    {
        /// <summary>
        /// 为新图形或早期的AutoCAD版本下的图形指定颜色相关打印样式
        /// </summary>
        Legacy,
        /// <summary>
        /// 为新图形或早期的AutoCAD版本下的图形指定命名打印样式
        /// </summary>
        Named
    }

    /// <summary>
    /// 指定当由于I/O 端口冲突造成向设备的输出必须通过系统打印机缓冲时是否警告用户
    /// </summary>
    public enum PrinterSpoolAlert
    {
        /// <summary>
        /// 始终警告并创建错误日志
        /// </summary>
        AlwaysAlert,
        /// <summary>
        /// 仅第一次警告但创建所有错误日志
        /// </summary>
        AlertOnce,
        /// <summary>
        /// 从不警告但创建所有错误日志
        /// </summary>
        NeverAlertLogOnce,
        /// <summary>
        /// 从不警告也从不创建任何错误日志
        /// </summary>
        NeverAlert
    }

    /// <summary>
    /// 确定在 AutoCAD 设计中心源图形未分配插入单位的对象自动使用的单位
    /// </summary>
    public enum InsertUnits
    {
        /// <summary>
        /// 不指定（无单位）
        /// </summary>
        Unitless,
        /// <summary>
        /// 英寸
        /// </summary>
        Inches,
        /// <summary>
        /// 英尺
        /// </summary>
        Feet,
        /// <summary>
        /// 英里
        /// </summary>
        Miles,
        /// <summary>
        /// 毫米
        /// </summary>
        Millimeters,
        /// <summary>
        /// 厘米
        /// </summary>
        Centimeters,
        /// <summary>
        /// 米
        /// </summary>
        Meters,
        /// <summary>
        /// 公里
        /// </summary>
        Kilometers,
        /// <summary>
        /// 微英寸
        /// </summary>
        Microinches,
        /// <summary>
        /// 英里
        /// </summary>
        Mils,
        /// <summary>
        /// 码
        /// </summary>
        Yards,
        /// <summary>
        /// 埃
        /// </summary>
        Angstroms,
        /// <summary>
        /// 纳米
        /// </summary>
        Nanometers,
        /// <summary>
        /// 微米
        /// </summary>
        Microns,
        /// <summary>
        /// 分米
        /// </summary>
        Decimeters,
        /// <summary>
        /// 十米
        /// </summary>
        Decameters,
        /// <summary>
        /// 百米
        /// </summary>
        Hectometers,
        /// <summary>
        /// 百万公里
        /// </summary>
        Gigameters,
        /// <summary>
        /// 天文单位
        /// </summary>
        AstronomicalUnits,
        /// <summary>
        /// 光年
        /// </summary>
        LightYears,
        /// <summary>
        /// 秒差距
        /// </summary>
        Parsecs
    }

    /// <summary>
    /// 指定 Windows 标准或 AutoCAD 传统快捷键
    /// </summary>
    public enum KeyboardAccelerator
    {
        /// <summary>
        /// 使用 AutoCAD 传统键盘设置
        /// </summary>
        PreferenceClassic,
        /// <summary>
        /// 使用 Windows 标准键盘设置
        /// </summary>
        PreferenceCustom
    }

    /// <summary>
    /// 控制 AutoCAD 如何响应坐标数据的输入
    /// </summary>
    public enum KeyboardPriority
    {
        /// <summary>
        /// 当输入坐标时，严格遵照对象捕捉模式
        /// </summary>
        RunningObjSnap,
        /// <summary>
        /// 当输入坐标时，严格遵照键盘输入模式
        /// </summary>
        Entry,
        /// <summary>
        /// 当输入坐标时，严格按照键盘输入模式。但当坐标是通过脚本输入时，遵照对象捕捉模式
        /// </summary>
        EntryExceptScripts
    }

    /// <summary>
    /// 决定处于命令模式 (有一个命令正在执行) 时绘图区域中右键单击的功能
    /// </summary>
    public enum DrawingAreaSCMCommand
    {
        /// <summary>
        /// 禁用命令快捷菜单,结果为当命令期间按右键为回车
        /// </summary>
        Enter,
        /// <summary>
        /// 启用命令快捷菜单
        /// </summary>
        EnableSCM,
        /// <summary>
        /// 只在命令行提示中选项当前有效时启用命令快捷菜单。在命令行提示中，选项是在方括号[]中。如果没有有效的选项，右键为回车
        /// </summary>
        EnableSCMOptions
    }

    /// <summary>
    /// 决定处于默认模式 (未选中对象且无命令在执行) 时绘图区域中右键单击的功能
    /// </summary>
    public enum DrawingAreaSCMDefault
    {
        /// <summary>
        /// 禁用默认快捷菜单
        /// </summary>
        RepeatLastCommand,
        /// <summary>
        /// 启用默认快捷菜单
        /// </summary>
        SCM
    }

    /// <summary>
    /// 决定处于编辑模式 (选中一个或多个对象且无命令在执行) 时绘图区域中右键单击的功能
    /// </summary>
    public enum DrawingAreaSCMEdit
    {
        /// <summary>
        /// 禁用编辑快捷菜单
        /// </summary>
        EdRepeatLastCommand,
        /// <summary>
        /// 启用编辑快捷菜单
        /// </summary>
        EdSCM
    }

    /// <summary>
    /// 封装COM的Preferences类，该类指定当前 AutoCAD 设置
    /// </summary>
    public static class Preferences
    {
        //获取Preferences对象(COM类）
        static Type AcadPreferences = Type.GetTypeFromHandle(Type.GetTypeHandle(Application.Preferences));  
      
        /// <summary>
        /// 获取“选项”对话框对应选项卡上选项的属性值
        /// </summary>
        /// <param name="ProjectName">选项卡名称</param>
        /// <param name="PropertyName">属性名称</param>
        /// <returns>返回选项的属性值</returns>
        public static object GetProperties(string ProjectName, string PropertyName)
        {
            try
            {
                //通过后期绑定的方式调用Preferences对象的ProjectName属性
                object obj = AcadPreferences.InvokeMember(ProjectName, BindingFlags.GetProperty, null, Application.Preferences, new object[0]);
                //获取ProjectName属性对应的COM类
                Type AcadPreferencesUnknown = Type.GetTypeFromHandle(Type.GetTypeHandle(obj));
                //获取ProjectName属性对应的COM类的PropertyName属性
                return (object)AcadPreferencesUnknown.InvokeMember(PropertyName, BindingFlags.GetProperty, null, obj, new object[0]);
            }
            catch
            {
                return null;
            }
        }

        /// <summary>
        /// 设置“选项”对话框对应选项卡上选项的属性值
        /// </summary>
        /// <param name="ProjectName">选项卡名称</param>
        /// <param name="PropertyName">属性名称</param>
        /// <param name="Value">属性值</param>
        /// <returns>如果属性设置成功，则返回true，否则返回false</returns>
        public static bool SetProperties(string ProjectName, string PropertyName, object Value)
        {
            try
            {
                object obj = AcadPreferences.InvokeMember(ProjectName, BindingFlags.GetProperty, null, Application.Preferences, new object[0]);
                Type AcadPreferencesUnknown = Type.GetTypeFromHandle(Type.GetTypeHandle(obj));
                AcadPreferencesUnknown.InvokeMember(PropertyName, BindingFlags.SetProperty, null, obj, new object[1] { Value });
                return true;
            }
            catch
            {
                return false;
            }
        }

        /// <summary>
        /// “选项”对话框“显示”选项卡的所有选项
        /// </summary>
        public static class Display
        {
            /// <summary>
            /// 获取或设置自动追踪矢量的颜色
            /// </summary>
            public static Color AutoTrackingVecColor
            {
                get { return ColorTranslator.FromOle(Convert.ToInt32(Preferences.GetProperties("Display", "AutoTrackingVecColor"))); }
                set { Preferences.SetProperties("Display", "AutoTrackingVecColor", ColorTranslator.ToOle(value)); }
            }

            /// <summary>
            /// 获取或设置十字光标的大小（屏幕大小的百分比）
            /// </summary>
            public static int CursorSize
            {
                get { return (int)Preferences.GetProperties("Display", "CursorSize"); }
                set { Preferences.SetProperties("Display", "CursorSize", value); }
            }

            /// <summary>
            /// 获取或设置是否在图形编辑器中显示模型和布局选项卡
            /// </summary>
            public static bool DisplayLayoutTabs
            {
                get { return (bool)Preferences.GetProperties("Display", "DisplayLayoutTabs"); }
                set { Preferences.SetProperties("Display", "DisplayLayoutTabs", value); }
            }

            /// <summary>
            /// 获取或设置是否在图形窗口的右边显示屏幕菜单。
            /// </summary>
            public static bool DisplayScreenMenu
            {
                get { return (bool)Preferences.GetProperties("Display", "DisplayScreenMenu"); }
                set { Preferences.SetProperties("Display", "DisplayScreenMenu", value); }
            }

            /// <summary>
            /// 获取或设置是否在图形窗口的下边和右边显示滚动条
            /// </summary>
            public static bool DisplayScrollBars
            {
                get { return (bool)Preferences.GetProperties("Display", "DisplayScrollBars"); }
                set { Preferences.SetProperties("Display", "DisplayScrollBars", value); }
            }

            /// <summary>
            /// 获取或设置命令窗口所显示的文字行数
            /// </summary>
            public static int DockedVisibleLines
            {
                get { return (int)Preferences.GetProperties("Display", "DockedVisibleLines"); }
                set { Preferences.SetProperties("Display", "DockedVisibleLines", value); }
            }

            /// <summary>
            /// 获取或设置图纸空间布局的背景颜色
            /// </summary>
            public static Color GraphicsWinLayoutBackgrndColor
            {
                get { return ColorTranslator.FromOle(Convert.ToInt32(Preferences.GetProperties("Display", "GraphicsWinLayoutBackgrndColor"))); }
                set { Preferences.SetProperties("Display", "GraphicsWinLayoutBackgrndColor", ColorTranslator.ToOle(value)); }
            }

            /// <summary>
            /// 获取或设置模型空间窗口的背景颜色
            /// </summary>
            public static Color GraphicsWinModelBackgrndColor
            {
                get { return ColorTranslator.FromOle(Convert.ToInt32(Preferences.GetProperties("Display", "GraphicsWinModelBackgrndColor"))); }
                set { Preferences.SetProperties("Display", "GraphicsWinModelBackgrndColor", ColorTranslator.ToOle(value)); }
            }

            /// <summary>
            /// 获取或设置保留在内存中的文本窗口中的文字行数
            /// </summary>
            public static int HistoryLines
            {
                get { return (int)Preferences.GetProperties("Display", "HistoryLines"); }
                set { Preferences.SetProperties("Display", "HistoryLines", value); }
            }

            /// <summary>
            /// 获取或设置是否在选择过程中显示光栅图像
            /// </summary>
            public static bool ImageFrameHighlight
            {
                get { return (bool)Preferences.GetProperties("Display", "ImageFrameHighlight"); }
                set { Preferences.SetProperties("Display", "ImageFrameHighlight", value); }
            }

            /// <summary>
            /// 获取或设置是否自动为新布局创建视口
            /// </summary>
            public static bool LayoutCreateViewport
            {
                get { return (bool)Preferences.GetProperties("Display", "LayoutCreateViewport"); }
                set { Preferences.SetProperties("Display", "LayoutCreateViewport", value); }
            }

            /// <summary>
            /// 获取或设置图纸空间布局中十字光标和文字的颜色
            /// </summary>
            public static Color LayoutCrosshairColor
            {
                get { return ColorTranslator.FromOle(Convert.ToInt32(Preferences.GetProperties("Display", "LayoutCrosshairColor"))); }
                set { Preferences.SetProperties("Display", "LayoutCrosshairColor", ColorTranslator.ToOle(value)); }
            }

            /// <summary>
            /// 获取或设置是否在布局中显示页边距
            /// </summary>
            public static bool LayoutDisplayMargins
            {
                get { return (bool)Preferences.GetProperties("Display", "LayoutDisplayMargins"); }
                set { Preferences.SetProperties("Display", "LayoutDisplayMargins", value); }
            }

            /// <summary>
            /// 获取或设置是否在布局中显示图纸背景
            /// </summary>
            public static bool LayoutDisplayPaper
            {
                get { return (bool)Preferences.GetProperties("Display", "LayoutDisplayPaper"); }
                set { Preferences.SetProperties("Display", "LayoutDisplayPaper", value); }
            }

            /// <summary>
            /// 获取或设置是否在布局中显示图纸背景阴影
            /// </summary>
            public static bool LayoutDisplayPaperShadow
            {
                get { return (bool)Preferences.GetProperties("Display", "LayoutDisplayPaperShadow"); }
                set { Preferences.SetProperties("Display", "LayoutDisplayPaperShadow", value); }
            }

            /// <summary>
            /// 获取或设置是否在创建新布局时显示“打印设置”对话框
            /// </summary>
            public static bool LayoutShowPlotSetup
            {
                get { return (bool)Preferences.GetProperties("Display", "LayoutShowPlotSetup"); }
                set { Preferences.SetProperties("Display", "LayoutShowPlotSetup", value); }
            }

            /// <summary>
            /// 获取或设置在AutoCAD 启动时是否布满整个屏幕
            /// </summary>
            public static bool MaxAutoCADWindow
            {
                get { return (bool)Preferences.GetProperties("Display", "MaxAutoCADWindow"); }
                set { Preferences.SetProperties("Display", "MaxAutoCADWindow", value); }
            }

            /// <summary>
            /// 获取或设置模型空间十字光标和文字的颜色
            /// </summary>
            public static Color ModelCrosshairColor
            {
                get { return ColorTranslator.FromOle(Convert.ToInt32(Preferences.GetProperties("Display", "ModelCrosshairColor"))); }
                set { Preferences.SetProperties("Display", "ModelCrosshairColor", ColorTranslator.ToOle(value)); }
            }

            /// <summary>
            /// 获取或设置是否在实时平移和缩放时显示光栅图像
            /// </summary>
            public static bool ShowRasterImage
            {
                get { return (bool)Preferences.GetProperties("Display", "ShowRasterImage"); }
                set { Preferences.SetProperties("Display", "ShowRasterImage", value); }
            }

            /// <summary>
            /// 获取或设置文字的字号
            /// </summary>
            public static int TextFontSize
            {
                get { return (int)Preferences.GetProperties("Display", "TextFontSize"); }
                set { Preferences.SetProperties("Display", "TextFontSize", value); }
            }

            /// <summary>
            /// 获取或设置文字的字体
            /// </summary>
            public static string TextFont
            {
                get { return (string)Preferences.GetProperties("Display", "TextFont"); }
                set { Preferences.SetProperties("Display", "TextFont", value); }
            }

            /// <summary>
            /// 获取或设置文字的字体样式
            /// </summary>
            public static FontStyle TextFontStyle
            {
                get { return (FontStyle)Preferences.GetProperties("Display", "TextFontStyle"); }
                set { Preferences.SetProperties("Display", "TextFontStyle", value); }
            }

            /// <summary>
            /// 获取或设置文本窗口的背景颜色
            /// </summary>
            public static Color TextWinBackgrndColor
            {
                get { return ColorTranslator.FromOle(Convert.ToInt32(Preferences.GetProperties("Display", "TextWinBackgrndColor"))); }
                set { Preferences.SetProperties("Display", "TextWinBackgrndColor", ColorTranslator.ToOle(value)); }
            }

            /// <summary>
            /// 获取或设置文本窗口的文字颜色
            /// </summary>
            public static Color TextWinTextColor
            {
                get { return ColorTranslator.FromOle(Convert.ToInt32(Preferences.GetProperties("Display", "TextWinTextColor"))); }
                set { Preferences.SetProperties("Display", "TextWinTextColor", ColorTranslator.ToOle(value)); }
            }

            /// <summary>
            /// 获取或设置是否以真彩色显示光栅和渲染图像
            /// </summary>
            public static bool TrueColorImages
            {
                get { return (bool)Preferences.GetProperties("Display", "TrueColorImages"); }
                set { Preferences.SetProperties("Display", "TrueColorImages", value); }
            }

            /// <summary>
            /// 获取或设置照对象的褪色度百分比
            /// </summary>
            public static int XRefFadeIntensity
            {
                get { return (int)Preferences.GetProperties("Display", "XRefFadeIntensity"); }
                set { Preferences.SetProperties("Display", "XRefFadeIntensity", value); }
            }
        }

        /// <summary>
        /// “选项”对话框“文件”选项卡的所有选项
        /// </summary>
        public static class Files
        {
            /// <summary>
            /// 获取或设置AutoCAD 进程的活动配置
            /// </summary>
            public static string ActiveProfile
            {
                get { return (string)Preferences.GetProperties("Profiles", "ActiveProfile"); }
                set { Preferences.SetProperties("Profiles", "ActiveProfile", value); }
            }

            /// <summary>
            /// 当 AutoCAD 找不到源字体并且字体映射文件中未指定替换字体时所使用的字体文件的位置
            /// </summary>
            public static string AltFontFile
            {
                get { return (string)Preferences.GetProperties("Files", "AltFontFile"); }
                set { Preferences.SetProperties("Files", "AltFontFile", value); }
            }

            /// <summary>
            /// 获取或设置与标准 AutoCAD 数字化仪菜单交换的替换菜单的路径
            /// </summary>
            public static string AltTabletMenuFile
            {
                get { return (string)Preferences.GetProperties("Files", "AltTabletMenuFile"); }
                set { Preferences.SetProperties("Files", "AltTabletMenuFile", value); }
            }

            /// <summary>
            /// 获取或设置自动保存所创建文件的路径
            /// </summary>
            public static string AutoSavePath
            {
                get { return (string)Preferences.GetProperties("Files", "AutoSavePath"); }
                set { Preferences.SetProperties("Files", "AutoSavePath", value); }
            }

            /// <summary>
            /// 获取或设置配色系统路径
            /// </summary>
            public static string ColorBookPath
            {
                get { return (string)Preferences.GetProperties("Files", "ColorBookPath"); }
                set { Preferences.SetProperties("Files", "ColorBookPath", value); }
            }

            /// <summary>
            /// 获取或设置用于保存硬件设备驱动程序信息的配置文件的位置
            /// </summary>
            public static string ConfigFile
            {
                get { return (string)Preferences.GetProperties("Files", "ConfigFile"); }
            }

            /// <summary>
            /// 获取或设置自定义词典
            /// </summary>
            public static string CustomDictionary
            {
                get { return (string)Preferences.GetProperties("Files", "CustomDictionary"); }
                set { Preferences.SetProperties("Files", "CustomDictionary", value); }
            }

            /// <summary>
            /// 获取或设置默认 Internet 地址
            /// </summary>
            public static string DefaultInternetURL
            {
                get { return (string)Preferences.GetProperties("Files", "DefaultInternetURL"); }
                set { Preferences.SetProperties("Files", "DefaultInternetURL", value); }
            }

            /// <summary>
            /// 获取或设置AutoCAD 查找视频显示、定点设备、打印机和绘图仪所用 ADI 设备驱动程序的目录
            /// </summary>
            public static string DriversPath
            {
                get { return (string)Preferences.GetProperties("Files", "DriversPath"); }
                set { Preferences.SetProperties("Files", "DriversPath", value); }
            }

            /// <summary>
            /// 获取或设置用于定义当 AutoCAD 不能找到字体时替换字体的文件位置
            /// </summary>
            public static string FontFileMap
            {
                get { return (string)Preferences.GetProperties("Files", "FontFileMap"); }
                set { Preferences.SetProperties("Files", "FontFileMap", value); }
            }

            /// <summary>
            /// 获取或设置AutoCAD 帮助文件的位置
            /// </summary>
            public static string HelpFilePath
            {
                get { return (string)Preferences.GetProperties("Files", "HelpFilePath"); }
                set { Preferences.SetProperties("Files", "HelpFilePath", value); }
            }

            /// <summary>
            /// 获取或设置日志文件的位置
            /// </summary>
            public static string LogFilePath
            {
                get { return (string)Preferences.GetProperties("Files", "LogFilePath"); }
                set { Preferences.SetProperties("Files", "LogFilePath", value); }
            }

            /// <summary>
            /// 获取或设置用于拼写检查的当前词典
            /// </summary>
            public static string MainDictionary
            {
                get { return (string)Preferences.GetProperties("Files", "MainDictionary"); }
                set { Preferences.SetProperties("Files", "MainDictionary", value); }
            }

            /// <summary>
            /// 获取或设置进程的 AutoCAD 菜单或自定义文件的位置
            /// </summary>
            public static string MenuFile
            {
                get { return (string)Preferences.GetProperties("Files", "MenuFile"); }
                set { Preferences.SetProperties("Files", "MenuFile", value); }
            }

            /// <summary>
            /// 获取或设置页面设置中的替代样板文件的位置
            /// </summary>
            public static string PageSetupOverridesTemplateFile
            {
                get { return (string)Preferences.GetProperties("Files", "ageSetupOverridesTemplateFile"); }
                set { Preferences.SetProperties("Files", "ageSetupOverridesTemplateFile", value); }
            }

            /// <summary>
            /// 获取或设置打印日志文件的位置
            /// </summary>
            public static string PlotLogFilePath
            {
                get { return (string)Preferences.GetProperties("Files", "lotLogFilePath"); }
                set { Preferences.SetProperties("Files", "lotLogFilePath", value); }
            }

            /// <summary>
            /// 获取或设置acad.psf 文件中自定义前导部分的名称
            /// </summary>
            public static string PostScriptPrologFile
            {
                get { return (string)Preferences.GetProperties("Files", "ostScriptPrologFile"); }
                set { Preferences.SetProperties("Files", "ostScriptPrologFile", value); }
            }

            /// <summary>
            /// 获取或设置打印机配置文件的位置
            /// </summary>
            public static string PrinterConfigPath
            {
                get { return (string)Preferences.GetProperties("Files", "rinterConfigPath"); }
                set { Preferences.SetProperties("Files", "rinterConfigPath", value); }
            }

            /// <summary>
            /// 获取或设置打印机描述文件的位置
            /// </summary>
            public static string PrinterDescPath
            {
                get { return (string)Preferences.GetProperties("Files", "rinterDescPath"); }
                set { Preferences.SetProperties("Files", "rinterDescPath", value); }
            }

            /// <summary>
            /// 获取或设置打印机样式表文件的位置
            /// </summary>
            public static string PrinterStyleSheetPath
            {
                get { return (string)Preferences.GetProperties("Files", "rinterStyleSheetPath"); }
                set { Preferences.SetProperties("Files", "rinterStyleSheetPath", value); }
            }

            /// <summary>
            /// 获取或设置用作临时打印文件名的替换名称
            /// </summary>
            public static string PrintFile
            {
                get { return (string)Preferences.GetProperties("Files", "rintFile"); }
                set { Preferences.SetProperties("Files", "rintFile", value); }
            }

            /// <summary>
            /// 获取或设置后台打印文件的目录
            /// </summary>
            public static string PrintSpoolerPath
            {
                get { return (string)Preferences.GetProperties("Files", "rintSpoolerPath"); }
                set { Preferences.SetProperties("Files", "rintSpoolerPath", value); }
            }

            /// <summary>
            /// 获取或设置用于后台打印的应用程序
            /// </summary>
            public static string PrintSpoolExecutable
            {
                get { return (string)Preferences.GetProperties("Files", "rintSpoolExecutable"); }
                set { Preferences.SetProperties("Files", "rintSpoolExecutable", value); }
            }

            /// <summary>
            /// 获取或设置QNew命令的图形样板文件的位置
            /// </summary>
            public static string QNewTemplateFile
            {
                get { return (string)Preferences.GetProperties("Files", "QNewTemplateFile"); }
                set { Preferences.SetProperties("Files", "QNewTemplateFile", value); }
            }

            /// <summary>
            /// 获取或设置AutoCAD 搜索支持文件的目录
            /// </summary>
            public static string SupportPath
            {
                get { return (string)Preferences.GetProperties("Files", "SupportPath"); }
                set { Preferences.SetProperties("Files", "SupportPath", value); }
            }

            /// <summary>
            /// 获取或设置AutoCAD用于保存临时文件的目录
            /// </summary>
            public static string TempFilePath
            {
                get { return (string)Preferences.GetProperties("Files", "TempFilePath"); }
                set { Preferences.SetProperties("Files", "TempFilePath", value); }
            }

            /// <summary>
            /// 获取或设置“启动”向导所使用样板文件的路径
            /// </summary>
            public static string TemplateDWGPath
            {
                get { return (string)Preferences.GetProperties("Files", "TemplateDWGPath"); }
                set { Preferences.SetProperties("Files", "TemplateDWGPath", value); }
            }

            /// <summary>
            /// 获取或设置外部参照文件的位置
            /// </summary>
            public static string TempXRefPath
            {
                get { return (string)Preferences.GetProperties("Files", "TempXRefPath"); }
                set { Preferences.SetProperties("Files", "TempXRefPath", value); }
            }

            /// <summary>
            /// 获取或设置MTEXT 命令所使用文字编辑器的名称
            /// </summary>
            public static string TextEditor
            {
                get { return (string)Preferences.GetProperties("Files", "TextEditor"); }
                set { Preferences.SetProperties("Files", "TextEditor", value); }
            }

            /// <summary>
            /// 获取或设置AutoCAD 搜索渲染纹理贴图的目录
            /// </summary>
            public static string TextureMapPath
            {
                get { return (string)Preferences.GetProperties("Files", "TextureMapPath"); }
                set { Preferences.SetProperties("Files", "TextureMapPath", value); }
            }

            /// <summary>
            /// 获取或设置工具选项板路径
            /// </summary>
            public static string ToolPalettePath
            {
                get { return (string)Preferences.GetProperties("Files", "ToolPalettePath"); }
                set { Preferences.SetProperties("Files", "ToolPalettePath", value); }
            }

            /// <summary>
            /// 获取或设置工作空间文件的路径
            /// </summary>
            public static string WorkspacePath
            {
                get { return (string)Preferences.GetProperties("Files", "WorkspacePath"); }
                set { Preferences.SetProperties("Files", "WorkspacePath", value); }
            }

        }

        /// <summary>
        /// “选项”对话框“绘图”选项卡的所有选项
        /// </summary>
        public static class Drafting
        {
            /// <summary>
            /// 获取或设置获取自动对齐点的方式
            /// </summary>
            public static AlignmentPointAcquisition AlignmentPointAcquisition
            {
                get { return (AlignmentPointAcquisition)Preferences.GetProperties("Drafting", "AlignmentPointAcquisition"); }
                set { Preferences.SetProperties("Drafting", "AlignmentPointAcquisition", value); }
            }

            /// <summary>
            /// 获取或设置是否显示自动捕捉靶框
            /// </summary>
            public static bool AutoSnapAperture
            {
                get { return (bool)Preferences.GetProperties("Drafting", "AutoSnapAperture"); }
                set { Preferences.SetProperties("Drafting", "AutoSnapAperture", value); }
            }

            /// <summary>
            /// 获取或设置自动捕捉靶框的大小
            /// </summary>
            public static int AutoSnapApertureSize
            {
                get { return (int)Preferences.GetProperties("Drafting", "AutoSnapApertureSize"); }
                set { Preferences.SetProperties("Drafting", "AutoSnapApertureSize", value); }
            }

            /// <summary>
            /// 获取或设置是否打开自动捕捉磁吸
            /// </summary>
            public static bool AutoSnapMagnet
            {
                get { return (bool)Preferences.GetProperties("Drafting", "AutoSnapMagnet"); }
                set { Preferences.SetProperties("Drafting", "AutoSnapMagnet", value); }
            }

            /// <summary>
            /// 获取或设置是否打开自动捕捉标记
            /// </summary>
            public static bool AutoSnapMarker
            {
                get { return (bool)Preferences.GetProperties("Drafting", "AutoSnapMarker"); }
                set { Preferences.SetProperties("Drafting", "AutoSnapMarker", value); }
            }

            /// <summary>
            /// 获取或设置自动捕捉标记的颜色
            /// </summary>
            public static Color AutoSnapMarkerColor
            {
                get { return ColorTranslator.FromOle(Convert.ToInt32(Preferences.GetProperties("Drafting", "AutoSnapMarkerColor"))); }
                set { Preferences.SetProperties("Drafting", "AutoSnapMarkerColor", ColorTranslator.ToOle(value)); }
            }

            /// <summary>
            /// 获取或设置自动捕捉标记的大小
            /// </summary>
            public static int AutoSnapMarkerSize
            {
                get { return (int)Preferences.GetProperties("Drafting", "AutoSnapMarkerSize"); }
                set { Preferences.SetProperties("Drafting", "AutoSnapMarkerSize", value); }
            }

            /// <summary>
            /// 获取或设置是否打开自动捕捉工具提示
            /// </summary>
            public static bool AutoSnapToolTip
            {
                get { return (bool)Preferences.GetProperties("Drafting", "AutoSnapToolTip"); }
                set { Preferences.SetProperties("Drafting", "AutoSnapToolTip", value); }
            }

            /// <summary>
            /// 获取或设置是否打开自动追踪工具提示
            /// </summary>
            public static bool AutoTrackTooltip
            {
                get { return (bool)Preferences.GetProperties("Drafting", "AutoTrackTooltip"); }
                set { Preferences.SetProperties("Drafting", "AutoTrackTooltip", value); }
            }

            /// <summary>
            /// 获取或设置是否打开全屏追踪矢量
            /// </summary>
            public static bool FullScreenTrackingVector
            {
                get { return (bool)Preferences.GetProperties("Drafting", "FullScreenTrackingVector"); }
                set { Preferences.SetProperties("Drafting", "FullScreenTrackingVector", value); }
            }

            /// <summary>
            /// 获取或设置是否打开极轴追踪矢量
            /// </summary>
            public static bool PolarTrackingVector
            {
                get { return (bool)Preferences.GetProperties("Drafting", "PolarTrackingVector"); }
                set { Preferences.SetProperties("Drafting", "PolarTrackingVector", value); }
            }

        }

        /// <summary>
        /// “选项”对话框“打开和保存”选项卡的所有选项
        /// </summary>
        public static class OpenSave
        {
            /// <summary>
            /// 在渲染 DXFIN 或 DTBIN 交换命令后 AutoCAD 是否执行核查
            /// </summary>
            public static bool AutoAudit
            {
                get { return (bool)Preferences.GetProperties("OpenSave", "AutoAudit"); }
                set { Preferences.SetProperties("OpenSave", "AutoAudit", value); }
            }

            /// <summary>
            /// 获取或设置自动保存间隔的分钟数
            /// </summary>
            public static int AutoSaveInterval
            {
                get { return (int)Preferences.GetProperties("OpenSave", "AutoSaveInterval"); }
                set { Preferences.SetProperties("OpenSave", "AutoSaveInterval", value); }
            }

            /// <summary>
            /// 获取或设置是否使用备份文件
            /// </summary>
            public static bool CreateBackup
            {
                get { return (bool)Preferences.GetProperties("OpenSave", "CreateBackup"); }
                set { Preferences.SetProperties("OpenSave", "CreateBackup", value); }
            }

            /// <summary>
            /// 若图形包含第三方应用程序所创建的自定义对象时，是否以及何时由 AutoCAD 按需加载该应用程序
            /// </summary>
            public static ARXDemandLoad DemandLoadARXApp
            {
                get { return (ARXDemandLoad)Preferences.GetProperties("OpenSave", "DemandLoadARXApp"); }
                set { Preferences.SetProperties("OpenSave", "DemandLoadARXApp", value); }
            }

            /// <summary>
            /// 获取或设置是否每次对象被读入图形时都进行循环冗余码校验 (CRC) 
            /// </summary>
            public static bool FullCRCValidation
            {
                get { return (bool)Preferences.GetProperties("OpenSave", "FullCRCValidation"); }
                set { Preferences.SetProperties("OpenSave", "FullCRCValidation", value); }
            }

            /// <summary>
            /// 获取或设置图形文件中所允许的闲置空间的百分比 
            /// </summary>
            public static int IncrementalSavePercent
            {
                get { return (int)Preferences.GetProperties("OpenSave", "IncrementalSavePercent"); }
                set { Preferences.SetProperties("OpenSave", "IncrementalSavePercent", value); }
            }

            /// <summary>
            /// 获取或设置是否将文字窗口的内容写入日志文件 
            /// </summary>
            public static bool LogFileOn
            {
                get { return (bool)Preferences.GetProperties("OpenSave", "LogFileOn"); }
                set { Preferences.SetProperties("OpenSave", "LogFileOn", value); }
            }

            /// <summary>
            /// 获取或设置文件菜单中显示的最近使用文件的数目
            /// </summary>
            public static int MRUNumber
            {
                get { return (int)Preferences.GetProperties("OpenSave", "MRUNumber"); }
                set { Preferences.SetProperties("OpenSave", "MRUNumber", value); }
            }

            /// <summary>
            /// 获取或设置图形中由第三方应用程序所创建对象的显示
            /// </summary>
            public static ProxyImage ProxyImage
            {
                get { return (ProxyImage)Preferences.GetProperties("OpenSave", "ProxyImage"); }
                set { Preferences.SetProperties("OpenSave", "ProxyImage", value); }
            }

            /// <summary>
            /// 获取或设置图形的保存类型
            /// </summary>
            public static SaveAsType SaveAsType
            {
                get { return (SaveAsType)Preferences.GetProperties("OpenSave", "SaveAsType"); }
                set { Preferences.SetProperties("OpenSave", "SaveAsType", value); }
            }

            /// <summary>
            /// 获取或设置是否与图形一起保存 BMP 预览图像
            /// </summary>
            public static bool SavePreviewThumbnail
            {
                get { return (bool)Preferences.GetProperties("OpenSave", "SavePreviewThumbnail"); }
                set { Preferences.SetProperties("OpenSave", "SavePreviewThumbnail", value); }
            }

            /// <summary>
            /// 当用户打开包含自定义对象的图形时 AutoCAD 是否显示警告信息
            /// </summary>
            public static bool ShowProxyDialogBox
            {
                get { return (bool)Preferences.GetProperties("OpenSave", "ShowProxyDialogBox"); }
                set { Preferences.SetProperties("OpenSave", "ShowProxyDialogBox", value); }
            }

            /// <summary>
            /// 获取或设置临时文件的扩展名
            /// </summary>
            public static string TempFileExtension
            {
                get { return (string)Preferences.GetProperties("OpenSave", "TempFileExtension"); }
                set { Preferences.SetProperties("OpenSave", "TempFileExtension", value); }
            }

            /// <summary>
            /// 获取或设置外部参照对象的按需加载性能
            /// </summary>
            public static XRefDemandLoad XRefDemandLoad
            {
                get { return (XRefDemandLoad)Preferences.GetProperties("OpenSave", "XRefDemandLoad"); }
                set { Preferences.SetProperties("OpenSave", "XRefDemandLoad", value); }
            }

        }

        /// <summary>
        /// “选项”对话框“打印和发布”选项卡的所有选项
        /// </summary>
        public static class Output
        {
            /// <summary>
            /// 获取或设置是否自动生成打印日志
            /// </summary>
            public static bool AutomaticPlotLog
            {
                get { return (bool)Preferences.GetProperties("Output", "AutomaticPlotLog"); }
                set { Preferences.SetProperties("Output", "AutomaticPlotLog", value); }
            }

            /// <summary>
            /// 获取或设置是否连续生成打印日志
            /// </summary>
            public static bool ContinuousPlotLog
            {
                get { return (bool)Preferences.GetProperties("Output", "ContinuousPlotLog"); }
                set { Preferences.SetProperties("Output", "ContinuousPlotLog", value); }
            }

            /// <summary>
            /// 获取或设置布局和模型空间的默认输出设备
            /// </summary>
            public static string DefaultOutputDevice
            {
                get { return (string)Preferences.GetProperties("Output", "DefaultOutputDevice"); }
                set { Preferences.SetProperties("Output", "DefaultOutputDevice", value); }
            }

            /// <summary>
            /// 获取或设置打印到文件的缺省位置
            /// </summary>
            public static string DefaultPlotToFilePath
            {
                get { return (string)Preferences.GetProperties("Output", "DefaultPlotToFilePath"); }
                set { Preferences.SetProperties("Output", "DefaultPlotToFilePath", value); }
            }

            /// <summary>
            /// 获取或设置图形或用早期版本的 AutoCAD 创建且未用 AutoCAD 2000 格式保存的图形中的图层0的默认打印样式
            /// </summary>
            public static string DefaultPlotStyleForLayer
            {
                get { return (string)Preferences.GetProperties("Output", "DefaultPlotStyleForLayer"); }
                set { Preferences.SetProperties("Output", "DefaultPlotStyleForLayer", value); }
            }

            /// <summary>
            /// 获取或设置新创建对象的默认打印样式名称
            /// </summary>
            public static string DefaultPlotStyleForObjects
            {
                get { return (string)Preferences.GetProperties("Output", "DefaultPlotStyleForObjects"); }
                set { Preferences.SetProperties("Output", "DefaultPlotStyleForObjects", value); }
            }

            /// <summary>
            /// 获取或设置OLE对象的打印质量
            /// </summary>
            public static OleQuality OLEQuality
            {
                get { return (OleQuality)Preferences.GetProperties("Output", "OLEQuality"); }
                set { Preferences.SetProperties("Output", "OLEQuality", value); }
            }

            /// <summary>
            /// 获取或设置是否允许运行传统打印脚本
            /// </summary>
            public static bool PlotLegacy
            {
                get { return (bool)Preferences.GetProperties("Output", "PlotLegacy"); }
                set { Preferences.SetProperties("Output", "PlotLegacy", value); }
            }

            /// <summary>
            /// 获取或设置在创建新图形时对象颜色属性是否与打印样式名称关联
            /// </summary>
            public static PlotPolicy PlotPolicy
            {
                get { return (PlotPolicy)Preferences.GetProperties("Output", "PlotPolicy"); }
                set { Preferences.SetProperties("Output", "PlotPolicy", value); }
            }

            /// <summary>
            /// 获取或设置当布局配置的页面尺寸与PC3文件的默认设置不同时是否提醒用户
            /// </summary>
            public static bool PrinterPaperSizeAlert
            {
                get { return (bool)Preferences.GetProperties("Output", "PrinterPaperSizeAlert"); }
                set { Preferences.SetProperties("Output", "PrinterPaperSizeAlert", value); }
            }

            /// <summary>
            /// 获取或设置当由于I/O 端口冲突造成向设备的输出必须通过系统打印机缓冲时是否警告用户
            /// </summary>
            public static PrinterSpoolAlert PrinterSpoolAlert
            {
                get { return (PrinterSpoolAlert)Preferences.GetProperties("Output", "PrinterSpoolAlert"); }
                set { Preferences.SetProperties("Output", "PrinterSpoolAlert", value); }
            }

            /// <summary>
            /// 获取或设置是否使用最后一次成功打印时的打印设置
            /// </summary>
            public static bool UseLastPlotSettings
            {
                get { return (bool)Preferences.GetProperties("Output", "UseLastPlotSettings"); }
                set { Preferences.SetProperties("Output", "UseLastPlotSettings", value); }
            }

        }

        /// <summary>
        /// “选项”对话框“选择集”选项卡的所有选项
        /// </summary>
        public static class Selection
        {
            /// <summary>
            /// 获取或设置是否显示夹点
            /// </summary>        
            public static bool DisplayGrips
            {
                get { return (bool)Preferences.GetProperties("Selection", "DisplayGrips"); }
                set { Preferences.SetProperties("Selection", "DisplayGrips", value); }
            }

            /// <summary>
            /// 获取或设置是否在块中显示夹点
            /// </summary> 
            public static bool DisplayGripsWithinBlocks
            {
                get { return (bool)Preferences.GetProperties("Selection", "DisplayGripsWithinBlocks"); }
                set { Preferences.SetProperties("Selection", "DisplayGripsWithinBlocks", value); }
            }

            /// <summary>
            /// 获取或设置选定夹点的颜色
            /// </summary> 
            public static Color GripColorSelected
            {
                get { return ColorTranslator.FromOle(Convert.ToInt32(Preferences.GetProperties("Selection", "GripColorSelected"))); }
                set { Preferences.SetProperties("Selection", "GripColorSelected", ColorTranslator.ToOle(value)); }
            }

            /// <summary>
            /// 获取或设置未选中夹点的颜色
            /// </summary> 
            public static Color GripColorUnselected
            {
                get { return ColorTranslator.FromOle(Convert.ToInt32(Preferences.GetProperties("Selection", "GripColorUnselected"))); }
                set { Preferences.SetProperties("Selection", "GripColorUnselected", ColorTranslator.ToOle(value)); }
            }

            /// <summary>
            /// 获取或设置夹点的大小
            /// </summary> 
            public static int GripSize
            {
                get { return (int)Preferences.GetProperties("Selection", "GripSize"); }
                set { Preferences.SetProperties("Selection", "GripSize", value); }
            }

            /// <summary>
            /// 获取或设置对象是否要使用 Shift 键加入选择集
            /// </summary> 
            public static bool PickAdd
            {
                get { return (bool)Preferences.GetProperties("Selection", "PickAdd"); }
                set { Preferences.SetProperties("Selection", "PickAdd", value); }
            }

            /// <summary>
            /// 获取或设置在选择对象提示下是否自动显示选择窗口
            /// </summary> 
            public static bool PickAuto
            {
                get { return (bool)Preferences.GetProperties("Selection", "PickAuto"); }
                set { Preferences.SetProperties("Selection", "PickAuto", value); }
            }

            /// <summary>
            /// 获取或设置对象拾取框的大小
            /// </summary> 
            public static int PickBoxSize
            {
                get { return (int)Preferences.GetProperties("Selection", "PickBoxSize"); }
                set { Preferences.SetProperties("Selection", "PickBoxSize", value); }
            }

            /// <summary>
            /// 获取或设置绘制选择窗口的方式
            /// </summary> 
            public static bool PickDrag
            {
                get { return (bool)Preferences.GetProperties("Selection", "PickDrag"); }
                set { Preferences.SetProperties("Selection", "PickDrag", value); }
            }

            /// <summary>
            /// 获取或设置在发出命令之前（先选择后执行）还是之后选择对象
            /// </summary> 
            public static bool PickFirst
            {
                get { return (bool)Preferences.GetProperties("Selection", "PickFirst"); }
                set { Preferences.SetProperties("Selection", "PickFirst", value); }
            }

            /// <summary>
            /// 获取或设置是否在选择组合中的单个对象时将整个组合都选中
            /// </summary> 
            public static bool PickGroup
            {
                get { return (bool)Preferences.GetProperties("Selection", "PickGroup"); }
                set { Preferences.SetProperties("Selection", "PickGroup", value); }
            }

        }

        /// <summary>
        /// “选项”对话框“系统”选项卡的所有选项
        /// </summary>
        public static class System
        {
            /// <summary>
            /// 获取或设置AutoCAD 检测到无效输入时是否音响提示
            /// </summary>
            public static bool BeepOnError
            {
                get { return (bool)Preferences.GetProperties("System", "BeepOnError"); }
                set { Preferences.SetProperties("System", "BeepOnError", value); }
            }

            /// <summary>
            /// 获取或设置当图形中插入 OLE 对象时是否显示 OLE 缩放对话框
            /// </summary>
            public static bool DisplayOLEScale
            {
                get { return (bool)Preferences.GetProperties("System", "DisplayOLEScale"); }
                set { Preferences.SetProperties("System", "DisplayOLEScale", value); }
            }

            /// <summary>
            /// 获取或设置当 AutoCAD 启动时或新图创建时是否显示开始对话框
            /// </summary>
            public static bool EnableStartupDialog
            {
                get { return (bool)Preferences.GetProperties("System", "EnableStartupDialog"); }
                set { Preferences.SetProperties("System", "EnableStartupDialog", value); }
            }

            /// <summary>
            /// 获取或设置acad.lsp 是在启动时加载还是每一图形均加载
            /// </summary>
            public static bool LoadAcadLspInAllDocuments
            {
                get { return (bool)Preferences.GetProperties("System", "LoadAcadLspInAllDocuments"); }
                set { Preferences.SetProperties("System", "LoadAcadLspInAllDocuments", value); }
            }

            /// <summary>
            /// 获取或设置是否隐藏消息设置
            /// </summary>
            public static bool ShowWarningMessages
            {
                get { return (bool)Preferences.GetProperties("System", "ShowWarningMessages"); }
                set { Preferences.SetProperties("System", "ShowWarningMessages", value); }
            }

            /// <summary>
            /// 获取或设置是否在图形文件中保存链接索引
            /// </summary>
            public static bool StoreSQLIndex
            {
                get { return (bool)Preferences.GetProperties("System", "StoreSQLIndex"); }
                set { Preferences.SetProperties("System", "StoreSQLIndex", value); }
            }

            /// <summary>
            /// 获取或设置是否以只读模式打开表格
            /// </summary>
            public static bool TablesReadOnly
            {
                get { return (bool)Preferences.GetProperties("System", "TablesReadOnly"); }
                set { Preferences.SetProperties("System", "TablesReadOnly", value); }
            }

        }

        /// <summary>
        /// “选项”对话框“用户系统配置”选项卡的所有选项
        /// </summary>
        public static class User
        {
            /// <summary>
            /// 获取或设置在AutoCAD设计中心源图形未分配插入单位的对象自动使用的单位
            /// </summary>
            public static InsertUnits ADCInsertUnitsDefaultSource
            {
                get { return (InsertUnits)Preferences.GetProperties("User", "ADCInsertUnitsDefaultSource"); }
                set { Preferences.SetProperties("User", "ADCInsertUnitsDefaultSource", value); }
            }

            /// <summary>
            /// 获取或设置在AutoCAD设计中心目标图形未分配插入单位的对象自动使用的单位
            /// </summary>
            public static InsertUnits ADCInsertUnitsDefaultTarget
            {
                get { return (InsertUnits)Preferences.GetProperties("User", "ADCInsertUnitsDefaultTarget"); }
                set { Preferences.SetProperties("User", "ADCInsertUnitsDefaultTarget", value); }
            }

            /// <summary>
            /// 获取或设置是否显示超链接光标和快捷菜单
            /// </summary>
            public static bool HyperlinkDisplayCursor
            {
                get { return (bool)Preferences.GetProperties("User", "HyperlinkDisplayCursor"); }
                set { Preferences.SetProperties("User", "HyperlinkDisplayCursor", value); }
            }

            /// <summary>
            /// 获取或设置是否显示超链接工具提示
            /// </summary>
            public static bool HyperlinkDisplayTooltip
            {
                get { return (bool)Preferences.GetProperties("User", "HyperlinkDisplayTooltip"); }
                set { Preferences.SetProperties("User", "HyperlinkDisplayTooltip", value); }
            }

            /// <summary>
            /// 获取或设置Windows 标准或 AutoCAD 传统快捷键
            /// </summary>
            public static KeyboardAccelerator KeyboardAccelerator
            {
                get { return (KeyboardAccelerator)Preferences.GetProperties("User", "KeyboardAccelerator"); }
                set { Preferences.SetProperties("User", "KeyboardAccelerator", value); }
            }

            /// <summary>
            /// 获取或设置AutoCAD 如何响应坐标数据的输入
            /// </summary>
            public static KeyboardPriority KeyboardPriority
            {
                get { return (KeyboardPriority)Preferences.GetProperties("User", "KeyboardPriority"); }
                set { Preferences.SetProperties("User", "KeyboardPriority", value); }
            }

            /// <summary>
            /// 获取或设置处于命令模式 (有一个命令正在执行) 时绘图区域中右键单击的功能
            /// </summary>
            public static DrawingAreaSCMCommand SCMCommandMode
            {
                get { return (DrawingAreaSCMCommand)Preferences.GetProperties("User", "SCMCommandMode"); }
                set { Preferences.SetProperties("User", "SCMCommandMode", value); }
            }

            /// <summary>
            /// 获取或设置处于默认模式 (未选中对象且无命令在执行) 时绘图区域中右键单击的功能
            /// </summary>
            public static DrawingAreaSCMDefault SCMDefaultMode
            {
                get { return (DrawingAreaSCMDefault)Preferences.GetProperties("User", "SCMDefaultMode"); }
                set { Preferences.SetProperties("User", "SCMDefaultMode", value); }
            }

            /// <summary>
            /// 获取或设置处于编辑模式 (选中一个或多个对象且无命令在执行) 时绘图区域中右键单击的功能
            /// </summary>
            public static DrawingAreaSCMEdit SCMEditMode
            {
                get { return (DrawingAreaSCMEdit)Preferences.GetProperties("User", "SCMEditMode"); }
                set { Preferences.SetProperties("User", "SCMEditMode", value); }
            }

            /// <summary>
            /// 获取或设置是否开启计时右键动作
            /// </summary>
            public static bool SCMTimeMode
            {
                get { return (bool)Preferences.GetProperties("User", "SCMTimeMode"); }
                set { Preferences.SetProperties("User", "SCMTimeMode", value); }
            }

            /// <summary>
            /// 获取或设置设置按持续时间显示快捷菜单来控制计时右键动作
            /// </summary>
            public static int SCMTimeValue
            {
                get { return (int)Preferences.GetProperties("User", "SCMTimeValue"); }
                set { Preferences.SetProperties("User", "SCMTimeValue", value); }
            }

            /// <summary>
            /// 获取或设置在图形区域右键点击时显示快捷菜单还是执行回车
            /// </summary>
            public static bool ShortCutMenuDisplay
            {
                get { return (bool)Preferences.GetProperties("User", "ShortCutMenuDisplay"); }
                set { Preferences.SetProperties("User", "ShortCutMenuDisplay", value); }
            }

        }
    }
}








﻿using System;
using System.Collections.Generic;
using System.Collections.Specialized;
using System.Linq;
using System.Text;
using Autodesk.AutoCAD.ApplicationServices;
using Autodesk.AutoCAD.Customization;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.EditorInput;
using Autodesk.AutoCAD.Runtime;
using DotNetARX;
using Autodesk.AutoCAD.Windows;
namespace CUIExample
{
    public class CUIExample
    {
        //设置CUI文件的名字，将其路径设置为当前运行目录
        string cuiFile = Tools.GetCurrentPath() + "\\MyCustom.cui";
        string menuGroupName = "MyCustom";//菜单组名
        //获得活动文档
        Document activeDoc = Application.DocumentManager.MdiActiveDocument;
        public CUIExample()
        {
            //添加程序退出时事件处理
            Application.QuitWillStart += new EventHandler(Application_QuitWillStart);
        }
        void Application_QuitWillStart(object sender, EventArgs e)
        {
            //由于触发此事件前文档已关闭，所以需通过模板重建，以便命令能够执行
            Document doc = Application.DocumentManager.Add("acadiso.dwt");
            //获取FILEDIA系统变量的值
            object oldFileDia = Application.GetSystemVariable("FILEDIA");
            //设置FILEDIA=0，禁止显示文件对话框，这样可以通过程序输入文件名
            Application.SetSystemVariable("FILEDIA", 0);
            //获取主CUI
            CustomizationSection mainCs = doc.GetMainCustomizationSection();
            //如果存在指定的局部CUI文件，则进行卸载
            if (mainCs.PartialCuiFiles.Contains(cuiFile))
                doc.Editor.PostCommand("cuiunload " + menuGroupName + " ");
            //恢复FILEDIA系统变量的值
            Application.SetSystemVariable("FILEDIA", oldFileDia);
        }
        [CommandMethod("AddMenu")]
        public void AddMenu()
        {
            string currentPath = Tools.GetCurrentPath();//当前运行目录
            //装载局部CUI文件，若不存在，则创建
            CustomizationSection cs = activeDoc.AddCui(cuiFile, menuGroupName);
            //添加表示绘制直线、多段线、矩形和圆的命令宏            
            cs.AddMacro("直线", "^C^C_Line ", "ID_MyLine", "创建直线段:   LINE", currentPath + "\\Image\\Line.BMP");
            cs.AddMacro("多段线", "^C^C_Pline ", "ID_MyPLine", "创建二维多段线:  PLINE", currentPath + "\\Image\\Polyline.BMP");
            cs.AddMacro("矩形", "^C^C_Rectang ", "ID_MyRectang", "创建矩形多段线:  RECTANG", currentPath + "\\Image\\Rectangle.BMP");
            cs.AddMacro("圆", "^C^C_circle ", "ID_MyCircle", "用指定半径创建圆:   CIRCLE", currentPath + "\\Image\\Circle.BMP");
            //添加表示复制、删除、移动及旋转操作的命令宏
            cs.AddMacro("复制", "^C^CCopy ", "ID_MyCopy", "复制对象:   COPY", currentPath + "\\Image\\Copy.BMP");
            cs.AddMacro("删除", "^C^CErase ", "ID_MyErase", "从图形删除对象:   ERASE", currentPath + "\\Image\\Erase.BMP");
            cs.AddMacro("移动", "^C^CMove ", "ID_MyMove", "将对象在指定方向上平移指定的距离:  MOVE", currentPath + "\\Image\\Move.BMP");
            cs.AddMacro("旋转", "^C^CRotate ", "ID_MyRotate", "绕基点旋转对象:  ROTATE", currentPath + "\\Image\\Rotate.BMP");
            //设置用于下拉菜单别名的字符串集合
            StringCollection sc = new StringCollection();
            sc.Add("MyPop1");
            //添加名为“我的菜单”的下拉菜单，如果已经存在，则返回null
            PopMenu myMenu = cs.MenuGroup.AddPopMenu("我的菜单", sc, "ID_MyMenu");
            if (myMenu != null)//如果“我的菜单”还没有被添加，则添加菜单项
            {
                //从上到下为“我的菜单”添加绘制直线、多段线、矩形和圆的菜单项
                myMenu.AddMenuItem(-1, null, "ID_MyLine");
                myMenu.AddMenuItem(-1, null, "ID_MyPLine");
                myMenu.AddMenuItem(-1, null, "ID_MyRectang");
                myMenu.AddMenuItem(-1, null, "ID_MyCircle");
                myMenu.AddSeparator(-1);//为菜单添加一分隔条
                //添加一个名为“修改”的子菜单
                PopMenu menuModify = myMenu.AddSubMenu(-1, "修改", "ID_MyModify");
                //从上到下为“修改”子菜单添加复制、删除、移动及旋转操作的菜单项
                menuModify.AddMenuItem(-1, null, "ID_MyCopy");
                menuModify.AddMenuItem(-1, null, "ID_MyErase");
                menuModify.AddMenuItem(-1, null, "ID_MyMove");
                menuModify.AddMenuItem(-1, null, "ID_MyRotate");
            }
            cs.LoadCui();//必须装载CUI文件，才能看到添加的菜单
        }
        [CommandMethod("AddToolbar")]
        public void AddToolbar()
        {
            //装载局部CUI文件，若不存在，则创建
            CustomizationSection cs = activeDoc.AddCui(cuiFile, menuGroupName);
            //添加名为“我的工具栏”的工具栏
            Toolbar barDraw = cs.MenuGroup.AddToolbar("我的工具栏");
            //为“我的工具栏”添加绘制直线、多段线、矩形和圆的按钮
            barDraw.AddToolbarButton(-1, "直线", "ID_MyLine");
            barDraw.AddToolbarButton(-1, "多段线", "ID_MyPLine");
            barDraw.AddToolbarButton(-1, "矩形", "ID_MyRectang");
            barDraw.AddToolbarButton(-1, "圆", "ID_MyCircle");
            //添加名为“修改工具栏”的工具栏，用于弹出式工具栏
            Toolbar barModify = cs.MenuGroup.AddToolbar("修改工具栏");
            //为“修改工具栏”添加复制、删除、移动及旋转操作的按钮
            ToolbarButton buttonCopy = barModify.AddToolbarButton(-1, "复制", "ID_MyCopy");
            ToolbarButton buttonErase = barModify.AddToolbarButton(-1, "删除", "ID_MyErase");
            ToolbarButton buttonMove = barModify.AddToolbarButton(-1, "移动", "ID_MyMove");
            ToolbarButton buttonRotate = barModify.AddToolbarButton(-1, "旋转", "ID_MyRotate");
            //将“修改工具栏”附着到“我的工具栏”的最后
            barDraw.AttachToolbarToFlyout(-1, barModify);
            cs.LoadCui();//必须装载CUI文件，才能看到添加的菜单
        }
        [CommandMethod("AddDoubleClick")]
        public void AddDoubleClick()
        {
            //装载局部CUI文件，若不存在，则创建
            CustomizationSection cs = activeDoc.AddCui(cuiFile, menuGroupName);
            //添加表示双击多段线动作的命令宏  
            MenuMacro macro = cs.AddMacro("多段线 - 双击", "^C^C_DoubleClickPline ", "ID_PlineDoubleClick", "调用自定义命令", null);
            //创建双击动作
            DoubleClickAction action = new DoubleClickAction(cs.MenuGroup, "优化多段线", -1);
            action.ElementID = "EID_mydblclick";//双击动作的标识号
            //设置双击动作的对象为多段线
            action.DxfName = RXClass.GetClass(typeof(Polyline)).DxfName;
            //创建一个双击命令对象，指定双击对象时执行的命令宏
            DoubleClickCmd cmd = new DoubleClickCmd(action, macro);
            action.DoubleClickCmd = cmd;//指定双击动作的命令对象
            cs.LoadCui();//必须装载CUI文件，才能看到添加的菜单
        }
        [CommandMethod("DoubleClickPline")]
        public void DoubleClickPline()
        {
            Application.ShowAlertDialog("你双击了多段线！");
        }
        [CommandMethod("AddDefaultContextMenu")]
        public void AddDefaultContextMenu()
        {
            //定义一个ContextMenuExtension对象，用于表示快捷菜单
            ContextMenuExtension contextMenu = new ContextMenuExtension();
            contextMenu.Title = "我的快捷菜单";//设置快捷菜单的标题
            MenuItem mi = new MenuItem("复制");//添加名为"复制"的菜单项
            //为"复制"菜单项添加单击事件
            mi.Click += new EventHandler(mi_Click);
            contextMenu.MenuItems.Add(mi);//将"复制"菜单项添加到快捷菜单中
            mi = new MenuItem("删除");//添加名为"删除"的菜单项
            //为"删除"菜单项添加单击事件
            mi.Click += new EventHandler(mi_Click);
            contextMenu.MenuItems.Add(mi);//将"删除"菜单项添加到快捷菜单中
            //为应用程序添加定义的快捷菜单
            Application.AddDefaultContextMenuExtension(contextMenu);
        }
        void mi_Click(object sender, EventArgs e)
        {
            MenuItem mi = sender as MenuItem;//获取发出命令的快捷菜单项
            //根据快捷菜单项的名字，分别调用对应的命令
            if (mi.Text == "复制")
                activeDoc.SendStringToExecute("_Copy ", true, false, true);
            else if (mi.Text == "删除")
                activeDoc.SendStringToExecute("_Erase ", true, false, true);
        }
        [CommandMethod("AddObjectContextMenu")]
        public void AddObjectContextMenu()
        {
            //定义一个ContextMenuExtension对象，用于表示快捷菜单
            ContextMenuExtension contextMenu = new ContextMenuExtension();
            //添加一个名为"统计个数"的菜单项，用于在AutoCAD命令行上显示所选择实体的个数
            MenuItem miCircle = new MenuItem("统计个数");
            //为"统计个数"菜单项添加单击事件，事件处理函数为调用自定义的Count命令
            miCircle.Click += delegate(object sender, EventArgs e)
            {
                activeDoc.SendStringToExecute("_Count ", true, false, false);
            };
            contextMenu.MenuItems.Add(miCircle);//将"统计个数"菜单项添加到快捷菜单中
            //获得实体所属的RXClass类型
            RXClass rx = RXClass.GetClass(typeof(Entity));
            //为实体对象添加定义的快捷菜单
            Application.AddObjectContextMenuExtension(rx, contextMenu);
        }
        [CommandMethod("Count", CommandFlags.UsePickSet)]
        public void CountEnts()
        {
            Editor ed = activeDoc.Editor;
            PromptSelectionResult result = ed.SelectImplied();
            if (result.Status == PromptStatus.OK)
                ed.WriteMessage("共选择了" + result.Value.Count + "个实体\n");
        }
    }
}
﻿using System.Collections.Specialized;
using System.IO;
using Autodesk.AutoCAD.ApplicationServices;
using Autodesk.AutoCAD.Customization;

namespace DotNetARX
{
    /// <summary>
    /// 操作CUI的类
    /// </summary>
    public static class CUITools
    {
        /// <summary>
        /// 获取并打开主CUI文件
        /// </summary>
        /// <param name="doc">AutoCAD文档对象</param>
        /// <returns>返回主CUI文件</returns>
        public static CustomizationSection GetMainCustomizationSection(this Document doc)
        {
            //获得主CUI文件所在的位置
            string mainCuiFile=Application.GetSystemVariable("MENUNAME") + ".cui";
            //打开主CUI文件
            return new CustomizationSection(mainCuiFile);
        }

        /// <summary>
        /// 创建局部CUI文件
        /// </summary>
        /// <param name="doc">AutoCAD文档对象</param>
        /// <param name="cuiFile">CUI文件名</param>
        /// <param name="menuGroupName">菜单组的名称</param>
        /// <returns>返回创建的CUI文件</returns>
        public static CustomizationSection AddCui(this Document doc, string cuiFile, string menuGroupName)
        {
            CustomizationSection cs;//声明CUI文件对象
            if (!File.Exists(cuiFile))//如果要创建的文件不存在
            {
                cs = new CustomizationSection();//创建CUI文件对象
                cs.MenuGroupName = menuGroupName;//指定菜单组名称
                cs.SaveAs(cuiFile);//保存CUI文件
            }
            //如果已经存在指定的CUI文件，则打开该文件
            else cs = new CustomizationSection(cuiFile);
            return cs;//返回CUI文件对象
        }

        /// <summary>
        /// 装载指定的局部CUI文件
        /// </summary>
        /// <param name="cs">CUI文件</param>
        public static void LoadCui(this CustomizationSection cs)
        {
            if (cs.IsModified) cs.Save();//如果CUI文件被修改，则保存
            //保存CMDECHO及FILEDIA系统变量
            object oldCmdEcho =  Application.GetSystemVariable("CMDECHO");
            object oldFileDia =    Application.GetSystemVariable("FILEDIA");
            //设置CMDECHO=0，控制不在命令行上回显提示和输入信息
            Application.SetSystemVariable("CMDECHO", 0);
            //设置FILEDIA=0，禁止显示文件对话框，这样可以通过程序输入文件名
            Application.SetSystemVariable("FILEDIA", 0);
            //获取当前活动文档
            Document doc=Application.DocumentManager.MdiActiveDocument;
            //获取主CUI文件
            CustomizationSection mainCs=doc.GetMainCustomizationSection();
            //如果已存在局部CUI文件，则先卸载
            if (mainCs.PartialCuiFiles.Contains(cs.CUIFileName))
                doc.SendStringToExecute("_.cuiunload " + cs.CUIFileBaseName + " ", false, false, false);
            //装载CUI文件，注意文件名必须是带路径的
            doc.SendStringToExecute("_.cuiload " + cs.CUIFileName + " ", false, false, false);
            //恢复CMDECHO及FILEDIA系统变量的初始值
            doc.SendStringToExecute("(setvar \"FILEDIA\" " + oldFileDia.ToString() + ")(princ) ", false, false, false);
            doc.SendStringToExecute("(setvar \"CMDECHO\" " + oldCmdEcho.ToString() + ")(princ) ", false, false, false);
        }

        /// <summary>
        /// 添加菜单项所要执行的宏
        /// </summary>
        /// <param name="source">CUI文件</param>
        /// <param name="name">宏的显示名称</param>
        /// <param name="command">宏的具体命令</param>
        /// <param name="tag">宏的标识符</param>
        /// <param name="helpString">宏的状态栏提示信息</param>
        /// <param name="imagePath">宏的图标</param>
        /// <returns>返回创建的宏</returns>
        public static MenuMacro AddMacro(this CustomizationSection source, string name, string command, string tag, string helpString, string imagePath)
        {
            MenuGroup menuGroup=source.MenuGroup;//获取CUI文件中的菜单组
            //判断菜单组中是否已经定义与菜单组名相同的宏集合
            MacroGroup mg=menuGroup.FindMacroGroup(menuGroup.Name);
            if (mg == null)//如果宏集合没有定义，则创建一个与菜单组名相同的宏集合
                mg = new MacroGroup(menuGroup.Name, menuGroup);
            //如果已经宏已经被定义，则返回
            foreach (MenuMacro macro in mg.MenuMacros)
                if (macro.ElementID == tag) return null;
            //在宏集合中创建一个命令宏
            MenuMacro MenuMacro=new MenuMacro(mg, name, command, tag);
            //指定命令宏的说明信息，在状态栏中显示
            MenuMacro.macro.HelpString = helpString;
            //指定命令宏的大小图像的路径
            MenuMacro.macro.LargeImage = MenuMacro.macro.SmallImage = imagePath;
            return MenuMacro;//返回命令宏
        }

        /// <summary>
        /// 添加下拉菜单
        /// </summary>
        /// <param name="menuGroup">包含菜单的菜单组</param>
        /// <param name="name">菜单名</param>
        /// <param name="aliasList">菜单的别名</param>
        /// <param name="tag">菜单的标识字符串</param>
        /// <returns>返回下拉菜单对象</returns>
        public static PopMenu AddPopMenu(this MenuGroup menuGroup, string name, StringCollection aliasList, string tag)
        {
            PopMenu pm=null;//声明下拉菜单对象
            //如果菜单组中没有名称为name的下拉菜单
            if (menuGroup.PopMenus.IsNameFree(name))
            {
                //为下拉菜单指定显示名称、别名、标识符和所属的菜单组
                pm = new PopMenu(name, aliasList, tag, menuGroup);
            }
            return pm;//返回下拉菜单对象
        }

        /// <summary>
        /// 为菜单添加菜单项
        /// </summary>
        /// <param name="parentMenu">菜单项所属的菜单</param>
        /// <param name="index">菜单项的位置</param>
        /// <param name="name">菜单项的显示名称</param>
        /// <param name="macroId">菜单项的命令宏的Id</param>
        /// <returns>返回添加的菜单项</returns>
        public static PopMenuItem AddMenuItem(this PopMenu parentMenu, int index, string name, string macroId)
        {
            PopMenuItem newPmi=null;
            //如果存在名为name的菜单项，则返回
            foreach (PopMenuItem pmi in parentMenu.PopMenuItems)
                if (pmi.Name == name) return newPmi;
            //定义一个菜单项对象，指定所属的菜单及位置
            newPmi = new PopMenuItem(parentMenu, index);
            ////如果name不为空，则指定菜单项的显示名为name，否则会使用命令宏的名称
            if (name != null) newPmi.Name = name;
            newPmi.MacroID = macroId;//菜单项的命令宏的ID
            return newPmi;//返回菜单项对象
        }

        /// <summary>
        /// 为下拉菜单添加子菜单
        /// </summary>
        /// <param name="parentMenu">下拉菜单</param>
        /// <param name="index">子菜单的位置</param>
        /// <param name="name">子菜单的显示名称</param>
        /// <param name="tag">子菜单的标识字符串</param>
        /// <returns>返回添加的子菜单</returns>
        public static PopMenu AddSubMenu(this PopMenu parentMenu, int index, string name, string tag)
        {
            PopMenu pm=null;//声明子菜单对象（属于下拉菜单类）
            //如果菜单组中没有名称为name的下拉菜单
            if (parentMenu.CustomizationSection.MenuGroup.PopMenus.IsNameFree(name))
            {
                //为子菜单指定显示名称、标识符和所属的菜单组，别名设为null
                pm = new PopMenu(name, null, tag, parentMenu.CustomizationSection.MenuGroup);
                //为子菜单指定其所属的菜单
                PopMenuRef menuRef=new PopMenuRef(pm, parentMenu, index);
            }
            return pm;//返回子菜单对象
        }

        /// <summary>
        /// 为菜单添加分隔条
        /// </summary>
        /// <param name="parentMenu">下拉菜单</param>
        /// <param name="index">分隔条的位置</param>
        /// <returns>返回添加的分隔条</returns>
        public static PopMenuItem AddSeparator(this PopMenu parentMenu, int index)
        {
            //定义一个分隔条并返回
            return new PopMenuItem(parentMenu, index);
        }

        /// <summary>
        /// 添加工具栏
        /// </summary>
        /// <param name="menuGroup">工具栏所属的菜单组</param>
        /// <param name="name">工具栏的显示名称</param>
        /// <returns>返回添加的工具栏</returns>
        public static Toolbar AddToolbar(this MenuGroup menuGroup, string name)
        {
            Toolbar tb=null;//声明一个工具栏对象
            //如果菜单组中没有名称为name的工具栏
            if (menuGroup.Toolbars.IsNameFree(name))
            {
                //为工具栏指定显示名称和所属的菜单组
                tb = new Toolbar(name, menuGroup);
                //设置工具栏为浮动工具栏
                tb.ToolbarOrient = ToolbarOrient.floating;
                //设置工具栏可见
                tb.ToolbarVisible = ToolbarVisible.show;
            }
            return tb;//返回工具栏对象
        }

        /// <summary>
        /// 向工具栏添加按钮
        /// </summary>
        /// <param name="parent">按钮所属的工具栏</param>
        /// <param name="index">按钮在工具栏上的位置</param>
        /// <param name="name">按钮的显示名称</param>
        /// <param name="macroId">按钮的命令宏的Id</param>
        /// <returns>返回工具栏按钮对象</returns>
        public static ToolbarButton AddToolbarButton(this Toolbar parent, int index, string name, string macroId)
        {
            //创建一个工具栏按钮对象，指定其命令宏Id、显示名称、所属的工具栏和位置
            ToolbarButton button=new ToolbarButton(macroId, name, parent, index);
            return button;//返回工具栏按钮对象
        }

        /// <summary>
        /// 向工具栏添加弹出式工具栏
        /// </summary>
        /// <param name="parent">工具栏所属的父工具栏</param>
        /// <param name="index">弹出式工具栏在父工具栏上的位置</param>
        /// <param name="toolbarRef">弹出式工具栏所引用的工具栏</param>
        public static void AttachToolbarToFlyout(this Toolbar parent, int index, Toolbar toolbarRef)
        {
            //创建一个弹出式工具栏，指定其所属的工具栏和位置
            ToolbarFlyout flyout=new ToolbarFlyout(parent, index);
            //指定弹出式工具栏所引用的工具栏 
            flyout.ToolbarReference = toolbarRef.Name;
            //引用的工具栏初始状态不可见
            toolbarRef.ToolbarVisible = ToolbarVisible.hide;
        }
    }
}
﻿using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using Autodesk.AutoCAD.Runtime;
using Autodesk.AutoCAD.ApplicationServices;
using chap10;
using Autodesk.AutoCAD.Windows;


namespace CustomDialog
{
    public class CustomDialog
    {
        [CommandMethod("ModalDialog")]
        public void ModalDialog()
        {
            ModalForm form=new ModalForm();
            Application.ShowModalDialog(form);
        }
    }
}
﻿using Autodesk.AutoCAD.ApplicationServices;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.DatabaseServices.Filters;
using Autodesk.AutoCAD.EditorInput;
using Autodesk.AutoCAD.Geometry;
using Autodesk.AutoCAD.Runtime;
using DotNetARX;
namespace DatabaseOperator
{
    public class DatabaseOperator
    {
        static string filename;//文件名
        [CommandMethod("CreateAndSaveDwg")]
        public void CreateAndSaveDwg()
        {
            //新建一个数据库对象以创建新的Dwg文件
            using (Database db=new Database())
            using (Transaction trans=db.TransactionManager.StartTransaction())
            {
                //新建两个圆
                Circle cir1=new Circle(new Point3d(1, 1, 0), Vector3d.ZAxis, 1.0);
                Circle cir2=new Circle(new Point3d(5, 5, 0), Vector3d.ZAxis, 2.0);
                db.AddToModelSpace(cir1, cir2);//将新建的圆加入模型空间
                //定义保存文件对话框
                PromptSaveFileOptions opt=new PromptSaveFileOptions("请输入文件名：");
                //保存文件对话框的文件扩展名列表
                opt.Filter = "图形(*.dwg)|*.dwg|图形(*.dxf)|*.dxf";
                opt.FilterIndex = 0;//文件过滤器列表中缺省显示的文件扩展名
                opt.DialogCaption = "图形另存为";//保存文件对话框的标题
                opt.InitialDirectory = @"C:\";//缺省保存目录
                opt.InitialFileName = "MyDwg";//缺省保存文件名
                Editor ed=Application.DocumentManager.MdiActiveDocument.Editor;
                //根据保存对话框中用户的选择，获取保存文件名
                PromptFileNameResult result=ed.GetFileNameForSave(opt);
                if (result.Status != PromptStatus.OK) return;
                filename = result.StringResult;
                db.SaveAs(filename, DwgVersion.Current);//保存文件为当前AutoCAD版本
                trans.Commit();//提交事务处理
            }
        }

        [CommandMethod("ReadDwg")]
        public void ReadDwg()
        {
            Editor ed = Application.DocumentManager.MdiActiveDocument.Editor;
            //新建一个数据库对象以读取Dwg文件
            using (Database db=new Database(false, true))
            using (Transaction trans=db.TransactionManager.StartTransaction())
            {
                //如果文件存在
                if (System.IO.File.Exists(filename))
                {
                    //把文件读入到数据库中
                    db.ReadDwgFile(filename, System.IO.FileShare.Read, true, null);
                    PartialOpenDatabase(db);//执行局部加载
                    //获取数据库的块表对象
                    BlockTable bt = (BlockTable)trans.GetObject(db.BlockTableId, OpenMode.ForRead);
                    //打开数据库的模型空间块表记录对象
                    BlockTableRecord btr = (BlockTableRecord)trans.GetObject(bt[BlockTableRecord.ModelSpace], OpenMode.ForRead);
                    //循环遍历模型空间中的实体
                    foreach (ObjectId id in btr)
                    {
                        Entity ent = trans.GetObject(id, OpenMode.ForRead) as Entity;
                        //显示实体的类名
                        if (ent != null) ed.WriteMessage("\n" + ent.GetType().ToString());
                    }
                }
                else ed.WriteMessage("文件不存在！");//文件不存在
                trans.Commit();
            }
        }

        public bool PartialOpenDatabase(Database db)
        {
            if (db == null) return false;//数据库未赋值，返回
            //指定局部加载的范围
            Point2d pt1=Point2d.Origin;
            Point2d pt2=new Point2d(100, 100);
            Point2dCollection pts=new Point2dCollection(2) { pt1, pt2 };
            //创建局部加载范围过滤器
            SpatialFilterDefinition filterDef=new SpatialFilterDefinition(
                pts, Vector3d.ZAxis, 0.0, 0.0, 0.0, true);
            SpatialFilter sFilter=new SpatialFilter();
            sFilter.Definition = filterDef;
            //创建图层过滤器，只加载Circle和Line层
            LayerFilter layerFilter=new LayerFilter();
            layerFilter.Add("Circle");
            layerFilter.Add("Line");
            //对图形数据库应用局部加载
            db.ApplyPartialOpenFilters(sFilter, layerFilter);
            if (db.IsPartiallyOpened)//判断图形数据库是否已局部加载
            {
                db.CloseInput(true);//关闭文件输入
                return true;//局部加载成功
            }
            else return false;//局部加载失败
        }
    }
}
﻿namespace AccessCAD {
    
    
    public partial class db_samplesDataSet {
    }
}
﻿//------------------------------------------------------------------------------
// <auto-generated>
//     此代码由工具生成。
//     运行时版本:4.0.30319.239
//
//     对此文件的更改可能会导致不正确的行为，并且如果
//     重新生成代码，这些更改将会丢失。
// </auto-generated>
//------------------------------------------------------------------------------

#pragma warning disable 1591

namespace AccessCAD {
    
    
    /// <summary>
    ///Represents a strongly typed in-memory cache of data.
    ///</summary>
    [global::System.Serializable()]
    [global::System.ComponentModel.DesignerCategoryAttribute("code")]
    [global::System.ComponentModel.ToolboxItem(true)]
    [global::System.Xml.Serialization.XmlSchemaProviderAttribute("GetTypedDataSetSchema")]
    [global::System.Xml.Serialization.XmlRootAttribute("db_samplesDataSet")]
    [global::System.ComponentModel.Design.HelpKeywordAttribute("vs.data.DataSet")]
    public partial class db_samplesDataSet : global::System.Data.DataSet {
        
        private ComputerDataTable tableComputer;
        
        private EmployeeDataTable tableEmployee;
        
        private InventoryDataTable tableInventory;
        
        private RoomDataTable tableRoom;
        
        private global::System.Data.DataRelation relationRoomComputer;
        
        private global::System.Data.DataRelation relationRoomEmployee;
        
        private global::System.Data.DataRelation relationRoomInventory;
        
        private global::System.Data.SchemaSerializationMode _schemaSerializationMode = global::System.Data.SchemaSerializationMode.IncludeSchema;
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        public db_samplesDataSet() {
            this.BeginInit();
            this.InitClass();
            global::System.ComponentModel.CollectionChangeEventHandler schemaChangedHandler = new global::System.ComponentModel.CollectionChangeEventHandler(this.SchemaChanged);
            base.Tables.CollectionChanged += schemaChangedHandler;
            base.Relations.CollectionChanged += schemaChangedHandler;
            this.EndInit();
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        protected db_samplesDataSet(global::System.Runtime.Serialization.SerializationInfo info, global::System.Runtime.Serialization.StreamingContext context) : 
                base(info, context, false) {
            if ((this.IsBinarySerialized(info, context) == true)) {
                this.InitVars(false);
                global::System.ComponentModel.CollectionChangeEventHandler schemaChangedHandler1 = new global::System.ComponentModel.CollectionChangeEventHandler(this.SchemaChanged);
                this.Tables.CollectionChanged += schemaChangedHandler1;
                this.Relations.CollectionChanged += schemaChangedHandler1;
                return;
            }
            string strSchema = ((string)(info.GetValue("XmlSchema", typeof(string))));
            if ((this.DetermineSchemaSerializationMode(info, context) == global::System.Data.SchemaSerializationMode.IncludeSchema)) {
                global::System.Data.DataSet ds = new global::System.Data.DataSet();
                ds.ReadXmlSchema(new global::System.Xml.XmlTextReader(new global::System.IO.StringReader(strSchema)));
                if ((ds.Tables["Computer"] != null)) {
                    base.Tables.Add(new ComputerDataTable(ds.Tables["Computer"]));
                }
                if ((ds.Tables["Employee"] != null)) {
                    base.Tables.Add(new EmployeeDataTable(ds.Tables["Employee"]));
                }
                if ((ds.Tables["Inventory"] != null)) {
                    base.Tables.Add(new InventoryDataTable(ds.Tables["Inventory"]));
                }
                if ((ds.Tables["Room"] != null)) {
                    base.Tables.Add(new RoomDataTable(ds.Tables["Room"]));
                }
                this.DataSetName = ds.DataSetName;
                this.Prefix = ds.Prefix;
                this.Namespace = ds.Namespace;
                this.Locale = ds.Locale;
                this.CaseSensitive = ds.CaseSensitive;
                this.EnforceConstraints = ds.EnforceConstraints;
                this.Merge(ds, false, global::System.Data.MissingSchemaAction.Add);
                this.InitVars();
            }
            else {
                this.ReadXmlSchema(new global::System.Xml.XmlTextReader(new global::System.IO.StringReader(strSchema)));
            }
            this.GetSerializationData(info, context);
            global::System.ComponentModel.CollectionChangeEventHandler schemaChangedHandler = new global::System.ComponentModel.CollectionChangeEventHandler(this.SchemaChanged);
            base.Tables.CollectionChanged += schemaChangedHandler;
            this.Relations.CollectionChanged += schemaChangedHandler;
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        [global::System.ComponentModel.Browsable(false)]
        [global::System.ComponentModel.DesignerSerializationVisibility(global::System.ComponentModel.DesignerSerializationVisibility.Content)]
        public ComputerDataTable Computer {
            get {
                return this.tableComputer;
            }
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        [global::System.ComponentModel.Browsable(false)]
        [global::System.ComponentModel.DesignerSerializationVisibility(global::System.ComponentModel.DesignerSerializationVisibility.Content)]
        public EmployeeDataTable Employee {
            get {
                return this.tableEmployee;
            }
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        [global::System.ComponentModel.Browsable(false)]
        [global::System.ComponentModel.DesignerSerializationVisibility(global::System.ComponentModel.DesignerSerializationVisibility.Content)]
        public InventoryDataTable Inventory {
            get {
                return this.tableInventory;
            }
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        [global::System.ComponentModel.Browsable(false)]
        [global::System.ComponentModel.DesignerSerializationVisibility(global::System.ComponentModel.DesignerSerializationVisibility.Content)]
        public RoomDataTable Room {
            get {
                return this.tableRoom;
            }
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        [global::System.ComponentModel.BrowsableAttribute(true)]
        [global::System.ComponentModel.DesignerSerializationVisibilityAttribute(global::System.ComponentModel.DesignerSerializationVisibility.Visible)]
        public override global::System.Data.SchemaSerializationMode SchemaSerializationMode {
            get {
                return this._schemaSerializationMode;
            }
            set {
                this._schemaSerializationMode = value;
            }
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        [global::System.ComponentModel.DesignerSerializationVisibilityAttribute(global::System.ComponentModel.DesignerSerializationVisibility.Hidden)]
        public new global::System.Data.DataTableCollection Tables {
            get {
                return base.Tables;
            }
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        [global::System.ComponentModel.DesignerSerializationVisibilityAttribute(global::System.ComponentModel.DesignerSerializationVisibility.Hidden)]
        public new global::System.Data.DataRelationCollection Relations {
            get {
                return base.Relations;
            }
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        protected override void InitializeDerivedDataSet() {
            this.BeginInit();
            this.InitClass();
            this.EndInit();
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        public override global::System.Data.DataSet Clone() {
            db_samplesDataSet cln = ((db_samplesDataSet)(base.Clone()));
            cln.InitVars();
            cln.SchemaSerializationMode = this.SchemaSerializationMode;
            return cln;
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        protected override bool ShouldSerializeTables() {
            return false;
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        protected override bool ShouldSerializeRelations() {
            return false;
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        protected override void ReadXmlSerializable(global::System.Xml.XmlReader reader) {
            if ((this.DetermineSchemaSerializationMode(reader) == global::System.Data.SchemaSerializationMode.IncludeSchema)) {
                this.Reset();
                global::System.Data.DataSet ds = new global::System.Data.DataSet();
                ds.ReadXml(reader);
                if ((ds.Tables["Computer"] != null)) {
                    base.Tables.Add(new ComputerDataTable(ds.Tables["Computer"]));
                }
                if ((ds.Tables["Employee"] != null)) {
                    base.Tables.Add(new EmployeeDataTable(ds.Tables["Employee"]));
                }
                if ((ds.Tables["Inventory"] != null)) {
                    base.Tables.Add(new InventoryDataTable(ds.Tables["Inventory"]));
                }
                if ((ds.Tables["Room"] != null)) {
                    base.Tables.Add(new RoomDataTable(ds.Tables["Room"]));
                }
                this.DataSetName = ds.DataSetName;
                this.Prefix = ds.Prefix;
                this.Namespace = ds.Namespace;
                this.Locale = ds.Locale;
                this.CaseSensitive = ds.CaseSensitive;
                this.EnforceConstraints = ds.EnforceConstraints;
                this.Merge(ds, false, global::System.Data.MissingSchemaAction.Add);
                this.InitVars();
            }
            else {
                this.ReadXml(reader);
                this.InitVars();
            }
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        protected override global::System.Xml.Schema.XmlSchema GetSchemaSerializable() {
            global::System.IO.MemoryStream stream = new global::System.IO.MemoryStream();
            this.WriteXmlSchema(new global::System.Xml.XmlTextWriter(stream, null));
            stream.Position = 0;
            return global::System.Xml.Schema.XmlSchema.Read(new global::System.Xml.XmlTextReader(stream), null);
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        internal void InitVars() {
            this.InitVars(true);
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        internal void InitVars(bool initTable) {
            this.tableComputer = ((ComputerDataTable)(base.Tables["Computer"]));
            if ((initTable == true)) {
                if ((this.tableComputer != null)) {
                    this.tableComputer.InitVars();
                }
            }
            this.tableEmployee = ((EmployeeDataTable)(base.Tables["Employee"]));
            if ((initTable == true)) {
                if ((this.tableEmployee != null)) {
                    this.tableEmployee.InitVars();
                }
            }
            this.tableInventory = ((InventoryDataTable)(base.Tables["Inventory"]));
            if ((initTable == true)) {
                if ((this.tableInventory != null)) {
                    this.tableInventory.InitVars();
                }
            }
            this.tableRoom = ((RoomDataTable)(base.Tables["Room"]));
            if ((initTable == true)) {
                if ((this.tableRoom != null)) {
                    this.tableRoom.InitVars();
                }
            }
            this.relationRoomComputer = this.Relations["RoomComputer"];
            this.relationRoomEmployee = this.Relations["RoomEmployee"];
            this.relationRoomInventory = this.Relations["RoomInventory"];
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        private void InitClass() {
            this.DataSetName = "db_samplesDataSet";
            this.Prefix = "";
            this.Namespace = "http://tempuri.org/db_samplesDataSet.xsd";
            this.EnforceConstraints = true;
            this.SchemaSerializationMode = global::System.Data.SchemaSerializationMode.IncludeSchema;
            this.tableComputer = new ComputerDataTable();
            base.Tables.Add(this.tableComputer);
            this.tableEmployee = new EmployeeDataTable();
            base.Tables.Add(this.tableEmployee);
            this.tableInventory = new InventoryDataTable();
            base.Tables.Add(this.tableInventory);
            this.tableRoom = new RoomDataTable();
            base.Tables.Add(this.tableRoom);
            this.relationRoomComputer = new global::System.Data.DataRelation("RoomComputer", new global::System.Data.DataColumn[] {
                        this.tableRoom.Room_NoColumn}, new global::System.Data.DataColumn[] {
                        this.tableComputer.Room_NoColumn}, false);
            this.Relations.Add(this.relationRoomComputer);
            this.relationRoomEmployee = new global::System.Data.DataRelation("RoomEmployee", new global::System.Data.DataColumn[] {
                        this.tableRoom.Room_NoColumn}, new global::System.Data.DataColumn[] {
                        this.tableEmployee.Room_NoColumn}, false);
            this.Relations.Add(this.relationRoomEmployee);
            this.relationRoomInventory = new global::System.Data.DataRelation("RoomInventory", new global::System.Data.DataColumn[] {
                        this.tableRoom.Room_NoColumn}, new global::System.Data.DataColumn[] {
                        this.tableInventory.Room_NoColumn}, false);
            this.Relations.Add(this.relationRoomInventory);
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        private bool ShouldSerializeComputer() {
            return false;
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        private bool ShouldSerializeEmployee() {
            return false;
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        private bool ShouldSerializeInventory() {
            return false;
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        private bool ShouldSerializeRoom() {
            return false;
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        private void SchemaChanged(object sender, global::System.ComponentModel.CollectionChangeEventArgs e) {
            if ((e.Action == global::System.ComponentModel.CollectionChangeAction.Remove)) {
                this.InitVars();
            }
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        public static global::System.Xml.Schema.XmlSchemaComplexType GetTypedDataSetSchema(global::System.Xml.Schema.XmlSchemaSet xs) {
            db_samplesDataSet ds = new db_samplesDataSet();
            global::System.Xml.Schema.XmlSchemaComplexType type = new global::System.Xml.Schema.XmlSchemaComplexType();
            global::System.Xml.Schema.XmlSchemaSequence sequence = new global::System.Xml.Schema.XmlSchemaSequence();
            global::System.Xml.Schema.XmlSchemaAny any = new global::System.Xml.Schema.XmlSchemaAny();
            any.Namespace = ds.Namespace;
            sequence.Items.Add(any);
            type.Particle = sequence;
            global::System.Xml.Schema.XmlSchema dsSchema = ds.GetSchemaSerializable();
            if (xs.Contains(dsSchema.TargetNamespace)) {
                global::System.IO.MemoryStream s1 = new global::System.IO.MemoryStream();
                global::System.IO.MemoryStream s2 = new global::System.IO.MemoryStream();
                try {
                    global::System.Xml.Schema.XmlSchema schema = null;
                    dsSchema.Write(s1);
                    for (global::System.Collections.IEnumerator schemas = xs.Schemas(dsSchema.TargetNamespace).GetEnumerator(); schemas.MoveNext(); ) {
                        schema = ((global::System.Xml.Schema.XmlSchema)(schemas.Current));
                        s2.SetLength(0);
                        schema.Write(s2);
                        if ((s1.Length == s2.Length)) {
                            s1.Position = 0;
                            s2.Position = 0;
                            for (; ((s1.Position != s1.Length) 
                                        && (s1.ReadByte() == s2.ReadByte())); ) {
                                ;
                            }
                            if ((s1.Position == s1.Length)) {
                                return type;
                            }
                        }
                    }
                }
                finally {
                    if ((s1 != null)) {
                        s1.Close();
                    }
                    if ((s2 != null)) {
                        s2.Close();
                    }
                }
            }
            xs.Add(dsSchema);
            return type;
        }
        
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        public delegate void ComputerRowChangeEventHandler(object sender, ComputerRowChangeEvent e);
        
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        public delegate void EmployeeRowChangeEventHandler(object sender, EmployeeRowChangeEvent e);
        
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        public delegate void InventoryRowChangeEventHandler(object sender, InventoryRowChangeEvent e);
        
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        public delegate void RoomRowChangeEventHandler(object sender, RoomRowChangeEvent e);
        
        /// <summary>
        ///Represents the strongly named DataTable class.
        ///</summary>
        [global::System.Serializable()]
        [global::System.Xml.Serialization.XmlSchemaProviderAttribute("GetTypedTableSchema")]
        public partial class ComputerDataTable : global::System.Data.TypedTableBase<ComputerRow> {
            
            private global::System.Data.DataColumn columnTag_Number;
            
            private global::System.Data.DataColumn columnManufacturer;
            
            private global::System.Data.DataColumn columnEquipment_Description;
            
            private global::System.Data.DataColumn columnItem_Type;
            
            private global::System.Data.DataColumn columnRoom_No;
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public ComputerDataTable() {
                this.TableName = "Computer";
                this.BeginInit();
                this.InitClass();
                this.EndInit();
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            internal ComputerDataTable(global::System.Data.DataTable table) {
                this.TableName = table.TableName;
                if ((table.CaseSensitive != table.DataSet.CaseSensitive)) {
                    this.CaseSensitive = table.CaseSensitive;
                }
                if ((table.Locale.ToString() != table.DataSet.Locale.ToString())) {
                    this.Locale = table.Locale;
                }
                if ((table.Namespace != table.DataSet.Namespace)) {
                    this.Namespace = table.Namespace;
                }
                this.Prefix = table.Prefix;
                this.MinimumCapacity = table.MinimumCapacity;
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            protected ComputerDataTable(global::System.Runtime.Serialization.SerializationInfo info, global::System.Runtime.Serialization.StreamingContext context) : 
                    base(info, context) {
                this.InitVars();
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public global::System.Data.DataColumn Tag_NumberColumn {
                get {
                    return this.columnTag_Number;
                }
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public global::System.Data.DataColumn ManufacturerColumn {
                get {
                    return this.columnManufacturer;
                }
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public global::System.Data.DataColumn Equipment_DescriptionColumn {
                get {
                    return this.columnEquipment_Description;
                }
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public global::System.Data.DataColumn Item_TypeColumn {
                get {
                    return this.columnItem_Type;
                }
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public global::System.Data.DataColumn Room_NoColumn {
                get {
                    return this.columnRoom_No;
                }
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            [global::System.ComponentModel.Browsable(false)]
            public int Count {
                get {
                    return this.Rows.Count;
                }
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public ComputerRow this[int index] {
                get {
                    return ((ComputerRow)(this.Rows[index]));
                }
            }
            
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public event ComputerRowChangeEventHandler ComputerRowChanging;
            
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public event ComputerRowChangeEventHandler ComputerRowChanged;
            
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public event ComputerRowChangeEventHandler ComputerRowDeleting;
            
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public event ComputerRowChangeEventHandler ComputerRowDeleted;
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public void AddComputerRow(ComputerRow row) {
                this.Rows.Add(row);
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public ComputerRow AddComputerRow(int Tag_Number, string Manufacturer, string Equipment_Description, string Item_Type, RoomRow parentRoomRowByRoomComputer) {
                ComputerRow rowComputerRow = ((ComputerRow)(this.NewRow()));
                object[] columnValuesArray = new object[] {
                        Tag_Number,
                        Manufacturer,
                        Equipment_Description,
                        Item_Type,
                        null};
                if ((parentRoomRowByRoomComputer != null)) {
                    columnValuesArray[4] = parentRoomRowByRoomComputer[0];
                }
                rowComputerRow.ItemArray = columnValuesArray;
                this.Rows.Add(rowComputerRow);
                return rowComputerRow;
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public ComputerRow FindByTag_Number(int Tag_Number) {
                return ((ComputerRow)(this.Rows.Find(new object[] {
                            Tag_Number})));
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public override global::System.Data.DataTable Clone() {
                ComputerDataTable cln = ((ComputerDataTable)(base.Clone()));
                cln.InitVars();
                return cln;
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            protected override global::System.Data.DataTable CreateInstance() {
                return new ComputerDataTable();
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            internal void InitVars() {
                this.columnTag_Number = base.Columns["Tag_Number"];
                this.columnManufacturer = base.Columns["Manufacturer"];
                this.columnEquipment_Description = base.Columns["Equipment_Description"];
                this.columnItem_Type = base.Columns["Item_Type"];
                this.columnRoom_No = base.Columns["Room_No"];
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            private void InitClass() {
                this.columnTag_Number = new global::System.Data.DataColumn("Tag_Number", typeof(int), null, global::System.Data.MappingType.Element);
                base.Columns.Add(this.columnTag_Number);
                this.columnManufacturer = new global::System.Data.DataColumn("Manufacturer", typeof(string), null, global::System.Data.MappingType.Element);
                base.Columns.Add(this.columnManufacturer);
                this.columnEquipment_Description = new global::System.Data.DataColumn("Equipment_Description", typeof(string), null, global::System.Data.MappingType.Element);
                base.Columns.Add(this.columnEquipment_Description);
                this.columnItem_Type = new global::System.Data.DataColumn("Item_Type", typeof(string), null, global::System.Data.MappingType.Element);
                base.Columns.Add(this.columnItem_Type);
                this.columnRoom_No = new global::System.Data.DataColumn("Room_No", typeof(string), null, global::System.Data.MappingType.Element);
                base.Columns.Add(this.columnRoom_No);
                this.Constraints.Add(new global::System.Data.UniqueConstraint("Constraint1", new global::System.Data.DataColumn[] {
                                this.columnTag_Number}, true));
                this.columnTag_Number.AllowDBNull = false;
                this.columnTag_Number.Unique = true;
                this.columnManufacturer.MaxLength = 50;
                this.columnEquipment_Description.MaxLength = 75;
                this.columnItem_Type.MaxLength = 75;
                this.columnRoom_No.MaxLength = 5;
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public ComputerRow NewComputerRow() {
                return ((ComputerRow)(this.NewRow()));
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            protected override global::System.Data.DataRow NewRowFromBuilder(global::System.Data.DataRowBuilder builder) {
                return new ComputerRow(builder);
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            protected override global::System.Type GetRowType() {
                return typeof(ComputerRow);
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            protected override void OnRowChanged(global::System.Data.DataRowChangeEventArgs e) {
                base.OnRowChanged(e);
                if ((this.ComputerRowChanged != null)) {
                    this.ComputerRowChanged(this, new ComputerRowChangeEvent(((ComputerRow)(e.Row)), e.Action));
                }
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            protected override void OnRowChanging(global::System.Data.DataRowChangeEventArgs e) {
                base.OnRowChanging(e);
                if ((this.ComputerRowChanging != null)) {
                    this.ComputerRowChanging(this, new ComputerRowChangeEvent(((ComputerRow)(e.Row)), e.Action));
                }
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            protected override void OnRowDeleted(global::System.Data.DataRowChangeEventArgs e) {
                base.OnRowDeleted(e);
                if ((this.ComputerRowDeleted != null)) {
                    this.ComputerRowDeleted(this, new ComputerRowChangeEvent(((ComputerRow)(e.Row)), e.Action));
                }
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            protected override void OnRowDeleting(global::System.Data.DataRowChangeEventArgs e) {
                base.OnRowDeleting(e);
                if ((this.ComputerRowDeleting != null)) {
                    this.ComputerRowDeleting(this, new ComputerRowChangeEvent(((ComputerRow)(e.Row)), e.Action));
                }
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public void RemoveComputerRow(ComputerRow row) {
                this.Rows.Remove(row);
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public static global::System.Xml.Schema.XmlSchemaComplexType GetTypedTableSchema(global::System.Xml.Schema.XmlSchemaSet xs) {
                global::System.Xml.Schema.XmlSchemaComplexType type = new global::System.Xml.Schema.XmlSchemaComplexType();
                global::System.Xml.Schema.XmlSchemaSequence sequence = new global::System.Xml.Schema.XmlSchemaSequence();
                db_samplesDataSet ds = new db_samplesDataSet();
                global::System.Xml.Schema.XmlSchemaAny any1 = new global::System.Xml.Schema.XmlSchemaAny();
                any1.Namespace = "http://www.w3.org/2001/XMLSchema";
                any1.MinOccurs = new decimal(0);
                any1.MaxOccurs = decimal.MaxValue;
                any1.ProcessContents = global::System.Xml.Schema.XmlSchemaContentProcessing.Lax;
                sequence.Items.Add(any1);
                global::System.Xml.Schema.XmlSchemaAny any2 = new global::System.Xml.Schema.XmlSchemaAny();
                any2.Namespace = "urn:schemas-microsoft-com:xml-diffgram-v1";
                any2.MinOccurs = new decimal(1);
                any2.ProcessContents = global::System.Xml.Schema.XmlSchemaContentProcessing.Lax;
                sequence.Items.Add(any2);
                global::System.Xml.Schema.XmlSchemaAttribute attribute1 = new global::System.Xml.Schema.XmlSchemaAttribute();
                attribute1.Name = "namespace";
                attribute1.FixedValue = ds.Namespace;
                type.Attributes.Add(attribute1);
                global::System.Xml.Schema.XmlSchemaAttribute attribute2 = new global::System.Xml.Schema.XmlSchemaAttribute();
                attribute2.Name = "tableTypeName";
                attribute2.FixedValue = "ComputerDataTable";
                type.Attributes.Add(attribute2);
                type.Particle = sequence;
                global::System.Xml.Schema.XmlSchema dsSchema = ds.GetSchemaSerializable();
                if (xs.Contains(dsSchema.TargetNamespace)) {
                    global::System.IO.MemoryStream s1 = new global::System.IO.MemoryStream();
                    global::System.IO.MemoryStream s2 = new global::System.IO.MemoryStream();
                    try {
                        global::System.Xml.Schema.XmlSchema schema = null;
                        dsSchema.Write(s1);
                        for (global::System.Collections.IEnumerator schemas = xs.Schemas(dsSchema.TargetNamespace).GetEnumerator(); schemas.MoveNext(); ) {
                            schema = ((global::System.Xml.Schema.XmlSchema)(schemas.Current));
                            s2.SetLength(0);
                            schema.Write(s2);
                            if ((s1.Length == s2.Length)) {
                                s1.Position = 0;
                                s2.Position = 0;
                                for (; ((s1.Position != s1.Length) 
                                            && (s1.ReadByte() == s2.ReadByte())); ) {
                                    ;
                                }
                                if ((s1.Position == s1.Length)) {
                                    return type;
                                }
                            }
                        }
                    }
                    finally {
                        if ((s1 != null)) {
                            s1.Close();
                        }
                        if ((s2 != null)) {
                            s2.Close();
                        }
                    }
                }
                xs.Add(dsSchema);
                return type;
            }
        }
        
        /// <summary>
        ///Represents the strongly named DataTable class.
        ///</summary>
        [global::System.Serializable()]
        [global::System.Xml.Serialization.XmlSchemaProviderAttribute("GetTypedTableSchema")]
        public partial class EmployeeDataTable : global::System.Data.TypedTableBase<EmployeeRow> {
            
            private global::System.Data.DataColumn columnEmp_Id;
            
            private global::System.Data.DataColumn columnLast_Name;
            
            private global::System.Data.DataColumn columnFirst_Name;
            
            private global::System.Data.DataColumn columnGender;
            
            private global::System.Data.DataColumn columnTitle;
            
            private global::System.Data.DataColumn columnDepartment;
            
            private global::System.Data.DataColumn columnRoom_No;
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public EmployeeDataTable() {
                this.TableName = "Employee";
                this.BeginInit();
                this.InitClass();
                this.EndInit();
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            internal EmployeeDataTable(global::System.Data.DataTable table) {
                this.TableName = table.TableName;
                if ((table.CaseSensitive != table.DataSet.CaseSensitive)) {
                    this.CaseSensitive = table.CaseSensitive;
                }
                if ((table.Locale.ToString() != table.DataSet.Locale.ToString())) {
                    this.Locale = table.Locale;
                }
                if ((table.Namespace != table.DataSet.Namespace)) {
                    this.Namespace = table.Namespace;
                }
                this.Prefix = table.Prefix;
                this.MinimumCapacity = table.MinimumCapacity;
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            protected EmployeeDataTable(global::System.Runtime.Serialization.SerializationInfo info, global::System.Runtime.Serialization.StreamingContext context) : 
                    base(info, context) {
                this.InitVars();
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public global::System.Data.DataColumn Emp_IdColumn {
                get {
                    return this.columnEmp_Id;
                }
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public global::System.Data.DataColumn Last_NameColumn {
                get {
                    return this.columnLast_Name;
                }
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public global::System.Data.DataColumn First_NameColumn {
                get {
                    return this.columnFirst_Name;
                }
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public global::System.Data.DataColumn GenderColumn {
                get {
                    return this.columnGender;
                }
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public global::System.Data.DataColumn TitleColumn {
                get {
                    return this.columnTitle;
                }
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public global::System.Data.DataColumn DepartmentColumn {
                get {
                    return this.columnDepartment;
                }
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public global::System.Data.DataColumn Room_NoColumn {
                get {
                    return this.columnRoom_No;
                }
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            [global::System.ComponentModel.Browsable(false)]
            public int Count {
                get {
                    return this.Rows.Count;
                }
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public EmployeeRow this[int index] {
                get {
                    return ((EmployeeRow)(this.Rows[index]));
                }
            }
            
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public event EmployeeRowChangeEventHandler EmployeeRowChanging;
            
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public event EmployeeRowChangeEventHandler EmployeeRowChanged;
            
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public event EmployeeRowChangeEventHandler EmployeeRowDeleting;
            
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public event EmployeeRowChangeEventHandler EmployeeRowDeleted;
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public void AddEmployeeRow(EmployeeRow row) {
                this.Rows.Add(row);
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public EmployeeRow AddEmployeeRow(string Emp_Id, string Last_Name, string First_Name, string Gender, string Title, string Department, RoomRow parentRoomRowByRoomEmployee) {
                EmployeeRow rowEmployeeRow = ((EmployeeRow)(this.NewRow()));
                object[] columnValuesArray = new object[] {
                        Emp_Id,
                        Last_Name,
                        First_Name,
                        Gender,
                        Title,
                        Department,
                        null};
                if ((parentRoomRowByRoomEmployee != null)) {
                    columnValuesArray[6] = parentRoomRowByRoomEmployee[0];
                }
                rowEmployeeRow.ItemArray = columnValuesArray;
                this.Rows.Add(rowEmployeeRow);
                return rowEmployeeRow;
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public EmployeeRow FindByEmp_Id(string Emp_Id) {
                return ((EmployeeRow)(this.Rows.Find(new object[] {
                            Emp_Id})));
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public override global::System.Data.DataTable Clone() {
                EmployeeDataTable cln = ((EmployeeDataTable)(base.Clone()));
                cln.InitVars();
                return cln;
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            protected override global::System.Data.DataTable CreateInstance() {
                return new EmployeeDataTable();
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            internal void InitVars() {
                this.columnEmp_Id = base.Columns["Emp_Id"];
                this.columnLast_Name = base.Columns["Last_Name"];
                this.columnFirst_Name = base.Columns["First_Name"];
                this.columnGender = base.Columns["Gender"];
                this.columnTitle = base.Columns["Title"];
                this.columnDepartment = base.Columns["Department"];
                this.columnRoom_No = base.Columns["Room_No"];
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            private void InitClass() {
                this.columnEmp_Id = new global::System.Data.DataColumn("Emp_Id", typeof(string), null, global::System.Data.MappingType.Element);
                base.Columns.Add(this.columnEmp_Id);
                this.columnLast_Name = new global::System.Data.DataColumn("Last_Name", typeof(string), null, global::System.Data.MappingType.Element);
                base.Columns.Add(this.columnLast_Name);
                this.columnFirst_Name = new global::System.Data.DataColumn("First_Name", typeof(string), null, global::System.Data.MappingType.Element);
                base.Columns.Add(this.columnFirst_Name);
                this.columnGender = new global::System.Data.DataColumn("Gender", typeof(string), null, global::System.Data.MappingType.Element);
                base.Columns.Add(this.columnGender);
                this.columnTitle = new global::System.Data.DataColumn("Title", typeof(string), null, global::System.Data.MappingType.Element);
                base.Columns.Add(this.columnTitle);
                this.columnDepartment = new global::System.Data.DataColumn("Department", typeof(string), null, global::System.Data.MappingType.Element);
                base.Columns.Add(this.columnDepartment);
                this.columnRoom_No = new global::System.Data.DataColumn("Room_No", typeof(string), null, global::System.Data.MappingType.Element);
                base.Columns.Add(this.columnRoom_No);
                this.Constraints.Add(new global::System.Data.UniqueConstraint("Constraint1", new global::System.Data.DataColumn[] {
                                this.columnEmp_Id}, true));
                this.columnEmp_Id.AllowDBNull = false;
                this.columnEmp_Id.Unique = true;
                this.columnEmp_Id.MaxLength = 5;
                this.columnLast_Name.MaxLength = 30;
                this.columnFirst_Name.MaxLength = 30;
                this.columnGender.MaxLength = 3;
                this.columnTitle.MaxLength = 25;
                this.columnDepartment.MaxLength = 30;
                this.columnRoom_No.MaxLength = 5;
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public EmployeeRow NewEmployeeRow() {
                return ((EmployeeRow)(this.NewRow()));
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            protected override global::System.Data.DataRow NewRowFromBuilder(global::System.Data.DataRowBuilder builder) {
                return new EmployeeRow(builder);
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            protected override global::System.Type GetRowType() {
                return typeof(EmployeeRow);
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            protected override void OnRowChanged(global::System.Data.DataRowChangeEventArgs e) {
                base.OnRowChanged(e);
                if ((this.EmployeeRowChanged != null)) {
                    this.EmployeeRowChanged(this, new EmployeeRowChangeEvent(((EmployeeRow)(e.Row)), e.Action));
                }
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            protected override void OnRowChanging(global::System.Data.DataRowChangeEventArgs e) {
                base.OnRowChanging(e);
                if ((this.EmployeeRowChanging != null)) {
                    this.EmployeeRowChanging(this, new EmployeeRowChangeEvent(((EmployeeRow)(e.Row)), e.Action));
                }
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            protected override void OnRowDeleted(global::System.Data.DataRowChangeEventArgs e) {
                base.OnRowDeleted(e);
                if ((this.EmployeeRowDeleted != null)) {
                    this.EmployeeRowDeleted(this, new EmployeeRowChangeEvent(((EmployeeRow)(e.Row)), e.Action));
                }
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            protected override void OnRowDeleting(global::System.Data.DataRowChangeEventArgs e) {
                base.OnRowDeleting(e);
                if ((this.EmployeeRowDeleting != null)) {
                    this.EmployeeRowDeleting(this, new EmployeeRowChangeEvent(((EmployeeRow)(e.Row)), e.Action));
                }
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public void RemoveEmployeeRow(EmployeeRow row) {
                this.Rows.Remove(row);
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public static global::System.Xml.Schema.XmlSchemaComplexType GetTypedTableSchema(global::System.Xml.Schema.XmlSchemaSet xs) {
                global::System.Xml.Schema.XmlSchemaComplexType type = new global::System.Xml.Schema.XmlSchemaComplexType();
                global::System.Xml.Schema.XmlSchemaSequence sequence = new global::System.Xml.Schema.XmlSchemaSequence();
                db_samplesDataSet ds = new db_samplesDataSet();
                global::System.Xml.Schema.XmlSchemaAny any1 = new global::System.Xml.Schema.XmlSchemaAny();
                any1.Namespace = "http://www.w3.org/2001/XMLSchema";
                any1.MinOccurs = new decimal(0);
                any1.MaxOccurs = decimal.MaxValue;
                any1.ProcessContents = global::System.Xml.Schema.XmlSchemaContentProcessing.Lax;
                sequence.Items.Add(any1);
                global::System.Xml.Schema.XmlSchemaAny any2 = new global::System.Xml.Schema.XmlSchemaAny();
                any2.Namespace = "urn:schemas-microsoft-com:xml-diffgram-v1";
                any2.MinOccurs = new decimal(1);
                any2.ProcessContents = global::System.Xml.Schema.XmlSchemaContentProcessing.Lax;
                sequence.Items.Add(any2);
                global::System.Xml.Schema.XmlSchemaAttribute attribute1 = new global::System.Xml.Schema.XmlSchemaAttribute();
                attribute1.Name = "namespace";
                attribute1.FixedValue = ds.Namespace;
                type.Attributes.Add(attribute1);
                global::System.Xml.Schema.XmlSchemaAttribute attribute2 = new global::System.Xml.Schema.XmlSchemaAttribute();
                attribute2.Name = "tableTypeName";
                attribute2.FixedValue = "EmployeeDataTable";
                type.Attributes.Add(attribute2);
                type.Particle = sequence;
                global::System.Xml.Schema.XmlSchema dsSchema = ds.GetSchemaSerializable();
                if (xs.Contains(dsSchema.TargetNamespace)) {
                    global::System.IO.MemoryStream s1 = new global::System.IO.MemoryStream();
                    global::System.IO.MemoryStream s2 = new global::System.IO.MemoryStream();
                    try {
                        global::System.Xml.Schema.XmlSchema schema = null;
                        dsSchema.Write(s1);
                        for (global::System.Collections.IEnumerator schemas = xs.Schemas(dsSchema.TargetNamespace).GetEnumerator(); schemas.MoveNext(); ) {
                            schema = ((global::System.Xml.Schema.XmlSchema)(schemas.Current));
                            s2.SetLength(0);
                            schema.Write(s2);
                            if ((s1.Length == s2.Length)) {
                                s1.Position = 0;
                                s2.Position = 0;
                                for (; ((s1.Position != s1.Length) 
                                            && (s1.ReadByte() == s2.ReadByte())); ) {
                                    ;
                                }
                                if ((s1.Position == s1.Length)) {
                                    return type;
                                }
                            }
                        }
                    }
                    finally {
                        if ((s1 != null)) {
                            s1.Close();
                        }
                        if ((s2 != null)) {
                            s2.Close();
                        }
                    }
                }
                xs.Add(dsSchema);
                return type;
            }
        }
        
        /// <summary>
        ///Represents the strongly named DataTable class.
        ///</summary>
        [global::System.Serializable()]
        [global::System.Xml.Serialization.XmlSchemaProviderAttribute("GetTypedTableSchema")]
        public partial class InventoryDataTable : global::System.Data.TypedTableBase<InventoryRow> {
            
            private global::System.Data.DataColumn columnInv_ID;
            
            private global::System.Data.DataColumn columnType;
            
            private global::System.Data.DataColumn columnDescription;
            
            private global::System.Data.DataColumn columnManufacturer;
            
            private global::System.Data.DataColumn columnModel;
            
            private global::System.Data.DataColumn columnPrice;
            
            private global::System.Data.DataColumn columnRoom_No;
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public InventoryDataTable() {
                this.TableName = "Inventory";
                this.BeginInit();
                this.InitClass();
                this.EndInit();
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            internal InventoryDataTable(global::System.Data.DataTable table) {
                this.TableName = table.TableName;
                if ((table.CaseSensitive != table.DataSet.CaseSensitive)) {
                    this.CaseSensitive = table.CaseSensitive;
                }
                if ((table.Locale.ToString() != table.DataSet.Locale.ToString())) {
                    this.Locale = table.Locale;
                }
                if ((table.Namespace != table.DataSet.Namespace)) {
                    this.Namespace = table.Namespace;
                }
                this.Prefix = table.Prefix;
                this.MinimumCapacity = table.MinimumCapacity;
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            protected InventoryDataTable(global::System.Runtime.Serialization.SerializationInfo info, global::System.Runtime.Serialization.StreamingContext context) : 
                    base(info, context) {
                this.InitVars();
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public global::System.Data.DataColumn Inv_IDColumn {
                get {
                    return this.columnInv_ID;
                }
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public global::System.Data.DataColumn TypeColumn {
                get {
                    return this.columnType;
                }
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public global::System.Data.DataColumn DescriptionColumn {
                get {
                    return this.columnDescription;
                }
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public global::System.Data.DataColumn ManufacturerColumn {
                get {
                    return this.columnManufacturer;
                }
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public global::System.Data.DataColumn ModelColumn {
                get {
                    return this.columnModel;
                }
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public global::System.Data.DataColumn PriceColumn {
                get {
                    return this.columnPrice;
                }
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public global::System.Data.DataColumn Room_NoColumn {
                get {
                    return this.columnRoom_No;
                }
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            [global::System.ComponentModel.Browsable(false)]
            public int Count {
                get {
                    return this.Rows.Count;
                }
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public InventoryRow this[int index] {
                get {
                    return ((InventoryRow)(this.Rows[index]));
                }
            }
            
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public event InventoryRowChangeEventHandler InventoryRowChanging;
            
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public event InventoryRowChangeEventHandler InventoryRowChanged;
            
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public event InventoryRowChangeEventHandler InventoryRowDeleting;
            
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public event InventoryRowChangeEventHandler InventoryRowDeleted;
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public void AddInventoryRow(InventoryRow row) {
                this.Rows.Add(row);
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public InventoryRow AddInventoryRow(double Inv_ID, string Type, string Description, string Manufacturer, string Model, decimal Price, RoomRow parentRoomRowByRoomInventory) {
                InventoryRow rowInventoryRow = ((InventoryRow)(this.NewRow()));
                object[] columnValuesArray = new object[] {
                        Inv_ID,
                        Type,
                        Description,
                        Manufacturer,
                        Model,
                        Price,
                        null};
                if ((parentRoomRowByRoomInventory != null)) {
                    columnValuesArray[6] = parentRoomRowByRoomInventory[0];
                }
                rowInventoryRow.ItemArray = columnValuesArray;
                this.Rows.Add(rowInventoryRow);
                return rowInventoryRow;
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public InventoryRow FindByInv_ID(double Inv_ID) {
                return ((InventoryRow)(this.Rows.Find(new object[] {
                            Inv_ID})));
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public override global::System.Data.DataTable Clone() {
                InventoryDataTable cln = ((InventoryDataTable)(base.Clone()));
                cln.InitVars();
                return cln;
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            protected override global::System.Data.DataTable CreateInstance() {
                return new InventoryDataTable();
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            internal void InitVars() {
                this.columnInv_ID = base.Columns["Inv_ID"];
                this.columnType = base.Columns["Type"];
                this.columnDescription = base.Columns["Description"];
                this.columnManufacturer = base.Columns["Manufacturer"];
                this.columnModel = base.Columns["Model"];
                this.columnPrice = base.Columns["Price"];
                this.columnRoom_No = base.Columns["Room_No"];
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            private void InitClass() {
                this.columnInv_ID = new global::System.Data.DataColumn("Inv_ID", typeof(double), null, global::System.Data.MappingType.Element);
                base.Columns.Add(this.columnInv_ID);
                this.columnType = new global::System.Data.DataColumn("Type", typeof(string), null, global::System.Data.MappingType.Element);
                base.Columns.Add(this.columnType);
                this.columnDescription = new global::System.Data.DataColumn("Description", typeof(string), null, global::System.Data.MappingType.Element);
                base.Columns.Add(this.columnDescription);
                this.columnManufacturer = new global::System.Data.DataColumn("Manufacturer", typeof(string), null, global::System.Data.MappingType.Element);
                base.Columns.Add(this.columnManufacturer);
                this.columnModel = new global::System.Data.DataColumn("Model", typeof(string), null, global::System.Data.MappingType.Element);
                base.Columns.Add(this.columnModel);
                this.columnPrice = new global::System.Data.DataColumn("Price", typeof(decimal), null, global::System.Data.MappingType.Element);
                base.Columns.Add(this.columnPrice);
                this.columnRoom_No = new global::System.Data.DataColumn("Room_No", typeof(string), null, global::System.Data.MappingType.Element);
                base.Columns.Add(this.columnRoom_No);
                this.Constraints.Add(new global::System.Data.UniqueConstraint("Constraint1", new global::System.Data.DataColumn[] {
                                this.columnInv_ID}, true));
                this.columnInv_ID.AllowDBNull = false;
                this.columnInv_ID.Unique = true;
                this.columnType.MaxLength = 30;
                this.columnDescription.MaxLength = 20;
                this.columnManufacturer.MaxLength = 25;
                this.columnModel.MaxLength = 20;
                this.columnRoom_No.MaxLength = 5;
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public InventoryRow NewInventoryRow() {
                return ((InventoryRow)(this.NewRow()));
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            protected override global::System.Data.DataRow NewRowFromBuilder(global::System.Data.DataRowBuilder builder) {
                return new InventoryRow(builder);
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            protected override global::System.Type GetRowType() {
                return typeof(InventoryRow);
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            protected override void OnRowChanged(global::System.Data.DataRowChangeEventArgs e) {
                base.OnRowChanged(e);
                if ((this.InventoryRowChanged != null)) {
                    this.InventoryRowChanged(this, new InventoryRowChangeEvent(((InventoryRow)(e.Row)), e.Action));
                }
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            protected override void OnRowChanging(global::System.Data.DataRowChangeEventArgs e) {
                base.OnRowChanging(e);
                if ((this.InventoryRowChanging != null)) {
                    this.InventoryRowChanging(this, new InventoryRowChangeEvent(((InventoryRow)(e.Row)), e.Action));
                }
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            protected override void OnRowDeleted(global::System.Data.DataRowChangeEventArgs e) {
                base.OnRowDeleted(e);
                if ((this.InventoryRowDeleted != null)) {
                    this.InventoryRowDeleted(this, new InventoryRowChangeEvent(((InventoryRow)(e.Row)), e.Action));
                }
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            protected override void OnRowDeleting(global::System.Data.DataRowChangeEventArgs e) {
                base.OnRowDeleting(e);
                if ((this.InventoryRowDeleting != null)) {
                    this.InventoryRowDeleting(this, new InventoryRowChangeEvent(((InventoryRow)(e.Row)), e.Action));
                }
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public void RemoveInventoryRow(InventoryRow row) {
                this.Rows.Remove(row);
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public static global::System.Xml.Schema.XmlSchemaComplexType GetTypedTableSchema(global::System.Xml.Schema.XmlSchemaSet xs) {
                global::System.Xml.Schema.XmlSchemaComplexType type = new global::System.Xml.Schema.XmlSchemaComplexType();
                global::System.Xml.Schema.XmlSchemaSequence sequence = new global::System.Xml.Schema.XmlSchemaSequence();
                db_samplesDataSet ds = new db_samplesDataSet();
                global::System.Xml.Schema.XmlSchemaAny any1 = new global::System.Xml.Schema.XmlSchemaAny();
                any1.Namespace = "http://www.w3.org/2001/XMLSchema";
                any1.MinOccurs = new decimal(0);
                any1.MaxOccurs = decimal.MaxValue;
                any1.ProcessContents = global::System.Xml.Schema.XmlSchemaContentProcessing.Lax;
                sequence.Items.Add(any1);
                global::System.Xml.Schema.XmlSchemaAny any2 = new global::System.Xml.Schema.XmlSchemaAny();
                any2.Namespace = "urn:schemas-microsoft-com:xml-diffgram-v1";
                any2.MinOccurs = new decimal(1);
                any2.ProcessContents = global::System.Xml.Schema.XmlSchemaContentProcessing.Lax;
                sequence.Items.Add(any2);
                global::System.Xml.Schema.XmlSchemaAttribute attribute1 = new global::System.Xml.Schema.XmlSchemaAttribute();
                attribute1.Name = "namespace";
                attribute1.FixedValue = ds.Namespace;
                type.Attributes.Add(attribute1);
                global::System.Xml.Schema.XmlSchemaAttribute attribute2 = new global::System.Xml.Schema.XmlSchemaAttribute();
                attribute2.Name = "tableTypeName";
                attribute2.FixedValue = "InventoryDataTable";
                type.Attributes.Add(attribute2);
                type.Particle = sequence;
                global::System.Xml.Schema.XmlSchema dsSchema = ds.GetSchemaSerializable();
                if (xs.Contains(dsSchema.TargetNamespace)) {
                    global::System.IO.MemoryStream s1 = new global::System.IO.MemoryStream();
                    global::System.IO.MemoryStream s2 = new global::System.IO.MemoryStream();
                    try {
                        global::System.Xml.Schema.XmlSchema schema = null;
                        dsSchema.Write(s1);
                        for (global::System.Collections.IEnumerator schemas = xs.Schemas(dsSchema.TargetNamespace).GetEnumerator(); schemas.MoveNext(); ) {
                            schema = ((global::System.Xml.Schema.XmlSchema)(schemas.Current));
                            s2.SetLength(0);
                            schema.Write(s2);
                            if ((s1.Length == s2.Length)) {
                                s1.Position = 0;
                                s2.Position = 0;
                                for (; ((s1.Position != s1.Length) 
                                            && (s1.ReadByte() == s2.ReadByte())); ) {
                                    ;
                                }
                                if ((s1.Position == s1.Length)) {
                                    return type;
                                }
                            }
                        }
                    }
                    finally {
                        if ((s1 != null)) {
                            s1.Close();
                        }
                        if ((s2 != null)) {
                            s2.Close();
                        }
                    }
                }
                xs.Add(dsSchema);
                return type;
            }
        }
        
        /// <summary>
        ///Represents the strongly named DataTable class.
        ///</summary>
        [global::System.Serializable()]
        [global::System.Xml.Serialization.XmlSchemaProviderAttribute("GetTypedTableSchema")]
        public partial class RoomDataTable : global::System.Data.TypedTableBase<RoomRow> {
            
            private global::System.Data.DataColumn columnRoom_No;
            
            private global::System.Data.DataColumn columnRoom_Type;
            
            private global::System.Data.DataColumn columnArea;
            
            private global::System.Data.DataColumn columnEntity_Handle;
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public RoomDataTable() {
                this.TableName = "Room";
                this.BeginInit();
                this.InitClass();
                this.EndInit();
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            internal RoomDataTable(global::System.Data.DataTable table) {
                this.TableName = table.TableName;
                if ((table.CaseSensitive != table.DataSet.CaseSensitive)) {
                    this.CaseSensitive = table.CaseSensitive;
                }
                if ((table.Locale.ToString() != table.DataSet.Locale.ToString())) {
                    this.Locale = table.Locale;
                }
                if ((table.Namespace != table.DataSet.Namespace)) {
                    this.Namespace = table.Namespace;
                }
                this.Prefix = table.Prefix;
                this.MinimumCapacity = table.MinimumCapacity;
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            protected RoomDataTable(global::System.Runtime.Serialization.SerializationInfo info, global::System.Runtime.Serialization.StreamingContext context) : 
                    base(info, context) {
                this.InitVars();
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public global::System.Data.DataColumn Room_NoColumn {
                get {
                    return this.columnRoom_No;
                }
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public global::System.Data.DataColumn Room_TypeColumn {
                get {
                    return this.columnRoom_Type;
                }
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public global::System.Data.DataColumn AreaColumn {
                get {
                    return this.columnArea;
                }
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public global::System.Data.DataColumn Entity_HandleColumn {
                get {
                    return this.columnEntity_Handle;
                }
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            [global::System.ComponentModel.Browsable(false)]
            public int Count {
                get {
                    return this.Rows.Count;
                }
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public RoomRow this[int index] {
                get {
                    return ((RoomRow)(this.Rows[index]));
                }
            }
            
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public event RoomRowChangeEventHandler RoomRowChanging;
            
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public event RoomRowChangeEventHandler RoomRowChanged;
            
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public event RoomRowChangeEventHandler RoomRowDeleting;
            
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public event RoomRowChangeEventHandler RoomRowDeleted;
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public void AddRoomRow(RoomRow row) {
                this.Rows.Add(row);
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public RoomRow AddRoomRow(string Room_No, string Room_Type, double Area, string Entity_Handle) {
                RoomRow rowRoomRow = ((RoomRow)(this.NewRow()));
                object[] columnValuesArray = new object[] {
                        Room_No,
                        Room_Type,
                        Area,
                        Entity_Handle};
                rowRoomRow.ItemArray = columnValuesArray;
                this.Rows.Add(rowRoomRow);
                return rowRoomRow;
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public RoomRow FindByRoom_No(string Room_No) {
                return ((RoomRow)(this.Rows.Find(new object[] {
                            Room_No})));
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public override global::System.Data.DataTable Clone() {
                RoomDataTable cln = ((RoomDataTable)(base.Clone()));
                cln.InitVars();
                return cln;
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            protected override global::System.Data.DataTable CreateInstance() {
                return new RoomDataTable();
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            internal void InitVars() {
                this.columnRoom_No = base.Columns["Room_No"];
                this.columnRoom_Type = base.Columns["Room_Type"];
                this.columnArea = base.Columns["Area"];
                this.columnEntity_Handle = base.Columns["Entity_Handle"];
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            private void InitClass() {
                this.columnRoom_No = new global::System.Data.DataColumn("Room_No", typeof(string), null, global::System.Data.MappingType.Element);
                base.Columns.Add(this.columnRoom_No);
                this.columnRoom_Type = new global::System.Data.DataColumn("Room_Type", typeof(string), null, global::System.Data.MappingType.Element);
                base.Columns.Add(this.columnRoom_Type);
                this.columnArea = new global::System.Data.DataColumn("Area", typeof(double), null, global::System.Data.MappingType.Element);
                base.Columns.Add(this.columnArea);
                this.columnEntity_Handle = new global::System.Data.DataColumn("Entity_Handle", typeof(string), null, global::System.Data.MappingType.Element);
                base.Columns.Add(this.columnEntity_Handle);
                this.Constraints.Add(new global::System.Data.UniqueConstraint("Constraint1", new global::System.Data.DataColumn[] {
                                this.columnRoom_No}, true));
                this.columnRoom_No.AllowDBNull = false;
                this.columnRoom_No.Unique = true;
                this.columnRoom_No.MaxLength = 5;
                this.columnRoom_Type.MaxLength = 25;
                this.columnEntity_Handle.MaxLength = 10;
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public RoomRow NewRoomRow() {
                return ((RoomRow)(this.NewRow()));
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            protected override global::System.Data.DataRow NewRowFromBuilder(global::System.Data.DataRowBuilder builder) {
                return new RoomRow(builder);
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            protected override global::System.Type GetRowType() {
                return typeof(RoomRow);
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            protected override void OnRowChanged(global::System.Data.DataRowChangeEventArgs e) {
                base.OnRowChanged(e);
                if ((this.RoomRowChanged != null)) {
                    this.RoomRowChanged(this, new RoomRowChangeEvent(((RoomRow)(e.Row)), e.Action));
                }
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            protected override void OnRowChanging(global::System.Data.DataRowChangeEventArgs e) {
                base.OnRowChanging(e);
                if ((this.RoomRowChanging != null)) {
                    this.RoomRowChanging(this, new RoomRowChangeEvent(((RoomRow)(e.Row)), e.Action));
                }
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            protected override void OnRowDeleted(global::System.Data.DataRowChangeEventArgs e) {
                base.OnRowDeleted(e);
                if ((this.RoomRowDeleted != null)) {
                    this.RoomRowDeleted(this, new RoomRowChangeEvent(((RoomRow)(e.Row)), e.Action));
                }
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            protected override void OnRowDeleting(global::System.Data.DataRowChangeEventArgs e) {
                base.OnRowDeleting(e);
                if ((this.RoomRowDeleting != null)) {
                    this.RoomRowDeleting(this, new RoomRowChangeEvent(((RoomRow)(e.Row)), e.Action));
                }
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public void RemoveRoomRow(RoomRow row) {
                this.Rows.Remove(row);
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public static global::System.Xml.Schema.XmlSchemaComplexType GetTypedTableSchema(global::System.Xml.Schema.XmlSchemaSet xs) {
                global::System.Xml.Schema.XmlSchemaComplexType type = new global::System.Xml.Schema.XmlSchemaComplexType();
                global::System.Xml.Schema.XmlSchemaSequence sequence = new global::System.Xml.Schema.XmlSchemaSequence();
                db_samplesDataSet ds = new db_samplesDataSet();
                global::System.Xml.Schema.XmlSchemaAny any1 = new global::System.Xml.Schema.XmlSchemaAny();
                any1.Namespace = "http://www.w3.org/2001/XMLSchema";
                any1.MinOccurs = new decimal(0);
                any1.MaxOccurs = decimal.MaxValue;
                any1.ProcessContents = global::System.Xml.Schema.XmlSchemaContentProcessing.Lax;
                sequence.Items.Add(any1);
                global::System.Xml.Schema.XmlSchemaAny any2 = new global::System.Xml.Schema.XmlSchemaAny();
                any2.Namespace = "urn:schemas-microsoft-com:xml-diffgram-v1";
                any2.MinOccurs = new decimal(1);
                any2.ProcessContents = global::System.Xml.Schema.XmlSchemaContentProcessing.Lax;
                sequence.Items.Add(any2);
                global::System.Xml.Schema.XmlSchemaAttribute attribute1 = new global::System.Xml.Schema.XmlSchemaAttribute();
                attribute1.Name = "namespace";
                attribute1.FixedValue = ds.Namespace;
                type.Attributes.Add(attribute1);
                global::System.Xml.Schema.XmlSchemaAttribute attribute2 = new global::System.Xml.Schema.XmlSchemaAttribute();
                attribute2.Name = "tableTypeName";
                attribute2.FixedValue = "RoomDataTable";
                type.Attributes.Add(attribute2);
                type.Particle = sequence;
                global::System.Xml.Schema.XmlSchema dsSchema = ds.GetSchemaSerializable();
                if (xs.Contains(dsSchema.TargetNamespace)) {
                    global::System.IO.MemoryStream s1 = new global::System.IO.MemoryStream();
                    global::System.IO.MemoryStream s2 = new global::System.IO.MemoryStream();
                    try {
                        global::System.Xml.Schema.XmlSchema schema = null;
                        dsSchema.Write(s1);
                        for (global::System.Collections.IEnumerator schemas = xs.Schemas(dsSchema.TargetNamespace).GetEnumerator(); schemas.MoveNext(); ) {
                            schema = ((global::System.Xml.Schema.XmlSchema)(schemas.Current));
                            s2.SetLength(0);
                            schema.Write(s2);
                            if ((s1.Length == s2.Length)) {
                                s1.Position = 0;
                                s2.Position = 0;
                                for (; ((s1.Position != s1.Length) 
                                            && (s1.ReadByte() == s2.ReadByte())); ) {
                                    ;
                                }
                                if ((s1.Position == s1.Length)) {
                                    return type;
                                }
                            }
                        }
                    }
                    finally {
                        if ((s1 != null)) {
                            s1.Close();
                        }
                        if ((s2 != null)) {
                            s2.Close();
                        }
                    }
                }
                xs.Add(dsSchema);
                return type;
            }
        }
        
        /// <summary>
        ///Represents strongly named DataRow class.
        ///</summary>
        public partial class ComputerRow : global::System.Data.DataRow {
            
            private ComputerDataTable tableComputer;
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            internal ComputerRow(global::System.Data.DataRowBuilder rb) : 
                    base(rb) {
                this.tableComputer = ((ComputerDataTable)(this.Table));
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public int Tag_Number {
                get {
                    return ((int)(this[this.tableComputer.Tag_NumberColumn]));
                }
                set {
                    this[this.tableComputer.Tag_NumberColumn] = value;
                }
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public string Manufacturer {
                get {
                    try {
                        return ((string)(this[this.tableComputer.ManufacturerColumn]));
                    }
                    catch (global::System.InvalidCastException e) {
                        throw new global::System.Data.StrongTypingException("表“Computer”中列“Manufacturer”的值为 DBNull。", e);
                    }
                }
                set {
                    this[this.tableComputer.ManufacturerColumn] = value;
                }
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public string Equipment_Description {
                get {
                    try {
                        return ((string)(this[this.tableComputer.Equipment_DescriptionColumn]));
                    }
                    catch (global::System.InvalidCastException e) {
                        throw new global::System.Data.StrongTypingException("表“Computer”中列“Equipment_Description”的值为 DBNull。", e);
                    }
                }
                set {
                    this[this.tableComputer.Equipment_DescriptionColumn] = value;
                }
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public string Item_Type {
                get {
                    try {
                        return ((string)(this[this.tableComputer.Item_TypeColumn]));
                    }
                    catch (global::System.InvalidCastException e) {
                        throw new global::System.Data.StrongTypingException("表“Computer”中列“Item_Type”的值为 DBNull。", e);
                    }
                }
                set {
                    this[this.tableComputer.Item_TypeColumn] = value;
                }
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public string Room_No {
                get {
                    try {
                        return ((string)(this[this.tableComputer.Room_NoColumn]));
                    }
                    catch (global::System.InvalidCastException e) {
                        throw new global::System.Data.StrongTypingException("表“Computer”中列“Room_No”的值为 DBNull。", e);
                    }
                }
                set {
                    this[this.tableComputer.Room_NoColumn] = value;
                }
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public RoomRow RoomRow {
                get {
                    return ((RoomRow)(this.GetParentRow(this.Table.ParentRelations["RoomComputer"])));
                }
                set {
                    this.SetParentRow(value, this.Table.ParentRelations["RoomComputer"]);
                }
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public bool IsManufacturerNull() {
                return this.IsNull(this.tableComputer.ManufacturerColumn);
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public void SetManufacturerNull() {
                this[this.tableComputer.ManufacturerColumn] = global::System.Convert.DBNull;
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public bool IsEquipment_DescriptionNull() {
                return this.IsNull(this.tableComputer.Equipment_DescriptionColumn);
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public void SetEquipment_DescriptionNull() {
                this[this.tableComputer.Equipment_DescriptionColumn] = global::System.Convert.DBNull;
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public bool IsItem_TypeNull() {
                return this.IsNull(this.tableComputer.Item_TypeColumn);
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public void SetItem_TypeNull() {
                this[this.tableComputer.Item_TypeColumn] = global::System.Convert.DBNull;
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public bool IsRoom_NoNull() {
                return this.IsNull(this.tableComputer.Room_NoColumn);
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public void SetRoom_NoNull() {
                this[this.tableComputer.Room_NoColumn] = global::System.Convert.DBNull;
            }
        }
        
        /// <summary>
        ///Represents strongly named DataRow class.
        ///</summary>
        public partial class EmployeeRow : global::System.Data.DataRow {
            
            private EmployeeDataTable tableEmployee;
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            internal EmployeeRow(global::System.Data.DataRowBuilder rb) : 
                    base(rb) {
                this.tableEmployee = ((EmployeeDataTable)(this.Table));
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public string Emp_Id {
                get {
                    return ((string)(this[this.tableEmployee.Emp_IdColumn]));
                }
                set {
                    this[this.tableEmployee.Emp_IdColumn] = value;
                }
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public string Last_Name {
                get {
                    try {
                        return ((string)(this[this.tableEmployee.Last_NameColumn]));
                    }
                    catch (global::System.InvalidCastException e) {
                        throw new global::System.Data.StrongTypingException("表“Employee”中列“Last_Name”的值为 DBNull。", e);
                    }
                }
                set {
                    this[this.tableEmployee.Last_NameColumn] = value;
                }
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public string First_Name {
                get {
                    try {
                        return ((string)(this[this.tableEmployee.First_NameColumn]));
                    }
                    catch (global::System.InvalidCastException e) {
                        throw new global::System.Data.StrongTypingException("表“Employee”中列“First_Name”的值为 DBNull。", e);
                    }
                }
                set {
                    this[this.tableEmployee.First_NameColumn] = value;
                }
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public string Gender {
                get {
                    try {
                        return ((string)(this[this.tableEmployee.GenderColumn]));
                    }
                    catch (global::System.InvalidCastException e) {
                        throw new global::System.Data.StrongTypingException("表“Employee”中列“Gender”的值为 DBNull。", e);
                    }
                }
                set {
                    this[this.tableEmployee.GenderColumn] = value;
                }
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public string Title {
                get {
                    try {
                        return ((string)(this[this.tableEmployee.TitleColumn]));
                    }
                    catch (global::System.InvalidCastException e) {
                        throw new global::System.Data.StrongTypingException("表“Employee”中列“Title”的值为 DBNull。", e);
                    }
                }
                set {
                    this[this.tableEmployee.TitleColumn] = value;
                }
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public string Department {
                get {
                    try {
                        return ((string)(this[this.tableEmployee.DepartmentColumn]));
                    }
                    catch (global::System.InvalidCastException e) {
                        throw new global::System.Data.StrongTypingException("表“Employee”中列“Department”的值为 DBNull。", e);
                    }
                }
                set {
                    this[this.tableEmployee.DepartmentColumn] = value;
                }
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public string Room_No {
                get {
                    try {
                        return ((string)(this[this.tableEmployee.Room_NoColumn]));
                    }
                    catch (global::System.InvalidCastException e) {
                        throw new global::System.Data.StrongTypingException("表“Employee”中列“Room_No”的值为 DBNull。", e);
                    }
                }
                set {
                    this[this.tableEmployee.Room_NoColumn] = value;
                }
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public RoomRow RoomRow {
                get {
                    return ((RoomRow)(this.GetParentRow(this.Table.ParentRelations["RoomEmployee"])));
                }
                set {
                    this.SetParentRow(value, this.Table.ParentRelations["RoomEmployee"]);
                }
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public bool IsLast_NameNull() {
                return this.IsNull(this.tableEmployee.Last_NameColumn);
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public void SetLast_NameNull() {
                this[this.tableEmployee.Last_NameColumn] = global::System.Convert.DBNull;
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public bool IsFirst_NameNull() {
                return this.IsNull(this.tableEmployee.First_NameColumn);
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public void SetFirst_NameNull() {
                this[this.tableEmployee.First_NameColumn] = global::System.Convert.DBNull;
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public bool IsGenderNull() {
                return this.IsNull(this.tableEmployee.GenderColumn);
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public void SetGenderNull() {
                this[this.tableEmployee.GenderColumn] = global::System.Convert.DBNull;
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public bool IsTitleNull() {
                return this.IsNull(this.tableEmployee.TitleColumn);
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public void SetTitleNull() {
                this[this.tableEmployee.TitleColumn] = global::System.Convert.DBNull;
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public bool IsDepartmentNull() {
                return this.IsNull(this.tableEmployee.DepartmentColumn);
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public void SetDepartmentNull() {
                this[this.tableEmployee.DepartmentColumn] = global::System.Convert.DBNull;
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public bool IsRoom_NoNull() {
                return this.IsNull(this.tableEmployee.Room_NoColumn);
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public void SetRoom_NoNull() {
                this[this.tableEmployee.Room_NoColumn] = global::System.Convert.DBNull;
            }
        }
        
        /// <summary>
        ///Represents strongly named DataRow class.
        ///</summary>
        public partial class InventoryRow : global::System.Data.DataRow {
            
            private InventoryDataTable tableInventory;
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            internal InventoryRow(global::System.Data.DataRowBuilder rb) : 
                    base(rb) {
                this.tableInventory = ((InventoryDataTable)(this.Table));
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public double Inv_ID {
                get {
                    return ((double)(this[this.tableInventory.Inv_IDColumn]));
                }
                set {
                    this[this.tableInventory.Inv_IDColumn] = value;
                }
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public string Type {
                get {
                    try {
                        return ((string)(this[this.tableInventory.TypeColumn]));
                    }
                    catch (global::System.InvalidCastException e) {
                        throw new global::System.Data.StrongTypingException("表“Inventory”中列“Type”的值为 DBNull。", e);
                    }
                }
                set {
                    this[this.tableInventory.TypeColumn] = value;
                }
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public string Description {
                get {
                    try {
                        return ((string)(this[this.tableInventory.DescriptionColumn]));
                    }
                    catch (global::System.InvalidCastException e) {
                        throw new global::System.Data.StrongTypingException("表“Inventory”中列“Description”的值为 DBNull。", e);
                    }
                }
                set {
                    this[this.tableInventory.DescriptionColumn] = value;
                }
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public string Manufacturer {
                get {
                    try {
                        return ((string)(this[this.tableInventory.ManufacturerColumn]));
                    }
                    catch (global::System.InvalidCastException e) {
                        throw new global::System.Data.StrongTypingException("表“Inventory”中列“Manufacturer”的值为 DBNull。", e);
                    }
                }
                set {
                    this[this.tableInventory.ManufacturerColumn] = value;
                }
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public string Model {
                get {
                    try {
                        return ((string)(this[this.tableInventory.ModelColumn]));
                    }
                    catch (global::System.InvalidCastException e) {
                        throw new global::System.Data.StrongTypingException("表“Inventory”中列“Model”的值为 DBNull。", e);
                    }
                }
                set {
                    this[this.tableInventory.ModelColumn] = value;
                }
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public decimal Price {
                get {
                    try {
                        return ((decimal)(this[this.tableInventory.PriceColumn]));
                    }
                    catch (global::System.InvalidCastException e) {
                        throw new global::System.Data.StrongTypingException("表“Inventory”中列“Price”的值为 DBNull。", e);
                    }
                }
                set {
                    this[this.tableInventory.PriceColumn] = value;
                }
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public string Room_No {
                get {
                    try {
                        return ((string)(this[this.tableInventory.Room_NoColumn]));
                    }
                    catch (global::System.InvalidCastException e) {
                        throw new global::System.Data.StrongTypingException("表“Inventory”中列“Room_No”的值为 DBNull。", e);
                    }
                }
                set {
                    this[this.tableInventory.Room_NoColumn] = value;
                }
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public RoomRow RoomRow {
                get {
                    return ((RoomRow)(this.GetParentRow(this.Table.ParentRelations["RoomInventory"])));
                }
                set {
                    this.SetParentRow(value, this.Table.ParentRelations["RoomInventory"]);
                }
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public bool IsTypeNull() {
                return this.IsNull(this.tableInventory.TypeColumn);
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public void SetTypeNull() {
                this[this.tableInventory.TypeColumn] = global::System.Convert.DBNull;
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public bool IsDescriptionNull() {
                return this.IsNull(this.tableInventory.DescriptionColumn);
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public void SetDescriptionNull() {
                this[this.tableInventory.DescriptionColumn] = global::System.Convert.DBNull;
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public bool IsManufacturerNull() {
                return this.IsNull(this.tableInventory.ManufacturerColumn);
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public void SetManufacturerNull() {
                this[this.tableInventory.ManufacturerColumn] = global::System.Convert.DBNull;
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public bool IsModelNull() {
                return this.IsNull(this.tableInventory.ModelColumn);
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public void SetModelNull() {
                this[this.tableInventory.ModelColumn] = global::System.Convert.DBNull;
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public bool IsPriceNull() {
                return this.IsNull(this.tableInventory.PriceColumn);
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public void SetPriceNull() {
                this[this.tableInventory.PriceColumn] = global::System.Convert.DBNull;
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public bool IsRoom_NoNull() {
                return this.IsNull(this.tableInventory.Room_NoColumn);
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public void SetRoom_NoNull() {
                this[this.tableInventory.Room_NoColumn] = global::System.Convert.DBNull;
            }
        }
        
        /// <summary>
        ///Represents strongly named DataRow class.
        ///</summary>
        public partial class RoomRow : global::System.Data.DataRow {
            
            private RoomDataTable tableRoom;
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            internal RoomRow(global::System.Data.DataRowBuilder rb) : 
                    base(rb) {
                this.tableRoom = ((RoomDataTable)(this.Table));
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public string Room_No {
                get {
                    return ((string)(this[this.tableRoom.Room_NoColumn]));
                }
                set {
                    this[this.tableRoom.Room_NoColumn] = value;
                }
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public string Room_Type {
                get {
                    try {
                        return ((string)(this[this.tableRoom.Room_TypeColumn]));
                    }
                    catch (global::System.InvalidCastException e) {
                        throw new global::System.Data.StrongTypingException("表“Room”中列“Room_Type”的值为 DBNull。", e);
                    }
                }
                set {
                    this[this.tableRoom.Room_TypeColumn] = value;
                }
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public double Area {
                get {
                    try {
                        return ((double)(this[this.tableRoom.AreaColumn]));
                    }
                    catch (global::System.InvalidCastException e) {
                        throw new global::System.Data.StrongTypingException("表“Room”中列“Area”的值为 DBNull。", e);
                    }
                }
                set {
                    this[this.tableRoom.AreaColumn] = value;
                }
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public string Entity_Handle {
                get {
                    try {
                        return ((string)(this[this.tableRoom.Entity_HandleColumn]));
                    }
                    catch (global::System.InvalidCastException e) {
                        throw new global::System.Data.StrongTypingException("表“Room”中列“Entity_Handle”的值为 DBNull。", e);
                    }
                }
                set {
                    this[this.tableRoom.Entity_HandleColumn] = value;
                }
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public bool IsRoom_TypeNull() {
                return this.IsNull(this.tableRoom.Room_TypeColumn);
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public void SetRoom_TypeNull() {
                this[this.tableRoom.Room_TypeColumn] = global::System.Convert.DBNull;
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public bool IsAreaNull() {
                return this.IsNull(this.tableRoom.AreaColumn);
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public void SetAreaNull() {
                this[this.tableRoom.AreaColumn] = global::System.Convert.DBNull;
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public bool IsEntity_HandleNull() {
                return this.IsNull(this.tableRoom.Entity_HandleColumn);
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public void SetEntity_HandleNull() {
                this[this.tableRoom.Entity_HandleColumn] = global::System.Convert.DBNull;
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public ComputerRow[] GetComputerRows() {
                if ((this.Table.ChildRelations["RoomComputer"] == null)) {
                    return new ComputerRow[0];
                }
                else {
                    return ((ComputerRow[])(base.GetChildRows(this.Table.ChildRelations["RoomComputer"])));
                }
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public EmployeeRow[] GetEmployeeRows() {
                if ((this.Table.ChildRelations["RoomEmployee"] == null)) {
                    return new EmployeeRow[0];
                }
                else {
                    return ((EmployeeRow[])(base.GetChildRows(this.Table.ChildRelations["RoomEmployee"])));
                }
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public InventoryRow[] GetInventoryRows() {
                if ((this.Table.ChildRelations["RoomInventory"] == null)) {
                    return new InventoryRow[0];
                }
                else {
                    return ((InventoryRow[])(base.GetChildRows(this.Table.ChildRelations["RoomInventory"])));
                }
            }
        }
        
        /// <summary>
        ///Row event argument class
        ///</summary>
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        public class ComputerRowChangeEvent : global::System.EventArgs {
            
            private ComputerRow eventRow;
            
            private global::System.Data.DataRowAction eventAction;
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public ComputerRowChangeEvent(ComputerRow row, global::System.Data.DataRowAction action) {
                this.eventRow = row;
                this.eventAction = action;
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public ComputerRow Row {
                get {
                    return this.eventRow;
                }
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public global::System.Data.DataRowAction Action {
                get {
                    return this.eventAction;
                }
            }
        }
        
        /// <summary>
        ///Row event argument class
        ///</summary>
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        public class EmployeeRowChangeEvent : global::System.EventArgs {
            
            private EmployeeRow eventRow;
            
            private global::System.Data.DataRowAction eventAction;
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public EmployeeRowChangeEvent(EmployeeRow row, global::System.Data.DataRowAction action) {
                this.eventRow = row;
                this.eventAction = action;
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public EmployeeRow Row {
                get {
                    return this.eventRow;
                }
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public global::System.Data.DataRowAction Action {
                get {
                    return this.eventAction;
                }
            }
        }
        
        /// <summary>
        ///Row event argument class
        ///</summary>
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        public class InventoryRowChangeEvent : global::System.EventArgs {
            
            private InventoryRow eventRow;
            
            private global::System.Data.DataRowAction eventAction;
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public InventoryRowChangeEvent(InventoryRow row, global::System.Data.DataRowAction action) {
                this.eventRow = row;
                this.eventAction = action;
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public InventoryRow Row {
                get {
                    return this.eventRow;
                }
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public global::System.Data.DataRowAction Action {
                get {
                    return this.eventAction;
                }
            }
        }
        
        /// <summary>
        ///Row event argument class
        ///</summary>
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        public class RoomRowChangeEvent : global::System.EventArgs {
            
            private RoomRow eventRow;
            
            private global::System.Data.DataRowAction eventAction;
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public RoomRowChangeEvent(RoomRow row, global::System.Data.DataRowAction action) {
                this.eventRow = row;
                this.eventAction = action;
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public RoomRow Row {
                get {
                    return this.eventRow;
                }
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public global::System.Data.DataRowAction Action {
                get {
                    return this.eventAction;
                }
            }
        }
    }
}
namespace AccessCAD.db_samplesDataSetTableAdapters {
    
    
    /// <summary>
    ///Represents the connection and commands used to retrieve and save data.
    ///</summary>
    [global::System.ComponentModel.DesignerCategoryAttribute("code")]
    [global::System.ComponentModel.ToolboxItem(true)]
    [global::System.ComponentModel.DataObjectAttribute(true)]
    [global::System.ComponentModel.DesignerAttribute("Microsoft.VSDesigner.DataSource.Design.TableAdapterDesigner, Microsoft.VSDesigner" +
        ", Version=10.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a")]
    [global::System.ComponentModel.Design.HelpKeywordAttribute("vs.data.TableAdapter")]
    public partial class ComputerTableAdapter : global::System.ComponentModel.Component {
        
        private global::System.Data.OleDb.OleDbDataAdapter _adapter;
        
        private global::System.Data.OleDb.OleDbConnection _connection;
        
        private global::System.Data.OleDb.OleDbTransaction _transaction;
        
        private global::System.Data.OleDb.OleDbCommand[] _commandCollection;
        
        private bool _clearBeforeFill;
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        public ComputerTableAdapter() {
            this.ClearBeforeFill = true;
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        protected internal global::System.Data.OleDb.OleDbDataAdapter Adapter {
            get {
                if ((this._adapter == null)) {
                    this.InitAdapter();
                }
                return this._adapter;
            }
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        internal global::System.Data.OleDb.OleDbConnection Connection {
            get {
                if ((this._connection == null)) {
                    this.InitConnection();
                }
                return this._connection;
            }
            set {
                this._connection = value;
                if ((this.Adapter.InsertCommand != null)) {
                    this.Adapter.InsertCommand.Connection = value;
                }
                if ((this.Adapter.DeleteCommand != null)) {
                    this.Adapter.DeleteCommand.Connection = value;
                }
                if ((this.Adapter.UpdateCommand != null)) {
                    this.Adapter.UpdateCommand.Connection = value;
                }
                for (int i = 0; (i < this.CommandCollection.Length); i = (i + 1)) {
                    if ((this.CommandCollection[i] != null)) {
                        ((global::System.Data.OleDb.OleDbCommand)(this.CommandCollection[i])).Connection = value;
                    }
                }
            }
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        internal global::System.Data.OleDb.OleDbTransaction Transaction {
            get {
                return this._transaction;
            }
            set {
                this._transaction = value;
                for (int i = 0; (i < this.CommandCollection.Length); i = (i + 1)) {
                    this.CommandCollection[i].Transaction = this._transaction;
                }
                if (((this.Adapter != null) 
                            && (this.Adapter.DeleteCommand != null))) {
                    this.Adapter.DeleteCommand.Transaction = this._transaction;
                }
                if (((this.Adapter != null) 
                            && (this.Adapter.InsertCommand != null))) {
                    this.Adapter.InsertCommand.Transaction = this._transaction;
                }
                if (((this.Adapter != null) 
                            && (this.Adapter.UpdateCommand != null))) {
                    this.Adapter.UpdateCommand.Transaction = this._transaction;
                }
            }
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        protected global::System.Data.OleDb.OleDbCommand[] CommandCollection {
            get {
                if ((this._commandCollection == null)) {
                    this.InitCommandCollection();
                }
                return this._commandCollection;
            }
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        public bool ClearBeforeFill {
            get {
                return this._clearBeforeFill;
            }
            set {
                this._clearBeforeFill = value;
            }
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        private void InitAdapter() {
            this._adapter = new global::System.Data.OleDb.OleDbDataAdapter();
            global::System.Data.Common.DataTableMapping tableMapping = new global::System.Data.Common.DataTableMapping();
            tableMapping.SourceTable = "Table";
            tableMapping.DataSetTable = "Computer";
            tableMapping.ColumnMappings.Add("Tag_Number", "Tag_Number");
            tableMapping.ColumnMappings.Add("Manufacturer", "Manufacturer");
            tableMapping.ColumnMappings.Add("Equipment_Description", "Equipment_Description");
            tableMapping.ColumnMappings.Add("Item_Type", "Item_Type");
            tableMapping.ColumnMappings.Add("Room_No", "Room_No");
            this._adapter.TableMappings.Add(tableMapping);
            this._adapter.DeleteCommand = new global::System.Data.OleDb.OleDbCommand();
            this._adapter.DeleteCommand.Connection = this.Connection;
            this._adapter.DeleteCommand.CommandText = @"DELETE FROM `Computer` WHERE ((`Tag_Number` = ?) AND ((? = 1 AND `Manufacturer` IS NULL) OR (`Manufacturer` = ?)) AND ((? = 1 AND `Equipment_Description` IS NULL) OR (`Equipment_Description` = ?)) AND ((? = 1 AND `Item_Type` IS NULL) OR (`Item_Type` = ?)) AND ((? = 1 AND `Room_No` IS NULL) OR (`Room_No` = ?)))";
            this._adapter.DeleteCommand.CommandType = global::System.Data.CommandType.Text;
            this._adapter.DeleteCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Original_Tag_Number", global::System.Data.OleDb.OleDbType.Integer, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Tag_Number", global::System.Data.DataRowVersion.Original, false, null));
            this._adapter.DeleteCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("IsNull_Manufacturer", global::System.Data.OleDb.OleDbType.Integer, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Manufacturer", global::System.Data.DataRowVersion.Original, true, null));
            this._adapter.DeleteCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Original_Manufacturer", global::System.Data.OleDb.OleDbType.VarWChar, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Manufacturer", global::System.Data.DataRowVersion.Original, false, null));
            this._adapter.DeleteCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("IsNull_Equipment_Description", global::System.Data.OleDb.OleDbType.Integer, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Equipment_Description", global::System.Data.DataRowVersion.Original, true, null));
            this._adapter.DeleteCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Original_Equipment_Description", global::System.Data.OleDb.OleDbType.VarWChar, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Equipment_Description", global::System.Data.DataRowVersion.Original, false, null));
            this._adapter.DeleteCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("IsNull_Item_Type", global::System.Data.OleDb.OleDbType.Integer, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Item_Type", global::System.Data.DataRowVersion.Original, true, null));
            this._adapter.DeleteCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Original_Item_Type", global::System.Data.OleDb.OleDbType.VarWChar, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Item_Type", global::System.Data.DataRowVersion.Original, false, null));
            this._adapter.DeleteCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("IsNull_Room_No", global::System.Data.OleDb.OleDbType.Integer, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Room_No", global::System.Data.DataRowVersion.Original, true, null));
            this._adapter.DeleteCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Original_Room_No", global::System.Data.OleDb.OleDbType.VarWChar, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Room_No", global::System.Data.DataRowVersion.Original, false, null));
            this._adapter.InsertCommand = new global::System.Data.OleDb.OleDbCommand();
            this._adapter.InsertCommand.Connection = this.Connection;
            this._adapter.InsertCommand.CommandText = "INSERT INTO `Computer` (`Tag_Number`, `Manufacturer`, `Equipment_Description`, `I" +
                "tem_Type`, `Room_No`) VALUES (?, ?, ?, ?, ?)";
            this._adapter.InsertCommand.CommandType = global::System.Data.CommandType.Text;
            this._adapter.InsertCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Tag_Number", global::System.Data.OleDb.OleDbType.Integer, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Tag_Number", global::System.Data.DataRowVersion.Current, false, null));
            this._adapter.InsertCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Manufacturer", global::System.Data.OleDb.OleDbType.VarWChar, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Manufacturer", global::System.Data.DataRowVersion.Current, false, null));
            this._adapter.InsertCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Equipment_Description", global::System.Data.OleDb.OleDbType.VarWChar, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Equipment_Description", global::System.Data.DataRowVersion.Current, false, null));
            this._adapter.InsertCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Item_Type", global::System.Data.OleDb.OleDbType.VarWChar, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Item_Type", global::System.Data.DataRowVersion.Current, false, null));
            this._adapter.InsertCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Room_No", global::System.Data.OleDb.OleDbType.VarWChar, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Room_No", global::System.Data.DataRowVersion.Current, false, null));
            this._adapter.UpdateCommand = new global::System.Data.OleDb.OleDbCommand();
            this._adapter.UpdateCommand.Connection = this.Connection;
            this._adapter.UpdateCommand.CommandText = @"UPDATE `Computer` SET `Tag_Number` = ?, `Manufacturer` = ?, `Equipment_Description` = ?, `Item_Type` = ?, `Room_No` = ? WHERE ((`Tag_Number` = ?) AND ((? = 1 AND `Manufacturer` IS NULL) OR (`Manufacturer` = ?)) AND ((? = 1 AND `Equipment_Description` IS NULL) OR (`Equipment_Description` = ?)) AND ((? = 1 AND `Item_Type` IS NULL) OR (`Item_Type` = ?)) AND ((? = 1 AND `Room_No` IS NULL) OR (`Room_No` = ?)))";
            this._adapter.UpdateCommand.CommandType = global::System.Data.CommandType.Text;
            this._adapter.UpdateCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Tag_Number", global::System.Data.OleDb.OleDbType.Integer, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Tag_Number", global::System.Data.DataRowVersion.Current, false, null));
            this._adapter.UpdateCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Manufacturer", global::System.Data.OleDb.OleDbType.VarWChar, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Manufacturer", global::System.Data.DataRowVersion.Current, false, null));
            this._adapter.UpdateCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Equipment_Description", global::System.Data.OleDb.OleDbType.VarWChar, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Equipment_Description", global::System.Data.DataRowVersion.Current, false, null));
            this._adapter.UpdateCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Item_Type", global::System.Data.OleDb.OleDbType.VarWChar, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Item_Type", global::System.Data.DataRowVersion.Current, false, null));
            this._adapter.UpdateCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Room_No", global::System.Data.OleDb.OleDbType.VarWChar, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Room_No", global::System.Data.DataRowVersion.Current, false, null));
            this._adapter.UpdateCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Original_Tag_Number", global::System.Data.OleDb.OleDbType.Integer, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Tag_Number", global::System.Data.DataRowVersion.Original, false, null));
            this._adapter.UpdateCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("IsNull_Manufacturer", global::System.Data.OleDb.OleDbType.Integer, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Manufacturer", global::System.Data.DataRowVersion.Original, true, null));
            this._adapter.UpdateCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Original_Manufacturer", global::System.Data.OleDb.OleDbType.VarWChar, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Manufacturer", global::System.Data.DataRowVersion.Original, false, null));
            this._adapter.UpdateCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("IsNull_Equipment_Description", global::System.Data.OleDb.OleDbType.Integer, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Equipment_Description", global::System.Data.DataRowVersion.Original, true, null));
            this._adapter.UpdateCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Original_Equipment_Description", global::System.Data.OleDb.OleDbType.VarWChar, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Equipment_Description", global::System.Data.DataRowVersion.Original, false, null));
            this._adapter.UpdateCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("IsNull_Item_Type", global::System.Data.OleDb.OleDbType.Integer, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Item_Type", global::System.Data.DataRowVersion.Original, true, null));
            this._adapter.UpdateCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Original_Item_Type", global::System.Data.OleDb.OleDbType.VarWChar, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Item_Type", global::System.Data.DataRowVersion.Original, false, null));
            this._adapter.UpdateCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("IsNull_Room_No", global::System.Data.OleDb.OleDbType.Integer, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Room_No", global::System.Data.DataRowVersion.Original, true, null));
            this._adapter.UpdateCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Original_Room_No", global::System.Data.OleDb.OleDbType.VarWChar, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Room_No", global::System.Data.DataRowVersion.Original, false, null));
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        private void InitConnection() {
            this._connection = new global::System.Data.OleDb.OleDbConnection();
            this._connection.ConnectionString = global::AccessCAD.Properties.Settings.Default.db_samplesConnectionString.Replace("|DataDirectory|", DotNetARX.Tools.GetCurrentPath());
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        private void InitCommandCollection() {
            this._commandCollection = new global::System.Data.OleDb.OleDbCommand[1];
            this._commandCollection[0] = new global::System.Data.OleDb.OleDbCommand();
            this._commandCollection[0].Connection = this.Connection;
            this._commandCollection[0].CommandText = "SELECT Tag_Number, Manufacturer, Equipment_Description, Item_Type, Room_No FROM C" +
                "omputer";
            this._commandCollection[0].CommandType = global::System.Data.CommandType.Text;
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        [global::System.ComponentModel.Design.HelpKeywordAttribute("vs.data.TableAdapter")]
        [global::System.ComponentModel.DataObjectMethodAttribute(global::System.ComponentModel.DataObjectMethodType.Fill, true)]
        public virtual int Fill(db_samplesDataSet.ComputerDataTable dataTable) {
            this.Adapter.SelectCommand = this.CommandCollection[0];
            if ((this.ClearBeforeFill == true)) {
                dataTable.Clear();
            }
            int returnValue = this.Adapter.Fill(dataTable);
            return returnValue;
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        [global::System.ComponentModel.Design.HelpKeywordAttribute("vs.data.TableAdapter")]
        [global::System.ComponentModel.DataObjectMethodAttribute(global::System.ComponentModel.DataObjectMethodType.Select, true)]
        public virtual db_samplesDataSet.ComputerDataTable GetData() {
            this.Adapter.SelectCommand = this.CommandCollection[0];
            db_samplesDataSet.ComputerDataTable dataTable = new db_samplesDataSet.ComputerDataTable();
            this.Adapter.Fill(dataTable);
            return dataTable;
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        [global::System.ComponentModel.Design.HelpKeywordAttribute("vs.data.TableAdapter")]
        public virtual int Update(db_samplesDataSet.ComputerDataTable dataTable) {
            return this.Adapter.Update(dataTable);
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        [global::System.ComponentModel.Design.HelpKeywordAttribute("vs.data.TableAdapter")]
        public virtual int Update(db_samplesDataSet dataSet) {
            return this.Adapter.Update(dataSet, "Computer");
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        [global::System.ComponentModel.Design.HelpKeywordAttribute("vs.data.TableAdapter")]
        public virtual int Update(global::System.Data.DataRow dataRow) {
            return this.Adapter.Update(new global::System.Data.DataRow[] {
                        dataRow});
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        [global::System.ComponentModel.Design.HelpKeywordAttribute("vs.data.TableAdapter")]
        public virtual int Update(global::System.Data.DataRow[] dataRows) {
            return this.Adapter.Update(dataRows);
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        [global::System.ComponentModel.Design.HelpKeywordAttribute("vs.data.TableAdapter")]
        [global::System.ComponentModel.DataObjectMethodAttribute(global::System.ComponentModel.DataObjectMethodType.Delete, true)]
        public virtual int Delete(global::System.Nullable<int> Original_Tag_Number, string Original_Manufacturer, string Original_Equipment_Description, string Original_Item_Type, string Original_Room_No) {
            if ((Original_Tag_Number.HasValue == true)) {
                this.Adapter.DeleteCommand.Parameters[0].Value = ((int)(Original_Tag_Number.Value));
            }
            else {
                this.Adapter.DeleteCommand.Parameters[0].Value = global::System.DBNull.Value;
            }
            if ((Original_Manufacturer == null)) {
                this.Adapter.DeleteCommand.Parameters[1].Value = ((object)(1));
                this.Adapter.DeleteCommand.Parameters[2].Value = global::System.DBNull.Value;
            }
            else {
                this.Adapter.DeleteCommand.Parameters[1].Value = ((object)(0));
                this.Adapter.DeleteCommand.Parameters[2].Value = ((string)(Original_Manufacturer));
            }
            if ((Original_Equipment_Description == null)) {
                this.Adapter.DeleteCommand.Parameters[3].Value = ((object)(1));
                this.Adapter.DeleteCommand.Parameters[4].Value = global::System.DBNull.Value;
            }
            else {
                this.Adapter.DeleteCommand.Parameters[3].Value = ((object)(0));
                this.Adapter.DeleteCommand.Parameters[4].Value = ((string)(Original_Equipment_Description));
            }
            if ((Original_Item_Type == null)) {
                this.Adapter.DeleteCommand.Parameters[5].Value = ((object)(1));
                this.Adapter.DeleteCommand.Parameters[6].Value = global::System.DBNull.Value;
            }
            else {
                this.Adapter.DeleteCommand.Parameters[5].Value = ((object)(0));
                this.Adapter.DeleteCommand.Parameters[6].Value = ((string)(Original_Item_Type));
            }
            if ((Original_Room_No == null)) {
                this.Adapter.DeleteCommand.Parameters[7].Value = ((object)(1));
                this.Adapter.DeleteCommand.Parameters[8].Value = global::System.DBNull.Value;
            }
            else {
                this.Adapter.DeleteCommand.Parameters[7].Value = ((object)(0));
                this.Adapter.DeleteCommand.Parameters[8].Value = ((string)(Original_Room_No));
            }
            global::System.Data.ConnectionState previousConnectionState = this.Adapter.DeleteCommand.Connection.State;
            if (((this.Adapter.DeleteCommand.Connection.State & global::System.Data.ConnectionState.Open) 
                        != global::System.Data.ConnectionState.Open)) {
                this.Adapter.DeleteCommand.Connection.Open();
            }
            try {
                int returnValue = this.Adapter.DeleteCommand.ExecuteNonQuery();
                return returnValue;
            }
            finally {
                if ((previousConnectionState == global::System.Data.ConnectionState.Closed)) {
                    this.Adapter.DeleteCommand.Connection.Close();
                }
            }
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        [global::System.ComponentModel.Design.HelpKeywordAttribute("vs.data.TableAdapter")]
        [global::System.ComponentModel.DataObjectMethodAttribute(global::System.ComponentModel.DataObjectMethodType.Insert, true)]
        public virtual int Insert(global::System.Nullable<int> Tag_Number, string Manufacturer, string Equipment_Description, string Item_Type, string Room_No) {
            if ((Tag_Number.HasValue == true)) {
                this.Adapter.InsertCommand.Parameters[0].Value = ((int)(Tag_Number.Value));
            }
            else {
                this.Adapter.InsertCommand.Parameters[0].Value = global::System.DBNull.Value;
            }
            if ((Manufacturer == null)) {
                this.Adapter.InsertCommand.Parameters[1].Value = global::System.DBNull.Value;
            }
            else {
                this.Adapter.InsertCommand.Parameters[1].Value = ((string)(Manufacturer));
            }
            if ((Equipment_Description == null)) {
                this.Adapter.InsertCommand.Parameters[2].Value = global::System.DBNull.Value;
            }
            else {
                this.Adapter.InsertCommand.Parameters[2].Value = ((string)(Equipment_Description));
            }
            if ((Item_Type == null)) {
                this.Adapter.InsertCommand.Parameters[3].Value = global::System.DBNull.Value;
            }
            else {
                this.Adapter.InsertCommand.Parameters[3].Value = ((string)(Item_Type));
            }
            if ((Room_No == null)) {
                this.Adapter.InsertCommand.Parameters[4].Value = global::System.DBNull.Value;
            }
            else {
                this.Adapter.InsertCommand.Parameters[4].Value = ((string)(Room_No));
            }
            global::System.Data.ConnectionState previousConnectionState = this.Adapter.InsertCommand.Connection.State;
            if (((this.Adapter.InsertCommand.Connection.State & global::System.Data.ConnectionState.Open) 
                        != global::System.Data.ConnectionState.Open)) {
                this.Adapter.InsertCommand.Connection.Open();
            }
            try {
                int returnValue = this.Adapter.InsertCommand.ExecuteNonQuery();
                return returnValue;
            }
            finally {
                if ((previousConnectionState == global::System.Data.ConnectionState.Closed)) {
                    this.Adapter.InsertCommand.Connection.Close();
                }
            }
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        [global::System.ComponentModel.Design.HelpKeywordAttribute("vs.data.TableAdapter")]
        [global::System.ComponentModel.DataObjectMethodAttribute(global::System.ComponentModel.DataObjectMethodType.Update, true)]
        public virtual int Update(global::System.Nullable<int> Tag_Number, string Manufacturer, string Equipment_Description, string Item_Type, string Room_No, global::System.Nullable<int> Original_Tag_Number, string Original_Manufacturer, string Original_Equipment_Description, string Original_Item_Type, string Original_Room_No) {
            if ((Tag_Number.HasValue == true)) {
                this.Adapter.UpdateCommand.Parameters[0].Value = ((int)(Tag_Number.Value));
            }
            else {
                this.Adapter.UpdateCommand.Parameters[0].Value = global::System.DBNull.Value;
            }
            if ((Manufacturer == null)) {
                this.Adapter.UpdateCommand.Parameters[1].Value = global::System.DBNull.Value;
            }
            else {
                this.Adapter.UpdateCommand.Parameters[1].Value = ((string)(Manufacturer));
            }
            if ((Equipment_Description == null)) {
                this.Adapter.UpdateCommand.Parameters[2].Value = global::System.DBNull.Value;
            }
            else {
                this.Adapter.UpdateCommand.Parameters[2].Value = ((string)(Equipment_Description));
            }
            if ((Item_Type == null)) {
                this.Adapter.UpdateCommand.Parameters[3].Value = global::System.DBNull.Value;
            }
            else {
                this.Adapter.UpdateCommand.Parameters[3].Value = ((string)(Item_Type));
            }
            if ((Room_No == null)) {
                this.Adapter.UpdateCommand.Parameters[4].Value = global::System.DBNull.Value;
            }
            else {
                this.Adapter.UpdateCommand.Parameters[4].Value = ((string)(Room_No));
            }
            if ((Original_Tag_Number.HasValue == true)) {
                this.Adapter.UpdateCommand.Parameters[5].Value = ((int)(Original_Tag_Number.Value));
            }
            else {
                this.Adapter.UpdateCommand.Parameters[5].Value = global::System.DBNull.Value;
            }
            if ((Original_Manufacturer == null)) {
                this.Adapter.UpdateCommand.Parameters[6].Value = ((object)(1));
                this.Adapter.UpdateCommand.Parameters[7].Value = global::System.DBNull.Value;
            }
            else {
                this.Adapter.UpdateCommand.Parameters[6].Value = ((object)(0));
                this.Adapter.UpdateCommand.Parameters[7].Value = ((string)(Original_Manufacturer));
            }
            if ((Original_Equipment_Description == null)) {
                this.Adapter.UpdateCommand.Parameters[8].Value = ((object)(1));
                this.Adapter.UpdateCommand.Parameters[9].Value = global::System.DBNull.Value;
            }
            else {
                this.Adapter.UpdateCommand.Parameters[8].Value = ((object)(0));
                this.Adapter.UpdateCommand.Parameters[9].Value = ((string)(Original_Equipment_Description));
            }
            if ((Original_Item_Type == null)) {
                this.Adapter.UpdateCommand.Parameters[10].Value = ((object)(1));
                this.Adapter.UpdateCommand.Parameters[11].Value = global::System.DBNull.Value;
            }
            else {
                this.Adapter.UpdateCommand.Parameters[10].Value = ((object)(0));
                this.Adapter.UpdateCommand.Parameters[11].Value = ((string)(Original_Item_Type));
            }
            if ((Original_Room_No == null)) {
                this.Adapter.UpdateCommand.Parameters[12].Value = ((object)(1));
                this.Adapter.UpdateCommand.Parameters[13].Value = global::System.DBNull.Value;
            }
            else {
                this.Adapter.UpdateCommand.Parameters[12].Value = ((object)(0));
                this.Adapter.UpdateCommand.Parameters[13].Value = ((string)(Original_Room_No));
            }
            global::System.Data.ConnectionState previousConnectionState = this.Adapter.UpdateCommand.Connection.State;
            if (((this.Adapter.UpdateCommand.Connection.State & global::System.Data.ConnectionState.Open) 
                        != global::System.Data.ConnectionState.Open)) {
                this.Adapter.UpdateCommand.Connection.Open();
            }
            try {
                int returnValue = this.Adapter.UpdateCommand.ExecuteNonQuery();
                return returnValue;
            }
            finally {
                if ((previousConnectionState == global::System.Data.ConnectionState.Closed)) {
                    this.Adapter.UpdateCommand.Connection.Close();
                }
            }
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        [global::System.ComponentModel.Design.HelpKeywordAttribute("vs.data.TableAdapter")]
        [global::System.ComponentModel.DataObjectMethodAttribute(global::System.ComponentModel.DataObjectMethodType.Update, true)]
        public virtual int Update(string Manufacturer, string Equipment_Description, string Item_Type, string Room_No, global::System.Nullable<int> Original_Tag_Number, string Original_Manufacturer, string Original_Equipment_Description, string Original_Item_Type, string Original_Room_No) {
            return this.Update(Original_Tag_Number, Manufacturer, Equipment_Description, Item_Type, Room_No, Original_Tag_Number, Original_Manufacturer, Original_Equipment_Description, Original_Item_Type, Original_Room_No);
        }
    }
    
    /// <summary>
    ///Represents the connection and commands used to retrieve and save data.
    ///</summary>
    [global::System.ComponentModel.DesignerCategoryAttribute("code")]
    [global::System.ComponentModel.ToolboxItem(true)]
    [global::System.ComponentModel.DataObjectAttribute(true)]
    [global::System.ComponentModel.DesignerAttribute("Microsoft.VSDesigner.DataSource.Design.TableAdapterDesigner, Microsoft.VSDesigner" +
        ", Version=10.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a")]
    [global::System.ComponentModel.Design.HelpKeywordAttribute("vs.data.TableAdapter")]
    public partial class EmployeeTableAdapter : global::System.ComponentModel.Component {
        
        private global::System.Data.OleDb.OleDbDataAdapter _adapter;
        
        private global::System.Data.OleDb.OleDbConnection _connection;
        
        private global::System.Data.OleDb.OleDbTransaction _transaction;
        
        private global::System.Data.OleDb.OleDbCommand[] _commandCollection;
        
        private bool _clearBeforeFill;
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        public EmployeeTableAdapter() {
            this.ClearBeforeFill = true;
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        protected internal global::System.Data.OleDb.OleDbDataAdapter Adapter {
            get {
                if ((this._adapter == null)) {
                    this.InitAdapter();
                }
                return this._adapter;
            }
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        internal global::System.Data.OleDb.OleDbConnection Connection {
            get {
                if ((this._connection == null)) {
                    this.InitConnection();
                }
                return this._connection;
            }
            set {
                this._connection = value;
                if ((this.Adapter.InsertCommand != null)) {
                    this.Adapter.InsertCommand.Connection = value;
                }
                if ((this.Adapter.DeleteCommand != null)) {
                    this.Adapter.DeleteCommand.Connection = value;
                }
                if ((this.Adapter.UpdateCommand != null)) {
                    this.Adapter.UpdateCommand.Connection = value;
                }
                for (int i = 0; (i < this.CommandCollection.Length); i = (i + 1)) {
                    if ((this.CommandCollection[i] != null)) {
                        ((global::System.Data.OleDb.OleDbCommand)(this.CommandCollection[i])).Connection = value;
                    }
                }
            }
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        internal global::System.Data.OleDb.OleDbTransaction Transaction {
            get {
                return this._transaction;
            }
            set {
                this._transaction = value;
                for (int i = 0; (i < this.CommandCollection.Length); i = (i + 1)) {
                    this.CommandCollection[i].Transaction = this._transaction;
                }
                if (((this.Adapter != null) 
                            && (this.Adapter.DeleteCommand != null))) {
                    this.Adapter.DeleteCommand.Transaction = this._transaction;
                }
                if (((this.Adapter != null) 
                            && (this.Adapter.InsertCommand != null))) {
                    this.Adapter.InsertCommand.Transaction = this._transaction;
                }
                if (((this.Adapter != null) 
                            && (this.Adapter.UpdateCommand != null))) {
                    this.Adapter.UpdateCommand.Transaction = this._transaction;
                }
            }
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        protected global::System.Data.OleDb.OleDbCommand[] CommandCollection {
            get {
                if ((this._commandCollection == null)) {
                    this.InitCommandCollection();
                }
                return this._commandCollection;
            }
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        public bool ClearBeforeFill {
            get {
                return this._clearBeforeFill;
            }
            set {
                this._clearBeforeFill = value;
            }
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        private void InitAdapter() {
            this._adapter = new global::System.Data.OleDb.OleDbDataAdapter();
            global::System.Data.Common.DataTableMapping tableMapping = new global::System.Data.Common.DataTableMapping();
            tableMapping.SourceTable = "Table";
            tableMapping.DataSetTable = "Employee";
            tableMapping.ColumnMappings.Add("Emp_Id", "Emp_Id");
            tableMapping.ColumnMappings.Add("Last_Name", "Last_Name");
            tableMapping.ColumnMappings.Add("First_Name", "First_Name");
            tableMapping.ColumnMappings.Add("Gender", "Gender");
            tableMapping.ColumnMappings.Add("Title", "Title");
            tableMapping.ColumnMappings.Add("Department", "Department");
            tableMapping.ColumnMappings.Add("Room_No", "Room_No");
            this._adapter.TableMappings.Add(tableMapping);
            this._adapter.DeleteCommand = new global::System.Data.OleDb.OleDbCommand();
            this._adapter.DeleteCommand.Connection = this.Connection;
            this._adapter.DeleteCommand.CommandText = @"DELETE FROM `Employee` WHERE ((`Emp_Id` = ?) AND ((? = 1 AND `Last_Name` IS NULL) OR (`Last_Name` = ?)) AND ((? = 1 AND `First_Name` IS NULL) OR (`First_Name` = ?)) AND ((? = 1 AND `Gender` IS NULL) OR (`Gender` = ?)) AND ((? = 1 AND `Title` IS NULL) OR (`Title` = ?)) AND ((? = 1 AND `Department` IS NULL) OR (`Department` = ?)) AND ((? = 1 AND `Room_No` IS NULL) OR (`Room_No` = ?)))";
            this._adapter.DeleteCommand.CommandType = global::System.Data.CommandType.Text;
            this._adapter.DeleteCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Original_Emp_Id", global::System.Data.OleDb.OleDbType.VarWChar, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Emp_Id", global::System.Data.DataRowVersion.Original, false, null));
            this._adapter.DeleteCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("IsNull_Last_Name", global::System.Data.OleDb.OleDbType.Integer, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Last_Name", global::System.Data.DataRowVersion.Original, true, null));
            this._adapter.DeleteCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Original_Last_Name", global::System.Data.OleDb.OleDbType.VarWChar, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Last_Name", global::System.Data.DataRowVersion.Original, false, null));
            this._adapter.DeleteCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("IsNull_First_Name", global::System.Data.OleDb.OleDbType.Integer, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "First_Name", global::System.Data.DataRowVersion.Original, true, null));
            this._adapter.DeleteCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Original_First_Name", global::System.Data.OleDb.OleDbType.VarWChar, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "First_Name", global::System.Data.DataRowVersion.Original, false, null));
            this._adapter.DeleteCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("IsNull_Gender", global::System.Data.OleDb.OleDbType.Integer, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Gender", global::System.Data.DataRowVersion.Original, true, null));
            this._adapter.DeleteCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Original_Gender", global::System.Data.OleDb.OleDbType.VarWChar, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Gender", global::System.Data.DataRowVersion.Original, false, null));
            this._adapter.DeleteCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("IsNull_Title", global::System.Data.OleDb.OleDbType.Integer, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Title", global::System.Data.DataRowVersion.Original, true, null));
            this._adapter.DeleteCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Original_Title", global::System.Data.OleDb.OleDbType.VarWChar, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Title", global::System.Data.DataRowVersion.Original, false, null));
            this._adapter.DeleteCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("IsNull_Department", global::System.Data.OleDb.OleDbType.Integer, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Department", global::System.Data.DataRowVersion.Original, true, null));
            this._adapter.DeleteCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Original_Department", global::System.Data.OleDb.OleDbType.VarWChar, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Department", global::System.Data.DataRowVersion.Original, false, null));
            this._adapter.DeleteCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("IsNull_Room_No", global::System.Data.OleDb.OleDbType.Integer, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Room_No", global::System.Data.DataRowVersion.Original, true, null));
            this._adapter.DeleteCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Original_Room_No", global::System.Data.OleDb.OleDbType.VarWChar, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Room_No", global::System.Data.DataRowVersion.Original, false, null));
            this._adapter.InsertCommand = new global::System.Data.OleDb.OleDbCommand();
            this._adapter.InsertCommand.Connection = this.Connection;
            this._adapter.InsertCommand.CommandText = "INSERT INTO `Employee` (`Emp_Id`, `Last_Name`, `First_Name`, `Gender`, `Title`, `" +
                "Department`, `Room_No`) VALUES (?, ?, ?, ?, ?, ?, ?)";
            this._adapter.InsertCommand.CommandType = global::System.Data.CommandType.Text;
            this._adapter.InsertCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Emp_Id", global::System.Data.OleDb.OleDbType.VarWChar, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Emp_Id", global::System.Data.DataRowVersion.Current, false, null));
            this._adapter.InsertCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Last_Name", global::System.Data.OleDb.OleDbType.VarWChar, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Last_Name", global::System.Data.DataRowVersion.Current, false, null));
            this._adapter.InsertCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("First_Name", global::System.Data.OleDb.OleDbType.VarWChar, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "First_Name", global::System.Data.DataRowVersion.Current, false, null));
            this._adapter.InsertCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Gender", global::System.Data.OleDb.OleDbType.VarWChar, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Gender", global::System.Data.DataRowVersion.Current, false, null));
            this._adapter.InsertCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Title", global::System.Data.OleDb.OleDbType.VarWChar, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Title", global::System.Data.DataRowVersion.Current, false, null));
            this._adapter.InsertCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Department", global::System.Data.OleDb.OleDbType.VarWChar, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Department", global::System.Data.DataRowVersion.Current, false, null));
            this._adapter.InsertCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Room_No", global::System.Data.OleDb.OleDbType.VarWChar, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Room_No", global::System.Data.DataRowVersion.Current, false, null));
            this._adapter.UpdateCommand = new global::System.Data.OleDb.OleDbCommand();
            this._adapter.UpdateCommand.Connection = this.Connection;
            this._adapter.UpdateCommand.CommandText = @"UPDATE `Employee` SET `Emp_Id` = ?, `Last_Name` = ?, `First_Name` = ?, `Gender` = ?, `Title` = ?, `Department` = ?, `Room_No` = ? WHERE ((`Emp_Id` = ?) AND ((? = 1 AND `Last_Name` IS NULL) OR (`Last_Name` = ?)) AND ((? = 1 AND `First_Name` IS NULL) OR (`First_Name` = ?)) AND ((? = 1 AND `Gender` IS NULL) OR (`Gender` = ?)) AND ((? = 1 AND `Title` IS NULL) OR (`Title` = ?)) AND ((? = 1 AND `Department` IS NULL) OR (`Department` = ?)) AND ((? = 1 AND `Room_No` IS NULL) OR (`Room_No` = ?)))";
            this._adapter.UpdateCommand.CommandType = global::System.Data.CommandType.Text;
            this._adapter.UpdateCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Emp_Id", global::System.Data.OleDb.OleDbType.VarWChar, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Emp_Id", global::System.Data.DataRowVersion.Current, false, null));
            this._adapter.UpdateCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Last_Name", global::System.Data.OleDb.OleDbType.VarWChar, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Last_Name", global::System.Data.DataRowVersion.Current, false, null));
            this._adapter.UpdateCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("First_Name", global::System.Data.OleDb.OleDbType.VarWChar, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "First_Name", global::System.Data.DataRowVersion.Current, false, null));
            this._adapter.UpdateCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Gender", global::System.Data.OleDb.OleDbType.VarWChar, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Gender", global::System.Data.DataRowVersion.Current, false, null));
            this._adapter.UpdateCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Title", global::System.Data.OleDb.OleDbType.VarWChar, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Title", global::System.Data.DataRowVersion.Current, false, null));
            this._adapter.UpdateCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Department", global::System.Data.OleDb.OleDbType.VarWChar, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Department", global::System.Data.DataRowVersion.Current, false, null));
            this._adapter.UpdateCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Room_No", global::System.Data.OleDb.OleDbType.VarWChar, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Room_No", global::System.Data.DataRowVersion.Current, false, null));
            this._adapter.UpdateCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Original_Emp_Id", global::System.Data.OleDb.OleDbType.VarWChar, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Emp_Id", global::System.Data.DataRowVersion.Original, false, null));
            this._adapter.UpdateCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("IsNull_Last_Name", global::System.Data.OleDb.OleDbType.Integer, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Last_Name", global::System.Data.DataRowVersion.Original, true, null));
            this._adapter.UpdateCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Original_Last_Name", global::System.Data.OleDb.OleDbType.VarWChar, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Last_Name", global::System.Data.DataRowVersion.Original, false, null));
            this._adapter.UpdateCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("IsNull_First_Name", global::System.Data.OleDb.OleDbType.Integer, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "First_Name", global::System.Data.DataRowVersion.Original, true, null));
            this._adapter.UpdateCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Original_First_Name", global::System.Data.OleDb.OleDbType.VarWChar, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "First_Name", global::System.Data.DataRowVersion.Original, false, null));
            this._adapter.UpdateCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("IsNull_Gender", global::System.Data.OleDb.OleDbType.Integer, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Gender", global::System.Data.DataRowVersion.Original, true, null));
            this._adapter.UpdateCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Original_Gender", global::System.Data.OleDb.OleDbType.VarWChar, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Gender", global::System.Data.DataRowVersion.Original, false, null));
            this._adapter.UpdateCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("IsNull_Title", global::System.Data.OleDb.OleDbType.Integer, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Title", global::System.Data.DataRowVersion.Original, true, null));
            this._adapter.UpdateCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Original_Title", global::System.Data.OleDb.OleDbType.VarWChar, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Title", global::System.Data.DataRowVersion.Original, false, null));
            this._adapter.UpdateCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("IsNull_Department", global::System.Data.OleDb.OleDbType.Integer, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Department", global::System.Data.DataRowVersion.Original, true, null));
            this._adapter.UpdateCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Original_Department", global::System.Data.OleDb.OleDbType.VarWChar, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Department", global::System.Data.DataRowVersion.Original, false, null));
            this._adapter.UpdateCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("IsNull_Room_No", global::System.Data.OleDb.OleDbType.Integer, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Room_No", global::System.Data.DataRowVersion.Original, true, null));
            this._adapter.UpdateCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Original_Room_No", global::System.Data.OleDb.OleDbType.VarWChar, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Room_No", global::System.Data.DataRowVersion.Original, false, null));
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        private void InitConnection() {
            this._connection = new global::System.Data.OleDb.OleDbConnection();
            this._connection.ConnectionString = global::AccessCAD.Properties.Settings.Default.db_samplesConnectionString.Replace("|DataDirectory|", DotNetARX.Tools.GetCurrentPath());
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        private void InitCommandCollection() {
            this._commandCollection = new global::System.Data.OleDb.OleDbCommand[1];
            this._commandCollection[0] = new global::System.Data.OleDb.OleDbCommand();
            this._commandCollection[0].Connection = this.Connection;
            this._commandCollection[0].CommandText = "SELECT Emp_Id, Last_Name, First_Name, Gender, Title, Department, Room_No FROM Emp" +
                "loyee";
            this._commandCollection[0].CommandType = global::System.Data.CommandType.Text;
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        [global::System.ComponentModel.Design.HelpKeywordAttribute("vs.data.TableAdapter")]
        [global::System.ComponentModel.DataObjectMethodAttribute(global::System.ComponentModel.DataObjectMethodType.Fill, true)]
        public virtual int Fill(db_samplesDataSet.EmployeeDataTable dataTable) {
            this.Adapter.SelectCommand = this.CommandCollection[0];
            if ((this.ClearBeforeFill == true)) {
                dataTable.Clear();
            }
            int returnValue = this.Adapter.Fill(dataTable);
            return returnValue;
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        [global::System.ComponentModel.Design.HelpKeywordAttribute("vs.data.TableAdapter")]
        [global::System.ComponentModel.DataObjectMethodAttribute(global::System.ComponentModel.DataObjectMethodType.Select, true)]
        public virtual db_samplesDataSet.EmployeeDataTable GetData() {
            this.Adapter.SelectCommand = this.CommandCollection[0];
            db_samplesDataSet.EmployeeDataTable dataTable = new db_samplesDataSet.EmployeeDataTable();
            this.Adapter.Fill(dataTable);
            return dataTable;
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        [global::System.ComponentModel.Design.HelpKeywordAttribute("vs.data.TableAdapter")]
        public virtual int Update(db_samplesDataSet.EmployeeDataTable dataTable) {
            return this.Adapter.Update(dataTable);
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        [global::System.ComponentModel.Design.HelpKeywordAttribute("vs.data.TableAdapter")]
        public virtual int Update(db_samplesDataSet dataSet) {
            return this.Adapter.Update(dataSet, "Employee");
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        [global::System.ComponentModel.Design.HelpKeywordAttribute("vs.data.TableAdapter")]
        public virtual int Update(global::System.Data.DataRow dataRow) {
            return this.Adapter.Update(new global::System.Data.DataRow[] {
                        dataRow});
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        [global::System.ComponentModel.Design.HelpKeywordAttribute("vs.data.TableAdapter")]
        public virtual int Update(global::System.Data.DataRow[] dataRows) {
            return this.Adapter.Update(dataRows);
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        [global::System.ComponentModel.Design.HelpKeywordAttribute("vs.data.TableAdapter")]
        [global::System.ComponentModel.DataObjectMethodAttribute(global::System.ComponentModel.DataObjectMethodType.Delete, true)]
        public virtual int Delete(string Original_Emp_Id, string Original_Last_Name, string Original_First_Name, string Original_Gender, string Original_Title, string Original_Department, string Original_Room_No) {
            if ((Original_Emp_Id == null)) {
                this.Adapter.DeleteCommand.Parameters[0].Value = global::System.DBNull.Value;
            }
            else {
                this.Adapter.DeleteCommand.Parameters[0].Value = ((string)(Original_Emp_Id));
            }
            if ((Original_Last_Name == null)) {
                throw new global::System.ArgumentNullException("Original_Last_Name");
            }
            else {
                this.Adapter.DeleteCommand.Parameters[1].Value = ((object)(0));
                this.Adapter.DeleteCommand.Parameters[2].Value = ((string)(Original_Last_Name));
            }
            if ((Original_First_Name == null)) {
                throw new global::System.ArgumentNullException("Original_First_Name");
            }
            else {
                this.Adapter.DeleteCommand.Parameters[3].Value = ((object)(0));
                this.Adapter.DeleteCommand.Parameters[4].Value = ((string)(Original_First_Name));
            }
            if ((Original_Gender == null)) {
                this.Adapter.DeleteCommand.Parameters[5].Value = ((object)(1));
                this.Adapter.DeleteCommand.Parameters[6].Value = global::System.DBNull.Value;
            }
            else {
                this.Adapter.DeleteCommand.Parameters[5].Value = ((object)(0));
                this.Adapter.DeleteCommand.Parameters[6].Value = ((string)(Original_Gender));
            }
            if ((Original_Title == null)) {
                this.Adapter.DeleteCommand.Parameters[7].Value = ((object)(1));
                this.Adapter.DeleteCommand.Parameters[8].Value = global::System.DBNull.Value;
            }
            else {
                this.Adapter.DeleteCommand.Parameters[7].Value = ((object)(0));
                this.Adapter.DeleteCommand.Parameters[8].Value = ((string)(Original_Title));
            }
            if ((Original_Department == null)) {
                this.Adapter.DeleteCommand.Parameters[9].Value = ((object)(1));
                this.Adapter.DeleteCommand.Parameters[10].Value = global::System.DBNull.Value;
            }
            else {
                this.Adapter.DeleteCommand.Parameters[9].Value = ((object)(0));
                this.Adapter.DeleteCommand.Parameters[10].Value = ((string)(Original_Department));
            }
            if ((Original_Room_No == null)) {
                this.Adapter.DeleteCommand.Parameters[11].Value = ((object)(1));
                this.Adapter.DeleteCommand.Parameters[12].Value = global::System.DBNull.Value;
            }
            else {
                this.Adapter.DeleteCommand.Parameters[11].Value = ((object)(0));
                this.Adapter.DeleteCommand.Parameters[12].Value = ((string)(Original_Room_No));
            }
            global::System.Data.ConnectionState previousConnectionState = this.Adapter.DeleteCommand.Connection.State;
            if (((this.Adapter.DeleteCommand.Connection.State & global::System.Data.ConnectionState.Open) 
                        != global::System.Data.ConnectionState.Open)) {
                this.Adapter.DeleteCommand.Connection.Open();
            }
            try {
                int returnValue = this.Adapter.DeleteCommand.ExecuteNonQuery();
                return returnValue;
            }
            finally {
                if ((previousConnectionState == global::System.Data.ConnectionState.Closed)) {
                    this.Adapter.DeleteCommand.Connection.Close();
                }
            }
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        [global::System.ComponentModel.Design.HelpKeywordAttribute("vs.data.TableAdapter")]
        [global::System.ComponentModel.DataObjectMethodAttribute(global::System.ComponentModel.DataObjectMethodType.Insert, true)]
        public virtual int Insert(string Emp_Id, string Last_Name, string First_Name, string Gender, string Title, string Department, string Room_No) {
            if ((Emp_Id == null)) {
                this.Adapter.InsertCommand.Parameters[0].Value = global::System.DBNull.Value;
            }
            else {
                this.Adapter.InsertCommand.Parameters[0].Value = ((string)(Emp_Id));
            }
            if ((Last_Name == null)) {
                throw new global::System.ArgumentNullException("Last_Name");
            }
            else {
                this.Adapter.InsertCommand.Parameters[1].Value = ((string)(Last_Name));
            }
            if ((First_Name == null)) {
                throw new global::System.ArgumentNullException("First_Name");
            }
            else {
                this.Adapter.InsertCommand.Parameters[2].Value = ((string)(First_Name));
            }
            if ((Gender == null)) {
                this.Adapter.InsertCommand.Parameters[3].Value = global::System.DBNull.Value;
            }
            else {
                this.Adapter.InsertCommand.Parameters[3].Value = ((string)(Gender));
            }
            if ((Title == null)) {
                this.Adapter.InsertCommand.Parameters[4].Value = global::System.DBNull.Value;
            }
            else {
                this.Adapter.InsertCommand.Parameters[4].Value = ((string)(Title));
            }
            if ((Department == null)) {
                this.Adapter.InsertCommand.Parameters[5].Value = global::System.DBNull.Value;
            }
            else {
                this.Adapter.InsertCommand.Parameters[5].Value = ((string)(Department));
            }
            if ((Room_No == null)) {
                this.Adapter.InsertCommand.Parameters[6].Value = global::System.DBNull.Value;
            }
            else {
                this.Adapter.InsertCommand.Parameters[6].Value = ((string)(Room_No));
            }
            global::System.Data.ConnectionState previousConnectionState = this.Adapter.InsertCommand.Connection.State;
            if (((this.Adapter.InsertCommand.Connection.State & global::System.Data.ConnectionState.Open) 
                        != global::System.Data.ConnectionState.Open)) {
                this.Adapter.InsertCommand.Connection.Open();
            }
            try {
                int returnValue = this.Adapter.InsertCommand.ExecuteNonQuery();
                return returnValue;
            }
            finally {
                if ((previousConnectionState == global::System.Data.ConnectionState.Closed)) {
                    this.Adapter.InsertCommand.Connection.Close();
                }
            }
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        [global::System.ComponentModel.Design.HelpKeywordAttribute("vs.data.TableAdapter")]
        [global::System.ComponentModel.DataObjectMethodAttribute(global::System.ComponentModel.DataObjectMethodType.Update, true)]
        public virtual int Update(string Emp_Id, string Last_Name, string First_Name, string Gender, string Title, string Department, string Room_No, string Original_Emp_Id, string Original_Last_Name, string Original_First_Name, string Original_Gender, string Original_Title, string Original_Department, string Original_Room_No) {
            if ((Emp_Id == null)) {
                this.Adapter.UpdateCommand.Parameters[0].Value = global::System.DBNull.Value;
            }
            else {
                this.Adapter.UpdateCommand.Parameters[0].Value = ((string)(Emp_Id));
            }
            if ((Last_Name == null)) {
                throw new global::System.ArgumentNullException("Last_Name");
            }
            else {
                this.Adapter.UpdateCommand.Parameters[1].Value = ((string)(Last_Name));
            }
            if ((First_Name == null)) {
                throw new global::System.ArgumentNullException("First_Name");
            }
            else {
                this.Adapter.UpdateCommand.Parameters[2].Value = ((string)(First_Name));
            }
            if ((Gender == null)) {
                this.Adapter.UpdateCommand.Parameters[3].Value = global::System.DBNull.Value;
            }
            else {
                this.Adapter.UpdateCommand.Parameters[3].Value = ((string)(Gender));
            }
            if ((Title == null)) {
                this.Adapter.UpdateCommand.Parameters[4].Value = global::System.DBNull.Value;
            }
            else {
                this.Adapter.UpdateCommand.Parameters[4].Value = ((string)(Title));
            }
            if ((Department == null)) {
                this.Adapter.UpdateCommand.Parameters[5].Value = global::System.DBNull.Value;
            }
            else {
                this.Adapter.UpdateCommand.Parameters[5].Value = ((string)(Department));
            }
            if ((Room_No == null)) {
                this.Adapter.UpdateCommand.Parameters[6].Value = global::System.DBNull.Value;
            }
            else {
                this.Adapter.UpdateCommand.Parameters[6].Value = ((string)(Room_No));
            }
            if ((Original_Emp_Id == null)) {
                this.Adapter.UpdateCommand.Parameters[7].Value = global::System.DBNull.Value;
            }
            else {
                this.Adapter.UpdateCommand.Parameters[7].Value = ((string)(Original_Emp_Id));
            }
            if ((Original_Last_Name == null)) {
                throw new global::System.ArgumentNullException("Original_Last_Name");
            }
            else {
                this.Adapter.UpdateCommand.Parameters[8].Value = ((object)(0));
                this.Adapter.UpdateCommand.Parameters[9].Value = ((string)(Original_Last_Name));
            }
            if ((Original_First_Name == null)) {
                throw new global::System.ArgumentNullException("Original_First_Name");
            }
            else {
                this.Adapter.UpdateCommand.Parameters[10].Value = ((object)(0));
                this.Adapter.UpdateCommand.Parameters[11].Value = ((string)(Original_First_Name));
            }
            if ((Original_Gender == null)) {
                this.Adapter.UpdateCommand.Parameters[12].Value = ((object)(1));
                this.Adapter.UpdateCommand.Parameters[13].Value = global::System.DBNull.Value;
            }
            else {
                this.Adapter.UpdateCommand.Parameters[12].Value = ((object)(0));
                this.Adapter.UpdateCommand.Parameters[13].Value = ((string)(Original_Gender));
            }
            if ((Original_Title == null)) {
                this.Adapter.UpdateCommand.Parameters[14].Value = ((object)(1));
                this.Adapter.UpdateCommand.Parameters[15].Value = global::System.DBNull.Value;
            }
            else {
                this.Adapter.UpdateCommand.Parameters[14].Value = ((object)(0));
                this.Adapter.UpdateCommand.Parameters[15].Value = ((string)(Original_Title));
            }
            if ((Original_Department == null)) {
                this.Adapter.UpdateCommand.Parameters[16].Value = ((object)(1));
                this.Adapter.UpdateCommand.Parameters[17].Value = global::System.DBNull.Value;
            }
            else {
                this.Adapter.UpdateCommand.Parameters[16].Value = ((object)(0));
                this.Adapter.UpdateCommand.Parameters[17].Value = ((string)(Original_Department));
            }
            if ((Original_Room_No == null)) {
                this.Adapter.UpdateCommand.Parameters[18].Value = ((object)(1));
                this.Adapter.UpdateCommand.Parameters[19].Value = global::System.DBNull.Value;
            }
            else {
                this.Adapter.UpdateCommand.Parameters[18].Value = ((object)(0));
                this.Adapter.UpdateCommand.Parameters[19].Value = ((string)(Original_Room_No));
            }
            global::System.Data.ConnectionState previousConnectionState = this.Adapter.UpdateCommand.Connection.State;
            if (((this.Adapter.UpdateCommand.Connection.State & global::System.Data.ConnectionState.Open) 
                        != global::System.Data.ConnectionState.Open)) {
                this.Adapter.UpdateCommand.Connection.Open();
            }
            try {
                int returnValue = this.Adapter.UpdateCommand.ExecuteNonQuery();
                return returnValue;
            }
            finally {
                if ((previousConnectionState == global::System.Data.ConnectionState.Closed)) {
                    this.Adapter.UpdateCommand.Connection.Close();
                }
            }
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        [global::System.ComponentModel.Design.HelpKeywordAttribute("vs.data.TableAdapter")]
        [global::System.ComponentModel.DataObjectMethodAttribute(global::System.ComponentModel.DataObjectMethodType.Update, true)]
        public virtual int Update(string Last_Name, string First_Name, string Gender, string Title, string Department, string Room_No, string Original_Emp_Id, string Original_Last_Name, string Original_First_Name, string Original_Gender, string Original_Title, string Original_Department, string Original_Room_No) {
            return this.Update(Original_Emp_Id, Last_Name, First_Name, Gender, Title, Department, Room_No, Original_Emp_Id, Original_Last_Name, Original_First_Name, Original_Gender, Original_Title, Original_Department, Original_Room_No);
        }
    }
    
    /// <summary>
    ///Represents the connection and commands used to retrieve and save data.
    ///</summary>
    [global::System.ComponentModel.DesignerCategoryAttribute("code")]
    [global::System.ComponentModel.ToolboxItem(true)]
    [global::System.ComponentModel.DataObjectAttribute(true)]
    [global::System.ComponentModel.DesignerAttribute("Microsoft.VSDesigner.DataSource.Design.TableAdapterDesigner, Microsoft.VSDesigner" +
        ", Version=10.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a")]
    [global::System.ComponentModel.Design.HelpKeywordAttribute("vs.data.TableAdapter")]
    public partial class InventoryTableAdapter : global::System.ComponentModel.Component {
        
        private global::System.Data.OleDb.OleDbDataAdapter _adapter;
        
        private global::System.Data.OleDb.OleDbConnection _connection;
        
        private global::System.Data.OleDb.OleDbTransaction _transaction;
        
        private global::System.Data.OleDb.OleDbCommand[] _commandCollection;
        
        private bool _clearBeforeFill;
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        public InventoryTableAdapter() {
            this.ClearBeforeFill = true;
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        protected internal global::System.Data.OleDb.OleDbDataAdapter Adapter {
            get {
                if ((this._adapter == null)) {
                    this.InitAdapter();
                }
                return this._adapter;
            }
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        internal global::System.Data.OleDb.OleDbConnection Connection {
            get {
                if ((this._connection == null)) {
                    this.InitConnection();
                }
                return this._connection;
            }
            set {
                this._connection = value;
                if ((this.Adapter.InsertCommand != null)) {
                    this.Adapter.InsertCommand.Connection = value;
                }
                if ((this.Adapter.DeleteCommand != null)) {
                    this.Adapter.DeleteCommand.Connection = value;
                }
                if ((this.Adapter.UpdateCommand != null)) {
                    this.Adapter.UpdateCommand.Connection = value;
                }
                for (int i = 0; (i < this.CommandCollection.Length); i = (i + 1)) {
                    if ((this.CommandCollection[i] != null)) {
                        ((global::System.Data.OleDb.OleDbCommand)(this.CommandCollection[i])).Connection = value;
                    }
                }
            }
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        internal global::System.Data.OleDb.OleDbTransaction Transaction {
            get {
                return this._transaction;
            }
            set {
                this._transaction = value;
                for (int i = 0; (i < this.CommandCollection.Length); i = (i + 1)) {
                    this.CommandCollection[i].Transaction = this._transaction;
                }
                if (((this.Adapter != null) 
                            && (this.Adapter.DeleteCommand != null))) {
                    this.Adapter.DeleteCommand.Transaction = this._transaction;
                }
                if (((this.Adapter != null) 
                            && (this.Adapter.InsertCommand != null))) {
                    this.Adapter.InsertCommand.Transaction = this._transaction;
                }
                if (((this.Adapter != null) 
                            && (this.Adapter.UpdateCommand != null))) {
                    this.Adapter.UpdateCommand.Transaction = this._transaction;
                }
            }
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        protected global::System.Data.OleDb.OleDbCommand[] CommandCollection {
            get {
                if ((this._commandCollection == null)) {
                    this.InitCommandCollection();
                }
                return this._commandCollection;
            }
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        public bool ClearBeforeFill {
            get {
                return this._clearBeforeFill;
            }
            set {
                this._clearBeforeFill = value;
            }
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        private void InitAdapter() {
            this._adapter = new global::System.Data.OleDb.OleDbDataAdapter();
            global::System.Data.Common.DataTableMapping tableMapping = new global::System.Data.Common.DataTableMapping();
            tableMapping.SourceTable = "Table";
            tableMapping.DataSetTable = "Inventory";
            tableMapping.ColumnMappings.Add("Inv_ID", "Inv_ID");
            tableMapping.ColumnMappings.Add("Type", "Type");
            tableMapping.ColumnMappings.Add("Description", "Description");
            tableMapping.ColumnMappings.Add("Manufacturer", "Manufacturer");
            tableMapping.ColumnMappings.Add("Model", "Model");
            tableMapping.ColumnMappings.Add("Price", "Price");
            tableMapping.ColumnMappings.Add("Room_No", "Room_No");
            this._adapter.TableMappings.Add(tableMapping);
            this._adapter.DeleteCommand = new global::System.Data.OleDb.OleDbCommand();
            this._adapter.DeleteCommand.Connection = this.Connection;
            this._adapter.DeleteCommand.CommandText = @"DELETE FROM `Inventory` WHERE ((`Inv_ID` = ?) AND ((? = 1 AND `Type` IS NULL) OR (`Type` = ?)) AND ((? = 1 AND `Description` IS NULL) OR (`Description` = ?)) AND ((? = 1 AND `Manufacturer` IS NULL) OR (`Manufacturer` = ?)) AND ((? = 1 AND `Model` IS NULL) OR (`Model` = ?)) AND ((? = 1 AND `Price` IS NULL) OR (`Price` = ?)) AND ((? = 1 AND `Room_No` IS NULL) OR (`Room_No` = ?)))";
            this._adapter.DeleteCommand.CommandType = global::System.Data.CommandType.Text;
            this._adapter.DeleteCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Original_Inv_ID", global::System.Data.OleDb.OleDbType.Double, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Inv_ID", global::System.Data.DataRowVersion.Original, false, null));
            this._adapter.DeleteCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("IsNull_Type", global::System.Data.OleDb.OleDbType.Integer, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Type", global::System.Data.DataRowVersion.Original, true, null));
            this._adapter.DeleteCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Original_Type", global::System.Data.OleDb.OleDbType.VarWChar, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Type", global::System.Data.DataRowVersion.Original, false, null));
            this._adapter.DeleteCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("IsNull_Description", global::System.Data.OleDb.OleDbType.Integer, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Description", global::System.Data.DataRowVersion.Original, true, null));
            this._adapter.DeleteCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Original_Description", global::System.Data.OleDb.OleDbType.VarWChar, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Description", global::System.Data.DataRowVersion.Original, false, null));
            this._adapter.DeleteCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("IsNull_Manufacturer", global::System.Data.OleDb.OleDbType.Integer, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Manufacturer", global::System.Data.DataRowVersion.Original, true, null));
            this._adapter.DeleteCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Original_Manufacturer", global::System.Data.OleDb.OleDbType.VarWChar, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Manufacturer", global::System.Data.DataRowVersion.Original, false, null));
            this._adapter.DeleteCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("IsNull_Model", global::System.Data.OleDb.OleDbType.Integer, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Model", global::System.Data.DataRowVersion.Original, true, null));
            this._adapter.DeleteCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Original_Model", global::System.Data.OleDb.OleDbType.VarWChar, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Model", global::System.Data.DataRowVersion.Original, false, null));
            this._adapter.DeleteCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("IsNull_Price", global::System.Data.OleDb.OleDbType.Integer, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Price", global::System.Data.DataRowVersion.Original, true, null));
            this._adapter.DeleteCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Original_Price", global::System.Data.OleDb.OleDbType.Currency, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Price", global::System.Data.DataRowVersion.Original, false, null));
            this._adapter.DeleteCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("IsNull_Room_No", global::System.Data.OleDb.OleDbType.Integer, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Room_No", global::System.Data.DataRowVersion.Original, true, null));
            this._adapter.DeleteCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Original_Room_No", global::System.Data.OleDb.OleDbType.VarWChar, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Room_No", global::System.Data.DataRowVersion.Original, false, null));
            this._adapter.InsertCommand = new global::System.Data.OleDb.OleDbCommand();
            this._adapter.InsertCommand.Connection = this.Connection;
            this._adapter.InsertCommand.CommandText = "INSERT INTO `Inventory` (`Inv_ID`, `Type`, `Description`, `Manufacturer`, `Model`" +
                ", `Price`, `Room_No`) VALUES (?, ?, ?, ?, ?, ?, ?)";
            this._adapter.InsertCommand.CommandType = global::System.Data.CommandType.Text;
            this._adapter.InsertCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Inv_ID", global::System.Data.OleDb.OleDbType.Double, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Inv_ID", global::System.Data.DataRowVersion.Current, false, null));
            this._adapter.InsertCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Type", global::System.Data.OleDb.OleDbType.VarWChar, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Type", global::System.Data.DataRowVersion.Current, false, null));
            this._adapter.InsertCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Description", global::System.Data.OleDb.OleDbType.VarWChar, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Description", global::System.Data.DataRowVersion.Current, false, null));
            this._adapter.InsertCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Manufacturer", global::System.Data.OleDb.OleDbType.VarWChar, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Manufacturer", global::System.Data.DataRowVersion.Current, false, null));
            this._adapter.InsertCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Model", global::System.Data.OleDb.OleDbType.VarWChar, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Model", global::System.Data.DataRowVersion.Current, false, null));
            this._adapter.InsertCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Price", global::System.Data.OleDb.OleDbType.Currency, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Price", global::System.Data.DataRowVersion.Current, false, null));
            this._adapter.InsertCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Room_No", global::System.Data.OleDb.OleDbType.VarWChar, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Room_No", global::System.Data.DataRowVersion.Current, false, null));
            this._adapter.UpdateCommand = new global::System.Data.OleDb.OleDbCommand();
            this._adapter.UpdateCommand.Connection = this.Connection;
            this._adapter.UpdateCommand.CommandText = @"UPDATE `Inventory` SET `Inv_ID` = ?, `Type` = ?, `Description` = ?, `Manufacturer` = ?, `Model` = ?, `Price` = ?, `Room_No` = ? WHERE ((`Inv_ID` = ?) AND ((? = 1 AND `Type` IS NULL) OR (`Type` = ?)) AND ((? = 1 AND `Description` IS NULL) OR (`Description` = ?)) AND ((? = 1 AND `Manufacturer` IS NULL) OR (`Manufacturer` = ?)) AND ((? = 1 AND `Model` IS NULL) OR (`Model` = ?)) AND ((? = 1 AND `Price` IS NULL) OR (`Price` = ?)) AND ((? = 1 AND `Room_No` IS NULL) OR (`Room_No` = ?)))";
            this._adapter.UpdateCommand.CommandType = global::System.Data.CommandType.Text;
            this._adapter.UpdateCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Inv_ID", global::System.Data.OleDb.OleDbType.Double, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Inv_ID", global::System.Data.DataRowVersion.Current, false, null));
            this._adapter.UpdateCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Type", global::System.Data.OleDb.OleDbType.VarWChar, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Type", global::System.Data.DataRowVersion.Current, false, null));
            this._adapter.UpdateCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Description", global::System.Data.OleDb.OleDbType.VarWChar, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Description", global::System.Data.DataRowVersion.Current, false, null));
            this._adapter.UpdateCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Manufacturer", global::System.Data.OleDb.OleDbType.VarWChar, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Manufacturer", global::System.Data.DataRowVersion.Current, false, null));
            this._adapter.UpdateCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Model", global::System.Data.OleDb.OleDbType.VarWChar, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Model", global::System.Data.DataRowVersion.Current, false, null));
            this._adapter.UpdateCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Price", global::System.Data.OleDb.OleDbType.Currency, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Price", global::System.Data.DataRowVersion.Current, false, null));
            this._adapter.UpdateCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Room_No", global::System.Data.OleDb.OleDbType.VarWChar, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Room_No", global::System.Data.DataRowVersion.Current, false, null));
            this._adapter.UpdateCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Original_Inv_ID", global::System.Data.OleDb.OleDbType.Double, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Inv_ID", global::System.Data.DataRowVersion.Original, false, null));
            this._adapter.UpdateCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("IsNull_Type", global::System.Data.OleDb.OleDbType.Integer, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Type", global::System.Data.DataRowVersion.Original, true, null));
            this._adapter.UpdateCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Original_Type", global::System.Data.OleDb.OleDbType.VarWChar, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Type", global::System.Data.DataRowVersion.Original, false, null));
            this._adapter.UpdateCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("IsNull_Description", global::System.Data.OleDb.OleDbType.Integer, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Description", global::System.Data.DataRowVersion.Original, true, null));
            this._adapter.UpdateCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Original_Description", global::System.Data.OleDb.OleDbType.VarWChar, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Description", global::System.Data.DataRowVersion.Original, false, null));
            this._adapter.UpdateCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("IsNull_Manufacturer", global::System.Data.OleDb.OleDbType.Integer, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Manufacturer", global::System.Data.DataRowVersion.Original, true, null));
            this._adapter.UpdateCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Original_Manufacturer", global::System.Data.OleDb.OleDbType.VarWChar, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Manufacturer", global::System.Data.DataRowVersion.Original, false, null));
            this._adapter.UpdateCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("IsNull_Model", global::System.Data.OleDb.OleDbType.Integer, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Model", global::System.Data.DataRowVersion.Original, true, null));
            this._adapter.UpdateCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Original_Model", global::System.Data.OleDb.OleDbType.VarWChar, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Model", global::System.Data.DataRowVersion.Original, false, null));
            this._adapter.UpdateCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("IsNull_Price", global::System.Data.OleDb.OleDbType.Integer, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Price", global::System.Data.DataRowVersion.Original, true, null));
            this._adapter.UpdateCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Original_Price", global::System.Data.OleDb.OleDbType.Currency, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Price", global::System.Data.DataRowVersion.Original, false, null));
            this._adapter.UpdateCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("IsNull_Room_No", global::System.Data.OleDb.OleDbType.Integer, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Room_No", global::System.Data.DataRowVersion.Original, true, null));
            this._adapter.UpdateCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Original_Room_No", global::System.Data.OleDb.OleDbType.VarWChar, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Room_No", global::System.Data.DataRowVersion.Original, false, null));
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        private void InitConnection() {
            this._connection = new global::System.Data.OleDb.OleDbConnection();
            this._connection.ConnectionString = global::AccessCAD.Properties.Settings.Default.db_samplesConnectionString.Replace("|DataDirectory|", DotNetARX.Tools.GetCurrentPath());
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        private void InitCommandCollection() {
            this._commandCollection = new global::System.Data.OleDb.OleDbCommand[1];
            this._commandCollection[0] = new global::System.Data.OleDb.OleDbCommand();
            this._commandCollection[0].Connection = this.Connection;
            this._commandCollection[0].CommandText = "SELECT Inv_ID, Type, Description, Manufacturer, Model, Price, Room_No FROM Invent" +
                "ory";
            this._commandCollection[0].CommandType = global::System.Data.CommandType.Text;
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        [global::System.ComponentModel.Design.HelpKeywordAttribute("vs.data.TableAdapter")]
        [global::System.ComponentModel.DataObjectMethodAttribute(global::System.ComponentModel.DataObjectMethodType.Fill, true)]
        public virtual int Fill(db_samplesDataSet.InventoryDataTable dataTable) {
            this.Adapter.SelectCommand = this.CommandCollection[0];
            if ((this.ClearBeforeFill == true)) {
                dataTable.Clear();
            }
            int returnValue = this.Adapter.Fill(dataTable);
            return returnValue;
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        [global::System.ComponentModel.Design.HelpKeywordAttribute("vs.data.TableAdapter")]
        [global::System.ComponentModel.DataObjectMethodAttribute(global::System.ComponentModel.DataObjectMethodType.Select, true)]
        public virtual db_samplesDataSet.InventoryDataTable GetData() {
            this.Adapter.SelectCommand = this.CommandCollection[0];
            db_samplesDataSet.InventoryDataTable dataTable = new db_samplesDataSet.InventoryDataTable();
            this.Adapter.Fill(dataTable);
            return dataTable;
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        [global::System.ComponentModel.Design.HelpKeywordAttribute("vs.data.TableAdapter")]
        public virtual int Update(db_samplesDataSet.InventoryDataTable dataTable) {
            return this.Adapter.Update(dataTable);
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        [global::System.ComponentModel.Design.HelpKeywordAttribute("vs.data.TableAdapter")]
        public virtual int Update(db_samplesDataSet dataSet) {
            return this.Adapter.Update(dataSet, "Inventory");
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        [global::System.ComponentModel.Design.HelpKeywordAttribute("vs.data.TableAdapter")]
        public virtual int Update(global::System.Data.DataRow dataRow) {
            return this.Adapter.Update(new global::System.Data.DataRow[] {
                        dataRow});
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        [global::System.ComponentModel.Design.HelpKeywordAttribute("vs.data.TableAdapter")]
        public virtual int Update(global::System.Data.DataRow[] dataRows) {
            return this.Adapter.Update(dataRows);
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        [global::System.ComponentModel.Design.HelpKeywordAttribute("vs.data.TableAdapter")]
        [global::System.ComponentModel.DataObjectMethodAttribute(global::System.ComponentModel.DataObjectMethodType.Delete, true)]
        public virtual int Delete(global::System.Nullable<double> Original_Inv_ID, string Original_Type, string Original_Description, string Original_Manufacturer, string Original_Model, global::System.Nullable<decimal> Original_Price, string Original_Room_No) {
            if ((Original_Inv_ID.HasValue == true)) {
                this.Adapter.DeleteCommand.Parameters[0].Value = ((double)(Original_Inv_ID.Value));
            }
            else {
                this.Adapter.DeleteCommand.Parameters[0].Value = global::System.DBNull.Value;
            }
            if ((Original_Type == null)) {
                this.Adapter.DeleteCommand.Parameters[1].Value = ((object)(1));
                this.Adapter.DeleteCommand.Parameters[2].Value = global::System.DBNull.Value;
            }
            else {
                this.Adapter.DeleteCommand.Parameters[1].Value = ((object)(0));
                this.Adapter.DeleteCommand.Parameters[2].Value = ((string)(Original_Type));
            }
            if ((Original_Description == null)) {
                this.Adapter.DeleteCommand.Parameters[3].Value = ((object)(1));
                this.Adapter.DeleteCommand.Parameters[4].Value = global::System.DBNull.Value;
            }
            else {
                this.Adapter.DeleteCommand.Parameters[3].Value = ((object)(0));
                this.Adapter.DeleteCommand.Parameters[4].Value = ((string)(Original_Description));
            }
            if ((Original_Manufacturer == null)) {
                this.Adapter.DeleteCommand.Parameters[5].Value = ((object)(1));
                this.Adapter.DeleteCommand.Parameters[6].Value = global::System.DBNull.Value;
            }
            else {
                this.Adapter.DeleteCommand.Parameters[5].Value = ((object)(0));
                this.Adapter.DeleteCommand.Parameters[6].Value = ((string)(Original_Manufacturer));
            }
            if ((Original_Model == null)) {
                this.Adapter.DeleteCommand.Parameters[7].Value = ((object)(1));
                this.Adapter.DeleteCommand.Parameters[8].Value = global::System.DBNull.Value;
            }
            else {
                this.Adapter.DeleteCommand.Parameters[7].Value = ((object)(0));
                this.Adapter.DeleteCommand.Parameters[8].Value = ((string)(Original_Model));
            }
            if ((Original_Price.HasValue == true)) {
                this.Adapter.DeleteCommand.Parameters[9].Value = ((object)(0));
                this.Adapter.DeleteCommand.Parameters[10].Value = ((decimal)(Original_Price.Value));
            }
            else {
                this.Adapter.DeleteCommand.Parameters[9].Value = ((object)(1));
                this.Adapter.DeleteCommand.Parameters[10].Value = global::System.DBNull.Value;
            }
            if ((Original_Room_No == null)) {
                this.Adapter.DeleteCommand.Parameters[11].Value = ((object)(1));
                this.Adapter.DeleteCommand.Parameters[12].Value = global::System.DBNull.Value;
            }
            else {
                this.Adapter.DeleteCommand.Parameters[11].Value = ((object)(0));
                this.Adapter.DeleteCommand.Parameters[12].Value = ((string)(Original_Room_No));
            }
            global::System.Data.ConnectionState previousConnectionState = this.Adapter.DeleteCommand.Connection.State;
            if (((this.Adapter.DeleteCommand.Connection.State & global::System.Data.ConnectionState.Open) 
                        != global::System.Data.ConnectionState.Open)) {
                this.Adapter.DeleteCommand.Connection.Open();
            }
            try {
                int returnValue = this.Adapter.DeleteCommand.ExecuteNonQuery();
                return returnValue;
            }
            finally {
                if ((previousConnectionState == global::System.Data.ConnectionState.Closed)) {
                    this.Adapter.DeleteCommand.Connection.Close();
                }
            }
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        [global::System.ComponentModel.Design.HelpKeywordAttribute("vs.data.TableAdapter")]
        [global::System.ComponentModel.DataObjectMethodAttribute(global::System.ComponentModel.DataObjectMethodType.Insert, true)]
        public virtual int Insert(global::System.Nullable<double> Inv_ID, string Type, string Description, string Manufacturer, string Model, global::System.Nullable<decimal> Price, string Room_No) {
            if ((Inv_ID.HasValue == true)) {
                this.Adapter.InsertCommand.Parameters[0].Value = ((double)(Inv_ID.Value));
            }
            else {
                this.Adapter.InsertCommand.Parameters[0].Value = global::System.DBNull.Value;
            }
            if ((Type == null)) {
                this.Adapter.InsertCommand.Parameters[1].Value = global::System.DBNull.Value;
            }
            else {
                this.Adapter.InsertCommand.Parameters[1].Value = ((string)(Type));
            }
            if ((Description == null)) {
                this.Adapter.InsertCommand.Parameters[2].Value = global::System.DBNull.Value;
            }
            else {
                this.Adapter.InsertCommand.Parameters[2].Value = ((string)(Description));
            }
            if ((Manufacturer == null)) {
                this.Adapter.InsertCommand.Parameters[3].Value = global::System.DBNull.Value;
            }
            else {
                this.Adapter.InsertCommand.Parameters[3].Value = ((string)(Manufacturer));
            }
            if ((Model == null)) {
                this.Adapter.InsertCommand.Parameters[4].Value = global::System.DBNull.Value;
            }
            else {
                this.Adapter.InsertCommand.Parameters[4].Value = ((string)(Model));
            }
            if ((Price.HasValue == true)) {
                this.Adapter.InsertCommand.Parameters[5].Value = ((decimal)(Price.Value));
            }
            else {
                this.Adapter.InsertCommand.Parameters[5].Value = global::System.DBNull.Value;
            }
            if ((Room_No == null)) {
                this.Adapter.InsertCommand.Parameters[6].Value = global::System.DBNull.Value;
            }
            else {
                this.Adapter.InsertCommand.Parameters[6].Value = ((string)(Room_No));
            }
            global::System.Data.ConnectionState previousConnectionState = this.Adapter.InsertCommand.Connection.State;
            if (((this.Adapter.InsertCommand.Connection.State & global::System.Data.ConnectionState.Open) 
                        != global::System.Data.ConnectionState.Open)) {
                this.Adapter.InsertCommand.Connection.Open();
            }
            try {
                int returnValue = this.Adapter.InsertCommand.ExecuteNonQuery();
                return returnValue;
            }
            finally {
                if ((previousConnectionState == global::System.Data.ConnectionState.Closed)) {
                    this.Adapter.InsertCommand.Connection.Close();
                }
            }
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        [global::System.ComponentModel.Design.HelpKeywordAttribute("vs.data.TableAdapter")]
        [global::System.ComponentModel.DataObjectMethodAttribute(global::System.ComponentModel.DataObjectMethodType.Update, true)]
        public virtual int Update(global::System.Nullable<double> Inv_ID, string Type, string Description, string Manufacturer, string Model, global::System.Nullable<decimal> Price, string Room_No, global::System.Nullable<double> Original_Inv_ID, string Original_Type, string Original_Description, string Original_Manufacturer, string Original_Model, global::System.Nullable<decimal> Original_Price, string Original_Room_No) {
            if ((Inv_ID.HasValue == true)) {
                this.Adapter.UpdateCommand.Parameters[0].Value = ((double)(Inv_ID.Value));
            }
            else {
                this.Adapter.UpdateCommand.Parameters[0].Value = global::System.DBNull.Value;
            }
            if ((Type == null)) {
                this.Adapter.UpdateCommand.Parameters[1].Value = global::System.DBNull.Value;
            }
            else {
                this.Adapter.UpdateCommand.Parameters[1].Value = ((string)(Type));
            }
            if ((Description == null)) {
                this.Adapter.UpdateCommand.Parameters[2].Value = global::System.DBNull.Value;
            }
            else {
                this.Adapter.UpdateCommand.Parameters[2].Value = ((string)(Description));
            }
            if ((Manufacturer == null)) {
                this.Adapter.UpdateCommand.Parameters[3].Value = global::System.DBNull.Value;
            }
            else {
                this.Adapter.UpdateCommand.Parameters[3].Value = ((string)(Manufacturer));
            }
            if ((Model == null)) {
                this.Adapter.UpdateCommand.Parameters[4].Value = global::System.DBNull.Value;
            }
            else {
                this.Adapter.UpdateCommand.Parameters[4].Value = ((string)(Model));
            }
            if ((Price.HasValue == true)) {
                this.Adapter.UpdateCommand.Parameters[5].Value = ((decimal)(Price.Value));
            }
            else {
                this.Adapter.UpdateCommand.Parameters[5].Value = global::System.DBNull.Value;
            }
            if ((Room_No == null)) {
                this.Adapter.UpdateCommand.Parameters[6].Value = global::System.DBNull.Value;
            }
            else {
                this.Adapter.UpdateCommand.Parameters[6].Value = ((string)(Room_No));
            }
            if ((Original_Inv_ID.HasValue == true)) {
                this.Adapter.UpdateCommand.Parameters[7].Value = ((double)(Original_Inv_ID.Value));
            }
            else {
                this.Adapter.UpdateCommand.Parameters[7].Value = global::System.DBNull.Value;
            }
            if ((Original_Type == null)) {
                this.Adapter.UpdateCommand.Parameters[8].Value = ((object)(1));
                this.Adapter.UpdateCommand.Parameters[9].Value = global::System.DBNull.Value;
            }
            else {
                this.Adapter.UpdateCommand.Parameters[8].Value = ((object)(0));
                this.Adapter.UpdateCommand.Parameters[9].Value = ((string)(Original_Type));
            }
            if ((Original_Description == null)) {
                this.Adapter.UpdateCommand.Parameters[10].Value = ((object)(1));
                this.Adapter.UpdateCommand.Parameters[11].Value = global::System.DBNull.Value;
            }
            else {
                this.Adapter.UpdateCommand.Parameters[10].Value = ((object)(0));
                this.Adapter.UpdateCommand.Parameters[11].Value = ((string)(Original_Description));
            }
            if ((Original_Manufacturer == null)) {
                this.Adapter.UpdateCommand.Parameters[12].Value = ((object)(1));
                this.Adapter.UpdateCommand.Parameters[13].Value = global::System.DBNull.Value;
            }
            else {
                this.Adapter.UpdateCommand.Parameters[12].Value = ((object)(0));
                this.Adapter.UpdateCommand.Parameters[13].Value = ((string)(Original_Manufacturer));
            }
            if ((Original_Model == null)) {
                this.Adapter.UpdateCommand.Parameters[14].Value = ((object)(1));
                this.Adapter.UpdateCommand.Parameters[15].Value = global::System.DBNull.Value;
            }
            else {
                this.Adapter.UpdateCommand.Parameters[14].Value = ((object)(0));
                this.Adapter.UpdateCommand.Parameters[15].Value = ((string)(Original_Model));
            }
            if ((Original_Price.HasValue == true)) {
                this.Adapter.UpdateCommand.Parameters[16].Value = ((object)(0));
                this.Adapter.UpdateCommand.Parameters[17].Value = ((decimal)(Original_Price.Value));
            }
            else {
                this.Adapter.UpdateCommand.Parameters[16].Value = ((object)(1));
                this.Adapter.UpdateCommand.Parameters[17].Value = global::System.DBNull.Value;
            }
            if ((Original_Room_No == null)) {
                this.Adapter.UpdateCommand.Parameters[18].Value = ((object)(1));
                this.Adapter.UpdateCommand.Parameters[19].Value = global::System.DBNull.Value;
            }
            else {
                this.Adapter.UpdateCommand.Parameters[18].Value = ((object)(0));
                this.Adapter.UpdateCommand.Parameters[19].Value = ((string)(Original_Room_No));
            }
            global::System.Data.ConnectionState previousConnectionState = this.Adapter.UpdateCommand.Connection.State;
            if (((this.Adapter.UpdateCommand.Connection.State & global::System.Data.ConnectionState.Open) 
                        != global::System.Data.ConnectionState.Open)) {
                this.Adapter.UpdateCommand.Connection.Open();
            }
            try {
                int returnValue = this.Adapter.UpdateCommand.ExecuteNonQuery();
                return returnValue;
            }
            finally {
                if ((previousConnectionState == global::System.Data.ConnectionState.Closed)) {
                    this.Adapter.UpdateCommand.Connection.Close();
                }
            }
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        [global::System.ComponentModel.Design.HelpKeywordAttribute("vs.data.TableAdapter")]
        [global::System.ComponentModel.DataObjectMethodAttribute(global::System.ComponentModel.DataObjectMethodType.Update, true)]
        public virtual int Update(string Type, string Description, string Manufacturer, string Model, global::System.Nullable<decimal> Price, string Room_No, global::System.Nullable<double> Original_Inv_ID, string Original_Type, string Original_Description, string Original_Manufacturer, string Original_Model, global::System.Nullable<decimal> Original_Price, string Original_Room_No) {
            return this.Update(Original_Inv_ID, Type, Description, Manufacturer, Model, Price, Room_No, Original_Inv_ID, Original_Type, Original_Description, Original_Manufacturer, Original_Model, Original_Price, Original_Room_No);
        }
    }
    
    /// <summary>
    ///Represents the connection and commands used to retrieve and save data.
    ///</summary>
    [global::System.ComponentModel.DesignerCategoryAttribute("code")]
    [global::System.ComponentModel.ToolboxItem(true)]
    [global::System.ComponentModel.DataObjectAttribute(true)]
    [global::System.ComponentModel.DesignerAttribute("Microsoft.VSDesigner.DataSource.Design.TableAdapterDesigner, Microsoft.VSDesigner" +
        ", Version=10.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a")]
    [global::System.ComponentModel.Design.HelpKeywordAttribute("vs.data.TableAdapter")]
    public partial class RoomTableAdapter : global::System.ComponentModel.Component {
        
        private global::System.Data.OleDb.OleDbDataAdapter _adapter;
        
        private global::System.Data.OleDb.OleDbConnection _connection;
        
        private global::System.Data.OleDb.OleDbTransaction _transaction;
        
        private global::System.Data.OleDb.OleDbCommand[] _commandCollection;
        
        private bool _clearBeforeFill;
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        public RoomTableAdapter() {
            this.ClearBeforeFill = true;
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        protected internal global::System.Data.OleDb.OleDbDataAdapter Adapter {
            get {
                if ((this._adapter == null)) {
                    this.InitAdapter();
                }
                return this._adapter;
            }
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        internal global::System.Data.OleDb.OleDbConnection Connection {
            get {
                if ((this._connection == null)) {
                    this.InitConnection();
                }
                return this._connection;
            }
            set {
                this._connection = value;
                if ((this.Adapter.InsertCommand != null)) {
                    this.Adapter.InsertCommand.Connection = value;
                }
                if ((this.Adapter.DeleteCommand != null)) {
                    this.Adapter.DeleteCommand.Connection = value;
                }
                if ((this.Adapter.UpdateCommand != null)) {
                    this.Adapter.UpdateCommand.Connection = value;
                }
                for (int i = 0; (i < this.CommandCollection.Length); i = (i + 1)) {
                    if ((this.CommandCollection[i] != null)) {
                        ((global::System.Data.OleDb.OleDbCommand)(this.CommandCollection[i])).Connection = value;
                    }
                }
            }
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        internal global::System.Data.OleDb.OleDbTransaction Transaction {
            get {
                return this._transaction;
            }
            set {
                this._transaction = value;
                for (int i = 0; (i < this.CommandCollection.Length); i = (i + 1)) {
                    this.CommandCollection[i].Transaction = this._transaction;
                }
                if (((this.Adapter != null) 
                            && (this.Adapter.DeleteCommand != null))) {
                    this.Adapter.DeleteCommand.Transaction = this._transaction;
                }
                if (((this.Adapter != null) 
                            && (this.Adapter.InsertCommand != null))) {
                    this.Adapter.InsertCommand.Transaction = this._transaction;
                }
                if (((this.Adapter != null) 
                            && (this.Adapter.UpdateCommand != null))) {
                    this.Adapter.UpdateCommand.Transaction = this._transaction;
                }
            }
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        protected global::System.Data.OleDb.OleDbCommand[] CommandCollection {
            get {
                if ((this._commandCollection == null)) {
                    this.InitCommandCollection();
                }
                return this._commandCollection;
            }
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        public bool ClearBeforeFill {
            get {
                return this._clearBeforeFill;
            }
            set {
                this._clearBeforeFill = value;
            }
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        private void InitAdapter() {
            this._adapter = new global::System.Data.OleDb.OleDbDataAdapter();
            global::System.Data.Common.DataTableMapping tableMapping = new global::System.Data.Common.DataTableMapping();
            tableMapping.SourceTable = "Table";
            tableMapping.DataSetTable = "Room";
            tableMapping.ColumnMappings.Add("Room_No", "Room_No");
            tableMapping.ColumnMappings.Add("Room_Type", "Room_Type");
            tableMapping.ColumnMappings.Add("Area", "Area");
            tableMapping.ColumnMappings.Add("Entity_Handle", "Entity_Handle");
            this._adapter.TableMappings.Add(tableMapping);
            this._adapter.DeleteCommand = new global::System.Data.OleDb.OleDbCommand();
            this._adapter.DeleteCommand.Connection = this.Connection;
            this._adapter.DeleteCommand.CommandText = "DELETE FROM `Room` WHERE ((`Room_No` = ?) AND ((? = 1 AND `Room_Type` IS NULL) OR" +
                " (`Room_Type` = ?)) AND ((? = 1 AND `Area` IS NULL) OR (`Area` = ?)) AND ((? = 1" +
                " AND `Entity_Handle` IS NULL) OR (`Entity_Handle` = ?)))";
            this._adapter.DeleteCommand.CommandType = global::System.Data.CommandType.Text;
            this._adapter.DeleteCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Original_Room_No", global::System.Data.OleDb.OleDbType.VarWChar, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Room_No", global::System.Data.DataRowVersion.Original, false, null));
            this._adapter.DeleteCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("IsNull_Room_Type", global::System.Data.OleDb.OleDbType.Integer, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Room_Type", global::System.Data.DataRowVersion.Original, true, null));
            this._adapter.DeleteCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Original_Room_Type", global::System.Data.OleDb.OleDbType.VarWChar, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Room_Type", global::System.Data.DataRowVersion.Original, false, null));
            this._adapter.DeleteCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("IsNull_Area", global::System.Data.OleDb.OleDbType.Integer, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Area", global::System.Data.DataRowVersion.Original, true, null));
            this._adapter.DeleteCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Original_Area", global::System.Data.OleDb.OleDbType.Double, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Area", global::System.Data.DataRowVersion.Original, false, null));
            this._adapter.DeleteCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("IsNull_Entity_Handle", global::System.Data.OleDb.OleDbType.Integer, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Entity_Handle", global::System.Data.DataRowVersion.Original, true, null));
            this._adapter.DeleteCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Original_Entity_Handle", global::System.Data.OleDb.OleDbType.VarWChar, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Entity_Handle", global::System.Data.DataRowVersion.Original, false, null));
            this._adapter.InsertCommand = new global::System.Data.OleDb.OleDbCommand();
            this._adapter.InsertCommand.Connection = this.Connection;
            this._adapter.InsertCommand.CommandText = "INSERT INTO `Room` (`Room_No`, `Room_Type`, `Area`, `Entity_Handle`) VALUES (?, ?" +
                ", ?, ?)";
            this._adapter.InsertCommand.CommandType = global::System.Data.CommandType.Text;
            this._adapter.InsertCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Room_No", global::System.Data.OleDb.OleDbType.VarWChar, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Room_No", global::System.Data.DataRowVersion.Current, false, null));
            this._adapter.InsertCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Room_Type", global::System.Data.OleDb.OleDbType.VarWChar, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Room_Type", global::System.Data.DataRowVersion.Current, false, null));
            this._adapter.InsertCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Area", global::System.Data.OleDb.OleDbType.Double, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Area", global::System.Data.DataRowVersion.Current, false, null));
            this._adapter.InsertCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Entity_Handle", global::System.Data.OleDb.OleDbType.VarWChar, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Entity_Handle", global::System.Data.DataRowVersion.Current, false, null));
            this._adapter.UpdateCommand = new global::System.Data.OleDb.OleDbCommand();
            this._adapter.UpdateCommand.Connection = this.Connection;
            this._adapter.UpdateCommand.CommandText = @"UPDATE `Room` SET `Room_No` = ?, `Room_Type` = ?, `Area` = ?, `Entity_Handle` = ? WHERE ((`Room_No` = ?) AND ((? = 1 AND `Room_Type` IS NULL) OR (`Room_Type` = ?)) AND ((? = 1 AND `Area` IS NULL) OR (`Area` = ?)) AND ((? = 1 AND `Entity_Handle` IS NULL) OR (`Entity_Handle` = ?)))";
            this._adapter.UpdateCommand.CommandType = global::System.Data.CommandType.Text;
            this._adapter.UpdateCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Room_No", global::System.Data.OleDb.OleDbType.VarWChar, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Room_No", global::System.Data.DataRowVersion.Current, false, null));
            this._adapter.UpdateCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Room_Type", global::System.Data.OleDb.OleDbType.VarWChar, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Room_Type", global::System.Data.DataRowVersion.Current, false, null));
            this._adapter.UpdateCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Area", global::System.Data.OleDb.OleDbType.Double, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Area", global::System.Data.DataRowVersion.Current, false, null));
            this._adapter.UpdateCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Entity_Handle", global::System.Data.OleDb.OleDbType.VarWChar, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Entity_Handle", global::System.Data.DataRowVersion.Current, false, null));
            this._adapter.UpdateCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Original_Room_No", global::System.Data.OleDb.OleDbType.VarWChar, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Room_No", global::System.Data.DataRowVersion.Original, false, null));
            this._adapter.UpdateCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("IsNull_Room_Type", global::System.Data.OleDb.OleDbType.Integer, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Room_Type", global::System.Data.DataRowVersion.Original, true, null));
            this._adapter.UpdateCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Original_Room_Type", global::System.Data.OleDb.OleDbType.VarWChar, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Room_Type", global::System.Data.DataRowVersion.Original, false, null));
            this._adapter.UpdateCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("IsNull_Area", global::System.Data.OleDb.OleDbType.Integer, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Area", global::System.Data.DataRowVersion.Original, true, null));
            this._adapter.UpdateCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Original_Area", global::System.Data.OleDb.OleDbType.Double, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Area", global::System.Data.DataRowVersion.Original, false, null));
            this._adapter.UpdateCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("IsNull_Entity_Handle", global::System.Data.OleDb.OleDbType.Integer, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Entity_Handle", global::System.Data.DataRowVersion.Original, true, null));
            this._adapter.UpdateCommand.Parameters.Add(new global::System.Data.OleDb.OleDbParameter("Original_Entity_Handle", global::System.Data.OleDb.OleDbType.VarWChar, 0, global::System.Data.ParameterDirection.Input, ((byte)(0)), ((byte)(0)), "Entity_Handle", global::System.Data.DataRowVersion.Original, false, null));
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        private void InitConnection() {
            this._connection = new global::System.Data.OleDb.OleDbConnection();
            this._connection.ConnectionString = global::AccessCAD.Properties.Settings.Default.db_samplesConnectionString.Replace("|DataDirectory|", DotNetARX.Tools.GetCurrentPath());
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        private void InitCommandCollection() {
            this._commandCollection = new global::System.Data.OleDb.OleDbCommand[1];
            this._commandCollection[0] = new global::System.Data.OleDb.OleDbCommand();
            this._commandCollection[0].Connection = this.Connection;
            this._commandCollection[0].CommandText = "SELECT Room_No, Room_Type, Area, Entity_Handle FROM Room";
            this._commandCollection[0].CommandType = global::System.Data.CommandType.Text;
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        [global::System.ComponentModel.Design.HelpKeywordAttribute("vs.data.TableAdapter")]
        [global::System.ComponentModel.DataObjectMethodAttribute(global::System.ComponentModel.DataObjectMethodType.Fill, true)]
        public virtual int Fill(db_samplesDataSet.RoomDataTable dataTable) {
            this.Adapter.SelectCommand = this.CommandCollection[0];
            if ((this.ClearBeforeFill == true)) {
                dataTable.Clear();
            }
            int returnValue = this.Adapter.Fill(dataTable);
            return returnValue;
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        [global::System.ComponentModel.Design.HelpKeywordAttribute("vs.data.TableAdapter")]
        [global::System.ComponentModel.DataObjectMethodAttribute(global::System.ComponentModel.DataObjectMethodType.Select, true)]
        public virtual db_samplesDataSet.RoomDataTable GetData() {
            this.Adapter.SelectCommand = this.CommandCollection[0];
            db_samplesDataSet.RoomDataTable dataTable = new db_samplesDataSet.RoomDataTable();
            this.Adapter.Fill(dataTable);
            return dataTable;
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        [global::System.ComponentModel.Design.HelpKeywordAttribute("vs.data.TableAdapter")]
        public virtual int Update(db_samplesDataSet.RoomDataTable dataTable) {
            return this.Adapter.Update(dataTable);
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        [global::System.ComponentModel.Design.HelpKeywordAttribute("vs.data.TableAdapter")]
        public virtual int Update(db_samplesDataSet dataSet) {
            return this.Adapter.Update(dataSet, "Room");
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        [global::System.ComponentModel.Design.HelpKeywordAttribute("vs.data.TableAdapter")]
        public virtual int Update(global::System.Data.DataRow dataRow) {
            return this.Adapter.Update(new global::System.Data.DataRow[] {
                        dataRow});
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        [global::System.ComponentModel.Design.HelpKeywordAttribute("vs.data.TableAdapter")]
        public virtual int Update(global::System.Data.DataRow[] dataRows) {
            return this.Adapter.Update(dataRows);
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        [global::System.ComponentModel.Design.HelpKeywordAttribute("vs.data.TableAdapter")]
        [global::System.ComponentModel.DataObjectMethodAttribute(global::System.ComponentModel.DataObjectMethodType.Delete, true)]
        public virtual int Delete(string Original_Room_No, string Original_Room_Type, global::System.Nullable<double> Original_Area, string Original_Entity_Handle) {
            if ((Original_Room_No == null)) {
                this.Adapter.DeleteCommand.Parameters[0].Value = global::System.DBNull.Value;
            }
            else {
                this.Adapter.DeleteCommand.Parameters[0].Value = ((string)(Original_Room_No));
            }
            if ((Original_Room_Type == null)) {
                this.Adapter.DeleteCommand.Parameters[1].Value = ((object)(1));
                this.Adapter.DeleteCommand.Parameters[2].Value = global::System.DBNull.Value;
            }
            else {
                this.Adapter.DeleteCommand.Parameters[1].Value = ((object)(0));
                this.Adapter.DeleteCommand.Parameters[2].Value = ((string)(Original_Room_Type));
            }
            if ((Original_Area.HasValue == true)) {
                this.Adapter.DeleteCommand.Parameters[3].Value = ((object)(0));
                this.Adapter.DeleteCommand.Parameters[4].Value = ((double)(Original_Area.Value));
            }
            else {
                this.Adapter.DeleteCommand.Parameters[3].Value = ((object)(1));
                this.Adapter.DeleteCommand.Parameters[4].Value = global::System.DBNull.Value;
            }
            if ((Original_Entity_Handle == null)) {
                this.Adapter.DeleteCommand.Parameters[5].Value = ((object)(1));
                this.Adapter.DeleteCommand.Parameters[6].Value = global::System.DBNull.Value;
            }
            else {
                this.Adapter.DeleteCommand.Parameters[5].Value = ((object)(0));
                this.Adapter.DeleteCommand.Parameters[6].Value = ((string)(Original_Entity_Handle));
            }
            global::System.Data.ConnectionState previousConnectionState = this.Adapter.DeleteCommand.Connection.State;
            if (((this.Adapter.DeleteCommand.Connection.State & global::System.Data.ConnectionState.Open) 
                        != global::System.Data.ConnectionState.Open)) {
                this.Adapter.DeleteCommand.Connection.Open();
            }
            try {
                int returnValue = this.Adapter.DeleteCommand.ExecuteNonQuery();
                return returnValue;
            }
            finally {
                if ((previousConnectionState == global::System.Data.ConnectionState.Closed)) {
                    this.Adapter.DeleteCommand.Connection.Close();
                }
            }
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        [global::System.ComponentModel.Design.HelpKeywordAttribute("vs.data.TableAdapter")]
        [global::System.ComponentModel.DataObjectMethodAttribute(global::System.ComponentModel.DataObjectMethodType.Insert, true)]
        public virtual int Insert(string Room_No, string Room_Type, global::System.Nullable<double> Area, string Entity_Handle) {
            if ((Room_No == null)) {
                this.Adapter.InsertCommand.Parameters[0].Value = global::System.DBNull.Value;
            }
            else {
                this.Adapter.InsertCommand.Parameters[0].Value = ((string)(Room_No));
            }
            if ((Room_Type == null)) {
                this.Adapter.InsertCommand.Parameters[1].Value = global::System.DBNull.Value;
            }
            else {
                this.Adapter.InsertCommand.Parameters[1].Value = ((string)(Room_Type));
            }
            if ((Area.HasValue == true)) {
                this.Adapter.InsertCommand.Parameters[2].Value = ((double)(Area.Value));
            }
            else {
                this.Adapter.InsertCommand.Parameters[2].Value = global::System.DBNull.Value;
            }
            if ((Entity_Handle == null)) {
                this.Adapter.InsertCommand.Parameters[3].Value = global::System.DBNull.Value;
            }
            else {
                this.Adapter.InsertCommand.Parameters[3].Value = ((string)(Entity_Handle));
            }
            global::System.Data.ConnectionState previousConnectionState = this.Adapter.InsertCommand.Connection.State;
            if (((this.Adapter.InsertCommand.Connection.State & global::System.Data.ConnectionState.Open) 
                        != global::System.Data.ConnectionState.Open)) {
                this.Adapter.InsertCommand.Connection.Open();
            }
            try {
                int returnValue = this.Adapter.InsertCommand.ExecuteNonQuery();
                return returnValue;
            }
            finally {
                if ((previousConnectionState == global::System.Data.ConnectionState.Closed)) {
                    this.Adapter.InsertCommand.Connection.Close();
                }
            }
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        [global::System.ComponentModel.Design.HelpKeywordAttribute("vs.data.TableAdapter")]
        [global::System.ComponentModel.DataObjectMethodAttribute(global::System.ComponentModel.DataObjectMethodType.Update, true)]
        public virtual int Update(string Room_No, string Room_Type, global::System.Nullable<double> Area, string Entity_Handle, string Original_Room_No, string Original_Room_Type, global::System.Nullable<double> Original_Area, string Original_Entity_Handle) {
            if ((Room_No == null)) {
                this.Adapter.UpdateCommand.Parameters[0].Value = global::System.DBNull.Value;
            }
            else {
                this.Adapter.UpdateCommand.Parameters[0].Value = ((string)(Room_No));
            }
            if ((Room_Type == null)) {
                this.Adapter.UpdateCommand.Parameters[1].Value = global::System.DBNull.Value;
            }
            else {
                this.Adapter.UpdateCommand.Parameters[1].Value = ((string)(Room_Type));
            }
            if ((Area.HasValue == true)) {
                this.Adapter.UpdateCommand.Parameters[2].Value = ((double)(Area.Value));
            }
            else {
                this.Adapter.UpdateCommand.Parameters[2].Value = global::System.DBNull.Value;
            }
            if ((Entity_Handle == null)) {
                this.Adapter.UpdateCommand.Parameters[3].Value = global::System.DBNull.Value;
            }
            else {
                this.Adapter.UpdateCommand.Parameters[3].Value = ((string)(Entity_Handle));
            }
            if ((Original_Room_No == null)) {
                this.Adapter.UpdateCommand.Parameters[4].Value = global::System.DBNull.Value;
            }
            else {
                this.Adapter.UpdateCommand.Parameters[4].Value = ((string)(Original_Room_No));
            }
            if ((Original_Room_Type == null)) {
                this.Adapter.UpdateCommand.Parameters[5].Value = ((object)(1));
                this.Adapter.UpdateCommand.Parameters[6].Value = global::System.DBNull.Value;
            }
            else {
                this.Adapter.UpdateCommand.Parameters[5].Value = ((object)(0));
                this.Adapter.UpdateCommand.Parameters[6].Value = ((string)(Original_Room_Type));
            }
            if ((Original_Area.HasValue == true)) {
                this.Adapter.UpdateCommand.Parameters[7].Value = ((object)(0));
                this.Adapter.UpdateCommand.Parameters[8].Value = ((double)(Original_Area.Value));
            }
            else {
                this.Adapter.UpdateCommand.Parameters[7].Value = ((object)(1));
                this.Adapter.UpdateCommand.Parameters[8].Value = global::System.DBNull.Value;
            }
            if ((Original_Entity_Handle == null)) {
                this.Adapter.UpdateCommand.Parameters[9].Value = ((object)(1));
                this.Adapter.UpdateCommand.Parameters[10].Value = global::System.DBNull.Value;
            }
            else {
                this.Adapter.UpdateCommand.Parameters[9].Value = ((object)(0));
                this.Adapter.UpdateCommand.Parameters[10].Value = ((string)(Original_Entity_Handle));
            }
            global::System.Data.ConnectionState previousConnectionState = this.Adapter.UpdateCommand.Connection.State;
            if (((this.Adapter.UpdateCommand.Connection.State & global::System.Data.ConnectionState.Open) 
                        != global::System.Data.ConnectionState.Open)) {
                this.Adapter.UpdateCommand.Connection.Open();
            }
            try {
                int returnValue = this.Adapter.UpdateCommand.ExecuteNonQuery();
                return returnValue;
            }
            finally {
                if ((previousConnectionState == global::System.Data.ConnectionState.Closed)) {
                    this.Adapter.UpdateCommand.Connection.Close();
                }
            }
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        [global::System.ComponentModel.Design.HelpKeywordAttribute("vs.data.TableAdapter")]
        [global::System.ComponentModel.DataObjectMethodAttribute(global::System.ComponentModel.DataObjectMethodType.Update, true)]
        public virtual int Update(string Room_Type, global::System.Nullable<double> Area, string Entity_Handle, string Original_Room_No, string Original_Room_Type, global::System.Nullable<double> Original_Area, string Original_Entity_Handle) {
            return this.Update(Original_Room_No, Room_Type, Area, Entity_Handle, Original_Room_No, Original_Room_Type, Original_Area, Original_Entity_Handle);
        }
    }
    
    /// <summary>
    ///TableAdapterManager is used to coordinate TableAdapters in the dataset to enable Hierarchical Update scenarios
    ///</summary>
    [global::System.ComponentModel.DesignerCategoryAttribute("code")]
    [global::System.ComponentModel.ToolboxItem(true)]
    [global::System.ComponentModel.DesignerAttribute("Microsoft.VSDesigner.DataSource.Design.TableAdapterManagerDesigner, Microsoft.VSD" +
        "esigner, Version=10.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a")]
    [global::System.ComponentModel.Design.HelpKeywordAttribute("vs.data.TableAdapterManager")]
    public partial class TableAdapterManager : global::System.ComponentModel.Component {
        
        private UpdateOrderOption _updateOrder;
        
        private ComputerTableAdapter _computerTableAdapter;
        
        private EmployeeTableAdapter _employeeTableAdapter;
        
        private InventoryTableAdapter _inventoryTableAdapter;
        
        private RoomTableAdapter _roomTableAdapter;
        
        private bool _backupDataSetBeforeUpdate;
        
        private global::System.Data.IDbConnection _connection;
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        public UpdateOrderOption UpdateOrder {
            get {
                return this._updateOrder;
            }
            set {
                this._updateOrder = value;
            }
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        [global::System.ComponentModel.EditorAttribute("Microsoft.VSDesigner.DataSource.Design.TableAdapterManagerPropertyEditor, Microso" +
            "ft.VSDesigner, Version=10.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3" +
            "a", "System.Drawing.Design.UITypeEditor")]
        public ComputerTableAdapter ComputerTableAdapter {
            get {
                return this._computerTableAdapter;
            }
            set {
                this._computerTableAdapter = value;
            }
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        [global::System.ComponentModel.EditorAttribute("Microsoft.VSDesigner.DataSource.Design.TableAdapterManagerPropertyEditor, Microso" +
            "ft.VSDesigner, Version=10.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3" +
            "a", "System.Drawing.Design.UITypeEditor")]
        public EmployeeTableAdapter EmployeeTableAdapter {
            get {
                return this._employeeTableAdapter;
            }
            set {
                this._employeeTableAdapter = value;
            }
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        [global::System.ComponentModel.EditorAttribute("Microsoft.VSDesigner.DataSource.Design.TableAdapterManagerPropertyEditor, Microso" +
            "ft.VSDesigner, Version=10.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3" +
            "a", "System.Drawing.Design.UITypeEditor")]
        public InventoryTableAdapter InventoryTableAdapter {
            get {
                return this._inventoryTableAdapter;
            }
            set {
                this._inventoryTableAdapter = value;
            }
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        [global::System.ComponentModel.EditorAttribute("Microsoft.VSDesigner.DataSource.Design.TableAdapterManagerPropertyEditor, Microso" +
            "ft.VSDesigner, Version=10.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3" +
            "a", "System.Drawing.Design.UITypeEditor")]
        public RoomTableAdapter RoomTableAdapter {
            get {
                return this._roomTableAdapter;
            }
            set {
                this._roomTableAdapter = value;
            }
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        public bool BackupDataSetBeforeUpdate {
            get {
                return this._backupDataSetBeforeUpdate;
            }
            set {
                this._backupDataSetBeforeUpdate = value;
            }
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        [global::System.ComponentModel.Browsable(false)]
        public global::System.Data.IDbConnection Connection {
            get {
                if ((this._connection != null)) {
                    return this._connection;
                }
                if (((this._computerTableAdapter != null) 
                            && (this._computerTableAdapter.Connection != null))) {
                    return this._computerTableAdapter.Connection;
                }
                if (((this._employeeTableAdapter != null) 
                            && (this._employeeTableAdapter.Connection != null))) {
                    return this._employeeTableAdapter.Connection;
                }
                if (((this._inventoryTableAdapter != null) 
                            && (this._inventoryTableAdapter.Connection != null))) {
                    return this._inventoryTableAdapter.Connection;
                }
                if (((this._roomTableAdapter != null) 
                            && (this._roomTableAdapter.Connection != null))) {
                    return this._roomTableAdapter.Connection;
                }
                return null;
            }
            set {
                this._connection = value;
            }
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        [global::System.ComponentModel.Browsable(false)]
        public int TableAdapterInstanceCount {
            get {
                int count = 0;
                if ((this._computerTableAdapter != null)) {
                    count = (count + 1);
                }
                if ((this._employeeTableAdapter != null)) {
                    count = (count + 1);
                }
                if ((this._inventoryTableAdapter != null)) {
                    count = (count + 1);
                }
                if ((this._roomTableAdapter != null)) {
                    count = (count + 1);
                }
                return count;
            }
        }
        
        /// <summary>
        ///Update rows in top-down order.
        ///</summary>
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        private int UpdateUpdatedRows(db_samplesDataSet dataSet, global::System.Collections.Generic.List<global::System.Data.DataRow> allChangedRows, global::System.Collections.Generic.List<global::System.Data.DataRow> allAddedRows) {
            int result = 0;
            if ((this._roomTableAdapter != null)) {
                global::System.Data.DataRow[] updatedRows = dataSet.Room.Select(null, null, global::System.Data.DataViewRowState.ModifiedCurrent);
                updatedRows = this.GetRealUpdatedRows(updatedRows, allAddedRows);
                if (((updatedRows != null) 
                            && (0 < updatedRows.Length))) {
                    result = (result + this._roomTableAdapter.Update(updatedRows));
                    allChangedRows.AddRange(updatedRows);
                }
            }
            if ((this._computerTableAdapter != null)) {
                global::System.Data.DataRow[] updatedRows = dataSet.Computer.Select(null, null, global::System.Data.DataViewRowState.ModifiedCurrent);
                updatedRows = this.GetRealUpdatedRows(updatedRows, allAddedRows);
                if (((updatedRows != null) 
                            && (0 < updatedRows.Length))) {
                    result = (result + this._computerTableAdapter.Update(updatedRows));
                    allChangedRows.AddRange(updatedRows);
                }
            }
            if ((this._inventoryTableAdapter != null)) {
                global::System.Data.DataRow[] updatedRows = dataSet.Inventory.Select(null, null, global::System.Data.DataViewRowState.ModifiedCurrent);
                updatedRows = this.GetRealUpdatedRows(updatedRows, allAddedRows);
                if (((updatedRows != null) 
                            && (0 < updatedRows.Length))) {
                    result = (result + this._inventoryTableAdapter.Update(updatedRows));
                    allChangedRows.AddRange(updatedRows);
                }
            }
            if ((this._employeeTableAdapter != null)) {
                global::System.Data.DataRow[] updatedRows = dataSet.Employee.Select(null, null, global::System.Data.DataViewRowState.ModifiedCurrent);
                updatedRows = this.GetRealUpdatedRows(updatedRows, allAddedRows);
                if (((updatedRows != null) 
                            && (0 < updatedRows.Length))) {
                    result = (result + this._employeeTableAdapter.Update(updatedRows));
                    allChangedRows.AddRange(updatedRows);
                }
            }
            return result;
        }
        
        /// <summary>
        ///Insert rows in top-down order.
        ///</summary>
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        private int UpdateInsertedRows(db_samplesDataSet dataSet, global::System.Collections.Generic.List<global::System.Data.DataRow> allAddedRows) {
            int result = 0;
            if ((this._roomTableAdapter != null)) {
                global::System.Data.DataRow[] addedRows = dataSet.Room.Select(null, null, global::System.Data.DataViewRowState.Added);
                if (((addedRows != null) 
                            && (0 < addedRows.Length))) {
                    result = (result + this._roomTableAdapter.Update(addedRows));
                    allAddedRows.AddRange(addedRows);
                }
            }
            if ((this._computerTableAdapter != null)) {
                global::System.Data.DataRow[] addedRows = dataSet.Computer.Select(null, null, global::System.Data.DataViewRowState.Added);
                if (((addedRows != null) 
                            && (0 < addedRows.Length))) {
                    result = (result + this._computerTableAdapter.Update(addedRows));
                    allAddedRows.AddRange(addedRows);
                }
            }
            if ((this._inventoryTableAdapter != null)) {
                global::System.Data.DataRow[] addedRows = dataSet.Inventory.Select(null, null, global::System.Data.DataViewRowState.Added);
                if (((addedRows != null) 
                            && (0 < addedRows.Length))) {
                    result = (result + this._inventoryTableAdapter.Update(addedRows));
                    allAddedRows.AddRange(addedRows);
                }
            }
            if ((this._employeeTableAdapter != null)) {
                global::System.Data.DataRow[] addedRows = dataSet.Employee.Select(null, null, global::System.Data.DataViewRowState.Added);
                if (((addedRows != null) 
                            && (0 < addedRows.Length))) {
                    result = (result + this._employeeTableAdapter.Update(addedRows));
                    allAddedRows.AddRange(addedRows);
                }
            }
            return result;
        }
        
        /// <summary>
        ///Delete rows in bottom-up order.
        ///</summary>
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        private int UpdateDeletedRows(db_samplesDataSet dataSet, global::System.Collections.Generic.List<global::System.Data.DataRow> allChangedRows) {
            int result = 0;
            if ((this._employeeTableAdapter != null)) {
                global::System.Data.DataRow[] deletedRows = dataSet.Employee.Select(null, null, global::System.Data.DataViewRowState.Deleted);
                if (((deletedRows != null) 
                            && (0 < deletedRows.Length))) {
                    result = (result + this._employeeTableAdapter.Update(deletedRows));
                    allChangedRows.AddRange(deletedRows);
                }
            }
            if ((this._inventoryTableAdapter != null)) {
                global::System.Data.DataRow[] deletedRows = dataSet.Inventory.Select(null, null, global::System.Data.DataViewRowState.Deleted);
                if (((deletedRows != null) 
                            && (0 < deletedRows.Length))) {
                    result = (result + this._inventoryTableAdapter.Update(deletedRows));
                    allChangedRows.AddRange(deletedRows);
                }
            }
            if ((this._computerTableAdapter != null)) {
                global::System.Data.DataRow[] deletedRows = dataSet.Computer.Select(null, null, global::System.Data.DataViewRowState.Deleted);
                if (((deletedRows != null) 
                            && (0 < deletedRows.Length))) {
                    result = (result + this._computerTableAdapter.Update(deletedRows));
                    allChangedRows.AddRange(deletedRows);
                }
            }
            if ((this._roomTableAdapter != null)) {
                global::System.Data.DataRow[] deletedRows = dataSet.Room.Select(null, null, global::System.Data.DataViewRowState.Deleted);
                if (((deletedRows != null) 
                            && (0 < deletedRows.Length))) {
                    result = (result + this._roomTableAdapter.Update(deletedRows));
                    allChangedRows.AddRange(deletedRows);
                }
            }
            return result;
        }
        
        /// <summary>
        ///Remove inserted rows that become updated rows after calling TableAdapter.Update(inserted rows) first
        ///</summary>
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        private global::System.Data.DataRow[] GetRealUpdatedRows(global::System.Data.DataRow[] updatedRows, global::System.Collections.Generic.List<global::System.Data.DataRow> allAddedRows) {
            if (((updatedRows == null) 
                        || (updatedRows.Length < 1))) {
                return updatedRows;
            }
            if (((allAddedRows == null) 
                        || (allAddedRows.Count < 1))) {
                return updatedRows;
            }
            global::System.Collections.Generic.List<global::System.Data.DataRow> realUpdatedRows = new global::System.Collections.Generic.List<global::System.Data.DataRow>();
            for (int i = 0; (i < updatedRows.Length); i = (i + 1)) {
                global::System.Data.DataRow row = updatedRows[i];
                if ((allAddedRows.Contains(row) == false)) {
                    realUpdatedRows.Add(row);
                }
            }
            return realUpdatedRows.ToArray();
        }
        
        /// <summary>
        ///Update all changes to the dataset.
        ///</summary>
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        public virtual int UpdateAll(db_samplesDataSet dataSet) {
            if ((dataSet == null)) {
                throw new global::System.ArgumentNullException("dataSet");
            }
            if ((dataSet.HasChanges() == false)) {
                return 0;
            }
            if (((this._computerTableAdapter != null) 
                        && (this.MatchTableAdapterConnection(this._computerTableAdapter.Connection) == false))) {
                throw new global::System.ArgumentException("由 TableAdapterManager 管理的所有 TableAdapter 必须使用相同的连接字符串。");
            }
            if (((this._employeeTableAdapter != null) 
                        && (this.MatchTableAdapterConnection(this._employeeTableAdapter.Connection) == false))) {
                throw new global::System.ArgumentException("由 TableAdapterManager 管理的所有 TableAdapter 必须使用相同的连接字符串。");
            }
            if (((this._inventoryTableAdapter != null) 
                        && (this.MatchTableAdapterConnection(this._inventoryTableAdapter.Connection) == false))) {
                throw new global::System.ArgumentException("由 TableAdapterManager 管理的所有 TableAdapter 必须使用相同的连接字符串。");
            }
            if (((this._roomTableAdapter != null) 
                        && (this.MatchTableAdapterConnection(this._roomTableAdapter.Connection) == false))) {
                throw new global::System.ArgumentException("由 TableAdapterManager 管理的所有 TableAdapter 必须使用相同的连接字符串。");
            }
            global::System.Data.IDbConnection workConnection = this.Connection;
            if ((workConnection == null)) {
                throw new global::System.ApplicationException("TableAdapterManager 不包含任何连接信息。请将每个 TableAdapterManager TableAdapter 属性设置为有效的 Tabl" +
                        "eAdapter 实例。");
            }
            bool workConnOpened = false;
            if (((workConnection.State & global::System.Data.ConnectionState.Broken) 
                        == global::System.Data.ConnectionState.Broken)) {
                workConnection.Close();
            }
            if ((workConnection.State == global::System.Data.ConnectionState.Closed)) {
                workConnection.Open();
                workConnOpened = true;
            }
            global::System.Data.IDbTransaction workTransaction = workConnection.BeginTransaction();
            if ((workTransaction == null)) {
                throw new global::System.ApplicationException("事务无法开始。当前的数据连接不支持事务或当前状态不允许事务开始。");
            }
            global::System.Collections.Generic.List<global::System.Data.DataRow> allChangedRows = new global::System.Collections.Generic.List<global::System.Data.DataRow>();
            global::System.Collections.Generic.List<global::System.Data.DataRow> allAddedRows = new global::System.Collections.Generic.List<global::System.Data.DataRow>();
            global::System.Collections.Generic.List<global::System.Data.Common.DataAdapter> adaptersWithAcceptChangesDuringUpdate = new global::System.Collections.Generic.List<global::System.Data.Common.DataAdapter>();
            global::System.Collections.Generic.Dictionary<object, global::System.Data.IDbConnection> revertConnections = new global::System.Collections.Generic.Dictionary<object, global::System.Data.IDbConnection>();
            int result = 0;
            global::System.Data.DataSet backupDataSet = null;
            if (this.BackupDataSetBeforeUpdate) {
                backupDataSet = new global::System.Data.DataSet();
                backupDataSet.Merge(dataSet);
            }
            try {
                // ---- Prepare for update -----------
                //
                if ((this._computerTableAdapter != null)) {
                    revertConnections.Add(this._computerTableAdapter, this._computerTableAdapter.Connection);
                    this._computerTableAdapter.Connection = ((global::System.Data.OleDb.OleDbConnection)(workConnection));
                    this._computerTableAdapter.Transaction = ((global::System.Data.OleDb.OleDbTransaction)(workTransaction));
                    if (this._computerTableAdapter.Adapter.AcceptChangesDuringUpdate) {
                        this._computerTableAdapter.Adapter.AcceptChangesDuringUpdate = false;
                        adaptersWithAcceptChangesDuringUpdate.Add(this._computerTableAdapter.Adapter);
                    }
                }
                if ((this._employeeTableAdapter != null)) {
                    revertConnections.Add(this._employeeTableAdapter, this._employeeTableAdapter.Connection);
                    this._employeeTableAdapter.Connection = ((global::System.Data.OleDb.OleDbConnection)(workConnection));
                    this._employeeTableAdapter.Transaction = ((global::System.Data.OleDb.OleDbTransaction)(workTransaction));
                    if (this._employeeTableAdapter.Adapter.AcceptChangesDuringUpdate) {
                        this._employeeTableAdapter.Adapter.AcceptChangesDuringUpdate = false;
                        adaptersWithAcceptChangesDuringUpdate.Add(this._employeeTableAdapter.Adapter);
                    }
                }
                if ((this._inventoryTableAdapter != null)) {
                    revertConnections.Add(this._inventoryTableAdapter, this._inventoryTableAdapter.Connection);
                    this._inventoryTableAdapter.Connection = ((global::System.Data.OleDb.OleDbConnection)(workConnection));
                    this._inventoryTableAdapter.Transaction = ((global::System.Data.OleDb.OleDbTransaction)(workTransaction));
                    if (this._inventoryTableAdapter.Adapter.AcceptChangesDuringUpdate) {
                        this._inventoryTableAdapter.Adapter.AcceptChangesDuringUpdate = false;
                        adaptersWithAcceptChangesDuringUpdate.Add(this._inventoryTableAdapter.Adapter);
                    }
                }
                if ((this._roomTableAdapter != null)) {
                    revertConnections.Add(this._roomTableAdapter, this._roomTableAdapter.Connection);
                    this._roomTableAdapter.Connection = ((global::System.Data.OleDb.OleDbConnection)(workConnection));
                    this._roomTableAdapter.Transaction = ((global::System.Data.OleDb.OleDbTransaction)(workTransaction));
                    if (this._roomTableAdapter.Adapter.AcceptChangesDuringUpdate) {
                        this._roomTableAdapter.Adapter.AcceptChangesDuringUpdate = false;
                        adaptersWithAcceptChangesDuringUpdate.Add(this._roomTableAdapter.Adapter);
                    }
                }
                // 
                //---- Perform updates -----------
                //
                if ((this.UpdateOrder == UpdateOrderOption.UpdateInsertDelete)) {
                    result = (result + this.UpdateUpdatedRows(dataSet, allChangedRows, allAddedRows));
                    result = (result + this.UpdateInsertedRows(dataSet, allAddedRows));
                }
                else {
                    result = (result + this.UpdateInsertedRows(dataSet, allAddedRows));
                    result = (result + this.UpdateUpdatedRows(dataSet, allChangedRows, allAddedRows));
                }
                result = (result + this.UpdateDeletedRows(dataSet, allChangedRows));
                // 
                //---- Commit updates -----------
                //
                workTransaction.Commit();
                if ((0 < allAddedRows.Count)) {
                    global::System.Data.DataRow[] rows = new System.Data.DataRow[allAddedRows.Count];
                    allAddedRows.CopyTo(rows);
                    for (int i = 0; (i < rows.Length); i = (i + 1)) {
                        global::System.Data.DataRow row = rows[i];
                        row.AcceptChanges();
                    }
                }
                if ((0 < allChangedRows.Count)) {
                    global::System.Data.DataRow[] rows = new System.Data.DataRow[allChangedRows.Count];
                    allChangedRows.CopyTo(rows);
                    for (int i = 0; (i < rows.Length); i = (i + 1)) {
                        global::System.Data.DataRow row = rows[i];
                        row.AcceptChanges();
                    }
                }
            }
            catch (global::System.Exception ex) {
                workTransaction.Rollback();
                // ---- Restore the dataset -----------
                if (this.BackupDataSetBeforeUpdate) {
                    global::System.Diagnostics.Debug.Assert((backupDataSet != null));
                    dataSet.Clear();
                    dataSet.Merge(backupDataSet);
                }
                else {
                    if ((0 < allAddedRows.Count)) {
                        global::System.Data.DataRow[] rows = new System.Data.DataRow[allAddedRows.Count];
                        allAddedRows.CopyTo(rows);
                        for (int i = 0; (i < rows.Length); i = (i + 1)) {
                            global::System.Data.DataRow row = rows[i];
                            row.AcceptChanges();
                            row.SetAdded();
                        }
                    }
                }
                throw ex;
            }
            finally {
                if (workConnOpened) {
                    workConnection.Close();
                }
                if ((this._computerTableAdapter != null)) {
                    this._computerTableAdapter.Connection = ((global::System.Data.OleDb.OleDbConnection)(revertConnections[this._computerTableAdapter]));
                    this._computerTableAdapter.Transaction = null;
                }
                if ((this._employeeTableAdapter != null)) {
                    this._employeeTableAdapter.Connection = ((global::System.Data.OleDb.OleDbConnection)(revertConnections[this._employeeTableAdapter]));
                    this._employeeTableAdapter.Transaction = null;
                }
                if ((this._inventoryTableAdapter != null)) {
                    this._inventoryTableAdapter.Connection = ((global::System.Data.OleDb.OleDbConnection)(revertConnections[this._inventoryTableAdapter]));
                    this._inventoryTableAdapter.Transaction = null;
                }
                if ((this._roomTableAdapter != null)) {
                    this._roomTableAdapter.Connection = ((global::System.Data.OleDb.OleDbConnection)(revertConnections[this._roomTableAdapter]));
                    this._roomTableAdapter.Transaction = null;
                }
                if ((0 < adaptersWithAcceptChangesDuringUpdate.Count)) {
                    global::System.Data.Common.DataAdapter[] adapters = new System.Data.Common.DataAdapter[adaptersWithAcceptChangesDuringUpdate.Count];
                    adaptersWithAcceptChangesDuringUpdate.CopyTo(adapters);
                    for (int i = 0; (i < adapters.Length); i = (i + 1)) {
                        global::System.Data.Common.DataAdapter adapter = adapters[i];
                        adapter.AcceptChangesDuringUpdate = true;
                    }
                }
            }
            return result;
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        protected virtual void SortSelfReferenceRows(global::System.Data.DataRow[] rows, global::System.Data.DataRelation relation, bool childFirst) {
            global::System.Array.Sort<global::System.Data.DataRow>(rows, new SelfReferenceComparer(relation, childFirst));
        }
        
        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        protected virtual bool MatchTableAdapterConnection(global::System.Data.IDbConnection inputConnection) {
            if ((this._connection != null)) {
                return true;
            }
            if (((this.Connection == null) 
                        || (inputConnection == null))) {
                return true;
            }
            if (string.Equals(this.Connection.ConnectionString, inputConnection.ConnectionString, global::System.StringComparison.Ordinal)) {
                return true;
            }
            return false;
        }
        
        /// <summary>
        ///Update Order Option
        ///</summary>
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        public enum UpdateOrderOption {
            
            InsertUpdateDelete = 0,
            
            UpdateInsertDelete = 1,
        }
        
        /// <summary>
        ///Used to sort self-referenced table's rows
        ///</summary>
        [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
        private class SelfReferenceComparer : object, global::System.Collections.Generic.IComparer<global::System.Data.DataRow> {
            
            private global::System.Data.DataRelation _relation;
            
            private int _childFirst;
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            internal SelfReferenceComparer(global::System.Data.DataRelation relation, bool childFirst) {
                this._relation = relation;
                if (childFirst) {
                    this._childFirst = -1;
                }
                else {
                    this._childFirst = 1;
                }
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            private global::System.Data.DataRow GetRoot(global::System.Data.DataRow row, out int distance) {
                global::System.Diagnostics.Debug.Assert((row != null));
                global::System.Data.DataRow root = row;
                distance = 0;

                global::System.Collections.Generic.IDictionary<global::System.Data.DataRow, global::System.Data.DataRow> traversedRows = new global::System.Collections.Generic.Dictionary<global::System.Data.DataRow, global::System.Data.DataRow>();
                traversedRows[row] = row;

                global::System.Data.DataRow parent = row.GetParentRow(this._relation, global::System.Data.DataRowVersion.Default);
                for (
                ; ((parent != null) 
                            && (traversedRows.ContainsKey(parent) == false)); 
                ) {
                    distance = (distance + 1);
                    root = parent;
                    traversedRows[parent] = parent;
                    parent = parent.GetParentRow(this._relation, global::System.Data.DataRowVersion.Default);
                }

                if ((distance == 0)) {
                    traversedRows.Clear();
                    traversedRows[row] = row;
                    parent = row.GetParentRow(this._relation, global::System.Data.DataRowVersion.Original);
                    for (
                    ; ((parent != null) 
                                && (traversedRows.ContainsKey(parent) == false)); 
                    ) {
                        distance = (distance + 1);
                        root = parent;
                        traversedRows[parent] = parent;
                        parent = parent.GetParentRow(this._relation, global::System.Data.DataRowVersion.Original);
                    }
                }

                return root;
            }
            
            [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
            [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Data.Design.TypedDataSetGenerator", "4.0.0.0")]
            public int Compare(global::System.Data.DataRow row1, global::System.Data.DataRow row2) {
                if (object.ReferenceEquals(row1, row2)) {
                    return 0;
                }
                if ((row1 == null)) {
                    return -1;
                }
                if ((row2 == null)) {
                    return 1;
                }

                int distance1 = 0;
                global::System.Data.DataRow root1 = this.GetRoot(row1, out distance1);

                int distance2 = 0;
                global::System.Data.DataRow root2 = this.GetRoot(row2, out distance2);

                if (object.ReferenceEquals(root1, root2)) {
                    return (this._childFirst * distance1.CompareTo(distance2));
                }
                else {
                    global::System.Diagnostics.Debug.Assert(((root1.Table != null) 
                                    && (root2.Table != null)));
                    if ((root1.Table.Rows.IndexOf(root1) < root2.Table.Rows.IndexOf(root2))) {
                        return -1;
                    }
                    else {
                        return 1;
                    }
                }
            }
        }
    }
}

#pragma warning restore 1591﻿using Autodesk.AutoCAD.DatabaseServices;

namespace DotNetARX
{
    /// <summary>
    /// 字典操作类，包括扩展字典与有名对象字典
    /// </summary>
    public static class DictTools
    {
        /// <summary>
        /// 添加扩展记录
        /// </summary>
        /// <param name="id">对象的Id</param>
        /// <param name="searchKey">扩展记录名称</param>
        /// <param name="values">扩展记录的内容</param>
        /// <returns>返回添加的扩展记录的Id</returns>
        public static ObjectId AddXrecord(this ObjectId id, string searchKey, TypedValueList values)
        {
            DBObject obj=id.GetObject(OpenMode.ForRead);//打开对象
            // 判断对象是否已经拥有扩展字典,若无扩展字典，则
            if (obj.ExtensionDictionary.IsNull)
            {
                obj.UpgradeOpen(); // 切换对象为写的状态
                obj.CreateExtensionDictionary();// 为对象创建扩展字典
                obj.DowngradeOpen(); // 为了安全，将对象切换成读的状态
            }
            // 打开对象的扩展字典
            DBDictionary dict=(DBDictionary)obj.ExtensionDictionary.GetObject(OpenMode.ForRead);
            // 如果扩展字典中已包含指定的扩展记录对象，则返回
            if (dict.Contains(searchKey))
                return ObjectId.Null;
            Xrecord xrec=new Xrecord();// 为对象新建一个扩展记录
            xrec.Data = values;// 指定扩展记录的内容
            dict.UpgradeOpen(); // 将扩展字典切换成写的状态
            //在扩展字典中加入新建的扩展记录，并指定它的搜索关键字
            ObjectId idXrec = dict.SetAt(searchKey, xrec);
            id.Database.TransactionManager.AddNewlyCreatedDBObject(xrec, true);
            dict.DowngradeOpen(); // 为了安全，将扩展字典切换成读的状态            
            return idXrec; // 返回添加的扩展记录的的Id
        }

        /// <summary>
        /// 获取扩展记录
        /// </summary>
        /// <param name="id">对象的Id</param>
        /// <param name="searchKey">扩展记录名称</param>
        /// <returns>返回扩展记录的内容</returns>
        public static TypedValueList GetXrecord(this ObjectId id, string searchKey)
        {
            DBObject obj=id.GetObject(OpenMode.ForRead);
            //获取对象的扩展字典
            ObjectId dictId=obj.ExtensionDictionary;
            if (dictId.IsNull) return null;//若对象没有扩展字典，则返回
            DBDictionary dict=(DBDictionary)dictId.GetObject(OpenMode.ForRead);
            //在扩展字典中搜索指定关键字的扩展记录，如果没找到则返回
            if (!dict.Contains(searchKey)) return null;
            // 获取扩展记录的Id
            ObjectId xrecordId=dict.GetAt(searchKey);
            //打开扩展记录并获取扩展记录的内容
            Xrecord xrecord=(Xrecord)xrecordId.GetObject(OpenMode.ForRead);
            return xrecord.Data; // 返回扩展记录的内容
        }

        /// <summary>
        /// 添加有名对象字典项
        /// </summary>
        /// <param name="db">数据库</param>
        /// <param name="searchKey">有名对象字典项的名称</param>
        /// <returns>返回添加的有名对象字典项的Id</returns>
        public static ObjectId AddNamedDictionary(this Database db, string searchKey)
        {
            ObjectId id=ObjectId.Null; // 存储添加的命名字典项的Id
            //打开数据库的有名对象字典
            DBDictionary dicts=(DBDictionary)db.NamedObjectsDictionaryId.GetObject(OpenMode.ForRead);
            if (!dicts.Contains(searchKey)) // 如果不存在指定关键字的字典项
            {
                DBDictionary dict=new DBDictionary(); //新建字典项 
                dicts.UpgradeOpen(); // 切换有名对象字典为写
                id = dicts.SetAt(searchKey, dict);//设置新建字典项的搜索关键字
                dicts.DowngradeOpen(); // 为了安全，将有名对象字典切换成读的状态
                //将新建的字典项添加到事务处理中
                db.TransactionManager.AddNewlyCreatedDBObject(dict, true);
            }
            return id; // 返回添加的字典项的Id
        }
    }
}
﻿using System;
using Autodesk.ADN.AutoCAD;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.Geometry;
using Autodesk.AutoCAD.Runtime;
using DotNetARX;
namespace DimConstraints
{
    public class DimConstraints
    {
        [CommandMethod("SameArea")]
        public void SameArea()
        {
            Database db = HostApplicationServices.WorkingDatabase;
            using (Transaction trans = db.TransactionManager.StartTransaction())
            {
                // 创建一个角点为（0，0）、（30，30）的矩形（多段线表示）
                Polyline rect = new Polyline();
                rect.CreateRectangle(Point2d.Origin, new Point2d(30, 30));
                // 创建一个圆心为(15, 15, 0)、半径为1的圆
                Circle cir = new Circle { Center = new Point3d(15, 15, 0), Radius = 1 };
                db.AddToModelSpace(rect, cir); // 将矩形及圆添加到模型空间
                // 声明一个点集对象，用来存储矩形的顶点及中点
                Point3dCollection pts = new Point3dCollection();
                for (int i = 0; i < 8; i++)
                {
                    pts.Add(rect.GetPointAtParameter(i * 0.5));
                }
                // 为多段线添加平行约束，使其成为平行四边形
                AssocUtil.CreateParallelConstraint(rect.ObjectId, rect.ObjectId, pts[1], pts[5]);
                AssocUtil.CreateParallelConstraint(rect.ObjectId, rect.ObjectId, pts[3], pts[7]);
                // 为多段线添加水平约束，使其平行于X轴
                AssocUtil.CreateHorizontalConstraint(rect.ObjectId, pts[3]);
                // 为多段线添加垂直约束，使其平行于Y轴
                AssocUtil.CreateVerticalConstraint(rect.ObjectId, pts[1]);
                // 为多段线添加固定约束，使其一条边保持不动
                AssocUtil.CreateFixConstraint(rect.ObjectId, pts[7]);
                // 为矩形添加对齐标注约束，约束矩形的宽度
                //ObjectId widthId = AssocUtil.CreateAlignedDimConstraint(rect.ObjectId, pts[0], pts[2], pts[1].PolarPoint(Math.PI, 10));
                ObjectId widthId = AssocUtil.Create2LineAngularDimConstraint(rect.ObjectId, rect.ObjectId,pts[0], pts[2], pts[1].PolarPoint(Math.PI, 10));
                // 为矩形添加对齐标注约束，约束矩形的长度
                ObjectId lengthId = AssocUtil.CreateAlignedDimConstraint(rect.ObjectId, pts[0], pts[6], pts[7].PolarPoint(-Math.PI / 2, 10));
                // 将对齐标注约束参数重新命名
                AssocUtil.RenameVariable(widthId, "Width", true);
                AssocUtil.RenameVariable(lengthId, "Length", true);
                // 获取当前图形中名为Area的用户参数，如果不存在，则创建
                ObjectId areaId = AssocUtil.GetVariableByName(db.CurrentSpaceId, "Area", true);
                string errMsg; // 存储错误信息的字符串
                // 设置Area参数的表达式为Width*Length，即矩形的面积
                AssocUtil.SetVariableValue(areaId, null, "Width*Length", "", out errMsg);
                // 为圆添加半径约束
                ObjectId radiusId = AssocUtil.CreateRadialDimConstraint(cir.ObjectId, cir.GetPointAtParameter(Math.PI / 4), cir.GetPointAtParameter(Math.PI / 4));
                // 设置半径约束的表达式为sqrt(Area/PI)，根据矩形的面积获取圆的半径
                AssocUtil.SetVariableValue(radiusId, null, "sqrt(Area/PI)", "", out errMsg);
                // 将半径约束参数重新命名
                AssocUtil.RenameVariable(radiusId, "Radius", true);
                // 添加水平标注约束，约束矩形角点与圆心之间的距离
                ObjectId centerXId = AssocUtil.CreateHorizontalDimConstraint(rect.ObjectId, cir.ObjectId, pts[2], cir.Center, pts[3].PolarPoint(Math.PI / 2, 10));
                // 设置水平标注约束的表达式为Length/2，即矩形长度的一半
                AssocUtil.SetVariableValue(centerXId, null, "Length/2", "", out errMsg);
                // 添加垂直标注约束，约束矩形角点与圆心之间的距离
                ObjectId centerYId = AssocUtil.CreateVerticalDimConstraint(rect.ObjectId, cir.ObjectId, pts[6], cir.Center, pts[5].PolarPoint(0, 10));
                // 设置垂直标注约束的表达式为Width/2，即矩形宽度的一半
                AssocUtil.SetVariableValue(centerYId, null, "Width/2", "", out errMsg);
                trans.Commit();
            }
        }
    }
}
﻿using System;
using System.Collections.Generic;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.Geometry;
using Autodesk.AutoCAD.Runtime;
using DotNetARX;
namespace Dimensions
{
    public class Dimensions
    {
        [CommandMethod("DimTest")]
        public void DimTest()
        {
            Database db=HostApplicationServices.WorkingDatabase;
            using (Transaction trans=db.TransactionManager.StartTransaction())
            {
                // 创建要标注的图形
                Line line1=new Line(new Point3d(30, 20, 0), new Point3d(120, 20, 0));
                Line line2=new Line(new Point3d(120, 20, 0), new Point3d(120, 40, 0));
                Line line3=new Line(new Point3d(120, 40, 0), new Point3d(90, 80, 0));
                Line line4=new Line(new Point3d(90, 80, 0), new Point3d(30, 80, 0));
                Arc arc=new Arc(new Point3d(30, 50, 0), 30, Math.PI / 2, Math.PI * 3 / 2);
                Circle cir1=new Circle(new Point3d(30, 50, 0), Vector3d.ZAxis, 15);
                Circle cir2=new Circle(new Point3d(70, 50, 0), Vector3d.ZAxis, 10);
                //将图形添加到模型空间中
                db.AddToModelSpace(line1, line2, line3, line4, arc, cir1, cir2);
                //创建一个列表，用于存储标注对象
                List<Dimension> dims=new List<Dimension>();
                // 创建转角标注（水平）
                RotatedDimension dimRotated1=new RotatedDimension();
                //指定第一条尺寸界线的附着位置
                dimRotated1.XLine1Point = line1.StartPoint;
                //指定第二条尺寸界线的附着位置
                dimRotated1.XLine2Point = line1.EndPoint;
                //指定尺寸线的位置
                dimRotated1.DimLinePoint = GeTools.MidPoint(line1.StartPoint, line1.EndPoint).PolarPoint(-Math.PI / 2, 10);
                dimRotated1.DimensionText = "<>mm";//设置标注的文字为标注值+后缀mm
                dims.Add(dimRotated1);//将水平转角标注添加到列表中
                //创建转角标注(垂直）
                RotatedDimension dimRotated2=new RotatedDimension();
                dimRotated2.Rotation = Math.PI / 2;//转角标注角度为90度，表示垂直方向
                //指定两条尺寸界线的附着位置和尺寸线的位置
                dimRotated2.XLine1Point = line2.StartPoint;
                dimRotated2.XLine2Point = line2.EndPoint;
                dimRotated2.DimLinePoint = GeTools.MidPoint(line2.StartPoint, line2.EndPoint).PolarPoint(0, 10);
                dims.Add(dimRotated2);//将垂直转角标注添加到列表中
                //创建转角标注（尺寸公差标注）
                RotatedDimension dimRotated3=new RotatedDimension();
                //指定两条尺寸界线的附着位置和尺寸线的位置
                dimRotated3.XLine1Point = line4.StartPoint;
                dimRotated3.XLine2Point = line4.EndPoint;
                dimRotated3.DimLinePoint = GeTools.MidPoint(line4.StartPoint, line4.EndPoint).PolarPoint(Math.PI / 2, 10);
                //设置标注的文字为标注值+堆叠文字
                dimRotated3.DimensionText = TextTools.StackText("<>", "+0.026", "-0.025", StackType.Tolerance, 0.7);
                dims.Add(dimRotated3);//将尺寸公差标注添加到列表中
                // 创建对齐标注
                AlignedDimension dimAligned=new AlignedDimension();
                //指定两条尺寸界线的附着位置和尺寸线的位置
                dimAligned.XLine1Point = line3.StartPoint;
                dimAligned.XLine2Point = line3.EndPoint;
                dimAligned.DimLinePoint = GeTools.MidPoint(line3.StartPoint, line3.EndPoint).PolarPoint(Math.PI / 2, 10);
                //设置标注的文字为标注值+公差符号
                dimAligned.DimensionText = "<>" + TextSpecialSymbol.Tolerance + "0.2";
                dims.Add(dimAligned);//将对齐标注添加到列表中
                // 创建半径标注
                RadialDimension dimRadial=new RadialDimension();
                dimRadial.Center = cir1.Center;//圆或圆弧的圆心
                //用于附着引线的圆或圆弧上的点
                dimRadial.ChordPoint = cir1.Center.PolarPoint(GeTools.DegreeToRadian(30), 15);
                dimRadial.LeaderLength = 10;//引线长度
                dims.Add(dimRadial);//将半径标注添加到列表中
                // 创建直径标注
                DiametricDimension dimDiametric=new DiametricDimension();
                //圆或圆弧上第一个直径点的坐标
                dimDiametric.ChordPoint = cir2.Center.PolarPoint(GeTools.DegreeToRadian(45), 10);
                //圆或圆弧上第二个直径点的坐标
                dimDiametric.FarChordPoint = cir2.Center.PolarPoint(GeTools.DegreeToRadian(-135), 10);
                dimDiametric.LeaderLength = 0;//从 ChordPoint 到注解文字或折线处的长度
                dims.Add(dimDiametric);//将直径标注添加到列表中
                // 创建角度标注
                Point3AngularDimension  dimLineAngular=new Point3AngularDimension();
                //圆或圆弧的圆心、或两尺寸界线间的共有顶点的坐标
                dimLineAngular.CenterPoint = line2.StartPoint;                
                //指定两条尺寸界线的附着位置
                dimLineAngular.XLine1Point = line1.StartPoint;
                dimLineAngular.XLine2Point = line2.EndPoint;
                //设置角度标志圆弧线上的点
                dimLineAngular.ArcPoint = line2.StartPoint.PolarPoint(GeTools.DegreeToRadian(135), 10);
                dims.Add(dimLineAngular);//将角度标注添加到列表中
                // 创建弧长标注,标注文字取为默认值
                ArcDimension dimArc=new ArcDimension(arc.Center, arc.StartPoint, arc.EndPoint, arc.Center.PolarPoint(Math.PI, arc.Radius + 10), "<>", db.Dimstyle);
                dims.Add(dimArc);//将弧长标注添加到列表中
                // 创建显示X轴值的坐标标注
                OrdinateDimension dimX=new OrdinateDimension();
                dimX.UsingXAxis = true;//显示 X 轴值
                dimX.DefiningPoint = cir2.Center;//标注点
                //指定引线终点，即标注文字显示的位置
                dimX.LeaderEndPoint = cir2.Center.PolarPoint(-Math.PI / 2, 20);
                dims.Add(dimX);//将坐标标注添加到列表中
                // 创建显示Y轴值的坐标标注
                OrdinateDimension dimY=new OrdinateDimension();
                dimY.UsingXAxis = false;//显示Y轴                
                dimY.DefiningPoint = cir2.Center;//标注点
                //指定引线终点，即标注文字显示的位置
                dimY.LeaderEndPoint = cir2.Center.PolarPoint(0, 20);
                dims.Add(dimY);//将坐标标注添加到列表中
                foreach (Dimension dim in dims)//遍历标注列表
                {
                    dim.DimensionStyle = db.Dimstyle;//设置标注样式为当前样式
                    db.AddToModelSpace(dim);//将标注添加到模型空间中
                }
                trans.Commit();//提交更改
            }
        }
    }
}
﻿using Autodesk.AutoCAD.ApplicationServices;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.EditorInput;
using Autodesk.AutoCAD.Runtime;
using DotNetARX;

namespace DimStyles
{
    public class DimStyles
    {
        [CommandMethod("NewDim")]
        public void NewDim()
        {
            Database db = HostApplicationServices.WorkingDatabase;
            Editor ed = Application.DocumentManager.MdiActiveDocument.Editor;
            string dimName = "";//存储标注样式名
            using (Transaction trans = db.TransactionManager.StartTransaction())
            {
                while (dimName == "")//如果用户没有输入标注样式名，则循环
                {
                    //提示用户输入标注样式名
                    PromptResult pr = ed.GetString("请输入标注样式名称");
                    if (pr.Status != PromptStatus.OK) return;
                    try
                    {
                        //验证输入的标注样式名是否合法
                        SymbolUtilityServices.ValidateSymbolName(pr.StringResult, false);
                        dimName = pr.StringResult;//标注样式名
                        //添加名为dimName的标注样式记录
                        ObjectId dimId = db.AddDimStyle(dimName);
                        //以写的方式打开新建的标注样式记录
                        DimStyleTableRecord dstr = (DimStyleTableRecord)trans.GetObject(dimId, OpenMode.ForWrite);
                        dstr.Dimasz = 3;//箭头大小
                        dstr.Dimexe = 3;//超出尺寸线的大小
                        dstr.Dimtad = 1;//文字位于标注线的上方
                        dstr.Dimtxt = 3;//标注文字的高度
                        //设置新添加的标注样式为当前标注样式
                        db.Dimstyle = dimId;
                        //为防止出现替代样式的问题，请添加下面的语句
                        db.SetDimstyleData(dstr);
                        break;//添加标注样式成功，跳出循环
                    }
                    catch
                    {
                        ed.WriteMessage("符号表名称不合法\n");
                    }
                }
                trans.Commit();
            }
        }
        [CommandMethod("CopyDim")]
        public void CopyDim()
        {
            Database db = HostApplicationServices.WorkingDatabase;
            Editor ed = Application.DocumentManager.MdiActiveDocument.Editor;
            //提示用户选择标注对象
            PromptEntityOptions opt = new PromptEntityOptions("请选择标注对象");
            opt.SetRejectMessage("你选择的不是标注对象");
            opt.AddAllowedClass(typeof(Dimension), false);
            PromptEntityResult result = ed.GetEntity(opt);
            if (result.Status != PromptStatus.OK) return;
            using (Transaction trans = db.TransactionManager.StartTransaction())
            {
                //获取标注对象
                Dimension dim = (Dimension)trans.GetObject(result.ObjectId, OpenMode.ForRead);
                //新建标注样式表记录
                DimStyleTableRecord dstr1 = new DimStyleTableRecord();
                //复制标注对象的标注样式表记录
                dstr1.CopyFrom(dim.GetDimstyleData());
                //设置标注样式表记录名称
                dstr1.Name = "标注对象样式";
                DimStyleTableRecord dstr2 = new DimStyleTableRecord();
                //复制当前的标注样式表记录
                dstr2.CopyFrom(db.GetDimstyleData());
                dstr2.Name = "数据库样式";
                DimStyleTableRecord dstr3 = new DimStyleTableRecord();
                //复制已有的标注样式表记录
                dstr3.CopyFrom(dstr2);
                dstr3.Name = "复制样式";
                //打开标注样式表并添加新建的标注样式表记录
                DimStyleTable dst = (DimStyleTable)trans.GetObject(db.DimStyleTableId, OpenMode.ForWrite);
                dst.Add(dstr1);
                dst.Add(dstr2);
                dst.Add(dstr3);
                trans.AddNewlyCreatedDBObject(dstr1, true);
                trans.AddNewlyCreatedDBObject(dstr2, true);
                trans.AddNewlyCreatedDBObject(dstr3, true);
                trans.Commit();
            }
        }
    }
}
﻿using Autodesk.AutoCAD.DatabaseServices;

namespace DotNetARX
{
    /// <summary>
    /// 标注样式操作类
    /// </summary>
    public static class DimStyleTools
    {
        /// <summary>
        /// 创建一个新的标注样式
        /// </summary>
        /// <param name="db">数据库对象</param>
        /// <param name="styleName">标注样式名</param>
        /// <returns>返回新建的标注样式的Id</returns>
        public static ObjectId AddDimStyle(this Database db, string styleName)
        {
            //打开标注样式表
            DimStyleTable dst=(DimStyleTable)db.DimStyleTableId.GetObject(OpenMode.ForRead);
            if (!dst.Has(styleName))//如果不存在名为styleName的标注样式，则新建一个标注样式
            {
                //定义一个新的标注样式表记录
                DimStyleTableRecord dstr=new DimStyleTableRecord();
                dstr.Name = styleName;//设置标注样式名
                dst.UpgradeOpen();//切换标注样式表的状态为写以添加新的标注样式
                dst.Add(dstr);//将标注样式表记录的信息添加到标注样式表中
                //把标注式表记录添加到事务处理中
                db.TransactionManager.AddNewlyCreatedDBObject(dstr, true);
                dst.DowngradeOpen();//为了安全，将标注样式表的状态切换为读
            }
            return dst[styleName];//返回新添加的标注样式表记录的ObjectId
        }
    }
}
﻿using Autodesk.AutoCAD.ApplicationServices;
using Autodesk.AutoCAD.DatabaseServices;

namespace DotNetARX
{
    /// <summary>
    /// 与公差标注有关的特殊格式代码
    /// </summary>
    public struct DimFormatCode
    {
        /// <summary>
        /// 倾斜度（∠）
        /// </summary>
        public static readonly string Angular=@"{\Fgdt;" + "a}";
        /// <summary>
        /// 垂直度（⊥）
        /// </summary>
        public static readonly string VerticalLine=@"{\Fgdt;" + "b}";
        /// <summary>
        /// 平面度（◇）
        /// </summary>
        public static readonly string Flatness=@"{\Fgdt;" + "c}";
        /// <summary>
        /// 面轮廓度（封闭的半圆）
        /// </summary>
        public static readonly string HalfCircleClosed=@"{\Fgdt;" + "d}";
        /// <summary>
        /// 圆度（○）
        /// </summary>
        public static readonly string SingleCircle=@"{\Fgdt;" + "e}";
        /// <summary>
        /// 平行度（∥）
        /// </summary>
        public static readonly string Parallel=@"{\Fgdt;" + "f}";
        /// <summary>
        /// 圆柱度
        /// </summary>
        public static readonly string Cylindricity=@"{\Fgdt;" + "g}";
        /// <summary>
        /// 圆跳动度（↗）
        /// </summary>
        public static readonly string CircularRunout=@"{\Fgdt;" + "h}";
        /// <summary>
        /// 对称度
        /// </summary>
        public static readonly string SymmetrySymbol=@"{\Fgdt;" + "i}";
        /// <summary>
        /// 位置度（⊕）
        /// </summary>
        public static readonly string Position=@"{\Fgdt;" + "j}";
        /// <summary>
        /// 线轮廓度（⌒）
        /// </summary>
        public static readonly string HalfCircle=@"{\Fgdt;" + "k}";
        /// <summary>
        /// 最小实体要求（带圆圈的L）
        /// </summary>
        public static readonly string CircleL=@"{\Fgdt;" + "l}";
        /// <summary>
        /// 最大实体要求（带圆圈的M）
        /// </summary>
        public static readonly string CircleM=@"{\Fgdt;" + "m}";
        /// <summary>
        /// 公差直径（φ）
        /// </summary>
        public static readonly string Diameter=@"{\Fgdt;" + "n}";
        /// <summary>
        /// 正方形（□）
        /// </summary>
        public static readonly string Square=@"{\Fgdt;" + "o}";
        /// <summary>
        /// 延伸公差带（带圆圈的P）
        /// </summary>
        public static readonly string CircleP=@"{\Fgdt;" + "p}";
        /// <summary>
        /// 中心线（C和L重叠）
        /// </summary>
        public static readonly string CenterLine=@"{\Fgdt;" + "q}";
        /// <summary>
        /// 同轴度（◎）
        /// </summary>
        public static readonly string TwoCircles=@"{\Fgdt;" + "r}";
        /// <summary>
        /// 不考虑特征尺寸（带圆圈的S）
        /// </summary>
        public static readonly string CircleS=@"{\Fgdt;" + "s}";
        /// <summary>
        /// 全跳动度（符号为两带箭头的斜线）
        /// </summary>
        public static readonly string TotalRunout=@"{\Fgdt;" + "t}";
        /// <summary>
        /// 直线度（―）
        /// </summary>
        public static readonly string Line=@"{\Fgdt;" + "u}";
        /// <summary>
        /// 机械制图中的柱形沉孔和锪平面孔
        /// </summary>
        public static readonly string CounterBore=@"{\Fgdt;" + "v}";
        /// <summary>
        /// 机械制图中的埋头孔（∨）
        /// </summary>
        public static readonly string CounterSink=@"{\Fgdt;" + "w}";
        /// <summary>
        /// 机械制图中的沉孔深度
        /// </summary>
        public static readonly string Depth=@"{\Fgdt;" + "x}";
        /// <summary>
        /// 锥形接续器符号
        /// </summary>
        public static readonly string ConicalTaper=@"{\Fgdt;" + "y}";
        /// <summary>
        /// 机械制图中的锥度（⊿）
        /// </summary>
        public static readonly string Slope=@"{\Fgdt;" + "z}";
    }

    /// <summary>
    /// 标注中的箭头符号
    /// </summary>
    public struct DimArrowBlock
    {
        /// <summary>
        /// 实心闭合
        /// </summary>
        public static readonly string ClosedFilled="";
        /// <summary>
        /// 点
        /// </summary>
        public static readonly string Dot="_DOT";
        /// <summary>
        /// 小点
        /// </summary>
        public static readonly string DotSmall="_DOTSMALL";
        /// <summary>
        /// 空心点
        /// </summary>
        public static readonly string DotBlank="_DOTBLANK";
        /// <summary>
        /// 原点标记
        /// </summary>
        public static readonly string Origin="_ORIGIN";
        /// <summary>
        /// 原点标记2
        /// </summary>
        public static readonly string Origin2="_ORIGIN2";
        /// <summary>
        /// 打开
        /// </summary>
        public static readonly string Open="_OPEN";
        /// <summary>
        /// 直角
        /// </summary>
        public static readonly string RightAngle="_OPEN90";
        /// <summary>
        /// 30度角
        /// </summary>
        public static readonly string Angle30="_OPEN30";
        /// <summary>
        /// 闭合
        /// </summary>
        public static readonly string Closed="_CLOSED";
        /// <summary>
        /// 空心小点
        /// </summary>
        public static readonly string DotSmallBlank="_SMALL";
        /// <summary>
        /// 无
        /// </summary>
        public static readonly string None="_NONE";
        /// <summary>
        /// 倾斜
        /// </summary>
        public static readonly string Oblique="_OBLIQUE";
        /// <summary>
        /// 实心框
        /// </summary>
        public static readonly string BoxFilled="_BOXFILLED";
        /// <summary>
        /// 框
        /// </summary>
        public static readonly string Box="_BOXBLANK";
        /// <summary>
        /// 空心闭合
        /// </summary>
        public static readonly string ClosedBlank="_CLOSEDBLANK";
        /// <summary>
        /// 实心基准三角形
        /// </summary>
        public static readonly string TriangleFilled="_DATUMFILLED";
        /// <summary>
        /// 基准三角形
        /// </summary>
        public static readonly string Triangle="_DATUMBLANK";
        /// <summary>
        /// 积分
        /// </summary>
        public static readonly string Integral="_INTEGRAL";
        /// <summary>
        /// 建筑标记
        /// </summary>
        public static readonly string ArchitecturalTick="_ARCHTICK";
    }
    /// <summary>
    /// AutoCAD自带的用于多重引线注释块的名称
    /// </summary>
    public struct LeaderBlockContent
    {
        /// <summary>
        /// 详细信息标注
        /// </summary>
        public static readonly string Detail="_DetailCallout";
        /// <summary>
        /// 方框（□）
        /// </summary>
        public static readonly string Box="_TagBox";
        /// <summary>
        /// 圆（○）
        /// </summary>
        public static readonly string Circle="_TagCircle";
        /// <summary>
        /// 正六边形
        /// </summary>
        public static readonly string Hexagon="_TagHexagon";
        /// <summary>
        /// 槽
        /// </summary>
        public static readonly string Slot="_TagSlot";
        /// <summary>
        /// 三角形（△）
        /// </summary>
        public static readonly string Triangle="_TagTriangle";
    }
    /// <summary>
    /// 标注操作类（含引线、形位公差）
    /// </summary>
    public static class DimTools
    {
        #region 标注系统变量
        /// <summary>
        /// 当前尺寸线箭头符号
        /// </summary>
        public static string ArrowBlock
        {
            //获取DIMBLK系统变量值，它表示尺寸线末端显示的箭头块
            get { return Application.GetSystemVariable("DIMBLK").ToString(); }
            set
            {
                //设置DIMBLK系统变量值
                Application.SetSystemVariable("DIMBLK", value);
            }
        }
        #endregion

        /// <summary>
        /// 获取与名称对应的箭头块的ObjectId
        /// </summary>
        /// <param name="db">数据库对象</param>
        /// <param name="arrowName">箭头名</param>
        /// <returns>返回指定箭头块的ObjectId</returns>
        public static ObjectId GetArrowObjectId(this Database db, string arrowName)
        {
            ObjectId arrId=ObjectId.Null;//存储箭头符号的ObjectId
            using (Transaction trans=db.TransactionManager.StartTransaction())
            {
                BlockTable bt=(BlockTable)trans.GetObject(db.BlockTableId, OpenMode.ForRead);
                //如果图形中存在指定名称的箭头块，则获取其ObjectId
                if (bt.Has(arrowName)) arrId = bt[arrowName];
                trans.Commit();
            }
            return arrId;//返回箭头块的ObjectId
        }
        /// <summary>
        /// 设置形位公差值
        /// </summary>
        /// <param name="frame">形位公差特征控制框对象</param>
        /// <param name="geometricSym">几何特征符号，表示公差的几何特征，例如位置、轮廓、形状、方向或跳动</param>
        /// <param name="torlerance">公差值</param>
        /// <param name="firstDatum">第一级基准要素</param>
        /// <param name="secondDatum">第二级基准要素</param>
        /// <param name="thirdDatum">第三级基准要素</param>
        public static void CreateTolerance(this FeatureControlFrame frame, string geometricSym, string torlerance, string firstDatum, string secondDatum, string thirdDatum)
        {
            if (frame == null) return;//特征控制框对象必须已定义，否则返回
            //设置形位公差值，各组成部分用竖线（%%v）分隔
            frame.Text = geometricSym + "%%v" + torlerance + "%%v" + firstDatum + "%%v" + secondDatum + "%%v" + thirdDatum;
        }
    }
}
﻿using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using Autodesk.AutoCAD.ApplicationServices;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.EditorInput;
using Autodesk.AutoCAD.Geometry;
using Autodesk.AutoCAD.Runtime;
using DotNetARX;
namespace DocManager
{
    public class DocManager
    {
        [CommandMethod("OpenDwg")]
        public void OpenDwg()
        {
            Editor ed = Application.DocumentManager.MdiActiveDocument.Editor;
            //获取文档管理器对象以打开Dwg文件
            DocumentCollection docs = Application.DocumentManager;
            //设置打开文件对话框的有关选项
            PromptOpenFileOptions opt = new PromptOpenFileOptions("\n请输入文件名：");
            opt.Filter = "图形(*.dwg)|*.dwg|图形(*.dxf)|*.dxf";
            opt.FilterIndex = 0;
            //根据打开文件对话框中用户的选择，获取文件名
            string filename = ed.GetFileNameForOpen(opt).StringResult;
            //打开所选择的Dwg文件
            Document doc = docs.Open(filename, true);
            //设置当前的活动文档为新打开的Dwg文件
            Application.DocumentManager.MdiActiveDocument = doc;
        }
        [CommandMethod("SaveDwg")]
        public void SaveDwg()
        {
            Document doc=Application.DocumentManager.MdiActiveDocument;
            //获取DWGTITLED系统变量，它指示当前图形是否已命名。
            object tiled=Application.GetSystemVariable("DWGTITLED");
            if (!doc.Saved()) return;//如果图形没有未保存的修改，则返回
            if (Convert.ToInt16(tiled) == 0)//如果图形没有被命名
                doc.Database.SaveAs("C:\\test.dwg", DwgVersion.Current);
            else
                doc.Save();//保存当前文档
        }
        [CommandMethod("CreateNewDwg", CommandFlags.Session)]
        public void CreateNewDwg()
        {
            string template="acad.dwt";//确定要使用的文档模板
            DocumentCollection docs=Application.DocumentManager;
            Document doc=docs.Add(template);//根据模板创建文档
            Database db=doc.Database;
            using (doc.LockDocument())//锁定文档
            {
                Transaction trans=db.TransactionManager.StartTransaction();
                Circle cir=new Circle();
                cir.Center = new Point3d(5, 5, 0);
                cir.Radius = 5;
                db.AddToModelSpace(cir);//将圆添加到文档的模型空间
                trans.Commit();
            }
        }
        [CommandMethod("CloseAllDwgs", CommandFlags.Session)]
        public void CloseAllDwgs()
        {
            DocumentCollection docs=Application.DocumentManager;
            foreach (Document doc in docs)//遍历打开的文档
            {
                //如果文档中有运行的命令（不包括CloseAllDwgs命令）
                if (doc.CommandInProgress != "" && doc.CommandInProgress != "CloseAllDwgs")
                    doc.SendCommand("\x03\x03");//向命令行发出两个Esc命令，终止命令的运行
                if (doc.IsReadOnly) doc.CloseAndDiscard();//如果是只读文件，直接关闭
                else //不是只读文件
                {
                    if (docs.MdiActiveDocument != doc)//如果不是当前文档，则切换成当前文档
                        docs.MdiActiveDocument = doc;
                    //如果文档有未保存的修改，则保存后关闭文档
                    if (doc.Saved()) doc.CloseAndSave(doc.Name);
                    else doc.CloseAndDiscard();//如果文档没有未保存的修改，则直接关闭
                }
            }
        }
    }
}
﻿using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using Autodesk.AutoCAD.ApplicationServices;
using Autodesk.AutoCAD.DatabaseServices;

namespace DotNetARX
{
    /// <summary>
    /// 文档操作类
    /// </summary>
    public static class DocumentTools
    {
        /// <summary>
        /// 确定文档中是否有未保存的修改。
        /// </summary>
        /// <param name="doc">文档对象</param>
        /// <returns>如果有未保存的修改，则返回true，否则返回false。</returns>
        public static bool Saved(this Document doc)
        {
            //获取DBMOD系统变量，它用来指示图形的修改状态
            object dbmod=Application.GetSystemVariable("DBMOD");
            //若DBMOD不为0，则表示图形已被修改但还未被保存
            if (Convert.ToInt16(dbmod) != 0) return true;
            else return false;//图形没有未保存的修改
        }

        /// <summary>
        /// 保存已有文档
        /// </summary>
        /// <param name="doc">文档对象</param>
        public static void Save(this Document doc)
        {
            doc.Database.SaveAs(doc.Name, DwgVersion.Current);
        }
    }
}
﻿using System.Collections.Generic;
using System.Runtime.InteropServices;
using Autodesk.AutoCAD.DatabaseServices;
using DotNetARX;
using Masterhe.OPM;
namespace XDataFilter
{
    public class DoorAtt : PropertyBase
    {
        SortedDictionary<string,double> doors=new SortedDictionary<string, double>();
        public override int PropertyCount
        {
            get
            {
                return 2;
            }
        }
        public override PropertyTypeEnum GetPropertyType(int nIndex)
        {
            //确定每个属性的类型
            switch (nIndex)
            {
                case 0:
                    return PropertyTypeEnum.PT_DropDownList;
                default:
                    return PropertyTypeEnum.PT_Normal;
            }
        }
        public override string GetCategoryName(int nIndex)
        {
            return "门属性";
        }
        public override bool IsPropertyReadOnly(int index)
        {
            return index == 1;
        }
        #region 必须重载的方法
        public override object GetCurrentValueData(int nIndex, DBObject pObj)
        {
            ObjectId id=pObj.ObjectId;
            TypedValueList xdata=pObj.GetXDataForApplication(Commands.appName);
            if (xdata == null) return null;
            switch (nIndex)
            {
                case 0:
                    return xdata[1].Value;
                default:
                    return xdata[2].Value;
            }
            
        }

        public override VarEnum GetCurrentValueType(int nIndex)
        {
            switch (nIndex)
            {
                case 0:
                    return VarEnum.VT_BSTR;
                default:
                    return VarEnum.VT_R8;
            }
        }

        public override string GetDescription(int nIndex)
        {
            switch (nIndex)
            {
                case 0:
                    return "指定门的类型";
                default:
                    return "指定门的价格";
            }
        }

        public override string GetDisplayName(int nIndex)
        {
            switch (nIndex)
            {
                case 0:
                    return "类型";
                default:
                    return "价格";
            }
        }

        public override void SetCurrentValueData(int nIndex, DBObject pObj, object objData)
        {
            ObjectId id=pObj.ObjectId;
            TypedValueList xdata=pObj.GetXDataForApplication(Commands.appName);
            if (xdata == null) return;
            switch (nIndex)
            {
                case 0:
                    string doorType=objData.ToString();
                    xdata[1] = new TypedValue((int)DxfCode.ExtendedDataAsciiString, doorType);
                    xdata[2] = new TypedValue((int)DxfCode.ExtendedDataReal,Commands.doors[doorType]);
                    break;
            }
            using (Transaction trans=id.Database.TransactionManager.StartTransaction())
            {
                id.RemoveXData(Commands.appName);
                id.AddXData(Commands.appName, xdata);
                trans.Commit();
            }            
        }
        #endregion
        #region 为PropertyTypeEnum.PT_DropDownList重载的方法
        List<string> listDoorTypes = null;
        public override int GetNumPropertyValues(int nIndex)
        {
            if (listDoorTypes == null)
            {
                listDoorTypes = new List<string>();
                listDoorTypes.AddRange(new string[] { "木门","铁门","铝合金门"});
            }
            return listDoorTypes.Count;
        }
        public override string GetPropValueName(int nIndex, int lValueIndex)
        {
            return listDoorTypes[lValueIndex].ToString();
        }
        public override object GetPropValueData(int nIndex, int lValueIndex)
        {
            return listDoorTypes[lValueIndex];
        }
        #endregion
    }
}
﻿using System;
using Autodesk.AutoCAD.ApplicationServices;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.EditorInput;
using Autodesk.AutoCAD.Geometry;
using Autodesk.AutoCAD.Runtime;
using DotNetARX;

namespace DrawSolid3d
{
    public class Draw3dSolid
    {
        [CommandMethod("CreateBase3D")]
        public void CreateBase3DTest()
        {
            // 创建长方体
            Draw3DTools.AddBox(new Point3d(2.0, 3.0, 0.0), -30.0, 20.0, 10.0);

            // 创建球体
            Draw3DTools.AddSphere(new Point3d(25.0, -35.0, 0.0), 15.0);

            // 创建圆柱体
            Draw3DTools.AddCylinder(new Point3d(50.0, 60.0, 0.0), 15.0, 30.0);

            // 创建圆锥体 
            Draw3DTools.AddCone(new Point3d(-20.0, -45.0, 0.0), 15.0, 30.0);

            // 创建圆环体
            Draw3DTools.AddTorus(new Point3d(80.0, 0.0, 0.0), 20.0, 3.0);

            // 创建楔体
            Draw3DTools.AddWedge(new Point3d(20.0, 50.0, 0.0), -30.0, 20.0, 10.0);

            // 创建棱柱
            Draw3DTools.AddPrism(new Point3d(90.0, 60.0, 0.0), 20, 5, 10.0);

            // 创建棱锥
            Draw3DTools.AddPyramid(new Point3d(90.0, -60.0, 0.0), -20, 5, 10.0);
        }

        // 截面
        [CommandMethod("CreateSection")]
        public void CreateSectionTest()
        {
            Database db = HostApplicationServices.WorkingDatabase;
            Editor ed = Application.DocumentManager.MdiActiveDocument.Editor;

            Solid3d solid3dEnt = new Solid3d();
            solid3dEnt.RecordHistory = true;
            solid3dEnt.CreateBox(30, 20, 10);
            Point3d cenPt = new Point3d(15, 10, 5);
            Matrix3d mt = ed.CurrentUserCoordinateSystem;
            mt = mt * Matrix3d.Displacement(cenPt - Point3d.Origin);
            solid3dEnt.TransformBy(mt);

            Plane testPlane = new Plane(new Point3d(0, 10, 10),
                new Point3d(0, 0, 5), new Point3d(15, 0, 10));
            // 得到截面面域
            Region regEnt = solid3dEnt.GetSection(testPlane);

            using (Transaction tr = db.TransactionManager.StartTransaction())
            {
                db.AddToModelSpace(solid3dEnt);
                db.AddToModelSpace(regEnt);
                tr.Commit();
            }
        }

        // 平面切割
        [CommandMethod("CreateSlice")]
        public void CreateSliceTest()
        {
            Database db = HostApplicationServices.WorkingDatabase;
            Editor ed = Application.DocumentManager.MdiActiveDocument.Editor;

            Solid3d solid3dEnt = new Solid3d();
            solid3dEnt.RecordHistory = true;
            solid3dEnt.CreateBox(30, 20, 10);
            Point3d cenPt = new Point3d(15, 10, 5);
            Matrix3d mt = ed.CurrentUserCoordinateSystem;
            mt = mt * Matrix3d.Displacement(cenPt - Point3d.Origin);
            solid3dEnt.TransformBy(mt);

            Plane testPlane = new Plane(new Point3d(0, 10, 10),
                new Point3d(0, 0, 5), new Point3d(15, 0, 10));

            // 切割实体
            solid3dEnt.Slice(testPlane);
            using (Transaction tr = db.TransactionManager.StartTransaction())
            {
                db.AddToModelSpace(solid3dEnt);
                tr.Commit();
            }
        }


        // 普通拉伸
        [CommandMethod("CreateExt1")]
        public void CreateExtTest1()
        {
            Editor ed = Application.DocumentManager.MdiActiveDocument.Editor;
            Database db = HostApplicationServices.WorkingDatabase;
            Matrix3d mt = ed.CurrentUserCoordinateSystem;

            Line lineEnt = new Line(new Point3d(10.0, 10.0, 0), new Point3d(20.0, 10.0, 0.0));
            Arc arcEnt = new Arc(new Point3d(15.0, 10.0, 0.0), Vector3d.ZAxis, 5.0, 0.0, Math.PI);
            lineEnt.TransformBy(mt);
            arcEnt.TransformBy(mt);

            DBObjectCollection ents = new DBObjectCollection();
            ents.Add(lineEnt);
            ents.Add(arcEnt);

            DBObjectCollection regions = Region.CreateFromCurves(ents);
            Region regionEnt = (Region)regions[0];

            Draw3DTools.AddExtrudedSolid(regionEnt, 20.0, 5 * Math.PI / 180);
            lineEnt.Dispose();
            arcEnt.Dispose();
            regionEnt.Dispose();
        }

        // 沿路径拉伸
        [CommandMethod("CreateExt2")]
        public void CreateExtTest2()
        {
            Editor ed = Application.DocumentManager.MdiActiveDocument.Editor;
            Database db = HostApplicationServices.WorkingDatabase;
            Matrix3d mt = ed.CurrentUserCoordinateSystem;

            Line lineEnt = new Line(new Point3d(0.0, 0.0, 0.0), new Point3d(10.0, 0.0, 0.0));
            Arc arcEnt = new Arc(new Point3d(5.0, 0.0, 0.0), Vector3d.ZAxis, 5.0, 0.0, Math.PI);
            Arc pathEnt = new Arc(new Point3d(50.0, 0, 0), new Vector3d(0.0, -1.0, 0.0),
                50.0, 0.0, Math.PI);

            lineEnt.TransformBy(mt);
            arcEnt.TransformBy(mt);
            pathEnt.TransformBy(mt);

            DBObjectCollection ents = new DBObjectCollection();
            ents.Add(lineEnt);
            ents.Add(arcEnt);

            DBObjectCollection regions = Region.CreateFromCurves(ents);
            Region regionEnt = (Region)regions[0];

            Draw3DTools.AddExtrudedSolid(regionEnt, pathEnt, 2 * Math.PI / 180);

            lineEnt.Dispose();
            arcEnt.Dispose();
            pathEnt.Dispose();
            regionEnt.Dispose();
        }

        // 旋转体
        [CommandMethod("CreateRev")]
        public void CreateRevTest()
        {
            Editor ed = Application.DocumentManager.MdiActiveDocument.Editor;
            Database db = HostApplicationServices.WorkingDatabase;
            Matrix3d mt = ed.CurrentUserCoordinateSystem;

            Line lineEnt = new Line(new Point3d(20.0, 0.0, 0.0), new Point3d(30.0, 0.0, 0.0));
            Arc arcEnt = new Arc(new Point3d(25.0, 0.0, 0.0), Vector3d.ZAxis, 5.0, 0.0, Math.PI);

            lineEnt.TransformBy(mt);
            arcEnt.TransformBy(mt);

            DBObjectCollection ents = new DBObjectCollection();
            ents.Add(lineEnt);
            ents.Add(arcEnt);

            DBObjectCollection regions = Region.CreateFromCurves(ents);
            Region regionEnt = (Region)regions[0];

            Draw3DTools.AddRevolvedSolid(regionEnt, Point3d.Origin.TransformBy(mt),
                (new Point3d(10.0, 0.0, 0.0)).TransformBy(mt), 0.5 * Math.PI);

            lineEnt.Dispose();
            arcEnt.Dispose();
            regionEnt.Dispose();
        }

        // 布尔运算
        [CommandMethod("NetBool")]
        public void NetBool()
        {
            Database db = HostApplicationServices.WorkingDatabase;
            Editor ed = Application.DocumentManager.MdiActiveDocument.Editor;

            Solid3d ent1 = new Solid3d();
            ent1.CreateBox(30.0, 20.0, 10.0);
            Point3d cenPt1 = new Point3d(15.0, 40.0, 5.0);
            Matrix3d mt1 = ed.CurrentUserCoordinateSystem;
            mt1 = mt1 * Matrix3d.Displacement(cenPt1 - Point3d.Origin);
            ent1.TransformBy(mt1);

            Solid3d ent2 = new Solid3d();
            ent2.CreateSphere(8.0);
            Point3d cenPt2 = new Point3d(30.0, 40.0, 10.0);
            Matrix3d mt2 = ed.CurrentUserCoordinateSystem;
            mt2 = mt2 * Matrix3d.Displacement(cenPt2 - Point3d.Origin);
            ent2.TransformBy(mt2);

            ent1.BooleanOperation(BooleanOperationType.BoolSubtract, ent2);

            using (Transaction tr = db.TransactionManager.StartTransaction())
            {
                db.AddToModelSpace(ent1);
                tr.Commit();
            }
        }

        // 扫琼(麦比乌斯环)
        [CommandMethod("CreateSweep")]
        public void CreateSweepTest()
        {
            Database db = HostApplicationServices.WorkingDatabase;
            
            // 路径曲线
            Arc pathEnt1 = new Arc(new Point3d(0, 0, 0), 5, 0, Math.PI);
            Arc pathEnt2 = new Arc(new Point3d(0, 0, 0), 5, Math.PI, 2 * Math.PI);

            // 截面实体
            Polyline sectionEnt1 = new Polyline();
            sectionEnt1.AddVertexAt(0, new Point2d(5.1, 1.0), 0, 0, 0);
            sectionEnt1.AddVertexAt(1, new Point2d(4.9, 1.0), 0, 0, 0);
            sectionEnt1.AddVertexAt(2, new Point2d(4.9, -1.0), 0, 0, 0);
            sectionEnt1.AddVertexAt(3, new Point2d(5.1, -1.0), 0, 0, 0);
            sectionEnt1.Closed = true;

            Polyline sectionEnt2 = new Polyline();
            sectionEnt2.AddVertexAt(0, new Point2d(-4.0, 0.1), 0, 0, 0);
            sectionEnt2.AddVertexAt(1, new Point2d(-6.0, 0.1), 0, 0, 0);
            sectionEnt2.AddVertexAt(2, new Point2d(-6.0, -0.1), 0, 0, 0);
            sectionEnt2.AddVertexAt(3, new Point2d(-4.0, -0.1), 0, 0, 0);
            sectionEnt2.Closed = true;

            // 旋转两个矩形
            Matrix3d mt = Matrix3d.Rotation(Math.PI / 2, Vector3d.XAxis,
                Point3d.Origin);
            sectionEnt1.TransformBy(mt);
            sectionEnt2.TransformBy(mt);

            // 扫琼选项
            SweepOptionsBuilder sweepOptBu = new SweepOptionsBuilder();
            sweepOptBu.TwistAngle = Math.PI / 2;
            SweepOptions sweepOpt = sweepOptBu.ToSweepOptions();

            // 扫琼
            Solid3d sweepEnt1 = new Solid3d();
            sweepEnt1.CreateSweptSolid(sectionEnt1, pathEnt1, sweepOpt);

            Solid3d sweepEnt2 = new Solid3d();
            sweepEnt2.CreateSweptSolid(sectionEnt2, pathEnt2, sweepOpt);

            sweepEnt1.BooleanOperation(BooleanOperationType.BoolUnite, sweepEnt2);
            sweepEnt1.ColorIndex = 1;

            using (Transaction tr = db.TransactionManager.StartTransaction())
            {
                db.AddToModelSpace(sweepEnt1);
                tr.Commit();
            }
        }

        // 放样(天圆地方)
        [CommandMethod("CreateLoft1")]
        public void CreateLoftTest1()
        {
            Database db = HostApplicationServices.WorkingDatabase;

            // 地方
            Polyline ent1 = new Polyline();
            ent1.AddVertexAt(0, new Point2d(50, 50), 0, 0, 0);
            ent1.AddVertexAt(1, new Point2d(-50, 50), 0, 0, 0);
            ent1.AddVertexAt(2, new Point2d(-50, -50), 0, 0, 0);
            ent1.AddVertexAt(3, new Point2d(50, -50), 0, 0, 0);
            ent1.Closed = true;

            // 天圆 
            Circle ent2 = new Circle(new Point3d(0, 0, 200), new Vector3d(0, 0, 1), 30);

            // 添加到实体数组
            Entity[] crossEnts = new Entity[2];
            crossEnts.SetValue(ent1, 0);
            crossEnts.SetValue(ent2, 1);

            // 空的引导线实体数组
            Entity[] guideCurs = new Entity[0];

            // 放样选项
            LoftOptions loftOpt = new LoftOptions();

            // 放样
            Solid3d loftEnt = new Solid3d();
            loftEnt.CreateLoftedSolid(crossEnts, guideCurs, null, loftOpt);

            using (Transaction tr = db.TransactionManager.StartTransaction())
            {
                db.AddToModelSpace(loftEnt);
                tr.Commit();
            }
        }

        // 放样(方圆90度弯头过渡管)
        [CommandMethod("CreateLoft2")]
        public void CreateLoftTest2()
        {
            Database db = HostApplicationServices.WorkingDatabase;

            Polyline ent1 = new Polyline();
            ent1.AddVertexAt(0, new Point2d(100, 100), 0, 0, 0);
            ent1.AddVertexAt(1, new Point2d(-100, 100), 0, 0, 0);
            ent1.AddVertexAt(2, new Point2d(-100, -100), 0, 0, 0);
            ent1.AddVertexAt(3, new Point2d(100, -100), 0, 0, 0);
            ent1.Closed = true;
            Circle ent2 = new Circle(new Point3d(300, 0, 300), new Vector3d(1, 0, 0), 60);

            Polyline ent3 = new Polyline();
            ent3.AddVertexAt(0, new Point2d(95, 95), 0, 0, 0);
            ent3.AddVertexAt(1, new Point2d(-95, 95), 0, 0, 0);
            ent3.AddVertexAt(2, new Point2d(-95, -95), 0, 0, 0);
            ent3.AddVertexAt(3, new Point2d(95, -95), 0, 0, 0);
            ent3.Closed = true;
            Circle ent4 = new Circle(new Point3d(300, 0, 300), new Vector3d(1, 0, 0), 55);

            Entity[] crossEnts1 = new Entity[2];
            crossEnts1.SetValue(ent1, 0);
            crossEnts1.SetValue(ent2, 1);

            Entity[] crossEnts2 = new Entity[2];
            crossEnts2.SetValue(ent3, 0);
            crossEnts2.SetValue(ent4, 1);

            Entity[] guideCurs = new Entity[0];

            Arc pathCur = new Arc(new Point3d(300, 0, 0), new Vector3d(0, -1, 0), 300,
                Math.PI / 2, Math.PI);

            LoftOptions loftOpt = new LoftOptions();

            Solid3d loftEnt1 = new Solid3d();
            loftEnt1.CreateLoftedSolid(crossEnts1, guideCurs, pathCur, loftOpt);

            Solid3d loftEnt2 = new Solid3d();
            loftEnt2.CreateLoftedSolid(crossEnts2, guideCurs, pathCur, loftOpt);

            loftEnt1.BooleanOperation(BooleanOperationType.BoolSubtract, loftEnt2);

            using (Transaction tr = db.TransactionManager.StartTransaction())
            {
                db.AddToModelSpace(loftEnt1);
                tr.Commit();
            }
        }
    }
}

﻿using System;
using Autodesk.AutoCAD.ApplicationServices;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.EditorInput;
using Autodesk.AutoCAD.Geometry;
using Autodesk.AutoCAD.Runtime;

namespace DotNetARX
{
    /// <summary>
    /// 3D操作类
    /// </summary>
    public static partial class Draw3DTools
    {
        /// <summary>
        /// 由角点、长度、宽度和高度在UCS中创建长方体
        /// </summary>
        /// <param name="cornerPt">角点</param>
        /// <param name="lengthX">长度</param>
        /// <param name="lengthY">宽度</param>
        /// <param name="lengthZ">高度</param>
        /// <returns>返回创建的长方体的Id</returns>
        public static ObjectId AddBox(Point3d cornerPt, double lengthX,
            double lengthY, double lengthZ)
        {
            Database db = HostApplicationServices.WorkingDatabase;
            Editor ed = Application.DocumentManager.MdiActiveDocument.Editor;

            if (Math.Abs(lengthX) < 0.00001 || Math.Abs(lengthY) < 0.00001 ||
                Math.Abs(lengthZ) < 0.00001)
            {
                ed.WriteMessage("\n参数不当,创建长方体失败！");
                return ObjectId.Null;
            }

            // 创建
            Solid3d ent = new Solid3d();
            ent.RecordHistory = true;
            ent.CreateBox(Math.Abs(lengthX), Math.Abs(lengthY), Math.Abs(lengthZ));

            // 位置调整
            Point3d cenPt = cornerPt + new Vector3d(0.5 * lengthX, 0.5 * lengthY, 0.5 * lengthZ);
            Matrix3d mt = ed.CurrentUserCoordinateSystem;
            mt = mt * Matrix3d.Displacement(cenPt - Point3d.Origin);
            ent.TransformBy(mt);

            ObjectId entId = ObjectId.Null;
            using (Transaction tr = db.TransactionManager.StartTransaction())
            {
                entId = db.AddToModelSpace(ent);
                tr.Commit();
            }          
            return entId;
        }

        /// <summary>
        /// 由底面中心点、半径和高度在UCS中创建圆柱体
        /// </summary>
        /// <param name="bottomCenPt">底面中心点</param>
        /// <param name="radius">底面半径</param>
        /// <param name="height">高度</param>
        /// <returns>返回创建的圆柱体的Id</returns>
        public static ObjectId AddCylinder(Point3d bottomCenPt, double radius, double height)
        {
            Database db = HostApplicationServices.WorkingDatabase;
            Editor ed = Application.DocumentManager.MdiActiveDocument.Editor;

            if (radius < 0.00001 || Math.Abs(height) < 0.00001)
            {
                ed.WriteMessage("\n参数不当,创建圆柱体失败！");
                return ObjectId.Null;
            }

            // 创建
            Solid3d ent = new Solid3d();
            ent.RecordHistory = true;
            ent.CreateFrustum(Math.Abs(height), radius, radius, radius);

            // 位置调整
            Point3d cenPt = bottomCenPt + new Vector3d(0.0, 0.0, 0.5 * height);
            Matrix3d mt = ed.CurrentUserCoordinateSystem;
            mt = mt * Matrix3d.Displacement(cenPt - Point3d.Origin);
            ent.TransformBy(mt);

            ObjectId entId = ObjectId.Null;
            using (Transaction tr = db.TransactionManager.StartTransaction())
            {
                entId = db.AddToModelSpace(ent);
                tr.Commit();
            }
            return entId;
        }

        /// <summary>
        /// 由底面中心点、半径和高度在UCS中创建圆锥体
        /// </summary>
        /// <param name="bottomCenPt">底面中心点</param>
        /// <param name="radius">底面半径</param>
        /// <param name="height">高度</param>
        /// <returns>返回创建的圆锥体的Id</returns>
        public static ObjectId AddCone(Point3d bottomCenPt, double radius, double height)
        {
            Database db = HostApplicationServices.WorkingDatabase;
            Editor ed = Application.DocumentManager.MdiActiveDocument.Editor;

            if (radius < 0.00001 || Math.Abs(height) < 0.00001)
            {
                ed.WriteMessage("\n参数不当,创建圆锥体失败！");
                return ObjectId.Null;
            }

            // 创建
            Solid3d ent = new Solid3d();
            ent.RecordHistory = true;
            ent.CreateFrustum(Math.Abs(height), radius, radius, 0);

            // 位置调整
            Point3d cenPt = bottomCenPt + new Vector3d(0.0, 0.0, 0.5 * height);
            Matrix3d mt = ed.CurrentUserCoordinateSystem;
            mt = mt * Matrix3d.Displacement(cenPt - Point3d.Origin);

            if (height < 0)
            {
                Plane miPlane = new Plane(bottomCenPt, bottomCenPt + new Vector3d(radius, 0.0, 0.0),
                bottomCenPt + new Vector3d(0.0, radius, 0.0));
                Matrix3d mtMirroring = Matrix3d.Mirroring(miPlane);
                mt = mt * Matrix3d.Mirroring(miPlane);
            }

            ent.TransformBy(mt);

            ObjectId entId = ObjectId.Null;
            using (Transaction tr = db.TransactionManager.StartTransaction())
            {
                entId = db.AddToModelSpace(ent);
                tr.Commit();
            }
            return entId;
        }

        /// <summary>
        /// 由中心点和半径在UCS中创建球体
        /// </summary>
        /// <param name="cenPt">中心点</param>
        /// <param name="radius">半径</param>
        /// <returns>返回创建的球体的Id</returns>
        public static ObjectId AddSphere(Point3d cenPt, double radius)
        {
            Database db = HostApplicationServices.WorkingDatabase;
            Editor ed = Application.DocumentManager.MdiActiveDocument.Editor;

            if (radius < 0.00001)
            {
                ed.WriteMessage("\n参数不当,创建球体失败！");
                return ObjectId.Null;
            }

            // 创建
            Solid3d ent = new Solid3d();
            ent.RecordHistory = true;
            ent.CreateSphere(radius);

            // 位置调整
            Matrix3d mt = ed.CurrentUserCoordinateSystem;
            mt = mt * Matrix3d.Displacement(cenPt - Point3d.Origin);
            ent.TransformBy(mt);

            ObjectId entId = ObjectId.Null;
            using (Transaction tr = db.TransactionManager.StartTransaction())
            {
                entId = db.AddToModelSpace(ent);
                tr.Commit();
            }
            return entId;
        }

        /// <summary>
        /// 由中心点、圆环半径和圆管半径在UCS中创建圆环体
        /// </summary>
        /// <param name="cenPt">中心点</param>
        /// <param name="majorRadius">圆环半径</param>
        /// <param name="minorRadius">圆管半径</param>
        /// <returns>返回创建的圆环体的Id</returns>
        public static ObjectId AddTorus(Point3d cenPt, double majorRadius, double minorRadius)
        {
            Database db = HostApplicationServices.WorkingDatabase;
            Editor ed = Application.DocumentManager.MdiActiveDocument.Editor;

            if (Math.Abs(majorRadius) < 0.00001 || minorRadius < 0.00001)
            {
                ed.WriteMessage("\n参数不当,创建圆锥体失败！");
                return ObjectId.Null;
            }

            try
            {
                // 创建
                Solid3d ent = new Solid3d();
                ent.RecordHistory = true;
                ent.CreateTorus(majorRadius, minorRadius);

                // 位置调整
                Matrix3d mt = ed.CurrentUserCoordinateSystem;
                mt = mt * Matrix3d.Displacement(cenPt - Point3d.Origin);
                ent.TransformBy(mt);

                ObjectId entId = ObjectId.Null;
                using (Transaction tr = db.TransactionManager.StartTransaction())
                {
                    entId = db.AddToModelSpace(ent);
                    tr.Commit();
                }
                return entId;
            }
            catch
            {
                ed.WriteMessage("\n参数不当,创建圆锥体失败！");
                return ObjectId.Null;
            }
        }

        /// <summary>
        /// 由角点、长度、宽度和高度在UCS中创建楔体
        /// </summary>
        /// <param name="cornerPt">角点</param>
        /// <param name="lengthAlongX">长度</param>
        /// <param name="lengthAlongY">宽度</param>
        /// <param name="lengthAlongZ">高度</param>
        /// <returns>返回创建的楔体的Id</returns>
        public static ObjectId AddWedge(Point3d cornerPt, double lengthAlongX,
            double lengthAlongY, double lengthAlongZ)
        {
            Database db = HostApplicationServices.WorkingDatabase;
            Editor ed = Application.DocumentManager.MdiActiveDocument.Editor;

            if (Math.Abs(lengthAlongX) < 0.00001 || Math.Abs(lengthAlongX) < 0.00001 || Math.Abs(lengthAlongX) < 0.00001)
            {
                ed.WriteMessage("\n参数不当,创建楔体失败！");
                return ObjectId.Null;
            }

            Solid3d ent = new Solid3d();
            ent.RecordHistory = true;
            ent.CreateWedge(Math.Abs(lengthAlongX), Math.Abs(lengthAlongY), Math.Abs(lengthAlongZ));

            // 位置调整
            Point3d cenPt = cornerPt + new Vector3d(0.5 * lengthAlongX, 0.5 * lengthAlongY, 0.5 * lengthAlongZ);
            Matrix3d mt = ed.CurrentUserCoordinateSystem;
            mt = mt * Matrix3d.Displacement(cenPt - Point3d.Origin);
            ent.TransformBy(mt);

            ObjectId entId = ObjectId.Null;
            using (Transaction tr = db.TransactionManager.StartTransaction())
            {
                entId = db.AddToModelSpace(ent);
                tr.Commit();
            }
            return entId;
        }

        /// <summary>
        /// 由底面中心点、高度、棱数和底面外接圆半径在UCS中创建棱柱
        /// </summary>
        /// <param name="bottomCenPt">底面中心点</param>
        /// <param name="height">高度</param>
        /// <param name="sides">棱数</param>
        /// <param name="radius">底面外接圆半径</param>
        /// <returns>返回创建的棱柱的Id</returns>
        public static ObjectId AddPrism(Point3d bottomCenPt, double height, int sides, double radius)
        {
            Database db = HostApplicationServices.WorkingDatabase;
            Editor ed = Application.DocumentManager.MdiActiveDocument.Editor;

            if (Math.Abs(height) < 0.00001 || radius < 0.00001 || sides < 3 || sides > 32)
            {
                ed.WriteMessage("\n参数不当,创建棱柱失败！");
                return ObjectId.Null;
            }

            // 创建
            Solid3d ent = new Solid3d();
            ent.RecordHistory = true;
            ent.CreatePyramid(Math.Abs(height), sides, radius, radius);

            // 位置调整
            Point3d cenPt = bottomCenPt + new Vector3d(0.0, 0.0, 0.5 * height);
            Matrix3d mt = ed.CurrentUserCoordinateSystem;
            mt = mt * Matrix3d.Displacement(cenPt - Point3d.Origin);
            ent.TransformBy(mt);

            ObjectId entId = ObjectId.Null;
            using (Transaction tr = db.TransactionManager.StartTransaction())
            {
                entId = db.AddToModelSpace(ent);
                tr.Commit();
            }
            return entId;
        }

        /// <summary>
        /// 由底面中心点、高度、棱数和底面外接圆半径创建棱锥
        /// </summary>
        /// <param name="bottomCenPt">底面中心点</param>
        /// <param name="height">高度</param>
        /// <param name="sides">棱数</param>
        /// <param name="radius">底面外接圆半径</param>
        /// <returns>返回创建的棱锥的Id</returns>
        public static ObjectId AddPyramid(Point3d bottomCenPt, double height, int sides, double radius)
        {
            Database db = HostApplicationServices.WorkingDatabase;
            Editor ed = Application.DocumentManager.MdiActiveDocument.Editor;

            if (Math.Abs(height) < 0.00001 || radius < 0.00001 || sides < 3 || sides > 32)
            {
                ed.WriteMessage("\n参数不当,创建棱柱失败！");
                return ObjectId.Null;
            }

            // 创建
            Solid3d ent = new Solid3d();
            ent.RecordHistory = true;
            ent.CreatePyramid(Math.Abs(height), sides, radius, 0);

            // 位置调整
            Point3d cenPt = bottomCenPt + new Vector3d(0.0, 0.0, 0.5 * height);
            Matrix3d mt = ed.CurrentUserCoordinateSystem;
            mt = mt * Matrix3d.Displacement(cenPt - Point3d.Origin);

            if (height < 0)
            {
                Plane miPlane = new Plane(bottomCenPt, bottomCenPt + new Vector3d(radius, 0.0, 0.0),
                bottomCenPt + new Vector3d(0.0, radius, 0.0));
                Matrix3d mtMirroring = Matrix3d.Mirroring(miPlane);
                mt = mt * Matrix3d.Mirroring(miPlane);
            }

            ent.TransformBy(mt);

            ObjectId entId = ObjectId.Null;
            using (Transaction tr = db.TransactionManager.StartTransaction())
            {
                entId = db.AddToModelSpace(ent);
                tr.Commit();
            }
            return entId;
        }

        /// <summary>
        /// 由截面面域、拉伸高度和拉伸角度创建拉伸体
        /// </summary>
        /// <param name="region">截面面域</param>
        /// <param name="height">拉伸高度</param>
        /// <param name="taperAngle">拉伸角度</param>
        /// <returns>返回创建的拉伸体的Id</returns>
        public static ObjectId AddExtrudedSolid(Region region, double height,
            double taperAngle)
        {
            Database db = HostApplicationServices.WorkingDatabase;
            Editor ed = Application.DocumentManager.MdiActiveDocument.Editor;

            try
            {
                Solid3d ent = new Solid3d();
                ent.Extrude(region, height, taperAngle);

                ObjectId entId = ObjectId.Null;
                using (Transaction tr = db.TransactionManager.StartTransaction())
                {
                    entId = db.AddToModelSpace(ent);
                    tr.Commit();
                }
                return entId;
            }
            catch
            {
                ed.WriteMessage("\n参数不当,创建拉伸体失败！");
                return ObjectId.Null;
            }
        }

        /// <summary>
        /// 由截面面域、拉伸路径曲线和拉伸角度创建拉伸体
        /// </summary>
        /// <param name="region">截面面域</param>
        /// <param name="path">拉伸路径曲线</param>
        /// <param name="taperAngle">拉伸角度</param>
        /// <returns>返回创建的拉伸体的Id</returns>
        public static ObjectId AddExtrudedSolid(Region region, Curve path,
            double taperAngle)
        {
            Database db = HostApplicationServices.WorkingDatabase;
            Editor ed = Application.DocumentManager.MdiActiveDocument.Editor;

            try
            {
                Solid3d ent = new Solid3d();
                ent.ExtrudeAlongPath(region, path, taperAngle);

                ObjectId entId = ObjectId.Null;
                using (Transaction tr = db.TransactionManager.StartTransaction())
                {
                    entId = db.AddToModelSpace(ent);
                    tr.Commit();
                }
                return entId;
            }
            catch
            {
                ed.WriteMessage("\n参数不当,创建拉伸体失败！");
                return ObjectId.Null;
            }
        }

        /// <summary>
        /// 由截面面域、旋转轴起点、旋转轴终点和旋转角度创建旋转体
        /// </summary>
        /// <param name="region">截面面域</param>
        /// <param name="axisPt1">旋转轴起点</param>
        /// <param name="axisPt2">旋转轴终点</param>
        /// <param name="angle">旋转角度</param>
        /// <returns>返回创建的旋转体的Id</returns>
        public static ObjectId AddRevolvedSolid(Region region, Point3d axisPt1,
            Point3d axisPt2, double angle)
        {
            Database db = HostApplicationServices.WorkingDatabase;
            Editor ed = Application.DocumentManager.MdiActiveDocument.Editor;

            try
            {
                Solid3d ent = new Solid3d();
                ent.Revolve(region, axisPt1, axisPt2 - axisPt1, angle);

                ObjectId entId = ObjectId.Null;
                using (Transaction tr = db.TransactionManager.StartTransaction())
                {
                    entId = db.AddToModelSpace(ent);
                    tr.Commit();
                }
                return entId;
            }
            catch
            {
                ed.WriteMessage("\n参数不当,创建旋转体失败！");
                return ObjectId.Null;
            }
        }

        /// <summary>
        /// 由布尔操作函数创建三维实体
        /// </summary>
        /// <param name="boolType">布尔操作类型</param>
        /// <param name="solid3dId1">参与操作的三维实体的Id</param>
        /// <param name="solid3dId2">参与操作的三维实体的Id</param>
        /// <returns>返回创建的三维实体的Id</returns>
        public static bool BoolSolid3dRegion(BooleanOperationType boolType,
            ObjectId solid3dId1, ObjectId solid3dId2)
        {
            Database db = HostApplicationServices.WorkingDatabase;
            Editor ed = Application.DocumentManager.MdiActiveDocument.Editor;

            using (Transaction trans = db.TransactionManager.StartTransaction())
            {
                try
                {
                    Entity ent1 = trans.GetObject(solid3dId1, OpenMode.ForWrite) as Entity;
                    Entity ent2 = trans.GetObject(solid3dId2, OpenMode.ForWrite) as Entity;

                    if (ent1 == null || ent2 == null)
                    {
                        ed.WriteMessage("\n布尔操作失败！");
                        return false;
                    }

                    if (ent1 is Solid3d & ent2 is Solid3d)
                    {
                        Solid3d solid3dEnt1 = (Solid3d)ent1;
                        Solid3d solid3dEnt2 = (Solid3d)ent2;
                        solid3dEnt1.BooleanOperation(boolType, solid3dEnt2);
                        ent2.Dispose();
                    }

                    if (ent1 is Region & ent2 is Region)
                    {
                        Region regionEnt1 = (Region)ent1;
                        Region regionEnt2 = (Region)ent2;
                        regionEnt1.BooleanOperation(boolType, regionEnt2);
                        ent2.Dispose();
                    }
                }
                catch
                {
                    ed.WriteMessage("\n布尔操作失败！");
                    return false;
                }
                trans.Commit();
                return true;
            }
        }
    }
}

﻿using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.ComponentModel;

namespace TabDialog
{
    public enum CityName
    {
        上海,
        北京,
        广州,
        其它
    }
    public class Drawing
    {
        [Category("基本信息"), Description("设置作者姓名"), DisplayName("姓名")]
        public string Name { get; set; }
        [Category("基本信息"), Description("设置作者年龄"), DisplayName("年龄")]
        public int Age { get; set; }
        [Category("基本信息"), Description("设置作者居住的城市"), DisplayName("居住城市")]
        public CityName City { get; set; }
        [Category("AutoCAD相关"), Description("设置AutoCAD的背景颜色"), DisplayName("背景颜色")]
        public System.Drawing.Color BackgroundColor { get; set; }
    }
}
﻿using System;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.Geometry;
using Autodesk.AutoCAD.GraphicsInterface;
using DotNetARX;

namespace XDataFilter
{
    public class DrawRule : DrawableOverrule
    {
        public override bool WorldDraw(Drawable drawable, WorldDraw wd)
        {
            //要绘制的对象强制转化为直线
            Line line=drawable as Line;
            //获取直线的起点、终点、长度
            Point3d startPoint=line.StartPoint;
            Point3d endPoint=line.EndPoint;
            double len=line.Length;
            //获取表示直线的方向向量
            Vector3d delta=line.Delta;
            //定义一个点集合，用于存储构成门框（矩形）的角点
            Point3dCollection pts=new Point3dCollection();
            Point3d pt1=startPoint - 0.05 * delta;
            Point3d pt2=pt1 - delta.Negate().RotateBy(Math.PI / 2, Vector3d.ZAxis);
            Point3d pt3=startPoint + delta.RotateBy(Math.PI / 2, Vector3d.ZAxis);
            pts.Add(startPoint);
            pts.Add(pt1);
            pts.Add(pt2);
            pts.Add(pt3);
            //绘制门框            
            wd.Geometry.Polygon(pts);
            //绘制表示门面的圆弧
            wd.Geometry.CircularArc(startPoint, len, Vector3d.ZAxis, delta, Math.PI / 2, ArcType.ArcSimple);
            //绘制结束，返回。若要绘制直线本身，则请调用下面一行代码
            return true;
            //return base.WorldDraw(drawable, wd);
        }

        public override int SetAttributes(Drawable drawable, DrawableTraits traits)
        {
            //由于我们只是改变直线的颜色，因此需要调用基类函数正常设置其它的属性
            int b=base.SetAttributes(drawable, traits);
            Line line=drawable as Line;
            ObjectId id=line.ObjectId;
            //获取直线的扩展数据
            TypedValueList xdata=line.GetXDataForApplication(Commands.appName);
            if (xdata != null)
            {
                string doorType=xdata[1].Value.ToString();
                switch (doorType)
                {
                    case "木门":
                        traits.Color = 1;//红色
                        break;
                    case "铁门":
                        traits.Color = 2;//黄色
                        break;
                    case "铝合金门":
                        traits.Color = 3;//绿色
                        break;
                }
            }
            return b;
        }
    }
}
﻿using System;
using Autodesk.AutoCAD.ApplicationServices;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.EditorInput;
using Autodesk.AutoCAD.Geometry;
using Autodesk.AutoCAD.Runtime;
using DotNetARX;
using ahlzl;

namespace DwawSolid3d
{
    public class Dwaw3dSolid
    {
        [CommandMethod("CreateBase3D")]
        public void CreateBase3DTest()
        {
            // 创建长方体
            
            Draw3DTools.AddBox(new Point3d(2.0, 3.0, 0.0), -30.0, 20.0, 10.0);
            // 创建球体
            Draw3DTools.AddSphere(new Point3d(25.0, -35.0, 0.0), 15.0);
            // 创建圆柱体
            Draw3DTools.AddCylinder(new Point3d(50.0, 60.0, 0.0), 15.0, 30.0);
            // 创建圆锥体 
            Draw3DTools.AddCone(new Point3d(-20.0, -45.0, 0.0), 15.0, 30.0);
            // 创建圆环体
            Draw3DTools.AddTorus(new Point3d(80.0, 0.0, 0.0), 20.0, 3.0);
            // 创建楔体
            Draw3DTools.AddWedge(new Point3d(20.0, 50.0, 0.0), -30.0, 20.0, 10.0);
            // 创建棱柱
            Draw3DTools.AddPrism(new Point3d(90.0, 60.0, 0.0), 20, 5, 10.0);
            // 创建棱锥
            Draw3DTools.AddPyramid(new Point3d(90.0, -60.0, 0.0), -20, 5, 10.0);
        }

        // 普通拉伸
        [CommandMethod("CreateExt1")]
        public void CreateExtTest1()
        {
            Editor ed = Application.DocumentManager.MdiActiveDocument.Editor;
            Database db = HostApplicationServices.WorkingDatabase;
            Matrix3d mt = ed.CurrentUserCoordinateSystem;

            Line lineEnt = new Line(new Point3d(10.0, 10.0, 0), new Point3d(20.0, 10.0,
        0.0));
            Arc arcEnt = new Arc(new Point3d(15.0, 10.0, 0.0), Vector3d.ZAxis, 5.0, 0.0,
        Math.PI);
            lineEnt.TransformBy(mt);
            arcEnt.TransformBy(mt);

            DBObjectCollection ents = new DBObjectCollection();
            ents.Add(lineEnt);
            ents.Add(arcEnt);

            DBObjectCollection regions = Region.CreateFromCurves(ents);
            Region regionEnt = (Region)regions[0];

            Draw3DTools.AddExtrudedSolid(regionEnt, 20.0, 5 * Math.PI / 180);
            lineEnt.Dispose();
            arcEnt.Dispose();
            regionEnt.Dispose();
        }

        // 沿路径拉伸
        [CommandMethod("CreateExt2")]
        public void CreateExtTest2()
        {
            Editor ed = Application.DocumentManager.MdiActiveDocument.Editor;
            Database db = HostApplicationServices.WorkingDatabase;
            Matrix3d mt = ed.CurrentUserCoordinateSystem;

            Line lineEnt = new Line(new Point3d(0.0, 0.0, 0.0), new Point3d(10.0, 0.0,
        0.0));
            Arc arcEnt = new Arc(new Point3d(5.0, 0.0, 0.0), Vector3d.ZAxis, 5.0, 0.0,
        Math.PI);
            Arc pathEnt = new Arc(new Point3d(50.0, 0, 0), new Vector3d(0.0, -1.0, 0.0),
                50.0, 0.0, Math.PI);

            lineEnt.TransformBy(mt);
            arcEnt.TransformBy(mt);
            pathEnt.TransformBy(mt);

            DBObjectCollection ents = new DBObjectCollection();
            ents.Add(lineEnt);
            ents.Add(arcEnt);

            DBObjectCollection regions = Region.CreateFromCurves(ents);
            Region regionEnt = (Region)regions[0];

            Draw3DTools.AddExtrudedSolid(regionEnt, pathEnt, 2 * Math.PI / 180);

            lineEnt.Dispose();
            arcEnt.Dispose();
            pathEnt.Dispose();
            regionEnt.Dispose();
        }

        // 旋转体
        [CommandMethod("CreateRev")]
        public void CreateRevTest()
        {
            Editor ed = Application.DocumentManager.MdiActiveDocument.Editor;
            Database db = HostApplicationServices.WorkingDatabase;
            Matrix3d mt = ed.CurrentUserCoordinateSystem;

            Line lineEnt = new Line(new Point3d(20.0, 0.0, 0.0), new Point3d(30.0, 0.0,
        0.0));
            Arc arcEnt = new Arc(new Point3d(25.0, 0.0, 0.0), Vector3d.ZAxis, 5.0, 0.0,
        Math.PI);

            lineEnt.TransformBy(mt);
            arcEnt.TransformBy(mt);

            DBObjectCollection ents = new DBObjectCollection();
            ents.Add(lineEnt);
            ents.Add(arcEnt);

            DBObjectCollection regions = Region.CreateFromCurves(ents);
            Region regionEnt = (Region)regions[0];

            Draw3DTools.AddRevolvedSolid(regionEnt, Point3d.Origin.TransformBy(mt),
                (new Point3d(10.0, 0.0, 0.0)).TransformBy(mt), 0.5 * Math.PI);

            lineEnt.Dispose();
            arcEnt.Dispose();
            regionEnt.Dispose();
        }

        // 布尔运算
        [CommandMethod("NetBool")]
        public void NetBoolTest()
        {
            Database db = HostApplicationServices.WorkingDatabase;
            Editor ed = Application.DocumentManager.MdiActiveDocument.Editor;

            Solid3d ent1 = new Solid3d();
            ent1.CreateBox(30.0, 20.0, 10.0);
            Point3d cenPt1 = new Point3d(15.0, 40.0, 5.0);
            Matrix3d mt1 = ed.CurrentUserCoordinateSystem;
            mt1 = mt1 * Matrix3d.Displacement(cenPt1 - Point3d.Origin);
            ent1.TransformBy(mt1);

            Solid3d ent2 = new Solid3d();
            ent2.CreateSphere(8.0);
            Point3d cenPt2 = new Point3d(30.0, 40.0, 10.0);
            Matrix3d mt2 = ed.CurrentUserCoordinateSystem;
            mt2 = mt2 * Matrix3d.Displacement(cenPt2 - Point3d.Origin);
            ent2.TransformBy(mt2);

            ent1.BooleanOperation(BooleanOperationType.BoolSubtract, ent2);

            using (Transaction tr = db.TransactionManager.StartTransaction())
            {
                db.AddToModelSpace(ent1);
                tr.Commit();
            }
        }

        // 扫琼(麦比乌斯环)
        [CommandMethod("CreateSweep")]
        public void CreateSweep()
        {
            Database db = HostApplicationServices.WorkingDatabase;

            // 路径曲线
            Arc pathEnt1 = new Arc(new Point3d(0, 0, 0), 5, 0, Math.PI);
            Arc pathEnt2 = new Arc(new Point3d(0, 0, 0), 5, Math.PI, 2 * Math.PI);

            // 截面实体
            Polyline sectionEnt1 = new Polyline();
            sectionEnt1.AddVertexAt(0, new Point2d(5.1, 1.0), 0, 0, 0);
            sectionEnt1.AddVertexAt(1, new Point2d(4.9, 1.0), 0, 0, 0);
            sectionEnt1.AddVertexAt(2, new Point2d(4.9, -1.0), 0, 0, 0);
            sectionEnt1.AddVertexAt(3, new Point2d(5.1, -1.0), 0, 0, 0);
            sectionEnt1.Closed = true;

            Polyline sectionEnt2 = new Polyline();
            sectionEnt2.AddVertexAt(0, new Point2d(-4.0, 0.1), 0, 0, 0);
            sectionEnt2.AddVertexAt(1, new Point2d(-6.0, 0.1), 0, 0, 0);
            sectionEnt2.AddVertexAt(2, new Point2d(-6.0, -0.1), 0, 0, 0);
            sectionEnt2.AddVertexAt(3, new Point2d(-4.0, -0.1), 0, 0, 0);
            sectionEnt2.Closed = true;

            // 旋转两个矩形
            Matrix3d mt = Matrix3d.Rotation(Math.PI / 2, Vector3d.XAxis,
                Point3d.Origin);
            sectionEnt1.TransformBy(mt);
            sectionEnt2.TransformBy(mt);

            // 扫琼选项
            SweepOptionsBuilder sweepOptBu = new SweepOptionsBuilder();
            sweepOptBu.TwistAngle = Math.PI / 2;
            SweepOptions sweepOpt = sweepOptBu.ToSweepOptions();

            // 扫琼
            Solid3d sweepEnt1 = Express3D.createSweptSolid(sectionEnt1, pathEnt1, sweepOpt);
            Solid3d sweepEnt2 = Express3D.createSweptSolid(sectionEnt2, pathEnt2, sweepOpt);

            // 并集
            sweepEnt1.BooleanOperation(BooleanOperationType.BoolUnite, sweepEnt2);
            sweepEnt1.ColorIndex = 1;

            // 添加到数据库
            using (Transaction tr = db.TransactionManager.StartTransaction())
            {
                db.AddToModelSpace(sweepEnt1);
                tr.Commit();
            }
        }

        // 放样(天圆地方)
        [CommandMethod("CreateLoft1")]
        public void CreateLoft1()
        {
            Database db = HostApplicationServices.WorkingDatabase;

            // 地方
            Polyline ent1 = new Polyline();
            ent1.AddVertexAt(0, new Point2d(50, 50), 0, 0, 0);
            ent1.AddVertexAt(1, new Point2d(-50, 50), 0, 0, 0);
            ent1.AddVertexAt(2, new Point2d(-50, -50), 0, 0, 0);
            ent1.AddVertexAt(3, new Point2d(50, -50), 0, 0, 0);
            ent1.Closed = true;

            // 天圆 
            Circle ent2 = new Circle(new Point3d(0, 0, 200), new Vector3d(0, 0, 1), 30);

            // 添加到实体数组
            Entity[] crossEnts = new Entity[2];
            crossEnts.SetValue(ent1, 0);
            crossEnts.SetValue(ent2, 1);

            // 空的引导线实体数组
            Entity[] guideCurs = new Entity[0];

            // 放样选项
            LoftOptions loftOpt = new LoftOptions();

            Solid3d loftEnt = Express3D.CreateLoftedSolid(crossEnts, guideCurs, null, loftOpt);
            // 添加到数据库
            using (Transaction tr = db.TransactionManager.StartTransaction())
            {
                db.AddToModelSpace(loftEnt);
                tr.Commit();
            }
        }

        // 放样(方圆90度弯头过渡管)
        [CommandMethod("CreateLoft2")]
        public void CreateLoft2()
        {
            Database db = HostApplicationServices.WorkingDatabase;

            Polyline ent1 = new Polyline();
            ent1.AddVertexAt(0, new Point2d(10.0, 10.0), 0.0, 0.0, 0.0);
            ent1.AddVertexAt(1, new Point2d(-10.0, 10.0), 0.0, 0.0, 0.0);
            ent1.AddVertexAt(2, new Point2d(-10.0, -10.0), 0.0, 0.0, 0.0);
            ent1.AddVertexAt(3, new Point2d(10.0, -10.0), 0.0, 0.0, 0.0);
            ent1.Closed = true;
            Circle ent2 = new Circle(new Point3d(30.0, 0.0, 30.0), new Vector3d(1.0, 0.0, 0.0), 6.0);

            Polyline ent3 = new Polyline();
            ent3.AddVertexAt(0, new Point2d(9.5, 9.5), 0.0, 0.0, 0.0);
            ent3.AddVertexAt(1, new Point2d(-9.5, 9.5), 0.0, 0.0, 0.0);
            ent3.AddVertexAt(2, new Point2d(-9.5, -9.5), 0.0, 0.0, 0.0);
            ent3.AddVertexAt(3, new Point2d(9.5, -9.5), 0.0, 0.0, 0.0);
            ent3.Closed = true;
            Circle ent4 = new Circle(new Point3d(30.0, 0.0, 30.0), new Vector3d(1.0, 0.0, 0.0), 5.5);

            Entity[] crossEnts1 = new Entity[2];
            crossEnts1.SetValue(ent1, 0);
            crossEnts1.SetValue(ent2, 1);

            Entity[] crossEnts2 = new Entity[2];
            crossEnts2.SetValue(ent3, 0);
            crossEnts2.SetValue(ent4, 1);

            Entity[] guideCurs = new Entity[0];

            Arc pathCur = new Arc(new Point3d(30.0, 0.0, 0.0), new Vector3d(0.0, -1.0, 0.0), 30.0,
                Math.PI / 2, Math.PI);

            LoftOptions loftOpt = new LoftOptions();

            Solid3d loftEnt1 = Express3D.CreateLoftedSolid(crossEnts1, guideCurs, pathCur, loftOpt);
            Solid3d loftEnt2 = Express3D.CreateLoftedSolid(crossEnts2, guideCurs, pathCur, loftOpt);

            loftEnt1.BooleanOperation(BooleanOperationType.BoolSubtract, loftEnt2);

            // 添加到数据库
            using (Transaction tr = db.TransactionManager.StartTransaction())
            {
                db.AddToModelSpace(loftEnt1);
                tr.Commit();
            }
        }
    }
}
﻿using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;

namespace DwawSolid3d
{
    public class DwawSolid3d
    {

    }
}
﻿using System.Collections.Generic;
using System.Linq;
using Autodesk.AutoCAD.ApplicationServices;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.Geometry;
using Autodesk.AutoCAD.Runtime;
using DotNetARX;
namespace DynBlock
{
    public class DynBlock
    {
        [CommandMethod("CountDynBlock")]
        public void CountDynBlock()
        {
            Database db=HostApplicationServices.WorkingDatabase;
            using (Transaction trans=db.TransactionManager.StartTransaction())
            {
                //选取模型空间中的Door动态块，并限定其Flip vertical属性为1（向右开的门）
                var doors=from d in db.GetEntsInModelSpace<BlockReference>()
                          where d.GetBlockName() == "Door" && d.ObjectId.GetDynBlockValue("Flip vertical") == "1"
                          select d;
                //显示向右开的门的个数
                Application.ShowAlertDialog("向右开的门共有" + doors.Count() + "个");
                trans.Commit();
            }
        }

        [CommandMethod("InsertDynBlock")]
        public void InsertDynBlock()
        {
            Database db=HostApplicationServices.WorkingDatabase;
            using (Transaction trans=db.TransactionManager.StartTransaction())
            {
                ObjectId model=db.GetModelSpaceId();//获取模型空间的ObjectId
                //表示块静态属性的字典对象
                Dictionary<string,string> atts=new Dictionary<string, string>();
                //添加门的各种静态属性
                atts.Add("SYM.", "2");
                atts.Add("WIDTH", "0.8m");
                atts.Add("HEIGHT", "2m");
                atts.Add("STYLE", "ONE PANEL");
                atts.Add("REF#", "TS 1040");
                atts.Add("MANUFACTURE", "TUR STYLE");
                atts.Add("COST", "200.00");
                //在模型空间的Doors层上插入表示门的Door块，插入点为原点，不旋转，不缩放
                ObjectId blockId=model.InsertBlockReference("Doors", "Door", Point3d.Origin, new Scale3d(), 0, atts);
                //设置门的动态属性，宽度为0.8个单位，垂直方向翻转
                blockId.SetDynBlockValue("Door Width", 0.8);
                blockId.SetDynBlockValue("Flip vertical", 1);
                trans.Commit();
            }
        }
    }
}
﻿using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using Autodesk.AutoCAD.Runtime;
using Autodesk.AutoCAD.EditorInput;
using Autodesk.AutoCAD.ApplicationServices;
using DotNetARX;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.Internal;
using System.Drawing;
using System.IO;
namespace EditAndPreviewBlock
{
    public class EditAndPreviewBlock
    {
        [CommandMethod("GenerateBlockPreview")]
        public void GenerateBlockPreviews()
        {
            Database db = HostApplicationServices.WorkingDatabase;
            Editor ed = Application.DocumentManager.MdiActiveDocument.Editor;
            PromptFileNameResult result = ed.GetFileNameForOpen("请选择需要预览的文件");
            if (result.Status != PromptStatus.OK) return;
            string filename=result.StringResult;
            string path = Path.GetDirectoryName(filename)+"\\"+Path.GetFileNameWithoutExtension(filename) + " icons";
            if (!Directory.Exists(path)) Directory.CreateDirectory(path);
            using (Transaction trans=db.TransactionManager.StartTransaction())
            {
                db.ImportBlocksFromDwg(result.StringResult);
                //打开块表
                BlockTable bt = (BlockTable)trans.GetObject(db.BlockTableId, OpenMode.ForRead);
                //循环遍历块表中的块表记录
                foreach (ObjectId blockRecordId in bt)
                {
                    //打开块表记录对象
                    BlockTableRecord btr = (BlockTableRecord)trans.GetObject(blockRecordId, OpenMode.ForRead);
                    //在组合框中只加入非匿名块和非布局块的名称
                    if (btr.IsAnonymous || btr.IsLayout || !btr.HasPreviewIcon) continue;
                    Bitmap preview=BlockThumbnailHelper.GetBlockThumbanail(btr.ObjectId);                    
                    preview.Save(path+"\\"+btr.Name + ".bmp");
                }                
                trans.Commit();
            }
        }
    }
}
﻿using System;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.Geometry;
using Autodesk.AutoCAD.Runtime;
using DotNetARX;
namespace EllipseAndSpline
{
    public class EllipseAndSpline
    {
        [CommandMethod("AddEllipse")]
        public void AddEllipse()
        {
            Database db=HostApplicationServices.WorkingDatabase;
            using (Transaction trans=db.TransactionManager.StartTransaction())
            {
                Vector3d majorAxis=new Vector3d(40, 0, 0);//长轴端点
                //使用中心点、所在平面、长轴矢量和半径比例(0.5)创建一个椭圆
                Ellipse ellipse1=new Ellipse(Point3d.Origin, Vector3d.ZAxis, majorAxis, 0.5, 0, 2 * Math.PI);
                Ellipse ellipse2=new Ellipse();//新建一个椭圆
                //定义外接矩形的两个角点
                Point3d pt1=new Point3d(-40, -40, 0);
                Point3d pt2=new Point3d(40, 40, 0);
                //根据外接矩形创建椭圆
                ellipse2.CreateEllipse(pt1, pt2);
                //创建椭圆弧
                majorAxis = new Vector3d(0, 40, 0);
                Ellipse ellipseArc=new Ellipse(Point3d.Origin, Vector3d.ZAxis, majorAxis, 0.25, Math.PI, 2 * Math.PI);
                //添加实体到模型空间
                db.AddToModelSpace(ellipse1, ellipse2, ellipseArc);
                trans.Commit();
            }
        }

        [CommandMethod("AddSpline")]
        public void AddSpline()
        {
            Database db=HostApplicationServices.WorkingDatabase;
            using (Transaction trans=db.TransactionManager.StartTransaction())
            {
                //使用样本点直接创建4阶样条曲线
                Point3dCollection pts=new Point3dCollection();
                pts.Add(new Point3d(0, 0, 0));
                pts.Add(new Point3d(10, 30, 0));
                pts.Add(new Point3d(60, 80, 0));
                pts.Add(new Point3d(100, 100, 0));
                Spline spline1=new Spline(pts, 4, 0);
                //根据起点和终点为的切线方向创建样条曲线
                Vector3d startTangent=new Vector3d(5, 1, 0);
                Vector3d endTangent=new Vector3d(5, 1, 0);
                pts[1] = new Point3d(30, 10, 0);
                pts[2] = new Point3d(80, 60, 0);
                Spline spline2=new Spline(pts, startTangent, endTangent, 4, 0);
                db.AddToModelSpace(spline1, spline2);
                trans.Commit();
            }
        }
    }
}
﻿using System;
using Autodesk.AutoCAD.ApplicationServices;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.EditorInput;
using Autodesk.AutoCAD.Geometry;
using Autodesk.AutoCAD.GraphicsInterface;
using Autodesk.AutoCAD.Runtime;

namespace UseEntityJig
{
    class EllipseJig : EntityJig
    {
        // 声明全局变量.
        private Point3d m_CenterPt, m_MajorPt;
        private Vector3d m_Normal, m_MajorAxis;
        private int m_PromptCounter;
        private double m_OtherAxisLength, m_RadiusRatio;
        private double m_StartAng, m_EndAng, m_ang1, m_ang2;

        // 派生类的构造函数.
        public EllipseJig(Point3d center, Vector3d vec)
            : base(new Ellipse())
        {
            m_CenterPt = center;
            m_Normal = vec;
        }

        protected override bool Update()
        {
            if (m_PromptCounter == 0)
            {
                // 第一次拖拽时，椭圆的半径比为1，屏幕上显示的是一个圆.
                m_RadiusRatio = 1;
                m_MajorAxis = m_MajorPt - m_CenterPt;
                m_StartAng = 0;
                m_EndAng = 2 * Math.PI;
            }
            else if (m_PromptCounter == 1)
            {
                // 第二次拖拽时，修改了椭圆的半径比，屏幕上显示的是一个完整椭圆.
                m_RadiusRatio = m_OtherAxisLength / m_MajorAxis.Length;
            }
            else if (m_PromptCounter == 2)
            {
                // 第三次拖拽时，修改了椭圆的起初角度，屏幕上显示的是一个终止角度为360度的椭圆弧.
                m_StartAng = m_ang1;
            }
            else if (m_PromptCounter == 3)
            {
                // 第四次拖拽时，修改了椭圆的终止角度，屏幕上显示的是一个最终的椭圆弧.
                m_EndAng = m_ang2;
            }

            try
            {
                if (m_RadiusRatio < 1)
                    // 更新椭圆的参数.
                    ((Ellipse)(Entity)).Set(m_CenterPt, m_Normal, m_MajorAxis, m_RadiusRatio, m_StartAng, m_EndAng);
                else
                {
                    // 如另一条半轴长度超过椭圆弧长轴方向矢量的长度，则要重新定义椭圆弧长轴方向矢量的方向和长度.
                    Vector3d mMajorAxis2 = m_MajorAxis.RotateBy(0.5 * Math.PI, Vector3d.ZAxis).DivideBy(1 / m_RadiusRatio);
                    // 更新椭圆的参数.
                    ((Ellipse)(Entity)).Set(m_CenterPt, m_Normal, mMajorAxis2, 1 / m_RadiusRatio, m_StartAng, m_EndAng);
                }
            }
            catch
            {
                // 此处不需要处理.
            }
            return true;
        }

        protected override SamplerStatus Sampler(JigPrompts prompts)
        {
            if (m_PromptCounter == 0)
            {
                // 定义一个点拖动交互类.
                JigPromptPointOptions optJigPoint = new JigPromptPointOptions("\n请指定椭圆弧轴上一点");
                // 设置拖拽的光标类型.
                optJigPoint.Cursor = CursorType.RubberBand;
                // 设置拖动光标基点.
                optJigPoint.BasePoint = m_CenterPt;
                optJigPoint.UseBasePoint = true;
                // 用AcquirePoint函数得到用户输入的点.
                PromptPointResult resJigPoint = prompts.AcquirePoint(optJigPoint);
                Point3d curPt = resJigPoint.Value;

                if (curPt != m_MajorPt)
                {
                    // 保存当前点.
                    m_MajorPt = curPt;
                }
                else
                {
                    return SamplerStatus.NoChange;
                }

                if (resJigPoint.Status == PromptStatus.Cancel)
                {
                    return SamplerStatus.Cancel;
                }
                else
                {
                    return SamplerStatus.OK;
                }
            }
            else if (m_PromptCounter == 1)
            {
                // 定义一个距离拖动交互类.
                JigPromptDistanceOptions optJigDis = new JigPromptDistanceOptions
                    ("\n请指定另一条半轴的长度");
                // 设置对拖拽的约束:禁止输入零和负值.
                optJigDis.UserInputControls = UserInputControls.NoZeroResponseAccepted |
                    UserInputControls.NoNegativeResponseAccepted;
                // 设置拖拽的光标类型.
                optJigDis.Cursor = CursorType.RubberBand;
                // 设置拖动光标基点.
                optJigDis.BasePoint = m_CenterPt;
                optJigDis.UseBasePoint = true;

                // 用AcquireDistance函数得到用户输入的距离值.
                PromptDoubleResult resJigDis = prompts.AcquireDistance(optJigDis);
                double radiusRatioTemp = resJigDis.Value;

                if (radiusRatioTemp != m_OtherAxisLength)
                {
                    // 保存当前距离值.
                    m_OtherAxisLength = radiusRatioTemp;
                }
                else
                {
                    return SamplerStatus.NoChange;
                }

                if (resJigDis.Status == PromptStatus.Cancel)
                {
                    return SamplerStatus.Cancel;
                }
                else
                {
                    return SamplerStatus.OK;
                }
            }
            else if (m_PromptCounter == 2)
            {
                // 设置椭圆弧0度基准角.
                double baseAng;
                Vector2d mMajorAxis2d = new Vector2d(m_MajorAxis.X, m_MajorAxis.Y);
                if (m_RadiusRatio < 1)
                {
                    baseAng = mMajorAxis2d.Angle;
                }
                else
                {
                    baseAng = mMajorAxis2d.Angle + 0.5 * Math.PI;
                }

                // 设置系统变量“ANGBASE”.
                Application.SetSystemVariable("ANGBASE", baseAng);
                // 定义一个角度拖动交互类.
                JigPromptAngleOptions optJigAngle1 = new JigPromptAngleOptions("\n请指定椭圆弧的起始角度");
                // 设置拖拽的光标类型.
                optJigAngle1.Cursor = CursorType.RubberBand;
                // 设置拖动光标基点.
                optJigAngle1.BasePoint = m_CenterPt;
                optJigAngle1.UseBasePoint = true;

                // 用AcquireAngle函数得到用户输入的角度值.
                PromptDoubleResult resJigAngle1 = prompts.AcquireAngle(optJigAngle1);
                m_ang1 = resJigAngle1.Value;

                if (m_StartAng != m_ang1)
                {
                    // 保存当前角度值.
                    m_StartAng = m_ang1;
                }
                else
                {
                    return SamplerStatus.NoChange;
                }

                if (resJigAngle1.Status == PromptStatus.Cancel)
                {
                    return SamplerStatus.Cancel;
                }
                else
                {
                    return SamplerStatus.OK;
                }
            }
            else if (m_PromptCounter == 3)
            {
                // 定义一个角度拖动交互类.
                JigPromptAngleOptions optJigAngle2 = new JigPromptAngleOptions("\n请指定椭圆弧的终止角度");
                // 设置拖拽的光标类型.
                optJigAngle2.Cursor = CursorType.RubberBand;
                // 设置拖动光标基点.
                optJigAngle2.BasePoint = m_CenterPt;
                optJigAngle2.UseBasePoint = true;

                // 用AcquireAngle函数得到用户输入的角度值.
                PromptDoubleResult resJigAngle2 = prompts.AcquireAngle(optJigAngle2);
                m_ang2 = resJigAngle2.Value;

                if (m_EndAng != m_ang2)
                {
                    // 保存当前角度值.
                    m_EndAng = m_ang2;
                }
                else
                {
                    return SamplerStatus.NoChange;
                }

                if (resJigAngle2.Status == PromptStatus.Cancel)
                {
                    return SamplerStatus.Cancel;
                }
                else
                {
                    return SamplerStatus.OK;
                }
            }
            else
            {
                return SamplerStatus.NoChange;
            }
        }

        // GetEntity函数用于得到派生类的实体.
        public Entity GetEntity()
        {
            return Entity;
        }

        // setPromptCounter过程用于控制不同的拖拽.
        public void setPromptCounter(int i)
        {
            m_PromptCounter = i;
        }
    }
}
﻿using System;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.Geometry;

namespace DotNetARX
{
    /// <summary>
    /// 椭圆操作类
    /// </summary>
    public static class EllipseTools
    {
        /// <summary>
        /// 根据外接矩形创建椭圆
        /// </summary>
        /// <param name="ellipse">椭圆对象</param>
        /// <param name="pt1">外接矩形的角点</param>
        /// <param name="pt2">外接矩形的角点</param>
        public static void CreateEllipse(this Ellipse ellipse, Point3d pt1, Point3d pt2)
        {
            //椭圆的中心点
            Point3d center=GeTools.MidPoint(pt1, pt2);
            Vector3d normal=Vector3d.ZAxis;//法向量
            //椭圆1/2长轴的矢量，矢量的起点为椭圆的中心，终点为椭圆长轴的一个端点
            Vector3d majorAxis=new Vector3d(Math.Abs(pt1.X - pt2.X) / 2, 0, 0);
            //椭圆短轴与长轴的长度比例
            double ratio=Math.Abs((pt1.Y - pt2.Y) / (pt1.X - pt2.X));
            //设置椭圆的参数
            ellipse.Set(center, normal, majorAxis, ratio, 0, 2 * Math.PI);
        }
    }
}
﻿using System;
using Autodesk.AutoCAD.ApplicationServices;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.EditorInput;
using Autodesk.AutoCAD.Geometry;
using Autodesk.AutoCAD.GraphicsInterface;

namespace UseDrawJig
{
    class ElRecJig : DrawJig
    {
        public Ellipse m_Ellipse;
        private Polyline m_PolyLine;
        private Point3d m_Pt1, m_Pt2;

        // 派生类的构造函数.
        public ElRecJig(Point3d pt1, Ellipse ellipse, Polyline polyline)
        {
            m_Pt1 = pt1;
            m_Ellipse = ellipse;
            m_PolyLine = polyline;
        }

        protected override bool WorldDraw(WorldDraw draw)
        {
            draw.Geometry.Draw(m_Ellipse);
            draw.Geometry.Draw(m_PolyLine);
            return true;
        }

        protected override SamplerStatus Sampler(JigPrompts prompts)
        {
            Editor ed = Application.DocumentManager.MdiActiveDocument.Editor;
            Matrix3d mt = ed.CurrentUserCoordinateSystem;

            JigPromptPointOptions optJigPoint = new JigPromptPointOptions
                ("\n请指定矩形的另一角点:");
            optJigPoint.UserInputControls =
                UserInputControls.Accept3dCoordinates
                | UserInputControls.NoZeroResponseAccepted
                | UserInputControls.NoNegativeResponseAccepted;
            optJigPoint.Cursor = CursorType.Crosshair;

            // 基点必须是WCS点. 
            optJigPoint.BasePoint = m_Pt1.TransformBy(mt);
            optJigPoint.UseBasePoint = true;

            PromptPointResult resJigPoint = prompts.AcquirePoint(optJigPoint);
            Point3d tempPt = resJigPoint.Value;

            if (resJigPoint.Status == PromptStatus.Cancel)
            {
                return SamplerStatus.Cancel;
            }

            if (m_Pt2 != tempPt)
            {
                m_Pt2 = tempPt;
                // 将WCS点转化为UCS点.
                Point3d ucsPt2 = m_Pt2.TransformBy(mt.Inverse());

                // 更新矩形参数.
                m_PolyLine.Normal = Vector3d.ZAxis;
                m_PolyLine.Elevation = 0;
                m_PolyLine.SetPointAt(0, new Point2d(m_Pt1.X, m_Pt1.Y));
                m_PolyLine.SetPointAt(1, new Point2d(ucsPt2.X, m_Pt1.Y));
                m_PolyLine.SetPointAt(2, new Point2d(ucsPt2.X, ucsPt2.Y));
                m_PolyLine.SetPointAt(3, new Point2d(m_Pt1.X, ucsPt2.Y));
                m_PolyLine.TransformBy(mt);

                // 更新椭圆参数.
                Point3d cenPt = MidPoint(m_Pt1.TransformBy(mt), m_Pt2);
                Point3d majorPt = new Point3d(ucsPt2.X, m_Pt1.Y, 0);
                Vector3d vecX = MidPoint(majorPt, ucsPt2).TransformBy(mt) - cenPt;

                try
                {
                    if (Math.Abs(ucsPt2.X - m_Pt1.X) < 0.0000001 |
                        Math.Abs(ucsPt2.Y - m_Pt1.Y) < 0.0000001)
                    {
                        m_Ellipse = new Ellipse(Point3d.Origin, Vector3d.ZAxis,
                            new Vector3d(0.00000001, 0, 0), 1, 0, 0);
                    }
                    else
                    {
                        double radiusRatio = Math.Abs((ucsPt2.X - m_Pt1.X) /
                            (ucsPt2.Y - m_Pt1.Y));

                        if (radiusRatio < 1)
                        {
                            majorPt = new Point3d(m_Pt1.X, ucsPt2.Y, 0);
                            vecX = MidPoint(majorPt, ucsPt2).TransformBy(mt) - cenPt;
                        }
                        else
                        {
                            radiusRatio = 1 / radiusRatio;
                        }
                        m_Ellipse.Set(cenPt, mt.CoordinateSystem3d.Zaxis, vecX,
                            radiusRatio, 0, 2 * Math.PI);
                    }
                }
                catch { }
                return SamplerStatus.OK;
            }
            else
            {
                return SamplerStatus.NoChange;
            }
        }

        private Point3d MidPoint(Point3d pt1, Point3d pt2)
        {
            return new Point3d((pt1.X + pt2.X) / 2, (pt1.Y + pt2.Y) / 2,
                (pt1.Z + pt2.Z) / 2);
        }
    }
}



﻿using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Windows.Forms;

namespace SQLCAD
{
    public partial class EmpForm : Form
    {
        public EmpForm()
        {
            InitializeComponent();
        }

        private void buttonOK_Click(object sender, EventArgs ex)
        {
            using (var office=new officeDataContext())//连接SQLServer数据库
            {
                //生成一个新的员工对象
                var newEmp=new Employee
                {
                    Last_Name = this.textBoxLastName.Text,
                    First_Name = this.textBoxFirstName.Text,
                    Room_No = this.textBoxRoomNumber.Text
                };
                office.Employee.InsertOnSubmit(newEmp); //将新员工添加到Employee表中
                office.SubmitChanges();  //提交更改到数据库
            }
            this.Dispose();//关闭窗体，返回到AutoCAD中
        }
    }
}
﻿namespace SQLCAD
{
    partial class EmpForm
    {
        /// <summary>
        /// Required designer variable.
        /// </summary>
        private System.ComponentModel.IContainer components = null;

        /// <summary>
        /// Clean up any resources being used.
        /// </summary>
        /// <param name="disposing">true if managed resources should be disposed; otherwise, false.</param>
        protected override void Dispose(bool disposing)
        {
            if (disposing && (components != null))
            {
                components.Dispose();
            }
            base.Dispose(disposing);
        }

        #region Windows Form Designer generated code

        /// <summary>
        /// Required method for Designer support - do not modify
        /// the contents of this method with the code editor.
        /// </summary>
        private void InitializeComponent()
        {
            this.textBoxLastName = new System.Windows.Forms.TextBox();
            this.textBoxFirstName = new System.Windows.Forms.TextBox();
            this.textBoxRoomNumber = new System.Windows.Forms.TextBox();
            this.label1 = new System.Windows.Forms.Label();
            this.label2 = new System.Windows.Forms.Label();
            this.label3 = new System.Windows.Forms.Label();
            this.buttonOK = new System.Windows.Forms.Button();
            this.SuspendLayout();
            // 
            // textBoxLastName
            // 
            this.textBoxLastName.Location = new System.Drawing.Point(95, 28);
            this.textBoxLastName.Name = "textBoxLastName";
            this.textBoxLastName.Size = new System.Drawing.Size(100, 21);
            this.textBoxLastName.TabIndex = 0;
            // 
            // textBoxFirstName
            // 
            this.textBoxFirstName.Location = new System.Drawing.Point(95, 55);
            this.textBoxFirstName.Name = "textBoxFirstName";
            this.textBoxFirstName.Size = new System.Drawing.Size(100, 21);
            this.textBoxFirstName.TabIndex = 0;
            // 
            // textBoxRoomNumber
            // 
            this.textBoxRoomNumber.Location = new System.Drawing.Point(95, 82);
            this.textBoxRoomNumber.Name = "textBoxRoomNumber";
            this.textBoxRoomNumber.Size = new System.Drawing.Size(100, 21);
            this.textBoxRoomNumber.TabIndex = 0;
            // 
            // label1
            // 
            this.label1.AutoSize = true;
            this.label1.Location = new System.Drawing.Point(13, 36);
            this.label1.Name = "label1";
            this.label1.Size = new System.Drawing.Size(17, 12);
            this.label1.TabIndex = 1;
            this.label1.Text = "姓";
            // 
            // label2
            // 
            this.label2.AutoSize = true;
            this.label2.Location = new System.Drawing.Point(13, 58);
            this.label2.Name = "label2";
            this.label2.Size = new System.Drawing.Size(17, 12);
            this.label2.TabIndex = 1;
            this.label2.Text = "名";
            // 
            // label3
            // 
            this.label3.AutoSize = true;
            this.label3.Location = new System.Drawing.Point(13, 85);
            this.label3.Name = "label3";
            this.label3.Size = new System.Drawing.Size(41, 12);
            this.label3.TabIndex = 1;
            this.label3.Text = "房间号";
            // 
            // buttonOK
            // 
            this.buttonOK.Location = new System.Drawing.Point(77, 133);
            this.buttonOK.Name = "buttonOK";
            this.buttonOK.Size = new System.Drawing.Size(75, 23);
            this.buttonOK.TabIndex = 2;
            this.buttonOK.Text = "确定";
            this.buttonOK.UseVisualStyleBackColor = true;
            this.buttonOK.Click += new System.EventHandler(this.buttonOK_Click);
            // 
            // EmpForm
            // 
            this.AutoScaleDimensions = new System.Drawing.SizeF(6F, 12F);
            this.AutoScaleMode = System.Windows.Forms.AutoScaleMode.Font;
            this.ClientSize = new System.Drawing.Size(240, 194);
            this.Controls.Add(this.buttonOK);
            this.Controls.Add(this.label3);
            this.Controls.Add(this.label2);
            this.Controls.Add(this.label1);
            this.Controls.Add(this.textBoxRoomNumber);
            this.Controls.Add(this.textBoxFirstName);
            this.Controls.Add(this.textBoxLastName);
            this.Name = "EmpForm";
            this.Text = "员工录入表";
            this.ResumeLayout(false);
            this.PerformLayout();

        }

        #endregion

        private System.Windows.Forms.TextBox textBoxLastName;
        private System.Windows.Forms.TextBox textBoxFirstName;
        private System.Windows.Forms.TextBox textBoxRoomNumber;
        private System.Windows.Forms.Label label1;
        private System.Windows.Forms.Label label2;
        private System.Windows.Forms.Label label3;
        private System.Windows.Forms.Button buttonOK;
    }
}﻿using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using Masterhe.OPM;
using System.Runtime.InteropServices;
using Autodesk.AutoCAD.DatabaseServices;
using DotNetARX;
using Autodesk.AutoCAD.ApplicationServices;
namespace OPMExample
{
    public class EmployeeAtt : PropertyBase
    {
        //设置属性个数，不重载就是一个
        public override int PropertyCount
        {
            get { return 2; }
        }
        public override PropertyTypeEnum GetPropertyType(int nIndex)
        {
            //确定每个属性的类型
            switch (nIndex)
            {
                //员工类型（以下拉列表表示）
                case 0: return PropertyTypeEnum.PT_DropDownList;
                default: return PropertyTypeEnum.PT_Normal;//年薪
            }
        }
        //将属性定义为一个新的组
        public override string GetCategoryName(int nIndex)
        {
            return "员工类别";
        }
        //设置年薪属性为只读属性
        public override bool IsPropertyReadOnly(int index)
        {
            return index == 1;
        }
        #region 必须重载的方法
        //获取当前的属性值
        public override object GetCurrentValueData(int nIndex, DBObject pObj)
        {
            //获取当前选择对象的扩展数据（"EMPLOYEE"）
            TypedValueList xdata=pObj.GetXDataForApplication(Commands.appName);
            //若没有对应的扩展数据，则返回
            if (xdata == null) return null;
            switch (nIndex)
            {
                case 0: return xdata[1].Value;//员工的职位
                default: return xdata[2].Value;//员工的年薪
            }
        }
        //获取当前的属性类别
        public override VarEnum GetCurrentValueType(int nIndex)
        {
            switch (nIndex)
            {
                case 0: return VarEnum.VT_BSTR;//员工职位的类别：string
                default: return VarEnum.VT_R8;  //员工年薪的类别：double
            }
        }
        //获取当前的属性描述
        public override string GetDescription(int nIndex)
        {
            switch (nIndex)
            {
                case 0: return "指定员工的职位";
                default: return "指定员工的年薪";
            }
        }
        //获取属性的显示名称
        public override string GetDisplayName(int nIndex)
        {
            switch (nIndex)
            {
                case 0: return "职位";
                default: return "年薪";
            }
        }
        //设置当前的属性值
        public override void SetCurrentValueData(int nIndex, DBObject pObj, object objData)
        {
            ObjectId id=pObj.ObjectId;
            //获取当前选择对象的扩展数据（"EMPLOYEE"）
            TypedValueList xdata=pObj.GetXDataForApplication(Commands.appName);
            //若没有对应的扩展数据，则返回
            if (xdata == null) return;
            switch (nIndex)
            {
                case 0:
                    string empType=objData.ToString();//员工类型
                    //设置员工的类型和对应的年薪
                    xdata[1] = new TypedValue((int)DxfCode.ExtendedDataAsciiString, empType);
                    xdata[2] = new TypedValue((int)DxfCode.ExtendedDataReal, Commands.employees[empType]);
                    break;
            }
            //修改扩展数据以对应属性值的更改
            using (Transaction trans=id.Database.TransactionManager.StartTransaction())
            {
                id.RemoveXData(Commands.appName);
                id.AddXData(Commands.appName, xdata);
                trans.Commit();
            }
        }
        #endregion
        #region 为PropertyTypeEnum.PT_DropDownList重载的方法
        //员工类型列表
        List<string> listEmpTypes = null;
        //获取下拉列表形式的属性可以取值的个数
        public override int GetNumPropertyValues(int nIndex)
        {
            if (listEmpTypes == null)
            {
                listEmpTypes = new List<string>();
                listEmpTypes.AddRange(new string[] { "普通员工", "管理人员", "董事长" });
            }
            return listEmpTypes.Count;
        }
        //获取与下拉列表索引对应的属性名
        public override string GetPropValueName(int nIndex, int lValueIndex)
        {
            return listEmpTypes[lValueIndex].ToString();
        }
        //获取与下拉列表索引对应的属性值
        public override object GetPropValueData(int nIndex, int lValueIndex)
        {
            return listEmpTypes[lValueIndex];
        }
        #endregion
    }
}
﻿using System;
using Autodesk.AutoCAD.ApplicationServices;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.EditorInput;
using Autodesk.AutoCAD.Geometry;
using Autodesk.AutoCAD.Runtime;
using DotNetARX;
namespace EntEdit
{
    public class EntEdit
    {
        [CommandMethod("EditLine")]
        public static void EditLine()
        {
            Database db = HostApplicationServices.WorkingDatabase;
            //事务处理管理器
            Autodesk.AutoCAD.DatabaseServices.TransactionManager tm = db.TransactionManager;
            //开始第一个事务处理tr1
            using (Transaction tr1 = tm.StartTransaction())
            {
                Point3d ptStart = Point3d.Origin;
                Point3d ptEnd = new Point3d(100, 0, 0);
                Line line1 = new Line(ptStart, ptEnd);
                ObjectId id1 = db.AddToModelSpace(line1);//添加直线到数据库中
                //开始第二个事务处理tr2
                using (Transaction tr2 = tm.StartTransaction())
                {
                    line1.UpgradeOpen();  //切换line1的状态为可写
                    line1.ColorIndex = 1; //设置直线的颜色为红色
                    ObjectId id2 = id1.Copy(ptStart, ptEnd);//复制直线
                    id2.Rotate(ptEnd, Math.PI / 2); //以直线的起点旋转90度
                    //开始第三个事务处理tr3
                    using (Transaction tr3 = tm.StartTransaction())
                    {
                        Line line2 =(Line)tr3.GetObject(id2, OpenMode.ForWrite);
                        line2.ColorIndex = 2;
                        tr3.Abort(); //撤销第三个事务处理tr3，line2的颜色不变
                    }
                    tr2.Commit();//提交第二个事务处理tr2，line1颜色变为红色，复制line1并旋转90度
                }
                tr1.Commit();//提交第二个事务处理tr1，添加line1到数据库中
            }
        }
    }
}
using Autodesk.AutoCAD.ApplicationServices;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.Geometry;

namespace DotNetARX
{
    /// <summary>
    /// ʵ
    /// </summary>
    public static class EntTools
    {
        /// <summary>
        /// ƶʵ
        /// </summary>
        /// <param name="id">ʵObjectId</param>
        /// <param name="sourcePt">ƶԴ</param>
        /// <param name="targetPt">ƶĿ</param>
        public static void Move(this ObjectId id, Point3d sourcePt, Point3d targetPt)
        {
            //ƶʵľ
            Vector3d vector = targetPt.GetVectorTo(sourcePt);
            Matrix3d mt = Matrix3d.Displacement(vector);
            //дķʽidʾʵ
            Entity ent = (Entity)id.GetObject(OpenMode.ForWrite);
            ent.TransformBy(mt);//ʵʵʩƶ
            ent.DowngradeOpen();//ΪֹлʵΪ״̬
        }

        /// <summary>
        /// ƶʵ
        /// </summary>
        /// <param name="ent">ʵ</param>
        /// <param name="sourcePt">ƶԴ</param>
        /// <param name="targetPt">ƶĿ</param>
        public static void Move(this Entity ent, Point3d sourcePt, Point3d targetPt)
        {
            if (ent.IsNewObject) // ǻδӵݿеʵ
            {
                // ƶʵľ
                Vector3d vector = targetPt.GetVectorTo(sourcePt);
                Matrix3d mt = Matrix3d.Displacement(vector);
                ent.TransformBy(mt);//ʵʵʩƶ
            }
            else // Ѿӵݿеʵ
            {
                ent.ObjectId.Move(sourcePt, targetPt);
            }
        }

        /// <summary>
        /// ʵ
        /// </summary>
        /// <param name="id">ʵObjectId</param>
        /// <param name="sourcePt">ƵԴ</param>
        /// <param name="targetPt">ƵĿ</param>
        /// <returns>ظʵObjectId</returns>
        public static ObjectId Copy(this ObjectId id, Point3d sourcePt, Point3d targetPt)
        {
            //ڸʵľ
            Vector3d vector = targetPt.GetVectorTo(sourcePt);
            Matrix3d mt = Matrix3d.Displacement(vector);
            //ȡidʾʵ
            Entity ent = (Entity)id.GetObject(OpenMode.ForRead);
            //ȡʵĿ
            Entity entCopy = ent.GetTransformedCopy(mt);
            //ƵʵӵģͿռ
            ObjectId copyId = id.Database.AddToModelSpace(entCopy);
            return copyId; //ظʵObjectId
        }

        /// <summary>
        /// ʵ
        /// </summary>
        /// <param name="ent">ʵ</param>
        /// <param name="sourcePt">ƵԴ</param>
        /// <param name="targetPt">ƵĿ</param>
        /// <returns>ظʵObjectId</returns>
        public static ObjectId Copy(this Entity ent, Point3d sourcePt, Point3d targetPt)
        {
            ObjectId copyId;
            if (ent.IsNewObject) // ǻδӵݿеʵ
            {
                //ڸʵľ
                Vector3d vector = targetPt.GetVectorTo(sourcePt);
                Matrix3d mt = Matrix3d.Displacement(vector);
                //ȡʵĿ
                Entity entCopy = ent.GetTransformedCopy(mt);
                //ƵʵӵģͿռ
                copyId = ent.Database.AddToModelSpace(entCopy);
            }
            else
            {
                copyId = ent.ObjectId.Copy(sourcePt, targetPt);
            }
            return copyId; //ظʵObjectId
        }

        /// <summary>
        /// תʵ
        /// </summary>
        /// <param name="id">ʵObjectId</param>
        /// <param name="basePt">ת</param>
        /// <param name="angle">תǶ</param>
        public static void Rotate(this ObjectId id, Point3d basePt, double angle)
        {
            Matrix3d mt = Matrix3d.Rotation(angle, Vector3d.ZAxis, basePt);
            Entity ent = (Entity)id.GetObject(OpenMode.ForWrite);
            ent.TransformBy(mt);
            ent.DowngradeOpen();
        }

        /// <summary>
        /// תʵ
        /// </summary>
        /// <param name="ent">ʵ</param>
        /// <param name="basePt">ת</param>
        /// <param name="angle">תǶ</param>
        public static void Rotate(this Entity ent, Point3d basePt, double angle)
        {
            if (ent.IsNewObject)
            {
                Matrix3d mt = Matrix3d.Rotation(angle, Vector3d.ZAxis, basePt);
                ent.TransformBy(mt);
            }
            else
            {
                ent.ObjectId.Rotate(basePt, angle);
            }
        }

        /// <summary>
        /// ʵ
        /// </summary>
        /// <param name="id">ʵObjectId</param>
        /// <param name="basePt">Ż</param>
        /// <param name="scaleFactor">ű</param>
        public static void Scale(this ObjectId id, Point3d basePt, double scaleFactor)
        {
            Matrix3d mt = Matrix3d.Scaling(scaleFactor, basePt);
            Entity ent = (Entity)id.GetObject(OpenMode.ForWrite);
            ent.TransformBy(mt);
            ent.DowngradeOpen();
        }

        /// <summary>
        /// ʵ
        /// </summary>
        /// <param name="ent">ʵ</param>
        /// <param name="basePt">Ż</param>
        /// <param name="scaleFactor">ű</param>
        public static void Scale(this Entity ent, Point3d basePt, double scaleFactor)
        {
            if (ent.IsNewObject)
            {
                Matrix3d mt = Matrix3d.Scaling(scaleFactor, basePt);
                ent.TransformBy(mt);
            }
            else
            {
                ent.ObjectId.Scale(basePt, scaleFactor);
            }
        }

        /// <summary>
        /// ʵ
        /// </summary>
        /// <param name="id">ʵObjectId</param>
        /// <param name="mirrorPt1">ĵһ</param>
        /// <param name="mirrorPt2">ĵڶ</param>
        /// <param name="eraseSourceObject">ǷɾԴ</param>
        /// <returns>ؾʵObjectId</returns>
        public static ObjectId Mirror(this ObjectId id, Point3d mirrorPt1, Point3d mirrorPt2, bool eraseSourceObject)
        {
            Line3d miLine = new Line3d(mirrorPt1, mirrorPt2);//
            Matrix3d mt = Matrix3d.Mirroring(miLine);//
            ObjectId mirrorId = id;
            Entity ent = (Entity)id.GetObject(OpenMode.ForWrite);
            //ɾԴֱӶԴʵо任
            if (eraseSourceObject == true)
                ent.TransformBy(mt);
            else //ɾԴԴ
            {
                Entity entCopy = ent.GetTransformedCopy(mt);
                mirrorId = id.Database.AddToModelSpace(entCopy);
            }
            return mirrorId;
        }

        /// <summary>
        /// ʵ
        /// </summary>
        /// <param name="ent">ʵ</param>
        /// <param name="mirrorPt1">ĵһ</param>
        /// <param name="mirrorPt2">ĵڶ</param>
        /// <param name="eraseSourceObject">ǷɾԴ</param>
        /// <returns>ؾʵObjectId</returns>
        public static ObjectId Mirror(this Entity ent, Point3d mirrorPt1, Point3d mirrorPt2, bool eraseSourceObject)
        {
            Line3d miLine = new Line3d(mirrorPt1, mirrorPt2);//
            Matrix3d mt = Matrix3d.Mirroring(miLine);//
            ObjectId mirrorId = ObjectId.Null;
            if (ent.IsNewObject)
            {
                //ɾԴֱӶԴʵо任
                if (eraseSourceObject == true)
                    ent.TransformBy(mt);
                else //ɾԴԴ
                {
                    Entity entCopy = ent.GetTransformedCopy(mt);
                    mirrorId = ent.Database.AddToModelSpace(entCopy);
                }
            }
            else
            {
                mirrorId = ent.ObjectId.Mirror(mirrorPt1, mirrorPt2, eraseSourceObject);
            }
            return mirrorId;
        }

        /// <summary>
        /// ƫʵ
        /// </summary>
        /// <param name="id">ʵObjectId</param>
        /// <param name="dis">ƫƾ</param>
        /// <returns>ƫƺʵId</returns>
        public static ObjectIdCollection Offset(this ObjectId id, double dis)
        {
            ObjectIdCollection ids = new ObjectIdCollection();
            Curve cur = id.GetObject(OpenMode.ForWrite) as Curve;
            if (cur != null)
            {
                try
                {
                    //ȡƫƵĶ󼯺
                    DBObjectCollection offsetCurves = cur.GetOffsetCurves(dis);
                    //󼯺תΪʵ飬ԷʵĲ
                    Entity[] offsetEnts = new Entity[offsetCurves.Count];
                    offsetCurves.CopyTo(offsetEnts, 0);
                    //ƫƵĶ뵽ݿ
                    ids = id.Database.AddToModelSpace(offsetEnts);
                }
                catch
                {
                    Application.ShowAlertDialog("޷ƫƣ");
                }
            }
            else
                Application.ShowAlertDialog("޷ƫƣ");
            return ids;//ƫƺʵId
        }

        /// <summary>
        /// ƫʵ
        /// </summary>
        /// <param name="ent">ʵ</param>
        /// <param name="dis">ƫƾ</param>
        /// <returns>ƫƺʵ弯</returns>
        public static DBObjectCollection Offset(this Entity ent, double dis)
        {
            DBObjectCollection offsetCurves = new DBObjectCollection();
            Curve cur = ent as Curve;
            if (cur != null)
            {
                try
                {
                    offsetCurves = cur.GetOffsetCurves(dis);
                    Entity[] offsetEnts = new Entity[offsetCurves.Count];
                    offsetCurves.CopyTo(offsetEnts, 0);
                }
                catch
                {
                    Application.ShowAlertDialog("޷ƫƣ");
                }
            }
            else
                Application.ShowAlertDialog("޷ƫƣ");
            return offsetCurves;
        }

        /// <summary>
        /// ʵ
        /// </summary>
        /// <param name="id">ʵObjectId</param>
        /// <param name="numRows">е,ֵΪ</param>
        /// <param name="numCols">е,ֵΪ</param>
        /// <param name="disRows">мľ</param>
        /// <param name="disCols">мľ</param>
        /// <returns>кʵ弯ϵObjectId</returns>
        public static ObjectIdCollection ArrayRectang(this ObjectId id, int numRows, int numCols, double disRows, double disCols)
        {
            // ڷкʵ弯ϵObjectId
            ObjectIdCollection ids = new ObjectIdCollection();
            // Զķʽʵ
            Entity ent = (Entity)id.GetObject(OpenMode.ForRead);
            for (int m = 0; m < numRows; m++)
            {
                for (int n = 0; n < numCols; n++)
                {
                    // ȡƽƾ
                    Matrix3d mt = Matrix3d.Displacement(new Vector3d(n * disCols, m * disRows, 0));
                    Entity entCopy = ent.GetTransformedCopy(mt);// ʵ
                    // ƵʵӵģͿռ
                    ObjectId entCopyId = id.Database.AddToModelSpace(entCopy);
                    ids.Add(entCopyId);// ʵObjectIdӵ
                }
            }
            ent.UpgradeOpen();// лʵΪд״̬
            ent.Erase();// ɾʵ
            return ids;// кʵ弯ϵObjectId
        }

        /// <summary>
        /// ʵ
        /// </summary>
        /// <param name="id">ʵObjectId</param>
        /// <param name="cenPt">еĵ</param>
        /// <param name="numObj">ڻҪĶ</param>
        /// <param name="angle">ԻȱʾǶȣֵʾʱ뷽תֵʾ˳ʱ뷽תǶΪ0</param>
        /// <returns>кʵ弯ϵObjectId</returns>
        public static ObjectIdCollection ArrayPolar(this ObjectId id, Point3d cenPt, int numObj, double angle)
        {
            ObjectIdCollection ids = new ObjectIdCollection();
            Entity ent = (Entity)id.GetObject(OpenMode.ForRead);
            for (int i = 0; i < numObj - 1; i++)
            {
                Matrix3d mt = Matrix3d.Rotation(angle * (i + 1) / numObj, Vector3d.ZAxis, cenPt);
                Entity entCopy = ent.GetTransformedCopy(mt);
                ObjectId entCopyId = id.Database.AddToModelSpace(entCopy);
                ids.Add(entCopyId);
            }
            return ids;
        }

        /// <summary>
        /// ɾʵ
        /// </summary>
        /// <param name="id">ʵObjectId</param>
        public static void Erase(this ObjectId id)
        {
            DBObject ent = id.GetObject(OpenMode.ForWrite);
            ent.Erase();
        }

        /// <summary>
        /// ͼݿģͿռʵİΧ
        /// </summary>
        /// <param name="db">ݿ</param>
        /// <returns>ģͿռʵİΧ</returns>
        public static Extents3d GetAllEntsExtent(this Database db)
        {
            Extents3d totalExt = new Extents3d();
            using (Transaction trans = db.TransactionManager.StartTransaction())
            {
                BlockTable bt = (BlockTable)trans.GetObject(db.BlockTableId, OpenMode.ForRead);
                BlockTableRecord btRcd = (BlockTableRecord)trans.GetObject(bt[BlockTableRecord.ModelSpace], OpenMode.ForRead);
                foreach (ObjectId entId in btRcd)
                {
                    Entity ent = trans.GetObject(entId, OpenMode.ForRead) as Entity;
                    totalExt.AddExtents(ent.GeometricExtents);
                }
            }
            return totalExt;
        }
    }
}
﻿using System;
using System.Collections.Generic;
using Autodesk.AutoCAD.ApplicationServices;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.EditorInput;
using Autodesk.AutoCAD.Geometry;
using Autodesk.AutoCAD.Runtime;
using DotNetARX;
using Excel = NetOffice.ExcelApi;

namespace ExcelCAD
{
    public class ExcelCAD
    {
        //提取Excel数据到CAD
        [CommandMethod("ExcelToCAD")]
        public void ExcelToCAD()
        {
            Document doc=Application.DocumentManager.MdiActiveDocument;
            Database db=doc.Database;
            Editor ed=doc.Editor;
            // 初始化对COM对象的支持
            LateBindingApi.Core.Factory.Initialize();
            // 声明一个Excel对象
            Excel.Application excelApp = new Excel.Application();
            //定义打开文件对话框选项
            PromptOpenFileOptions opt=new PromptOpenFileOptions("请选择Excel文件");
            //文件对话框的标题
            opt.DialogCaption = "选择Excel文件";
            //文件对话框的文件过滤器列表，可以是各版本的Excel
            opt.Filter = "Excel 97-2003工作簿(*.xls)|*.xls|Excel工作簿(*.xlsx)|*.xlsx";
            //文件过滤器列表中缺省显示的文件扩展名
            opt.FilterIndex = 0;
            //根据用户的选择，获取文件名
            PromptFileNameResult fileResult=ed.GetFileNameForOpen(opt);
            //若没有成功，则返回
            if (fileResult.Status != PromptStatus.OK) return;
            //设置文件名变量
            string filename=fileResult.StringResult;
            using (Transaction trans=db.TransactionManager.StartTransaction())
            {
                //打开选择的Excel文件，获得指定的页
                Excel.Workbook book= excelApp.Workbooks.Open(filename);
                Excel.Worksheet sheet=(Excel.Worksheet)book.Worksheets["Sheet1"];
                //用于保存点位名字和坐标的列表
                List<DBText> txts=new List<DBText>();
                List<DBPoint> points=new List<DBPoint>();
                //设置AutoCAD中点的形状和大小
                Application.SetSystemVariable("PDMODE", 35);
                Application.SetSystemVariable("PDSIZE", 2);
                int i=0;                
                //对单元格进行循环，若为空或空格则结束循环
                while (sheet.Cells[i + 1, 1].Value!= null && sheet.Cells[i + 1, 1].Value.ToString().Trim() != "")
                {
                    //设置临时变量用于保存点的位置和名称
                    DBPoint pt=new DBPoint();
                    DBText txt=new DBText();
                    //获取点的名称，位于第1列
                    txt.TextString = sheet.Cells[i + 1, 1].Value.ToString();
                    //获取点的X、Y、Z值，分别位于第2、3、4列
                    double x=Convert.ToDouble(sheet.Cells[i + 1, 2].Value);
                    double y=Convert.ToDouble(sheet.Cells[i + 1, 3].Value);
                    double z=Convert.ToDouble(sheet.Cells[i + 1, 4].Value);
                    //设置点的位置
                    pt.Position = new Point3d(x, y, z);
                    //设置文本的位置,位于点的右侧
                    txt.Position = pt.Position.Add(new Vector3d(3, 0, 0));
                    //添加点和点名称到对应的列表
                    points.Add(pt);
                    txts.Add(txt);
                    i++;
                }
                //添加点和点名称到当前模型空间
                db.AddToModelSpace(txts.ToArray());
                db.AddToModelSpace(points.ToArray());
                trans.Commit();
            }
            // 关闭Excel程序并销毁引用的对象
            excelApp.Quit();
            excelApp.Dispose();
        }
    }
}
﻿using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using System.Xml.Linq;
using Autodesk.AutoCAD.ApplicationServices;
using Autodesk.AutoCAD.Colors;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.Geometry;
using Autodesk.AutoCAD.Runtime;
using DotNetARX;
using Polenter.Serialization;
namespace FileCAD
{
    public class FileCAD
    {
        //写入文本文件
        [CommandMethod("WriteTextFile")]
        public static void WriteTextFile()
        {
            Database db=HostApplicationServices.WorkingDatabase;
            using (Transaction trans=db.TransactionManager.StartTransaction())
            {
                //设置文件名
                string fileName=Tools.GetCurrentPath() + "\\Points.txt";
                //获取AutoCAD中所有的点
                var pointsInCAD=db.GetEntsInModelSpace<DBPoint>();
                //将点的坐标值遍历进文本文件，若文件不存在则先会创建文件
                foreach (var point in pointsInCAD)
                {
                    File.AppendAllText(fileName, point.Position.ToString() + Environment.NewLine);
                }
                trans.Commit();
            }
        }

        //读取文本文件
        [CommandMethod("ReadTextFile")]
        public static void ReadTextFile()
        {
            List<DBPoint> ptsInCAD=new List<DBPoint>(); // 创建CAD点列表
            string fileName=Tools.GetCurrentPath() + "\\Points.txt"; // 打开文本文件
            if (File.Exists(fileName)) // 如果文件存在
            {
                string[] strLines=File.ReadAllLines(fileName); // 读取文本文件的所有行
                foreach (string strLine in strLines) // 遍历文本
                {
                    Point3d pt=strLine.StringToPoint3d(); // 将文本行的数据转换为Point3d            
                    ptsInCAD.Add(new DBPoint(pt)); // 创建AutoCAD点并添加到列表中
                }
            }
            Database db=HostApplicationServices.WorkingDatabase;
            using (Transaction trans=db.TransactionManager.StartTransaction())
            {
                db.AddToModelSpace(ptsInCAD.ToArray()); // 添加点到AutoCAD中
                trans.Commit();
            }
        }

        //二进制序列化
        [CommandMethod("Serilize")]
        public static void Serilize()
        {
            //定义一个可序列化类SerilizePoint的列表
            List<SerilizePoint> points=new List<SerilizePoint>();
            Database db=HostApplicationServices.WorkingDatabase;
            using (Transaction trans=db.TransactionManager.StartTransaction())
            {
                //获取AutoCAD中所有的点
                var pointsInCAD=db.GetEntsInModelSpace<DBPoint>();
                //对点的坐标值进行遍历并添加到SerilizePoint类列表
                foreach (var point in pointsInCAD)
                {
                    SerilizePoint sp=new SerilizePoint { X = point.Position.X, Y = point.Position.Y, Z = point.Position.Z };
                    points.Add(sp);
                }
                //声明一个二进制序列化对象
                SharpSerializer serializer = new SharpSerializer(true);
                //将SerilizePoint类列表序列化到一个二进制文件
                serializer.Serialize(points, Tools.GetCurrentPath() + "\\Points.bin");
                trans.Commit();
            }
        }

        // 二进制反序列化
        [CommandMethod("DeSerilize")]
        public static void DeSerilize()
        {
            // 定义一个可序列化类SerilizePoint的列表
            List<SerilizePoint> points=new List<SerilizePoint>();
            List<DBPoint> ptsInCAD=new List<DBPoint>();
            // 声明一个二进制序列化对象
            SharpSerializer serializer = new SharpSerializer(true);
            // 将Points.bin文件中保存的点坐标反序列化为SerilizePoint列表
            points = serializer.Deserialize(Tools.GetCurrentPath() + "\\Points.bin") as List<SerilizePoint>;

            foreach (var point in points) //遍历SerilizePoint列表以创建AutoCAD点
            {
                ptsInCAD.Add(new DBPoint(new Point3d(point.X, point.Y, point.Z)));
            }
            Database db=HostApplicationServices.WorkingDatabase;
            using (Transaction trans=db.TransactionManager.StartTransaction())
            {
                db.AddToModelSpace(ptsInCAD.ToArray()); // 添加点到AutoCAD中
                trans.Commit();
            }
        }

        //写入XML文件
        [CommandMethod("WriteXML")]
        public static void WriteXML()
        {
            //创建一个XML根元素
            XElement  xroot=new XElement("Root");
            Database db=HostApplicationServices.WorkingDatabase;
            using (Transaction trans=db.TransactionManager.StartTransaction())
            {
                //获取AutoCAD中所有的点
                var pointsInCAD=db.GetEntsInModelSpace<DBPoint>();
                //打开层表并进行遍历
                LayerTable lt=(LayerTable)trans.GetObject(db.LayerTableId, OpenMode.ForRead);
                foreach (ObjectId id in lt)
                {
                    //获取每个层的层名
                    LayerTableRecord ltr=(LayerTableRecord)trans.GetObject(id, OpenMode.ForRead);
                    string layerName=ltr.Name;
                    //创建一个名为Layer的新元素
                    XElement xLayer=new XElement("Layer");
                    //在Layer元素下添加表示层名、层颜色、层颜色索引值的属性
                    xLayer.Add(new XAttribute("Name", layerName));
                    xLayer.Add(new XAttribute("Color", ltr.Color.ToString()));
                    xLayer.Add(new XAttribute("ColorIndex", ltr.Color.ColorIndex.ToString()));
                    //获取点的坐标
                    var pointsOnLayer=from pt in pointsInCAD
                                      where pt.Layer == layerName
                                      select pt.Position;
                    var pointsToXML=new XElement("Points", //新建一个Points元素
                    from pt in pointsOnLayer //将点坐标遍历成Points元素下新的Point元素
                    select new XElement("Point",
                                new XElement("X", pt.X.ToString()),
                                new XElement("Y", pt.Y.ToString()),
                                new XElement("Z", pt.Z.ToString())
                                )
                            );
                    xLayer.Add(pointsToXML);//添加Points元素到Layer元素中
                    xroot.Add(xLayer);//添加Layer元素到根元素中
                }
                //在当前目录下新建一个XML文件，将从AutoCAD中获取的点信息添加到XML文件中
                string fileName=Tools.GetCurrentPath() + "\\Points.XML";
                xroot.Save(fileName);
                trans.Commit();
            }
        }
        //读取XML文件
        [CommandMethod("ReadXML")]
        public static void ReadXML()
        {
            //载入当前目录下的PointsLinq.XML文件
            string fileName=Tools.GetCurrentPath() + "\\Points.XML";
            XElement xroot=XElement.Load(fileName);
            Database db=HostApplicationServices.WorkingDatabase;
            //创建CAD点列表
            List<DBPoint> ptsInCAD=new List<DBPoint>();
            using (Transaction trans=db.TransactionManager.StartTransaction())
            {
                //打开层表，因为可能要加入新的层，所以打开方式为写
                LayerTable lt=(LayerTable)trans.GetObject(db.LayerTableId, OpenMode.ForWrite);
                //遍历根目录下的Layer元素
                foreach (var layer in xroot.Elements())
                {
                    //通过Layer元素的属性分别获取层名和层的颜色索引值
                    string layerName=layer.Attribute("Name").Value;
                    short colorIndex=Convert.ToInt16(layer.Attribute("ColorIndex").Value);
                    //如果图形中不存在指定的层，则创建新层
                    if (!lt.Has(layerName))
                    {
                        LayerTableRecord ltr=new LayerTableRecord();
                        ltr.Name = layerName;
                        ltr.Color = Color.FromColorIndex(ColorMethod.ByAci, colorIndex);
                        lt.Add(ltr);
                        trans.AddNewlyCreatedDBObject(ltr, true);
                    }
                    //遍历Layer元素的Points子元素下的Point元素
                    foreach (var point in layer.Element("Points").Elements())
                    {
                        //通过Point元素的X、Y、Z子元素获取点的坐标值
                        double x=Convert.ToDouble(point.Element("X").Value);
                        double y=Convert.ToDouble(point.Element("Y").Value);
                        double z=Convert.ToDouble(point.Element("Z").Value);
                        //创建CAD点，设置层并添加到点列表中以一次性添加到AutoCAD中
                        DBPoint dbPoint=new DBPoint(new Point3d(x, y, z));
                        dbPoint.Layer = layerName;
                        ptsInCAD.Add(dbPoint);
                    }
                }
                //将XML文件中获取的点添加到AutoCAD中
                db.AddToModelSpace(ptsInCAD.ToArray());
                trans.Commit();
            }
        }
    }
}
﻿using System;
using System.Collections.Generic;
using System.Linq;
using System.Windows.Forms;
using Microsoft.Win32;
namespace AutoNetLoad
{
    public partial class FormAutoLoad : Form
    {
        List<RegistryKey> autoCADVersions=new List<RegistryKey>();
        public FormAutoLoad()
        {
            InitializeComponent();
        }

        private void FormAutoLoad_Load(object sender, EventArgs e)
        {
            //获取当前AutoCAD的注册表键名
            string cadKeyName=GetAutoCADKeyName();
            //打开HKEY_LOCAL_MACHINE下当前AutoCAD的注册表键以获得版本号
            RegistryKey keyCAD=Registry.LocalMachine.OpenSubKey(cadKeyName);
            //设置文本框显示当前AutoCAD版本号
            string cadName=keyCAD.GetValue("ProductName").ToString();
            this.textBoxCurCAD.Text = cadName;
            //打开HKEY_CURRENT_USER下当前AutoCAD的Applications注册表键以显示已加载的.NET程序
            RegistryKey keyApplications=Registry.CurrentUser.CreateSubKey(cadKeyName + "\\" + "Applications");
            //遍历Applications下的注册表项
            foreach (var subKeyNameApp in keyApplications.GetSubKeyNames())
            {
                //打开注册表键
                RegistryKey keyApplication=keyApplications.OpenSubKey(subKeyNameApp);
                //如果是.NET程序
                if (keyApplication.GetValue("MANAGED") != null)
                {
                    //在列表框中添加.NET程序的名字和程序路径
                    ListViewItem item=new ListViewItem(subKeyNameApp);
                    item.SubItems.Add(keyApplication.GetValue("LOADER").ToString());
                    this.listViewAssembly.Items.Add(item);
                }
            }
        }

        private void buttonBrowse_Click(object sender, EventArgs e)
        {
            //判断用户是否通过文件对话框选择了.NET程序集
            if (this.openFileDialog1.ShowDialog() == DialogResult.OK)
            {
                //选择的DLL文件的文件名（含路径）
                this.textBoxFilePath.Text = this.openFileDialog1.FileName;
                //选择的DLL文件的文件名（不含路径与后缀），作为应用程序名
                this.textBoxApp.Text = System.IO.Path.GetFileNameWithoutExtension(this.textBoxFilePath.Text);
                //应用程序描述设置成程序名
                this.textBoxAppDesc.Text = this.textBoxApp.Text;
            }
        }

        private void buttonAdd_Click(object sender, EventArgs e)
        {
            string appName=this.textBoxApp.Text; //应用程序名
            string appDesc=this.textBoxAppDesc.Text; //应用描述
            string appPath=this.textBoxFilePath.Text;//应用程序路径
            //添加注册表项到Applications键下
            CreateDemandLoadingEntries(appName, appDesc, appPath, true, false, 2);
            //应用程序的有关信息添加到列表框中
            ListViewItem item=new ListViewItem(appName);
            item.SubItems.Add(appPath);
            this.listViewAssembly.Items.Add(item);
        }


        private void buttonExit_Click(object sender, EventArgs e)
        {
            this.Dispose();//销毁窗体
        }

        private void buttonDelete_Click(object sender, EventArgs e)
        {
            //获取列表框中当前选择的项
            string text=this.listViewAssembly.SelectedItems[0].Text;
            if (text != null)
            {
                //显示警告对话框，提示用户是否真的要删除注册表项
                DialogResult result=MessageBox.Show("你确实想删除" + text + "注册表项吗？", "警告", MessageBoxButtons.YesNo);
                if (result == DialogResult.Yes) //选择删除
                {
                    if (RemoveDemandLoadingEntries(text, true)) //删除成功
                    {
                        //从列表框中移除对应的注册表项
                        this.listViewAssembly.Items.Remove(listViewAssembly.SelectedItems[0]);
                    }
                }
            }
        }

        public static string GetAutoCADKeyName()
        {
            // 获取HKEY_CURRENT_USER键
            RegistryKey keyCurrentUser = Registry.CurrentUser;
            // 打开AutoCAD所属的注册表键:HKEY_CURRENT_USER\Software\Autodesk\AutoCAD
            RegistryKey keyAutoCAD =keyCurrentUser.OpenSubKey("Software\\Autodesk\\AutoCAD");
            //获得表示当前的AutoCAD版本的注册表键值:R18.2
            string valueCurAutoCAD=keyAutoCAD.GetValue("CurVer").ToString();
            if (valueCurAutoCAD == null) return "";//如果未安装AutoCAD，则返回
            //获取当前的AutoCAD版本的注册表键:HKEY_LOCAL_MACHINE\Software\Autodesk\AutoCAD\R18.2
            RegistryKey keyCurAutoCAD = keyAutoCAD.OpenSubKey(valueCurAutoCAD);
            //获取表示AutoCAD当前语言的注册表键值:ACAD-a001:804
            string language=keyCurAutoCAD.GetValue("CurVer").ToString();
            //获取AutoCAD当前语言的注册表键:HKEY_LOCAL_MACHINE\Software\Autodesk\AutoCAD\R18.2\ACAD-a001:804
            RegistryKey keyLanguage = keyCurAutoCAD.OpenSubKey(language);
            //返回去除HKEY_LOCAL_MACHINE前缀的当前AutoCAD注册表项的键名:Software\Autodesk\AutoCAD\R18.2\ACAD-a001:804
            return keyLanguage.Name.Substring(keyCurrentUser.Name.Length + 1);
        }

        public static bool CreateDemandLoadingEntries(string appName, string appDesc, string appPath, bool currentUser, bool overwrite, int flagLOADCTRLS)
        {
            //获取AutoCAD所属的注册表键名
            var autoCADKeyName=GetAutoCADKeyName();
            //确定是HKEY_CURRENT_USER还是HKEY_LOCAL_MACHINE
            RegistryKey keyRoot =currentUser ? Registry.CurrentUser : Registry.LocalMachine;
            // 由于某些AutoCAD版本的HKEY_CURRENT_USER可能不包括Applications键值，因此要创建该键值
            // 如果已经存在该鍵，无须担心可能的覆盖操作问题，因为CreateSubKey函数会以写的方式打开它而不会执行覆盖操作
            RegistryKey keyApp =keyRoot.CreateSubKey(autoCADKeyName + "\\" + "Applications");
            //若存在同名的程序且选择不覆盖则返回
            if (!overwrite && keyApp.GetSubKeyNames().Contains(appName))
                return false;
            //创建相应的键并设置自动加载应用程序的选项
            RegistryKey keyUserApp=keyApp.CreateSubKey(appName);
            keyUserApp.SetValue("DESCRIPTION", appDesc, RegistryValueKind.String);
            keyUserApp.SetValue("LOADCTRLS", flagLOADCTRLS, RegistryValueKind.DWord);
            keyUserApp.SetValue("LOADER", appPath, RegistryValueKind.String);
            keyUserApp.SetValue("MANAGED", 1, RegistryValueKind.DWord);
            return true;//创建键成功则返回
        }

        public static bool RemoveDemandLoadingEntries(string appName, bool currentUser)
        {
            try
            {
                // 获取AutoCAD所属的注册表键名
                string cadName = GetAutoCADKeyName();
                // 确定是HKEY_CURRENT_USER还是HKEY_LOCAL_MACHINE
                RegistryKey keyRoot =currentUser ? Registry.CurrentUser : Registry.LocalMachine;
                // 以写的方式打开Applications注册表键
                RegistryKey keyApp=keyRoot.OpenSubKey(cadName + "\\" + "Applications", true);
                //删除指定名称的注册表键
                keyApp.DeleteSubKeyTree(appName);
            }
            catch
            {
                return false;
            }
            return true;
        }
    }
}
﻿namespace AutoNetLoad
{
    partial class FormAutoLoad
    {
        /// <summary>
        /// 必需的设计器变量。
        /// </summary>
        private System.ComponentModel.IContainer components = null;

        /// <summary>
        /// 清理所有正在使用的资源。
        /// </summary>
        /// <param name="disposing">如果应释放托管资源，为 true；否则为 false。</param>
        protected override void Dispose(bool disposing)
        {
            if (disposing && (components != null))
            {
                components.Dispose();
            }
            base.Dispose(disposing);
        }

        #region Windows 窗体设计器生成的代码

        /// <summary>
        /// 设计器支持所需的方法 - 不要
        /// 使用代码编辑器修改此方法的内容。
        /// </summary>
        private void InitializeComponent()
        {
            this.label1 = new System.Windows.Forms.Label();
            this.label2 = new System.Windows.Forms.Label();
            this.textBoxFilePath = new System.Windows.Forms.TextBox();
            this.label3 = new System.Windows.Forms.Label();
            this.label4 = new System.Windows.Forms.Label();
            this.textBoxApp = new System.Windows.Forms.TextBox();
            this.textBoxAppDesc = new System.Windows.Forms.TextBox();
            this.buttonBrowse = new System.Windows.Forms.Button();
            this.openFileDialog1 = new System.Windows.Forms.OpenFileDialog();
            this.label5 = new System.Windows.Forms.Label();
            this.buttonAdd = new System.Windows.Forms.Button();
            this.buttonDelete = new System.Windows.Forms.Button();
            this.buttonExit = new System.Windows.Forms.Button();
            this.textBoxCurCAD = new System.Windows.Forms.TextBox();
            this.listViewAssembly = new System.Windows.Forms.ListView();
            this.columnHeader1 = ((System.Windows.Forms.ColumnHeader)(new System.Windows.Forms.ColumnHeader()));
            this.columnHeader2 = ((System.Windows.Forms.ColumnHeader)(new System.Windows.Forms.ColumnHeader()));
            this.SuspendLayout();
            // 
            // label1
            // 
            this.label1.AutoSize = true;
            this.label1.Location = new System.Drawing.Point(17, 9);
            this.label1.Name = "label1";
            this.label1.Size = new System.Drawing.Size(95, 12);
            this.label1.TabIndex = 0;
            this.label1.Text = "当前AutoCAD版本";
            // 
            // label2
            // 
            this.label2.AutoSize = true;
            this.label2.Location = new System.Drawing.Point(17, 68);
            this.label2.Name = "label2";
            this.label2.Size = new System.Drawing.Size(77, 12);
            this.label2.TabIndex = 2;
            this.label2.Text = ".NET程序路径";
            // 
            // textBoxFilePath
            // 
            this.textBoxFilePath.Location = new System.Drawing.Point(19, 93);
            this.textBoxFilePath.Multiline = true;
            this.textBoxFilePath.Name = "textBoxFilePath";
            this.textBoxFilePath.Size = new System.Drawing.Size(215, 83);
            this.textBoxFilePath.TabIndex = 3;
            // 
            // label3
            // 
            this.label3.AutoSize = true;
            this.label3.Location = new System.Drawing.Point(17, 196);
            this.label3.Name = "label3";
            this.label3.Size = new System.Drawing.Size(65, 12);
            this.label3.TabIndex = 4;
            this.label3.Text = "应用程序名";
            // 
            // label4
            // 
            this.label4.AutoSize = true;
            this.label4.Location = new System.Drawing.Point(17, 230);
            this.label4.Name = "label4";
            this.label4.Size = new System.Drawing.Size(77, 12);
            this.label4.TabIndex = 4;
            this.label4.Text = "应用程序描述";
            // 
            // textBoxApp
            // 
            this.textBoxApp.Location = new System.Drawing.Point(105, 196);
            this.textBoxApp.Name = "textBoxApp";
            this.textBoxApp.Size = new System.Drawing.Size(184, 21);
            this.textBoxApp.TabIndex = 5;
            // 
            // textBoxAppDesc
            // 
            this.textBoxAppDesc.Location = new System.Drawing.Point(105, 227);
            this.textBoxAppDesc.Name = "textBoxAppDesc";
            this.textBoxAppDesc.Size = new System.Drawing.Size(184, 21);
            this.textBoxAppDesc.TabIndex = 5;
            // 
            // buttonBrowse
            // 
            this.buttonBrowse.Location = new System.Drawing.Point(236, 93);
            this.buttonBrowse.Name = "buttonBrowse";
            this.buttonBrowse.Size = new System.Drawing.Size(53, 83);
            this.buttonBrowse.TabIndex = 6;
            this.buttonBrowse.Text = "浏览";
            this.buttonBrowse.UseVisualStyleBackColor = true;
            this.buttonBrowse.Click += new System.EventHandler(this.buttonBrowse_Click);
            // 
            // openFileDialog1
            // 
            this.openFileDialog1.Filter = ".NET程序集(*.dll)|*.dll";
            // 
            // label5
            // 
            this.label5.AutoSize = true;
            this.label5.Location = new System.Drawing.Point(364, 9);
            this.label5.Name = "label5";
            this.label5.Size = new System.Drawing.Size(149, 12);
            this.label5.TabIndex = 7;
            this.label5.Text = "已自动加载的.NET程序集：";
            // 
            // buttonAdd
            // 
            this.buttonAdd.Location = new System.Drawing.Point(105, 282);
            this.buttonAdd.Name = "buttonAdd";
            this.buttonAdd.Size = new System.Drawing.Size(75, 23);
            this.buttonAdd.TabIndex = 9;
            this.buttonAdd.Text = "加入注册表";
            this.buttonAdd.UseVisualStyleBackColor = true;
            this.buttonAdd.Click += new System.EventHandler(this.buttonAdd_Click);
            // 
            // buttonDelete
            // 
            this.buttonDelete.Location = new System.Drawing.Point(255, 282);
            this.buttonDelete.Name = "buttonDelete";
            this.buttonDelete.Size = new System.Drawing.Size(75, 23);
            this.buttonDelete.TabIndex = 9;
            this.buttonDelete.Text = "删除注册表";
            this.buttonDelete.UseVisualStyleBackColor = true;
            this.buttonDelete.Click += new System.EventHandler(this.buttonDelete_Click);
            // 
            // buttonExit
            // 
            this.buttonExit.Location = new System.Drawing.Point(438, 282);
            this.buttonExit.Name = "buttonExit";
            this.buttonExit.Size = new System.Drawing.Size(75, 23);
            this.buttonExit.TabIndex = 9;
            this.buttonExit.Text = "退出";
            this.buttonExit.UseVisualStyleBackColor = true;
            this.buttonExit.Click += new System.EventHandler(this.buttonExit_Click);
            // 
            // textBoxCurCAD
            // 
            this.textBoxCurCAD.Location = new System.Drawing.Point(19, 33);
            this.textBoxCurCAD.Name = "textBoxCurCAD";
            this.textBoxCurCAD.ReadOnly = true;
            this.textBoxCurCAD.Size = new System.Drawing.Size(270, 21);
            this.textBoxCurCAD.TabIndex = 10;
            // 
            // listViewAssembly
            // 
            this.listViewAssembly.Columns.AddRange(new System.Windows.Forms.ColumnHeader[] {
            this.columnHeader1,
            this.columnHeader2});
            this.listViewAssembly.Location = new System.Drawing.Point(366, 33);
            this.listViewAssembly.Name = "listViewAssembly";
            this.listViewAssembly.Size = new System.Drawing.Size(242, 215);
            this.listViewAssembly.TabIndex = 11;
            this.listViewAssembly.UseCompatibleStateImageBehavior = false;
            this.listViewAssembly.View = System.Windows.Forms.View.Details;
            // 
            // columnHeader1
            // 
            this.columnHeader1.Text = "程序名";
            // 
            // columnHeader2
            // 
            this.columnHeader2.Text = "文件路径";
            this.columnHeader2.Width = 80;
            // 
            // FormAutoLoad
            // 
            this.AutoScaleDimensions = new System.Drawing.SizeF(6F, 12F);
            this.AutoScaleMode = System.Windows.Forms.AutoScaleMode.Font;
            this.ClientSize = new System.Drawing.Size(620, 324);
            this.Controls.Add(this.listViewAssembly);
            this.Controls.Add(this.textBoxCurCAD);
            this.Controls.Add(this.buttonExit);
            this.Controls.Add(this.buttonDelete);
            this.Controls.Add(this.buttonAdd);
            this.Controls.Add(this.label5);
            this.Controls.Add(this.buttonBrowse);
            this.Controls.Add(this.textBoxAppDesc);
            this.Controls.Add(this.textBoxApp);
            this.Controls.Add(this.label4);
            this.Controls.Add(this.label3);
            this.Controls.Add(this.textBoxFilePath);
            this.Controls.Add(this.label2);
            this.Controls.Add(this.label1);
            this.MaximizeBox = false;
            this.Name = "FormAutoLoad";
            this.Text = ".NET程序自动加载器";
            this.Load += new System.EventHandler(this.FormAutoLoad_Load);
            this.ResumeLayout(false);
            this.PerformLayout();

        }

        #endregion

        private System.Windows.Forms.Label label1;
        private System.Windows.Forms.Label label2;
        private System.Windows.Forms.TextBox textBoxFilePath;
        private System.Windows.Forms.Label label3;
        private System.Windows.Forms.Label label4;
        private System.Windows.Forms.TextBox textBoxApp;
        private System.Windows.Forms.TextBox textBoxAppDesc;
        private System.Windows.Forms.Button buttonBrowse;
        private System.Windows.Forms.OpenFileDialog openFileDialog1;
        private System.Windows.Forms.Label label5;
        private System.Windows.Forms.Button buttonAdd;
        private System.Windows.Forms.Button buttonDelete;
        private System.Windows.Forms.Button buttonExit;
        private System.Windows.Forms.TextBox textBoxCurCAD;
        private System.Windows.Forms.ListView listViewAssembly;
        private System.Windows.Forms.ColumnHeader columnHeader1;
        private System.Windows.Forms.ColumnHeader columnHeader2;
    }
}

﻿using System;
using System.Drawing;
using System.Linq;
using System.Windows.Forms;

namespace AccessCAD
{
    public partial class FormEmployee : Form
    {
        //表示部门颜色的序列
        internal Color[] colors = new Color[] { Color.Red, Color.Yellow, Color.Green, Color.Cyan, Color.Blue, Color.Magenta, Color.Orange, Color.Brown, Color.Gray };
        public FormEmployee()
        {
            InitializeComponent();

        }

        private void FormEmployee_Load(object sender, EventArgs e)
        {
            //新建一个指向db_sample.mdb数据库的数据集
            using (db_samplesDataSet ds=new db_samplesDataSet())
            {
                // 创建一个用于Employee表的DataAdapter，用于检索数据和填充Employee表
                var empAdapter=new db_samplesDataSetTableAdapters.EmployeeTableAdapter();
                //填充数据集中的Employee表
                empAdapter.Fill(ds.Employee);
                //按照部门对员工进行分组，生成一个部门名和人数的新序列，并按人数降序排列
                var emps=(from emp in ds.Employee
                          group emp by emp.Department into g
                          select new { Department = g.Key, Count = g.Count() }).OrderByDescending(p => p.Count).ToList();
                //遍历部门
                for (int i = 0; i < emps.Count(); i++)
                {

                    //加入部门人数到饼图中
                    var point = this.chartEmployee.Series[0].Points.Add(emps[i].Count);
                    //设置图例文字
                    point.LegendText = emps[i].Department;
                    point.Color = colors[i]; //设置序列的颜色
                }

                //绑定到Datagrid
                this.dataGridViewEmployee.DataSource = emps;
                this.dataGridViewEmployee.Columns[0].HeaderText = "部门";
                this.dataGridViewEmployee.Columns[1].HeaderText = "员工数";
            }
        }
    }
}
﻿namespace AccessCAD
{
    partial class FormEmployee
    {
        /// <summary>
        /// Required designer variable.
        /// </summary>
        private System.ComponentModel.IContainer components = null;

        /// <summary>
        /// Clean up any resources being used.
        /// </summary>
        /// <param name="disposing">true if managed resources should be disposed; otherwise, false.</param>
        protected override void Dispose(bool disposing)
        {
            if (disposing && (components != null))
            {
                components.Dispose();
            }
            base.Dispose(disposing);
        }

        #region Windows Form Designer generated code

        /// <summary>
        /// Required method for Designer support - do not modify
        /// the contents of this method with the code editor.
        /// </summary>
        private void InitializeComponent()
        {
            System.Windows.Forms.DataVisualization.Charting.ChartArea chartArea1 = new System.Windows.Forms.DataVisualization.Charting.ChartArea();
            System.Windows.Forms.DataVisualization.Charting.Legend legend1 = new System.Windows.Forms.DataVisualization.Charting.Legend();
            System.Windows.Forms.DataVisualization.Charting.Series series1 = new System.Windows.Forms.DataVisualization.Charting.Series();
            this.chartEmployee = new System.Windows.Forms.DataVisualization.Charting.Chart();
            this.dataGridViewEmployee = new System.Windows.Forms.DataGridView();
            ((System.ComponentModel.ISupportInitialize)(this.chartEmployee)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.dataGridViewEmployee)).BeginInit();
            this.SuspendLayout();
            // 
            // chartEmployee
            // 
            chartArea1.Area3DStyle.Enable3D = true;
            chartArea1.Name = "ChartArea1";
            this.chartEmployee.ChartAreas.Add(chartArea1);
            this.chartEmployee.Dock = System.Windows.Forms.DockStyle.Left;
            legend1.Docking = System.Windows.Forms.DataVisualization.Charting.Docking.Bottom;
            legend1.Name = "Legend1";
            this.chartEmployee.Legends.Add(legend1);
            this.chartEmployee.Location = new System.Drawing.Point(0, 0);
            this.chartEmployee.Name = "chartEmployee";
            series1.ChartArea = "ChartArea1";
            series1.ChartType = System.Windows.Forms.DataVisualization.Charting.SeriesChartType.Pie;
            series1.CustomProperties = "PieLineColor=Red, MinimumRelativePieSize=10, PieLabelStyle=Outside";
            series1.Label = "#PERCENT{P0}";
            series1.Legend = "Legend1";
            series1.Name = "Series1";
            this.chartEmployee.Series.Add(series1);
            this.chartEmployee.Size = new System.Drawing.Size(317, 310);
            this.chartEmployee.TabIndex = 0;
            this.chartEmployee.Text = "chart1";
            // 
            // dataGridViewEmployee
            // 
            this.dataGridViewEmployee.ColumnHeadersHeightSizeMode = System.Windows.Forms.DataGridViewColumnHeadersHeightSizeMode.AutoSize;
            this.dataGridViewEmployee.Dock = System.Windows.Forms.DockStyle.Fill;
            this.dataGridViewEmployee.Location = new System.Drawing.Point(317, 0);
            this.dataGridViewEmployee.Name = "dataGridViewEmployee";
            this.dataGridViewEmployee.RowTemplate.Height = 23;
            this.dataGridViewEmployee.Size = new System.Drawing.Size(223, 310);
            this.dataGridViewEmployee.TabIndex = 1;
            // 
            // FormEmployee
            // 
            this.AutoScaleDimensions = new System.Drawing.SizeF(6F, 12F);
            this.AutoScaleMode = System.Windows.Forms.AutoScaleMode.Font;
            this.ClientSize = new System.Drawing.Size(540, 310);
            this.Controls.Add(this.dataGridViewEmployee);
            this.Controls.Add(this.chartEmployee);
            this.MaximizeBox = false;
            this.MinimizeBox = false;
            this.Name = "FormEmployee";
            this.Text = "人员组成";
            this.Load += new System.EventHandler(this.FormEmployee_Load);
            ((System.ComponentModel.ISupportInitialize)(this.chartEmployee)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.dataGridViewEmployee)).EndInit();
            this.ResumeLayout(false);

        }

        #endregion

        private System.Windows.Forms.DataGridView dataGridViewEmployee;
        internal System.Windows.Forms.DataVisualization.Charting.Chart chartEmployee;
    }
}﻿using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.IO;
using System.Linq;
using System.Reflection;
using System.Text;
using System.Windows.Forms;
using Autodesk.AutoCAD.ApplicationServices;
using Autodesk.AutoCAD.DatabaseServices;
using DotNetARX;
using AcadApp = Autodesk.AutoCAD.ApplicationServices.Application;
using AcadWnd = Autodesk.AutoCAD.Windows;
namespace CADDialog
{
    public partial class FormLayer : Form
    {
        Document doc;//文档
        Database db;//数据库
        //在对话框存在期间，必须保持事务处理为打开状态
        Transaction trans;//事务处理
        public FormLayer()
        {
            InitializeComponent();
            InitializeListView();//初始化列表视图控件
        }
        private void InitializeListView()
        {
            doc = AcadApp.DocumentManager.MdiActiveDocument;
            db = doc.Database;
            trans = db.TransactionManager.StartTransaction();
            //必须锁定文档，以防止不可预知的错误
            using (DocumentLock loc=doc.LockDocument())
            {
                //定义一个图像列表对象，用于加入列表视图中使用的各种图片
                ImageList imgList=new ImageList();
                //向图像列表添加图片
                imgList.Images.Add(CADResource.IsCurrentTrue);
                imgList.Images.Add(CADResource.IsCurrentFalse);
                imgList.Images.Add(CADResource.IsOffTrue);
                imgList.Images.Add(CADResource.IsOffFalse);
                imgList.Images.Add(CADResource.IsFrozenTrue);
                imgList.Images.Add(CADResource.IsFrozenFalse);
                imgList.Images.Add(CADResource.IsLockedTrue);
                imgList.Images.Add(CADResource.IsLockedFalse);
                imgList.Images.Add(CADResource.IsPlottableTrue);
                imgList.Images.Add(CADResource.IsPlottableFalse);
                imgList.Images.Add(CADResource.ViewportVisibilityDefaultTrue);
                imgList.Images.Add(CADResource.ViewportVisibilityDefaultFalse);
                //为图像列表中的图标设置索引键
                imgList.Images.SetKeyName(0, "IsCurrentTrue");
                imgList.Images.SetKeyName(1, "IsCurrentFalse");
                imgList.Images.SetKeyName(2, "IsOffTrue");
                imgList.Images.SetKeyName(3, "IsOffFalse");
                imgList.Images.SetKeyName(4, "IsFrozenTrue");
                imgList.Images.SetKeyName(5, "IsFrozenFalse");
                imgList.Images.SetKeyName(6, "IsLockedTrue");
                imgList.Images.SetKeyName(7, "IsLockedFalse");
                imgList.Images.SetKeyName(8, "IsPlottableTrue");
                imgList.Images.SetKeyName(9, "IsPlottableFalse");
                imgList.Images.SetKeyName(10, "ViewportVisibilityDefaultTRUE");
                imgList.Images.SetKeyName(11, "ViewportVisibilityDefaultFalse");
                //设置列表视图的小图标
                this.olvLayerManager.SmallImageList = imgList;
                //设置层状态列（图像表示）
                this.ColumnState.ImageGetter = delegate(object o)
                {
                    ObjectId layerId=(ObjectId)o;
                    if (layerId == db.Clayer)
                        return "IsCurrentTrue";//图层为当前层时的图像
                    else
                        return "IsCurrentFalse";//图层不是当前层时的图像
                };
                //设置层名列
                this.ColumnName.AspectGetter = delegate(object o)
                {
                    //获取列表视图中的模型对象:层的ObjectId
                    ObjectId layerId=(ObjectId)o;
                    LayerTableRecord ltr=(LayerTableRecord)layerId.GetObject(OpenMode.ForRead);
                    return ltr.Name;//返回图层名为本列内容
                };

                //设置图层打开状态列（图像表示）
                this.ColumnIsOff.ImageGetter = delegate(object o)
                {
                    ObjectId layerId=(ObjectId)o;
                    LayerTableRecord ltr=(LayerTableRecord)layerId.GetObject(OpenMode.ForRead);
                    if (ltr.IsOff)
                        return "IsOffTrue";//图层关闭的图像
                    else
                        return "IsOffFalse";//图层打开的图像
                };
                //设置图层冻结状态列（图像表示）
                this.ColumnIsFrozen.ImageGetter = delegate(object o)
                {
                    ObjectId layerId=(ObjectId)o;
                    LayerTableRecord ltr=(LayerTableRecord)layerId.GetObject(OpenMode.ForRead);
                    if (ltr.IsFrozen)
                        return "IsFrozenTrue";//图层冻结的图像
                    else
                        return "IsFrozenFalse";//图层未冻结的图像
                };

                //设置图层锁定状态列（图像表示）
                this.ColumnIsLocked.ImageGetter = delegate(object o)
                {
                    ObjectId layerId=(ObjectId)o;
                    LayerTableRecord ltr=(LayerTableRecord)layerId.GetObject(OpenMode.ForRead);
                    if (ltr.IsLocked)
                        return "IsLockedTrue";//图层锁定的图像
                    else
                        return "IsLockedFalse";//图层未锁定的图像
                };
                //设置图层颜色列
                this.ColumnColor.AspectGetter = delegate(object o)
                {
                    ObjectId layerId=(ObjectId)o;
                    LayerTableRecord ltr=(LayerTableRecord)layerId.GetObject(OpenMode.ForRead);
                    return ltr.Color.ColorNameForDisplay;//返回颜色名为本列的显示内容
                };
                //设置线型列
                this.ColumnLinetype.AspectGetter = delegate(object o)
                {
                    ObjectId layerId=(ObjectId)o;
                    LayerTableRecord ltr=(LayerTableRecord)layerId.GetObject(OpenMode.ForRead);
                    //获取图层的线型
                    LinetypeTableRecord lttr=(LinetypeTableRecord)ltr.LinetypeObjectId.GetObject(OpenMode.ForRead);
                    return lttr.Name;//返回图层线型名为本列的显示内容
                };
                //设置线宽列
                this.ColumnLineWeight.AspectGetter = delegate(object o)
                {
                    ObjectId layerId=(ObjectId)o;
                    LayerTableRecord ltr=(LayerTableRecord)layerId.GetObject(OpenMode.ForRead);
                    //获取图层的线宽值(LineWeight枚举)，并将其强制转换为double型
                    double lineWeight=(double)ltr.LineWeight / 100;
                    //设置本列显示的内容
                    if (lineWeight < 0)//线型类型为ByLayer、ByBlock、
                        return "默认";
                    else
                        return lineWeight.ToString("0.00") + " 毫米";
                };
                //设置图层可打印列（图像表示）
                this.ColumnIsPlottable.ImageGetter = delegate(object o)
                {
                    ObjectId layerId=(ObjectId)o;
                    LayerTableRecord ltr=(LayerTableRecord)trans.GetObject(layerId, OpenMode.ForRead);
                    if (ltr.IsPlottable)
                        return "IsPlottableTrue";//图层可打印的图像
                    else
                        return "IsPlottableFalse";//图层不可打印的图像
                };
                //设置打印样式列
                this.ColumnPlotStyleName.AspectGetter = delegate(object o)
                {
                    ObjectId layerId=(ObjectId)o;
                    LayerTableRecord ltr=(LayerTableRecord)layerId.GetObject(OpenMode.ForRead);
                    return ltr.PlotStyleName;//返回图层的打印样式名为本列的显示内容
                };
                //设置冻结新视口列（图像表示）
                this.ColumnViewportVisibilityDefault.ImageGetter = delegate(object o)
                {
                    ObjectId layerId=(ObjectId)o;
                    LayerTableRecord ltr=(LayerTableRecord)trans.GetObject(layerId, OpenMode.ForRead);
                    if (ltr.ViewportVisibilityDefault)
                        return "ViewportVisibilityDefaultTrue";//图层冻结新视口的图像
                    else
                        return "ViewportVisibilityDefaultFalse";//图层不冻结新视口的图像
                };
                //获取所有层表的ObjectId（DotNetARX中LayerTools类的自定义函数）
                List<ObjectId> layers = db.GetAllLayerObjectIds();
                //设置列表视图中需要显示的模型对象
                this.olvLayerManager.SetObjects(layers);
            }
        }

        private void FormLayer_Load(object sender, EventArgs e)
        {
            //获取当前层
            LayerTableRecord layer=db.Clayer.GetObject(OpenMode.ForRead) as LayerTableRecord;
            //设置文本框的内容为当前图层层
            this.textBoxCurrentLayer.Text = "当前图层：" + layer.Name;
        }

        private void olvLayerManager_CellClick(object sender, BrightIdeasSoftware.CellClickEventArgs e)
        {
            if (e.Item == null) return;//如果点击的单元格无内容，则返回
            //为了防止错误，锁定文档
            using (DocumentLock loc=doc.LockDocument())
            {
                //当前列表视图中使用的对象模型（图层的ObjectId）
                ObjectId layerId=(ObjectId)e.Model;
                //打开层表为写的状态
                LayerTableRecord ltr=(LayerTableRecord)layerId.GetObject(OpenMode.ForWrite);
                switch (e.Column.Text)//当前点击的单元格列名
                {
                    case "开"://点击的是图层打开列
                        //如果点击的是当前图层且图层为打开状态
                        if (layerId == db.Clayer && ltr.IsOff == false)
                        {
                            //显示一个警告对象框，提示用户是否关闭当前图层
                            DialogResult dlgRes=MessageBox.Show("当前图层将被关闭。\n是否要使当前图层保持打开状态？", "AutoCAD", MessageBoxButtons.YesNo, MessageBoxIcon.Warning);
                            //如果用户选择“是”按钮，则关闭当前图层
                            if (dlgRes == DialogResult.Yes)
                            {
                                ltr.IsOff = false;
                            }
                        }
                        else
                            ltr.IsOff = !ltr.IsOff;//切换图层的打开状态
                        break;
                    case "冻结"://点击的是图层冻结列
                        if (layerId == db.Clayer)//如果点击的是当前图层
                            //显示一个警告对象框，提示用户不能冻结当前图层
                            MessageBox.Show("不能冻结当前图层。", "AutoCAD", MessageBoxButtons.OK, MessageBoxIcon.Warning);
                        else
                            ltr.IsFrozen = !ltr.IsFrozen;//切换图层的冻结状态
                        break;
                    case "锁定"://点击的是图层锁定列
                        ltr.IsLocked = !ltr.IsLocked;//切换图层的锁定状态
                        break;
                    case "颜色"://点击的是图层颜色列
                        //打开一个AutoCAD颜色对话框
                        AcadWnd.ColorDialog colorDialog=new AcadWnd.ColorDialog();
                        colorDialog.ShowDialog();//显示颜色对话框
                        //设置图层的颜色为用户在颜色对话框中选择的颜色
                        ltr.Color = colorDialog.Color;
                        break;
                    case "线型"://点击的是图层线型列
                        //打开一个AutoCAD线型对话框
                        AcadWnd.LinetypeDialog linetypeDialog=new AcadWnd.LinetypeDialog();
                        linetypeDialog.ShowDialog();//显示线型对话框
                        //设置图层的线型为用户在线型对话框中选择的线型
                        ltr.LinetypeObjectId = linetypeDialog.Linetype;
                        break;
                    case "线宽"://点击的是图层线宽列
                        //打开一个AutoCAD线宽对话框
                        AcadWnd.LineWeightDialog lineWeightDialog=new AcadWnd.LineWeightDialog();
                        lineWeightDialog.ShowDialog();//显示线宽对话框
                        //设置图层的线宽为用户在线宽对话框中选择的线宽
                        ltr.LineWeight = lineWeightDialog.LineWeight;
                        break;
                    case "打印"://点击的是图层可打印列
                        ltr.IsPlottable = !ltr.IsPlottable;//切换图层的可打印状态
                        break;
                    case "冻结新视口"://点击的是图层是否冻结新视口列
                        //切换图层的是否冻结新视口状态
                        ltr.ViewportVisibilityDefault = !ltr.ViewportVisibilityDefault;
                        break;
                }
                //更新当前列表视图中使用的对象模型（图层的ObjectId）
                this.olvLayerManager.RefreshObject(e.Model);
            }
        }

        //设置当前层
        private void buttonSetCurrentLayer_Click(object sender, EventArgs e)
        {
            using (DocumentLock loc=doc.LockDocument())
            {
                //列表实视图中被选择的层
                ObjectId layerId=(ObjectId)this.olvLayerManager.SelectedObject;
                db.Clayer = layerId;//设置该层为当前层
                this.olvLayerManager.BuildList();//更新列表视图的状态
            }
        }
        //新建图层
        private void buttonNewLayer_Click(object sender, EventArgs e)
        {
            using (DocumentLock loc=doc.LockDocument())
            {
                LayerTable lt=(LayerTable)db.LayerTableId.GetObject(OpenMode.ForRead);
                //声明一个列表对象，用于存储当前图形中图层名类似于“图层
                List<int> layerNums=new List<int>();
                foreach (ObjectId layerId in lt)//遍历层表记录
                {
                    LayerTableRecord ltr=(LayerTableRecord)layerId.GetObject(OpenMode.ForRead);
                    //如果图层名以“图层”字样开头
                    if (ltr.Name.StartsWith("图层"))
                    {
                        //将图层名去除“图层”字样后的字符串值
                        string layerNum=ltr.Name.Substring(2);
                        if (layerNum.IsInt())
                            layerNums.Add(Convert.ToInt32(layerNum));
                    }
                }
                //要创建的新图层名的数字编号
                int newLayerNum=layerNums.Count > 0 ? layerNums.Max() + 1 : 1;
                //添加新图层
                ObjectId newLayerId=db.AddLayer("图层" + newLayerNum);
                //更新当前列表视图
                this.olvLayerManager.SetObjects(db.GetAllLayerObjectIds());
            }
        }

        //删除图层
        private void buttonDeleteLayer_Click(object sender, EventArgs e)
        {
            using (DocumentLock loc=doc.LockDocument())
            {
                //获取当前选择的图层名
                string layerName=this.olvLayerManager.SelectedItem.Text;
                //删除选择的图层，并判断是否可以删除
                if (db.DeleteLayer(layerName) == false)
                {
                    AcadApp.ShowAlertDialog("未能删除选定的图层。");
                }
            }
        }
        //新建冻结新视口
        private void buttonNewLayerFrozen_Click(object sender, EventArgs e)
        {
            using (DocumentLock loc=doc.LockDocument())
            {
                LayerTable lt=(LayerTable)db.LayerTableId.GetObject(OpenMode.ForRead);
                List<int> layerNums=new List<int>();
                foreach (ObjectId layerId in lt)
                {
                    LayerTableRecord ltr=(LayerTableRecord)layerId.GetObject(OpenMode.ForRead);
                    if (ltr.Name.StartsWith("图层"))
                    {
                        string layerNum=ltr.Name.Substring(2);
                        if (layerNum.IsInt())
                            layerNums.Add(Convert.ToInt32(layerNum));
                    }
                }
                int newLayerNum=layerNums.Count > 0 ? layerNums.Max() + 1 : 1;
                ObjectId newLayerId=db.AddLayer("图层" + newLayerNum);
                LayerTableRecord newLayer=(LayerTableRecord)newLayerId.GetObject(OpenMode.ForWrite);
                newLayer.ViewportVisibilityDefault = true;//冻结视口
                this.olvLayerManager.SetObjects(db.GetAllLayerObjectIds());
            }
        }
        //确定按钮
        private void buttonOK_Click(object sender, EventArgs e)
        {
            if (trans != null)//如果有事务处理需要提交
            {
                trans.Commit();//提交事务处理
                trans = null;
            }
            this.Dispose();//关闭对话框
        }
        //应用按钮
        private void buttonApply_Click(object sender, EventArgs e)
        {
            if (trans != null)
            {
                trans.Commit();//提交事务处理
                //再次开启事务处理
                trans = db.TransactionManager.StartTransaction();
            }
        }
        //帮助按钮
        private void buttonHelp_Click(object sender, EventArgs e)
        {
            string fullHelpPath = Path.Combine(Tools.GetCurrentPath(), "acad_acr.chm");
            AcadApp.InvokeHelp(fullHelpPath, "d0e55330");
        }
        //取消按钮
        private void buttonCancel_Click(object sender, EventArgs e)
        {
            if (trans != null)
            {
                trans.Abort();//放弃事务处理
                trans = null;
            }
            this.Dispose();
        }
    }
}
﻿namespace CADDialog
{
    partial class FormLayer
    {
        /// <summary>
        /// Required designer variable.
        /// </summary>
        private System.ComponentModel.IContainer components = null;

        /// <summary>
        /// Clean up any resources being used.
        /// </summary>
        /// <param name="disposing">true if managed resources should be disposed; otherwise, false.</param>
        protected override void Dispose(bool disposing)
        {
            if (disposing && (components != null))
            {
                components.Dispose();
            }
            base.Dispose(disposing);
        }

        #region Windows Form Designer generated code

        /// <summary>
        /// Required method for Designer support - do not modify
        /// the contents of this method with the code editor.
        /// </summary>
        private void InitializeComponent()
        {
            this.olvLayerManager = new BrightIdeasSoftware.ObjectListView();
            this.ColumnState = ((BrightIdeasSoftware.OLVColumn)(new BrightIdeasSoftware.OLVColumn()));
            this.ColumnName = ((BrightIdeasSoftware.OLVColumn)(new BrightIdeasSoftware.OLVColumn()));
            this.ColumnIsOff = ((BrightIdeasSoftware.OLVColumn)(new BrightIdeasSoftware.OLVColumn()));
            this.ColumnIsFrozen = ((BrightIdeasSoftware.OLVColumn)(new BrightIdeasSoftware.OLVColumn()));
            this.ColumnIsLocked = ((BrightIdeasSoftware.OLVColumn)(new BrightIdeasSoftware.OLVColumn()));
            this.ColumnColor = ((BrightIdeasSoftware.OLVColumn)(new BrightIdeasSoftware.OLVColumn()));
            this.ColumnLinetype = ((BrightIdeasSoftware.OLVColumn)(new BrightIdeasSoftware.OLVColumn()));
            this.ColumnLineWeight = ((BrightIdeasSoftware.OLVColumn)(new BrightIdeasSoftware.OLVColumn()));
            this.ColumnPlotStyleName = ((BrightIdeasSoftware.OLVColumn)(new BrightIdeasSoftware.OLVColumn()));
            this.ColumnIsPlottable = ((BrightIdeasSoftware.OLVColumn)(new BrightIdeasSoftware.OLVColumn()));
            this.ColumnViewportVisibilityDefault = ((BrightIdeasSoftware.OLVColumn)(new BrightIdeasSoftware.OLVColumn()));
            this.ColumnDescription = ((BrightIdeasSoftware.OLVColumn)(new BrightIdeasSoftware.OLVColumn()));
            this.buttonNewLayer = new System.Windows.Forms.Button();
            this.buttonNewLayerFrozen = new System.Windows.Forms.Button();
            this.buttonDeleteLayer = new System.Windows.Forms.Button();
            this.buttonSetCurrentLayer = new System.Windows.Forms.Button();
            this.textBoxCurrentLayer = new System.Windows.Forms.TextBox();
            this.buttonOK = new System.Windows.Forms.Button();
            this.buttonCancel = new System.Windows.Forms.Button();
            this.buttonHelp = new System.Windows.Forms.Button();
            this.buttonApply = new System.Windows.Forms.Button();
            ((System.ComponentModel.ISupportInitialize)(this.olvLayerManager)).BeginInit();
            this.SuspendLayout();
            // 
            // olvLayerManager
            // 
            this.olvLayerManager.AllColumns.Add(this.ColumnState);
            this.olvLayerManager.AllColumns.Add(this.ColumnName);
            this.olvLayerManager.AllColumns.Add(this.ColumnIsOff);
            this.olvLayerManager.AllColumns.Add(this.ColumnIsFrozen);
            this.olvLayerManager.AllColumns.Add(this.ColumnIsLocked);
            this.olvLayerManager.AllColumns.Add(this.ColumnColor);
            this.olvLayerManager.AllColumns.Add(this.ColumnLinetype);
            this.olvLayerManager.AllColumns.Add(this.ColumnLineWeight);
            this.olvLayerManager.AllColumns.Add(this.ColumnPlotStyleName);
            this.olvLayerManager.AllColumns.Add(this.ColumnIsPlottable);
            this.olvLayerManager.AllColumns.Add(this.ColumnViewportVisibilityDefault);
            this.olvLayerManager.AllColumns.Add(this.ColumnDescription);
            this.olvLayerManager.CellEditActivation = BrightIdeasSoftware.ObjectListView.CellEditActivateMode.SingleClick;
            this.olvLayerManager.Columns.AddRange(new System.Windows.Forms.ColumnHeader[] {
            this.ColumnState,
            this.ColumnName,
            this.ColumnIsOff,
            this.ColumnIsFrozen,
            this.ColumnIsLocked,
            this.ColumnColor,
            this.ColumnLinetype,
            this.ColumnLineWeight,
            this.ColumnPlotStyleName,
            this.ColumnIsPlottable,
            this.ColumnViewportVisibilityDefault,
            this.ColumnDescription});
            this.olvLayerManager.FullRowSelect = true;
            this.olvLayerManager.Location = new System.Drawing.Point(24, 56);
            this.olvLayerManager.Name = "olvLayerManager";
            this.olvLayerManager.ShowGroups = false;
            this.olvLayerManager.ShowImagesOnSubItems = true;
            this.olvLayerManager.Size = new System.Drawing.Size(779, 292);
            this.olvLayerManager.TabIndex = 0;
            this.olvLayerManager.UseCompatibleStateImageBehavior = false;
            this.olvLayerManager.View = System.Windows.Forms.View.Details;
            this.olvLayerManager.CellClick += new System.EventHandler<BrightIdeasSoftware.CellClickEventArgs>(this.olvLayerManager_CellClick);
            // 
            // ColumnState
            // 
            this.ColumnState.IsEditable = false;
            this.ColumnState.Text = "状态";
            // 
            // ColumnName
            // 
            this.ColumnName.AspectName = "";
            this.ColumnName.HeaderTextAlign = System.Windows.Forms.HorizontalAlignment.Center;
            this.ColumnName.IsEditable = false;
            this.ColumnName.Text = "名称";
            this.ColumnName.TextAlign = System.Windows.Forms.HorizontalAlignment.Center;
            // 
            // ColumnIsOff
            // 
            this.ColumnIsOff.AspectName = "";
            this.ColumnIsOff.HeaderTextAlign = System.Windows.Forms.HorizontalAlignment.Center;
            this.ColumnIsOff.IsEditable = false;
            this.ColumnIsOff.Text = "开";
            this.ColumnIsOff.TextAlign = System.Windows.Forms.HorizontalAlignment.Center;
            // 
            // ColumnIsFrozen
            // 
            this.ColumnIsFrozen.AspectName = "";
            this.ColumnIsFrozen.IsEditable = false;
            this.ColumnIsFrozen.Text = "冻结";
            // 
            // ColumnIsLocked
            // 
            this.ColumnIsLocked.AspectName = "";
            this.ColumnIsLocked.IsEditable = false;
            this.ColumnIsLocked.Text = "锁定";
            // 
            // ColumnColor
            // 
            this.ColumnColor.AspectName = "";
            this.ColumnColor.IsEditable = false;
            this.ColumnColor.Text = "颜色";
            // 
            // ColumnLinetype
            // 
            this.ColumnLinetype.AspectName = "";
            this.ColumnLinetype.IsEditable = false;
            this.ColumnLinetype.Text = "线型";
            // 
            // ColumnLineWeight
            // 
            this.ColumnLineWeight.AspectName = "";
            this.ColumnLineWeight.IsEditable = false;
            this.ColumnLineWeight.Text = "线宽";
            // 
            // ColumnPlotStyleName
            // 
            this.ColumnPlotStyleName.AspectName = "";
            this.ColumnPlotStyleName.IsEditable = false;
            this.ColumnPlotStyleName.Text = "打印样式";
            this.ColumnPlotStyleName.Width = 82;
            // 
            // ColumnIsPlottable
            // 
            this.ColumnIsPlottable.AspectName = "";
            this.ColumnIsPlottable.IsEditable = false;
            this.ColumnIsPlottable.Text = "打印";
            // 
            // ColumnViewportVisibilityDefault
            // 
            this.ColumnViewportVisibilityDefault.AspectName = "";
            this.ColumnViewportVisibilityDefault.IsEditable = false;
            this.ColumnViewportVisibilityDefault.Text = "冻结新视口";
            this.ColumnViewportVisibilityDefault.Width = 87;
            // 
            // ColumnDescription
            // 
            this.ColumnDescription.AspectName = "";
            this.ColumnDescription.IsEditable = false;
            this.ColumnDescription.Text = "说明";
            // 
            // buttonNewLayer
            // 
            this.buttonNewLayer.Image = global::CADDialog.CADResource.ButtonNew;
            this.buttonNewLayer.Location = new System.Drawing.Point(34, 24);
            this.buttonNewLayer.Name = "buttonNewLayer";
            this.buttonNewLayer.Size = new System.Drawing.Size(21, 23);
            this.buttonNewLayer.TabIndex = 1;
            this.buttonNewLayer.UseVisualStyleBackColor = true;
            this.buttonNewLayer.Click += new System.EventHandler(this.buttonNewLayer_Click);
            // 
            // buttonNewLayerFrozen
            // 
            this.buttonNewLayerFrozen.Image = global::CADDialog.CADResource.ButtonNewFreeze;
            this.buttonNewLayerFrozen.Location = new System.Drawing.Point(61, 24);
            this.buttonNewLayerFrozen.Name = "buttonNewLayerFrozen";
            this.buttonNewLayerFrozen.Size = new System.Drawing.Size(25, 23);
            this.buttonNewLayerFrozen.TabIndex = 2;
            this.buttonNewLayerFrozen.UseVisualStyleBackColor = true;
            this.buttonNewLayerFrozen.Click += new System.EventHandler(this.buttonNewLayerFrozen_Click);
            // 
            // buttonDeleteLayer
            // 
            this.buttonDeleteLayer.Image = global::CADDialog.CADResource.ButtonDelete;
            this.buttonDeleteLayer.Location = new System.Drawing.Point(92, 24);
            this.buttonDeleteLayer.Name = "buttonDeleteLayer";
            this.buttonDeleteLayer.Size = new System.Drawing.Size(29, 23);
            this.buttonDeleteLayer.TabIndex = 3;
            this.buttonDeleteLayer.UseVisualStyleBackColor = true;
            this.buttonDeleteLayer.Click += new System.EventHandler(this.buttonDeleteLayer_Click);
            // 
            // buttonSetCurrentLayer
            // 
            this.buttonSetCurrentLayer.Image = global::CADDialog.CADResource.IsCurrentTrue;
            this.buttonSetCurrentLayer.Location = new System.Drawing.Point(127, 24);
            this.buttonSetCurrentLayer.Name = "buttonSetCurrentLayer";
            this.buttonSetCurrentLayer.Size = new System.Drawing.Size(28, 23);
            this.buttonSetCurrentLayer.TabIndex = 4;
            this.buttonSetCurrentLayer.UseVisualStyleBackColor = true;
            this.buttonSetCurrentLayer.Click += new System.EventHandler(this.buttonSetCurrentLayer_Click);
            // 
            // textBoxCurrentLayer
            // 
            this.textBoxCurrentLayer.Location = new System.Drawing.Point(179, 26);
            this.textBoxCurrentLayer.Name = "textBoxCurrentLayer";
            this.textBoxCurrentLayer.ReadOnly = true;
            this.textBoxCurrentLayer.Size = new System.Drawing.Size(624, 21);
            this.textBoxCurrentLayer.TabIndex = 5;
            // 
            // buttonOK
            // 
            this.buttonOK.Location = new System.Drawing.Point(380, 355);
            this.buttonOK.Name = "buttonOK";
            this.buttonOK.Size = new System.Drawing.Size(75, 23);
            this.buttonOK.TabIndex = 6;
            this.buttonOK.Text = "确定";
            this.buttonOK.UseVisualStyleBackColor = true;
            this.buttonOK.Click += new System.EventHandler(this.buttonOK_Click);
            // 
            // buttonCancel
            // 
            this.buttonCancel.Location = new System.Drawing.Point(502, 355);
            this.buttonCancel.Name = "buttonCancel";
            this.buttonCancel.Size = new System.Drawing.Size(75, 23);
            this.buttonCancel.TabIndex = 7;
            this.buttonCancel.Text = "取消";
            this.buttonCancel.UseVisualStyleBackColor = true;
            this.buttonCancel.Click += new System.EventHandler(this.buttonCancel_Click);
            // 
            // buttonHelp
            // 
            this.buttonHelp.Location = new System.Drawing.Point(713, 355);
            this.buttonHelp.Name = "buttonHelp";
            this.buttonHelp.Size = new System.Drawing.Size(75, 23);
            this.buttonHelp.TabIndex = 8;
            this.buttonHelp.Text = "帮助(&H)";
            this.buttonHelp.UseVisualStyleBackColor = true;
            this.buttonHelp.Click += new System.EventHandler(this.buttonHelp_Click);
            // 
            // buttonApply
            // 
            this.buttonApply.Location = new System.Drawing.Point(613, 355);
            this.buttonApply.Name = "buttonApply";
            this.buttonApply.Size = new System.Drawing.Size(75, 23);
            this.buttonApply.TabIndex = 9;
            this.buttonApply.Text = "应用(&A)";
            this.buttonApply.UseVisualStyleBackColor = true;
            this.buttonApply.Click += new System.EventHandler(this.buttonApply_Click);
            // 
            // FormLayer
            // 
            this.AutoScaleDimensions = new System.Drawing.SizeF(6F, 12F);
            this.AutoScaleMode = System.Windows.Forms.AutoScaleMode.Font;
            this.ClientSize = new System.Drawing.Size(812, 390);
            this.Controls.Add(this.buttonApply);
            this.Controls.Add(this.buttonHelp);
            this.Controls.Add(this.buttonCancel);
            this.Controls.Add(this.buttonOK);
            this.Controls.Add(this.textBoxCurrentLayer);
            this.Controls.Add(this.buttonSetCurrentLayer);
            this.Controls.Add(this.buttonDeleteLayer);
            this.Controls.Add(this.buttonNewLayerFrozen);
            this.Controls.Add(this.buttonNewLayer);
            this.Controls.Add(this.olvLayerManager);
            this.HelpButton = true;
            this.MaximizeBox = false;
            this.MinimizeBox = false;
            this.Name = "FormLayer";
            this.Text = "图层特性管理器";
            this.Load += new System.EventHandler(this.FormLayer_Load);
            ((System.ComponentModel.ISupportInitialize)(this.olvLayerManager)).EndInit();
            this.ResumeLayout(false);
            this.PerformLayout();

        }

        #endregion

        private BrightIdeasSoftware.ObjectListView olvLayerManager;
        private BrightIdeasSoftware.OLVColumn ColumnName;
        private BrightIdeasSoftware.OLVColumn ColumnIsOff;
        private BrightIdeasSoftware.OLVColumn ColumnState;
        private BrightIdeasSoftware.OLVColumn ColumnIsFrozen;
        private BrightIdeasSoftware.OLVColumn ColumnIsLocked;
        private BrightIdeasSoftware.OLVColumn ColumnColor;
        private BrightIdeasSoftware.OLVColumn ColumnLinetype;
        private BrightIdeasSoftware.OLVColumn ColumnLineWeight;
        private BrightIdeasSoftware.OLVColumn ColumnPlotStyleName;
        private BrightIdeasSoftware.OLVColumn ColumnIsPlottable;
        private BrightIdeasSoftware.OLVColumn ColumnViewportVisibilityDefault;
        private BrightIdeasSoftware.OLVColumn ColumnDescription;
        private System.Windows.Forms.Button buttonNewLayer;
        private System.Windows.Forms.Button buttonNewLayerFrozen;
        private System.Windows.Forms.Button buttonDeleteLayer;
        private System.Windows.Forms.Button buttonSetCurrentLayer;
        private System.Windows.Forms.TextBox textBoxCurrentLayer;
        private System.Windows.Forms.Button buttonOK;
        private System.Windows.Forms.Button buttonCancel;
        private System.Windows.Forms.Button buttonHelp;
        private System.Windows.Forms.Button buttonApply;
    }
}﻿using Autodesk.ADN.AutoCAD;
using Autodesk.AutoCAD.ApplicationServices;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.EditorInput;
using Autodesk.AutoCAD.Geometry;
using Autodesk.AutoCAD.Runtime;
using DotNetARX;
namespace GeoConstraints
{
    public class GeoConstraints
    {
        [CommandMethod("CoinCenter")]
        public void CoinCenter()
        {
            Editor ed = Application.DocumentManager.MdiActiveDocument.Editor;
            Database db = HostApplicationServices.WorkingDatabase;
            using (Transaction trans = db.TransactionManager.StartTransaction())
            {
                // 提示用户选择一个圆，作为所有同心圆的圆心
                ed.WriteMessage("\n请选择第一个圆");
                var cirs = db.GetSelection<Circle>();
                if (cirs.Count != 1) return; // 如果选择的圆数量不是1，则返回
                Circle firstCir = cirs[0]; // 获取选择的圆对象
                cirs.Clear(); // 清空圆对象列表
                // 提示用户选择需要同心的圆
                ed.WriteMessage("\n请选择需要同心的圆");
                cirs = db.GetSelection<Circle>();
                foreach (Circle cir in cirs) // 遍历圆列表
                {
                    // 添加同心约束，让每个圆与第一个圆同心
                    AssocUtil.CreateConcentricConstraint(firstCir.ObjectId, cir.ObjectId, firstCir.Center, cir.Center);
                }
                trans.Commit();
            }
        }

        [CommandMethod("MakeRect")]
        public void MakeRect()
        {
            Editor ed = Application.DocumentManager.MdiActiveDocument.Editor;
            Database db = HostApplicationServices.WorkingDatabase;
            // 提示用户选择一个表示四边形的多段线
            PromptEntityOptions opt = new PromptEntityOptions("请选择一个四边形");
            opt.SetRejectMessage("必须是多段线");
            opt.AddAllowedClass(typeof(Polyline), true);
            PromptEntityResult result = ed.GetEntity(opt);
            if (result.Status != PromptStatus.OK) return; // 如果用户未选择，则返回
            ObjectId id = result.ObjectId; // 获取四边形的Id
            using (Transaction trans = db.TransactionManager.StartTransaction())
            {
                // 获取多段线对象
                Polyline pline = (Polyline)id.GetObject(OpenMode.ForRead);
                // 如果多段线不是四边形（拥有4个顶点且封闭）
                if (pline.NumberOfVertices != 4 && !pline.Closed) return;
                // 声明一个点集对象，用来存储多段线的顶点及中点
                Point3dCollection pts = new Point3dCollection();
                for (int i = 0; i < 8; i++)
                {
                    pts.Add(pline.GetPointAtParameter(i * 0.5));
                }
                // 为多段线添加平行约束，使其成为平行四边形
                AssocUtil.CreateParallelConstraint(id, id, pts[1], pts[5]);
                AssocUtil.CreateParallelConstraint(id, id, pts[3], pts[7]);
                // 为多段线添加水平约束，使其平行于X轴
                AssocUtil.CreateHorizontalConstraint(id, pts[3]);
                // 为多段线添加垂直约束，使其平行于Y轴
                AssocUtil.CreateVerticalConstraint(id, pts[1]);
                // 为多段线添加固定约束，使其一条边保持不动
                AssocUtil.CreateFixConstraint(id, pts[7]);
                trans.Commit();
            }
        }
    }
}
﻿using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using Autodesk.AutoCAD.Geometry;

namespace DotNetARX
{
    /// <summary>
    /// 几何类
    /// </summary>
    public static partial class GeTools
    {
        /// <summary>
        /// 将弧度值转换为角度值
        /// </summary>
        /// <param name="angle">弧度</param>
        /// <returns>返回角度值</returns>
        public static double RadianToDegree(this double angle)
        {
            return angle * (180.0 / Math.PI);
        }

        /// <summary>
        /// 将角度值转换为弧度值
        /// </summary>
        /// <param name="angle">角度</param>
        /// <returns>返回弧度值</returns>
        public static double DegreeToRadian(this double angle)
        {
            return angle * (Math.PI / 180.0);
        }

        /// <summary>
        /// 获取与给定点指定角度和距离的点
        /// </summary>
        /// <param name="point">给定点</param>
        /// <param name="angle">角度</param>
        /// <param name="dist">距离</param>
        /// <returns>返回与给定点指定角度和距离的点</returns>
        public static Point3d PolarPoint(this Point3d point, double angle, double dist)
        {
            return new Point3d(point.X + dist * Math.Cos(angle), point.Y + dist * Math.Sin(angle), point.Z);
        }

        /// <summary>
        /// 获取两个点之间的中点
        /// </summary>
        /// <param name="pt1">第一点</param>
        /// <param name="pt2">第二点</param>
        /// <returns>返回两个点之间的中点</returns>
        public static Point3d MidPoint(Point3d pt1, Point3d pt2)
        {
            Point3d midPoint = new Point3d((pt1.X + pt2.X) / 2.0,
                                        (pt1.Y + pt2.Y) / 2.0,
                                        (pt1.Z + pt2.Z) / 2.0);
            return midPoint;
        }

        /// <summary>
        /// 计算从第一点到第二点所确定的矢量与X轴正方向的夹角
        /// </summary>
        /// <param name="pt1">第一点</param>
        /// <param name="pt2">第二点</param>
        /// <returns>返回两点所确定的矢量与X轴正方向的夹角</returns>
        public static double AngleFromXAxis(this Point3d pt1, Point3d pt2)
        {
            //构建一个从第一点到第二点所确定的矢量
            Vector2d vector=new Vector2d(pt1.X - pt2.X, pt1.Y - pt2.Y);
            //返回该矢量和X轴正半轴的角度（弧度）
            return vector.Angle;
        }
    }
}
﻿using System.Linq;
using Autodesk.AutoCAD.ApplicationServices;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.EditorInput;
using Autodesk.AutoCAD.Runtime;
using DotNetARX;
namespace Groups
{
    public class Groups
    {
        [CommandMethod("MakeGroup")]
        public void MakeGroup()
        {
            Database db=HostApplicationServices.WorkingDatabase;
            Editor ed=Application.DocumentManager.MdiActiveDocument.Editor;
            //提示用户选择需要加入到组中的对象
            PromptSelectionOptions opt=new PromptSelectionOptions();
            opt.MessageForAdding = "\n请选择需要加入到组中的对象";
            PromptSelectionResult result=ed.GetSelection(opt);
            if (result.Status != PromptStatus.OK) return;
            SelectionSet ss=result.Value;//用户选择的对象
            using (Transaction trans=db.TransactionManager.StartTransaction())
            {
                //创建一个名为MyGroup的组，并添加用户选择的实体
                db.CreateGroup("MyGroup", ss.GetObjectIds());
                trans.Commit();
            }
        }

        [CommandMethod("AddEntity")]
        public void AddEntity()
        {
            Database db=HostApplicationServices.WorkingDatabase;
            Editor ed=Application.DocumentManager.MdiActiveDocument.Editor;
            using (Transaction trans=db.TransactionManager.StartTransaction())
            {
                //提示用户选择组对象
                PromptEntityResult entResult=ed.GetEntity("\n请选择组");
                if (entResult.Status != PromptStatus.OK) return;
                //根据选择的对象获得其所在的组
                var groups=entResult.ObjectId.GetGroups();
                if (groups == null) return;
                ObjectId groupId=groups.First();
                //提示用户选择要加入到组中的对象
                PromptSelectionOptions opt=new PromptSelectionOptions();
                opt.MessageForAdding = "\n请选择需要加入到组中的对象";
                PromptSelectionResult result=ed.GetSelection(opt);
                if (result.Status != PromptStatus.OK) return;
                SelectionSet ss=result.Value;
                //添加用户选择的实体到前面选择的组中
                groupId.AppendEntityToGroup(ss.GetObjectIds());
                trans.Commit();
            }
        }

        [CommandMethod("RemoveAllButLines")]
        public void RemoveAllButLines()
        {
            Database db=HostApplicationServices.WorkingDatabase;
            Editor ed=Application.DocumentManager.MdiActiveDocument.Editor;
            using (Transaction trans=db.TransactionManager.StartTransaction())
            {
                //提示用户选择组
                PromptEntityResult entResult=ed.GetEntity("\n请选择组");
                if (entResult.Status != PromptStatus.OK) return;
                //根据选择的对象获得其所在的组
                var groups=entResult.ObjectId.GetGroups();
                if (groups == null) return;
                ObjectId groupId=groups.First();
                //由于要在组中进行去除对象的操作，因此以写的方式打开找到的组对象
                Group group=(Group)trans.GetObject(groupId, OpenMode.ForWrite);
                //获取组对象中的所有实体的ObjectId并进行循环遍历
                ObjectIdList ids=group.GetAllEntityIds();
                foreach (var id in ids)
                {
                    //打开组中的当前对象
                    DBObject obj=trans.GetObject(id, OpenMode.ForRead);
                    if (obj is Line) continue;//如果对象为直线则不进行处理
                    group.Remove(id);//如果对象不是直线，则在组中移除它
                }
                group.SetColorIndex(1);//设置组中所有实体的颜色为红色
                trans.Commit();
            }
        }
    }
}﻿using System.Collections.Generic;
using System.Linq;
using Autodesk.AutoCAD.DatabaseServices;
namespace DotNetARX
{
    /// <summary>
    /// 组操作类
    /// </summary>
    public static class GroupTools
    {
        /// <summary>
        /// 创建组
        /// </summary>
        /// <param name="db">数据库对象</param>
        /// <param name="groupName">组名</param>
        /// <param name="ids">要加入实体的ObjectId集合</param>
        /// <returns>返回组的Id</returns>
        public static ObjectId CreateGroup(this Database db, string groupName, ObjectIdList ids)
        {
            //打开当前数据库的组字典对象
            DBDictionary groupDict=(DBDictionary)db.GroupDictionaryId.GetObject(OpenMode.ForRead);
            //如果已经存在指定名称的组，则返回
            if (groupDict.Contains(groupName)) return ObjectId.Null;
            //新建一个组对象
            Group group=new Group(groupName, true);
            groupDict.UpgradeOpen(); //切换组字典为写的状态
            //在组字典中加入新创建的组对象，并指定它的搜索关键字为groupName
            groupDict.SetAt(groupName, group);
            //通知事务处理完成组对象的加入
            db.TransactionManager.AddNewlyCreatedDBObject(group, true);
            group.Append(ids); // 在组对象中加入实体对象
            groupDict.DowngradeOpen(); //为了安全，将组字典切换成写
            return group.ObjectId; //返回组的Id
        }

        /// <summary>
        /// 向已有组中添加对象
        /// </summary>
        /// <param name="groupId">组对象的Id</param>
        /// <param name="entIds">要加入到组中的实体的ObjectId集合</param>
        public static void AppendEntityToGroup(this ObjectId groupId, ObjectIdList entIds)
        {
            //打开组对象
            Group group=groupId.GetObject(OpenMode.ForRead) as Group;
            if (group == null) return; //如果不是组对象，则返回
            group.UpgradeOpen(); // 切换组为写状态
            group.Append(entIds); // 在组中添加实体对象
            group.DowngradeOpen(); //为了安全，将组切换成写
        }

        /// <summary>
        /// 获取实体对象所在的组
        /// </summary>
        /// <param name="entId">实体的Id</param>
        /// <returns>返回实体所在的组</returns>
        public static IEnumerable<ObjectId> GetGroups(this ObjectId entId)
        {
            DBObject obj=entId.GetObject(OpenMode.ForRead);//打开实体
            //获取实体对象所拥有的永久反应器（组也属性永久反应器之一）
            ObjectIdCollection ids=obj.GetPersistentReactorIds();
            if (ids != null && ids.Count > 0)
            {
                //对实体的永久反应器进行筛选，只返回组
                var groupIds=from ObjectId id in ids
                             //获取永久反应器对象
                             let reactor = id.GetObject(OpenMode.ForRead)
                             //筛选条件设置为Group类
                             where reactor is Group
                             select id;
                if (groupIds.Count() > 0)//如果实体属于组
                    return groupIds;//返回实体所在组的ObjectId
            }
            return null;//没有组，则返回空值
        }

        /// <summary>
        /// 删除组
        /// </summary>
        /// <param name="db">数据库对象</param>
        /// <param name="groupName">组名</param>
        public static void RemoveGroup(this Database db, string groupName)
        {
            //获取数据库的组字典对象
            DBDictionary groupDict=(DBDictionary)db.GroupDictionaryId.GetObject(OpenMode.ForRead);
            //在组字典中搜索关键字为groupName的组对象
            if (groupDict.Contains(groupName)) //如果找到名为groupName的组
            {
                groupDict.UpgradeOpen();
                groupDict.Remove(groupName);  //从组字典中删除组
                groupDict.DowngradeOpen();
            }
        }

    }
}﻿using Autodesk.AutoCAD.Colors;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.Geometry;
using Autodesk.AutoCAD.Runtime;
using DotNetARX;
namespace Hatches
{
    public class Hatches
    {
        [CommandMethod("AddHatch")]
        public void AddHatch()
        {
            Database db=HostApplicationServices.WorkingDatabase;
            //创建一个正六边形
            Polyline polygon=new Polyline();
            polygon.CreatePolygon(new Point2d(500, 200), 6, 30);
            //创建一个圆
            Circle circle=new Circle();
            circle.Center = new Point3d(500, 200, 0);
            circle.Radius = 10;
            using (Transaction trans=db.TransactionManager.StartTransaction())
            {
                //将正六边形和圆添加到模型空间中
                ObjectId polygonId=db.AddToModelSpace(polygon);
                ObjectId circleId=db.AddToModelSpace(circle);
                //创建一个ObjectId集合类对象，用于存储填充边界的ObjectId
                ObjectIdCollection ids=new ObjectIdCollection();
                ids.Add(polygonId);//将正六边形的ObjectId添加到边界集合中
                Hatch hatch=new Hatch();//创建填充对象
                hatch.PatternScale = 0.5;//设置填充图案的比例
                //创建填充图案选项板
                HatchPalletteDialog dlg=new HatchPalletteDialog();
                //显示填充图案选项板
                bool isOK=dlg.ShowDialog();
                //如果用户选择了填充图案，则设置填充图案名为所选的图案名，否则为当前图案名
                string patterName=isOK ? dlg.GetPattern() : HatchTools.CurrentPattern;
                //根据上面的填充图案名创建图案填充，类型为预定义,与边界关联
                hatch.CreateHatch(HatchPatternType.PreDefined, patterName, true);
                //为填充添加外边界（正六边形）
                hatch.AppendLoop(HatchLoopTypes.Outermost, ids);
                ids.Clear();//清空集合以添加新的边界
                ids.Add(circleId);//将圆的ObjectId添加到边界集合中
                //为填充添加内边界（圆）
                hatch.AppendLoop(HatchLoopTypes.Default, ids);
                hatch.EvaluateHatch(true);//计算并显示填充对象
                trans.Commit();//提交更改
            }
        }
        [CommandMethod("AddGradientHatch")]
        public void AddGradientHatch()
        {
            Database db=HostApplicationServices.WorkingDatabase;
            //创建一个三角形
            Polyline triangle=new Polyline();
            triangle.CreatePolygon(new Point2d(550, 200), 3, 30);
            using (Transaction trans=db.TransactionManager.StartTransaction())
            {
                //将三角形添加到模型空间中
                ObjectId triangleId=db.AddToModelSpace(triangle);
                //创建一个ObjectId集合类对象，用于存储填充边界的ObjectId
                ObjectIdCollection ids=new ObjectIdCollection();
                ids.Add(triangleId);//将三角形的ObjectId添加到边界集合中
                Hatch hatch=new Hatch();//创建填充对象
                //创建两个Color类变量，分别表示填充的起始颜色（红）和结束颜色（蓝）
                Color color1=Color.FromColorIndex(ColorMethod.ByLayer, 1);
                Color color2=Color.FromColor(System.Drawing.Color.Blue);
                //创建渐变填充，与边界无关联
                hatch.CreateGradientHatch(HatchGradientName.Cylinder, color1, color2, false);
                //为填充添加边界（三角形）
                hatch.AppendLoop(HatchLoopTypes.Default, ids);
                hatch.EvaluateHatch(true);//计算并显示填充对象
                trans.Commit();//提交更改
            }
        }
    }
}
﻿using System;
using System.Runtime.InteropServices;
using Autodesk.AutoCAD.ApplicationServices;
using Autodesk.AutoCAD.Colors;
using Autodesk.AutoCAD.DatabaseServices;
using System.Security;

namespace DotNetARX
{
    /// <summary>
    /// 渐变色填充的图案名称
    /// </summary>
    public enum HatchGradientName
    {
        /// <summary>
        /// 线状渐变
        /// </summary>
        Linear,
        /// <summary>
        /// 圆柱状渐变
        /// </summary>
        Cylinder,
        /// <summary>
        /// 反圆柱状渐变
        /// </summary>
        Invcylinder,
        /// <summary>
        /// 球状渐变
        /// </summary>
        Spherical,
        /// <summary>
        /// 反球状渐变
        /// </summary>
        Invspherical,
        /// <summary>
        /// 半球状渐变
        /// </summary>
        Hemisperical,
        /// <summary>
        /// 反半球状渐变
        /// </summary>
        InvHemisperical,
        /// <summary>
        /// 抛物面状渐变
        /// </summary>
        Curved,
        /// <summary>
        /// 反抛物面状渐变
        /// </summary>
        Incurved
    }

    /// <summary>
    /// 填充图案选项板类
    /// </summary>
    public class HatchPalletteDialog
    {
        [SuppressUnmanagedCodeSecurity]
        [DllImport("acad.exe", EntryPoint = "?acedHatchPalletteDialog@@YA_NPB_W_NAAPA_W@Z", CharSet = CharSet.Auto)]
        static extern bool acedHatchPalletteDialog(string currentPattern, bool showCustom, out IntPtr newPattern);
        private string pattern;//用于存储用户选择的填充图案名称
        /// <summary>
        /// 是否显示自定义标签
        /// </summary>
        public bool ShowCustom { get; set; }
        /// <summary>
        /// 获取用户选择的填充图案名称
        /// </summary>
        /// <returns>返回填充图案名称</returns>
        public string GetPattern()
        {
            return pattern;
        }
        /// <summary>
        /// 构造函数，在填充图案选项板中显示自定义标签
        /// </summary>
        public HatchPalletteDialog()
        {
            ShowCustom = true;//显示自定义标签
        }
        /// <summary>
        /// 显示填充图案选项板
        /// </summary>
        /// <returns>如果用户选择了填充图案，则返回true，否则返回false</returns>
        public bool ShowDialog()
        {
            IntPtr ptr;//用户选择的
            //显示填充图案选项板
            bool isOK=acedHatchPalletteDialog(HatchTools.CurrentPattern, ShowCustom, out ptr);
            if (!isOK) return false;//如果用户未选择填充图案，返回false
            //用户选择了填充图案，通过指针获得图案名称并将其置为当前名称
            pattern = HatchTools.CurrentPattern = Marshal.PtrToStringAuto(ptr);
            return true;
        }
    }
    /// <summary>
    /// 填充操作类
    /// </summary>
    public static class HatchTools
    {
        /// <summary>
        /// 设置或读取默认填充图案，其名称最多可包含 34 个字符，其中不能有空格。
        /// </summary>
        public static string CurrentPattern
        {
            //获取HPNAME系统变量值，它表示默认的填充图案名
            get { return Application.GetSystemVariable("HPNAME").ToString(); }
            set
            {
                //如果要设置的值符合填充图案名，则设置HPNAME系统变量值
                if (value.Length <= 34 && !value.Contains(" ") && !value.IsNullOrWhiteSpace() && value != CurrentPattern)
                    Application.SetSystemVariable("HPNAME", value);
            }
        }

        /// <summary>
        /// 创建图案填充
        /// </summary>
        /// <param name="hatch">填充对象</param>
        /// <param name="patternType">填充图案类型</param>
        /// <param name="patternName">填充图案名</param>
        /// <param name="associative">填充是否与边界关联</param>
        public static void CreateHatch(this Hatch hatch, HatchPatternType patternType, string patternName, bool associative)
        {
            Database db=HostApplicationServices.WorkingDatabase;
            hatch.SetDatabaseDefaults();//设置填充的默认值
            //设置填充的类型和填充图案名
            hatch.SetHatchPattern(patternType, patternName);
            db.AddToModelSpace(hatch);//将填充添加到模型空间
            //设置填充与边界是否关联
            hatch.Associative = associative ? true : false;
        }

        /// <summary>
        /// 创建渐变色填充
        /// </summary>
        /// <param name="hatch">填充对象</param>
        /// <param name="gradientName">渐变色填充的图案名称</param>
        /// <param name="color1">渐变色填充的起始颜色</param>
        /// <param name="color2">渐变色填充的结束颜色</param>
        /// <param name="associative">填充是否与边界关联</param>
        public static void CreateGradientHatch(this Hatch hatch, HatchGradientName gradientName, Color color1, Color color2, bool associative)
        {
            //设置渐变色填充的类型所代表的字符串，用于将HatchGradientName枚举转换为对应的字符串
            string[] gradientNames=new string[] { "Linear","Cylinder","Invcylinder","Spherical",
                                            "Invspherical","Hemisperical","InvHemisperical","Curved","Incurved"};
            Database db=HostApplicationServices.WorkingDatabase;
            hatch.SetDatabaseDefaults();//设置填充的默认值
            //设置填充的类型为渐变色填充
            hatch.HatchObjectType = HatchObjectType.GradientObject;
            //设置渐变色填充的类型和图案名称
            hatch.SetGradient(GradientPatternType.PreDefinedGradient, gradientNames[(int)gradientName]);
            //新建两个Color类对象，分别表示渐变色填充的起始和结束颜色
            GradientColor gColor1=new GradientColor(color1, 0);
            GradientColor gColor2=new GradientColor(color2, 1);
            //设置渐变色填充的起始和结束颜色
            hatch.SetGradientColors(new GradientColor[] { gColor1, gColor2 });
            db.AddToModelSpace(hatch);//将填充添加到模型空间
            //设置填充与边界是否关联
            hatch.Associative = associative ? true : false;
        }
    }
}
﻿using System.Linq;
using Autodesk.AutoCAD.ApplicationServices;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.EditorInput;
using Autodesk.AutoCAD.Runtime;
using DotNetARX;
namespace HighestPoints
{
    public class HighestPoints
    {
        [CommandMethod("HighestPoints")]
        public void GetHighestPoints()
        {
            Document doc = Application.DocumentManager.MdiActiveDocument;
            Editor ed = doc.Editor;
            Database db = doc.Database;
            using (Transaction trans = db.TransactionManager.StartTransaction())
            {
                //获取模型空间中所有的点，用于LINQ的数据源
                var dbpoints = db.GetEntsInModelSpace<DBPoint>();
                //按Z值降序排列点，选择最大的100个点，并强制执行查询
                var highestPoints = (from p in dbpoints
                                     orderby p.Position.Z descending
                                     select p.Position).Take(100).ToList();
                //对LINQ查询的结果进行循环，依次在命令行输出最高的100个点的值
                for (int i = 0; i < highestPoints.Count; i++)
                {
                    ed.WriteMessage("\n {0} : {1} ", i, highestPoints[i]);
                }
                trans.Commit();
            }
        }
    }
}

﻿using Autodesk.AutoCAD.ApplicationServices;
using Autodesk.AutoCAD.DatabaseServices;
using DotNetARX;

namespace HighlightRule
{
    public class HightLightRule : HighlightOverrule
    {
        public static string GetDoorType(Entity entity)
        {
            string doorType=string.Empty;
            TypedValueList xdata=entity.GetXDataForApplication(Commands.appName);
            if (xdata != null)
            {
                doorType = xdata[1].Value.ToString();
            }
            return doorType;
        }
        public override void Highlight(Entity entity, FullSubentityPath subId, bool highlightAll)
        {
            //获取门的类型
            string doorType=GetDoorType(entity);
            Line line = entity as Line;
            if (line == null || doorType.IsNullOrWhiteSpace()) return;
            Database db= entity.Database;
            Document doc=db.GetDocument();
            //开启事务处理，注意锁定文档
            using (OpenCloseTransaction tran = db.TransactionManager.StartOpenCloseTransaction())
            using (DocumentLock loc=doc.LockDocument())
            {
                line.UpgradeOpen();
                //根据门的类型设置颜色
                switch (doorType)
                {
                    case "木门":
                        line.ColorIndex = 1;//红色
                        break;
                    case "铁门":
                        line.ColorIndex = 2;//黄色
                        break;
                    case "铝合金门":
                        line.ColorIndex = 3;//蓝色
                        break;
                }
                line.DowngradeOpen();
            }
            base.Highlight(entity, subId, highlightAll);
        }
        public override void Unhighlight(Entity entity, FullSubentityPath subId, bool highlightAll)
        {
            Database db= entity.Database;
            Document doc=db.GetDocument();
            string doorType=GetDoorType(entity);
            Line line = entity as Line;
            if (line == null || doorType.IsNullOrWhiteSpace()) return;
            using (OpenCloseTransaction tran = db.TransactionManager.StartOpenCloseTransaction())
            using (DocumentLock loc=doc.LockDocument())
            {
                line.UpgradeOpen();
                line.ColorIndex = 7;//还原直线的颜色为黑色
                line.DowngradeOpen();
            }
            base.Unhighlight(entity, subId, highlightAll);
        }
    }
}
﻿using Autodesk.AutoCAD.ApplicationServices;
using Autodesk.AutoCAD.EditorInput;
using Autodesk.AutoCAD.Runtime;
[assembly: ExtensionApplication(typeof(InitAndOpt.InitClass))]
[assembly: CommandClass(typeof(InitAndOpt.OptimizeClass))]
namespace InitAndOpt
{
    public class InitClass : IExtensionApplication
    {
        public void Initialize()
        {
            Editor ed= Application.DocumentManager.MdiActiveDocument.Editor;
            // 在AutoCAD命令行上显示一些信息，它们会在程序载入时被显示
            ed.WriteMessage("程序开始初始化。");
        }

        public void Terminate()
        {
            // 在Visual Studio 2010的输出窗口上显示程序结束的信息
            System.Diagnostics.Debug.WriteLine(
        "程序结束，你可以在里做一些程序的清理工作，如关闭AutoCAD文档");
        }

        [CommandMethod("InitCommand")]
        public void InitCommand()
        {
            Editor ed = Application.DocumentManager.MdiActiveDocument.Editor;
            ed.WriteMessage("Test");
        }
    }

}
﻿using System;
using Autodesk.AutoCAD.ApplicationServices;
using Autodesk.AutoCAD.Colors;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.EditorInput;
using Autodesk.AutoCAD.Geometry;
using Autodesk.AutoCAD.Runtime;
using DotNetARX;
namespace NetSelection
{
    public class Interactive
    {
        [CommandMethod("AddPoly")]
        public void AddPoly()
        {
            Document doc=Application.DocumentManager.MdiActiveDocument;
            Database db = doc.Database;
            Editor ed = doc.Editor;
            double width = 0; //初始化线宽
            short colorIndex = 0; //初始化颜色索引值
            int index = 2; //初始化多段线顶点数
            ObjectId polyEntId = ObjectId.Null; //声明多段线的ObjectId
            //定义第一个点的用户交互类
            PromptPointOptions optPoint = new PromptPointOptions("\n请输入第一个点<100,200>");
            optPoint.AllowNone = true; //允许用户回车响应
            //返回点的用户提示类
            PromptPointResult resPoint = ed.GetPoint(optPoint);
            //用户按下ESC键，退出
            if (resPoint.Status == PromptStatus.Cancel)
                return;
            Point3d ptStart; //声明第一个输入点
            //用户按回车键
            if (resPoint.Status == PromptStatus.None)
                //得到第一个输入点的默认值
                ptStart = new Point3d(100, 200, 0);
            else
                //得到第一个输入点
                ptStart = resPoint.Value;
            Point3d ptPrevious = ptStart;//保存当前点
            //定义输入下一点的点交互类
            PromptPointOptions optPtKey = new PromptPointOptions("\n请输入下一个点或[线宽(W)/颜色(C)/完成(O)]<O>");
            //为点交互类添加关键字
            optPtKey.Keywords.Add("W");
            optPtKey.Keywords.Add("C");
            optPtKey.Keywords.Add("O");
            optPtKey.Keywords.Default = "O"; //设置默认的关键字
            optPtKey.UseBasePoint = true; //允许使用基准点
            optPtKey.BasePoint = ptPrevious;//设置基准点
            optPtKey.AppendKeywordsToMessage = false;//不将关键字列表添加到提示信息中
            //提示用户输入点
            PromptPointResult resKey = ed.GetPoint(optPtKey);
            //如果用户输入点或关键字，则一直循环
            while (resKey.Status == PromptStatus.OK || resKey.Status == PromptStatus.Keyword)
            {
                Point3d ptNext;//声明下一个输入点
                //如果用户输入的是关键字集合对象中的关键字
                if (resKey.Status == PromptStatus.Keyword)
                {
                    switch (resKey.StringResult)
                    {
                        case "W":
                            width = GetWidth();
                            break;
                        case "C":
                            colorIndex = GetColorIndex();
                            break;
                        case "O":
                            return;
                        default:
                            ed.WriteMessage("\n输入了无效关键字");
                            break;
                    }
                }
                else
                {
                    ptNext = resKey.Value;//得到户输入的下一点
                    if (index == 2) //新建多段线
                    {
                        //提取三维点的X、Y坐标值，转化为二维点
                        Point2d pt1 = new Point2d(ptPrevious[0], ptPrevious[1]);
                        Point2d pt2 = new Point2d(ptNext[0], ptNext[1]);
                        Polyline  polyEnt= new Polyline();//新建一条多段线
                        //给多段线添加顶点，设置线宽
                        polyEnt.AddVertexAt(0, pt1, 0, width, width);
                        polyEnt.AddVertexAt(1, pt2, 0, width, width);
                        //设置多段线的颜色
                        polyEnt.Color = Color.FromColorIndex(ColorMethod.ByColor, colorIndex);
                        //将多段线添加到图形数据库并返回一个ObjectId(在绘图窗口动态显示多段线)
                        polyEntId = db.AddToModelSpace(polyEnt);
                    }
                    else  //修改多段线，添加最后一个顶点
                    {
                        using (Transaction trans = db.TransactionManager.StartTransaction())
                        {
                            //打开多段线的状态为写
                            Polyline  polyEnt=trans.GetObject(polyEntId, OpenMode.ForWrite) as Polyline;
                            if (polyEnt != null)
                            {
                                //继续添加多段线的顶点
                                Point2d ptCurrent = new Point2d(ptNext[0], ptNext[1]);
                                polyEnt.AddVertexAt(index - 1, ptCurrent, 0, width, width);
                                //重新设置多段线的颜色和线宽
                                polyEnt.Color = Color.FromColorIndex(ColorMethod.ByColor, colorIndex);
                                polyEnt.ConstantWidth = width;
                            }
                            trans.Commit();
                        }
                    }
                    index++;
                }
                ptPrevious = ptNext;
                optPtKey.BasePoint = ptPrevious;//重新设置基准点
                resKey = ed.GetPoint(optPtKey); //提示用户输入新的顶点
            }
        }

        // 得到用户输入线宽的函数.
        public double GetWidth()
        {
            Editor ed = Application.DocumentManager.MdiActiveDocument.Editor;
            //定义一个实数的用户交互类.
            PromptDoubleOptions optDou = new PromptDoubleOptions("\n请输入线宽");
            optDou.AllowNegative = false; //不允许输入负数
            optDou.DefaultValue = 0; //设置默认值
            PromptDoubleResult resDou = ed.GetDouble(optDou);
            if (resDou.Status == PromptStatus.OK)
            {
                Double width = resDou.Value;
                return width; //得到用户输入的线宽
            }
            else
                return 0;
        }

        // 得到用户输入颜色索引值的函数.
        public short GetColorIndex()
        {
            Editor ed = Application.DocumentManager.MdiActiveDocument.Editor;
            //定义一个整数的用户交互类
            PromptIntegerOptions optInt = new PromptIntegerOptions("\n请输入颜色索引值(0～256)");
            optInt.DefaultValue = 0; //设置默认值
            //返回一个整数提示类
            PromptIntegerResult resInt = ed.GetInteger(optInt);
            if (resInt.Status == PromptStatus.OK)
            {
                //得到用户输入的颜色索引值
                short colorIndex = (short)resInt.Value;
                if (colorIndex > 256 | colorIndex < 0)
                    return 0;
                else
                    return colorIndex;
            }
            else
                return 0;
        }
    }
}
﻿using System.Linq;
using Autodesk.AutoCAD.ApplicationServices;
using Autodesk.AutoCAD.Colors;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.EditorInput;
using Autodesk.AutoCAD.Runtime;
using DotNetARX;
namespace Layers
{
    public class Layers
    {
        [CommandMethod("CreateLayer")]
        public void CreateLayer()
        {
            Database db=HostApplicationServices.WorkingDatabase;
            Editor ed=Application.DocumentManager.MdiActiveDocument.Editor;
            string layerName="";//存储图层名
            using (Transaction trans=db.TransactionManager.StartTransaction())
            {
                while (layerName == "")//如果用户没有输入图层名，则循环
                {
                    //提示用户输入图层名
                    PromptResult pr=ed.GetString("请输入图层名称");
                    if (pr.Status != PromptStatus.OK) return;
                    try
                    {
                        //验证输入字符串是否符合符号表命名规则
                        SymbolUtilityServices.ValidateSymbolName(pr.StringResult, false);
                        layerName = pr.StringResult;//图层名
                        //添加名为layerName的图层
                        if (db.AddLayer(layerName) != ObjectId.Null)
                        {
                            ///提示用户输入图层颜色
                            PromptIntegerResult pir=ed.GetInteger("请输入层的颜色值");
                            if (pir.Status != PromptStatus.OK) return;
                            //设置图层的颜色
                            db.SetLayerColor(layerName, (short)pir.Value);
                            //设置新添加的图层为当前层
                            db.SetCurrentLayer(layerName);
                            break;//添加图层成功，跳出循环
                        }
                    }
                    catch (Autodesk.AutoCAD.Runtime.Exception ex)
                    {
                        //捕捉到异常,说明传入图层名不合法
                        ed.WriteMessage(ex.Message + "\n");
                    }
                }
                trans.Commit();
            }
        }

        [CommandMethod("DelRedLayer")]
        public void DelRedLayer()
        {
            Database db=HostApplicationServices.WorkingDatabase;
            using (Transaction trans=db.TransactionManager.StartTransaction())
            {
                //获取当前图形中所有颜色为红色的图层层名
                var redLayers=(from layer in db.GetAllLayers()
                               where layer.Color == Color.FromColorIndex(ColorMethod.ByAci, 1)
                               select layer.Name).ToList();
                //删除红色的图层
                redLayers.ForEach(layer => db.DeleteLayer(layer));
                trans.Commit();
            }
        }
    }
}
﻿using System.Collections.Generic;
using Autodesk.AutoCAD.Colors;
using Autodesk.AutoCAD.DatabaseServices;

namespace DotNetARX
{
    /// <summary>
    /// 图层操作类
    /// </summary>
    public static class LayerTools
    {
        /// <summary>
        /// 创建新图层
        /// </summary>
        /// <param name="db">数据库对象</param>
        /// <param name="layerName">图层名</param>
        /// <returns>返回新建图层的ObjectId</returns>
        public static ObjectId AddLayer(this Database db, string layerName)
        {
            //打开层表
            LayerTable lt=(LayerTable)db.LayerTableId.GetObject(OpenMode.ForRead);
            if (!lt.Has(layerName))//如果不存在名为layerName的图层，则新建一个图层
            {
                //定义一个新的层表记录
                LayerTableRecord ltr=new LayerTableRecord();
                ltr.Name = layerName;//设置图层名
                lt.UpgradeOpen();//切换层表的状态为写以添加新的图层
                //将层表记录的信息添加到层表中
                lt.Add(ltr);
                //把层表记录添加到事务处理中
                db.TransactionManager.AddNewlyCreatedDBObject(ltr, true);
                lt.DowngradeOpen();//为了安全，将层表的状态切换为读
            }
            return lt[layerName];//返回新添加的层表记录的ObjectId
        }

        /// <summary>
        /// 设置图层的颜色
        /// </summary>
        /// <param name="db">数据库对象</param>
        /// <param name="layerName">图层名</param>
        /// <param name="colorIndex">颜色索引</param>
        /// <returns>如果成功设置图层颜色，则返回true，否则返回false</returns>
        public static bool SetLayerColor(this Database db, string layerName, short colorIndex)
        {
            //打开层表
            LayerTable lt=(LayerTable)db.LayerTableId.GetObject(OpenMode.ForRead);
            //如果不存在名为layerName的图层，则返回
            if (!lt.Has(layerName)) return false;
            ObjectId layerId=lt[layerName];//获取名为layerName的层表记录的Id
            //以写的方式打开名为layerName的层表记录
            LayerTableRecord ltr=(LayerTableRecord)layerId.GetObject(OpenMode.ForWrite);
            //设置图层的颜色
            ltr.Color = Color.FromColorIndex(ColorMethod.ByAci, colorIndex);
            ltr.DowngradeOpen();//为了安全，将图层的状态切换为读
            return true;//设置图层颜色成功
        }

        /// <summary>
        /// 将指定的图层设置为当前层
        /// </summary>
        /// <param name="db">数据库对象</param>
        /// <param name="layerName">图层名</param>
        /// <returns>如果设置成功，则返回ture</returns>
        public static bool SetCurrentLayer(this Database db, string layerName)
        {
            //打开层表
            LayerTable lt=(LayerTable)db.LayerTableId.GetObject(OpenMode.ForRead);
            //如果不存在名为layerName的图层，则返回
            if (!lt.Has(layerName)) return false;
            //获取名为layerName的层表记录的Id
            ObjectId layerId=lt[layerName];
            //如果指定的图层为当前层，则返回
            if (db.Clayer == layerId) return false;
            db.Clayer = layerId;//指定当前层
            return true;//指定当前图层成功
        }

        /// <summary>
        /// 获取当前图形中所有的图层
        /// </summary>
        /// <param name="db">数据库对象</param>
        /// <returns>返回所有的层表记录</returns>
        public static List<LayerTableRecord> GetAllLayers(this Database db)
        {
            //打开层表
            LayerTable lt=(LayerTable)db.LayerTableId.GetObject(OpenMode.ForRead);
            //用于返回层表记录的列表
            List<LayerTableRecord> ltrs=new List<LayerTableRecord>();
            foreach (ObjectId id in lt)//遍历层表
            {
                //打开层表记录
                LayerTableRecord ltr=(LayerTableRecord)id.GetObject(OpenMode.ForRead);
                ltrs.Add(ltr);//添加到返回列表中
            }
            return ltrs;//返回所有的层表记录
        }

        /// <summary>
        /// 删除指定名称的图层
        /// </summary>
        /// <param name="db">数据库对象</param>
        /// <param name="layerName">图层名</param>
        /// <returns>如果删除成功，则返回true，否则返回false</returns>
        public static bool DeleteLayer(this Database db, string layerName)
        {
            //打开层表
            LayerTable lt=(LayerTable)db.LayerTableId.GetObject(OpenMode.ForRead);
            //如果层名为0或Defpoints，则返回（这两个图层不能删除）
            if (layerName == "0" || layerName == "Defpoints") return false;
            //如果不存在名为layerName的图层，则返回
            if (!lt.Has(layerName)) return false;
            ObjectId layerId=lt[layerName];//获取名为layerName的层表记录的Id
            //如果要删除的图层为当前层，则返回（不能删除当前层）
            if (layerId == db.Clayer) return false;
            //打开名为layerName的层表记录
            LayerTableRecord ltr=(LayerTableRecord)layerId.GetObject(OpenMode.ForRead);
            //如果要删除的图层包含对象或依赖外部参照，则返回（不能删除这些层）
            lt.GenerateUsageData();
            if (ltr.IsUsed) return false;
            ltr.UpgradeOpen();//切换层表记录为写的状态
            ltr.Erase(true);//删除名为layerName的图层
            return true;//删除图层成功
        }

        /// <summary>
        /// 获取所有图层的ObjectId
        /// </summary>
        /// <param name="db">数据库对象</param>
        /// <returns>返回所有图层的ObjectId</returns>
        public static List<ObjectId> GetAllLayerObjectIds(this Database db)
        {
            //打开层表
            LayerTable lt=(LayerTable)db.LayerTableId.GetObject(OpenMode.ForRead);
            //用于返回层表记录ObjectId的列表
            List<ObjectId> ltrs=new List<ObjectId>();
            //遍历层表
            foreach (ObjectId id in lt)
            {
                ltrs.Add(id);//添加到返回列表中
            }
            return ltrs;//返回所有的层表记录的ObjectId
        }
    }
}
﻿#pragma checksum "..\..\..\LayerWindow.xaml" "{406ea660-64cf-4c82-b6f0-42d48172a799}" "2DCB0AABDC2B781525444BA94D6AB93C"
//------------------------------------------------------------------------------
// <auto-generated>
//     此代码由工具生成。
//     运行时版本:4.0.30319.225
//
//     对此文件的更改可能会导致不正确的行为，并且如果
//     重新生成代码，这些更改将会丢失。
// </auto-generated>
//------------------------------------------------------------------------------

using Autodesk.AutoCAD.ApplicationServices;
using System;
using System.Diagnostics;
using System.Windows;
using System.Windows.Automation;
using System.Windows.Controls;
using System.Windows.Controls.Primitives;
using System.Windows.Data;
using System.Windows.Documents;
using System.Windows.Forms.Integration;
using System.Windows.Ink;
using System.Windows.Input;
using System.Windows.Markup;
using System.Windows.Media;
using System.Windows.Media.Animation;
using System.Windows.Media.Effects;
using System.Windows.Media.Imaging;
using System.Windows.Media.Media3D;
using System.Windows.Media.TextFormatting;
using System.Windows.Navigation;
using System.Windows.Shapes;
using System.Windows.Shell;


namespace Wpfs {
    
    
    /// <summary>
    /// LayerWindow
    /// </summary>
    [System.CodeDom.Compiler.GeneratedCodeAttribute("PresentationBuildTasks", "4.0.0.0")]
    public partial class LayerWindow : System.Windows.Window, System.Windows.Markup.IComponentConnector {
        
        private bool _contentLoaded;
        
        /// <summary>
        /// InitializeComponent
        /// </summary>
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        public void InitializeComponent() {
            if (_contentLoaded) {
                return;
            }
            _contentLoaded = true;
            System.Uri resourceLocater = new System.Uri("/Wpfs;component/layerwindow.xaml", System.UriKind.Relative);
            
            #line 1 "..\..\..\LayerWindow.xaml"
            System.Windows.Application.LoadComponent(this, resourceLocater);
            
            #line default
            #line hidden
        }
        
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [System.ComponentModel.EditorBrowsableAttribute(System.ComponentModel.EditorBrowsableState.Never)]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Design", "CA1033:InterfaceMethodsShouldBeCallableByChildTypes")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Maintainability", "CA1502:AvoidExcessiveComplexity")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1800:DoNotCastUnnecessarily")]
        void System.Windows.Markup.IComponentConnector.Connect(int connectionId, object target) {
            this._contentLoaded = true;
        }
    }
}

﻿#pragma checksum "..\..\..\LayerWindow.xaml" "{406ea660-64cf-4c82-b6f0-42d48172a799}" "2DCB0AABDC2B781525444BA94D6AB93C"
//------------------------------------------------------------------------------
// <auto-generated>
//     此代码由工具生成。
//     运行时版本:4.0.30319.225
//
//     对此文件的更改可能会导致不正确的行为，并且如果
//     重新生成代码，这些更改将会丢失。
// </auto-generated>
//------------------------------------------------------------------------------

using Autodesk.AutoCAD.ApplicationServices;
using System;
using System.Diagnostics;
using System.Windows;
using System.Windows.Automation;
using System.Windows.Controls;
using System.Windows.Controls.Primitives;
using System.Windows.Data;
using System.Windows.Documents;
using System.Windows.Forms.Integration;
using System.Windows.Ink;
using System.Windows.Input;
using System.Windows.Markup;
using System.Windows.Media;
using System.Windows.Media.Animation;
using System.Windows.Media.Effects;
using System.Windows.Media.Imaging;
using System.Windows.Media.Media3D;
using System.Windows.Media.TextFormatting;
using System.Windows.Navigation;
using System.Windows.Shapes;
using System.Windows.Shell;


namespace Wpfs {
    
    
    /// <summary>
    /// LayerWindow
    /// </summary>
    [System.CodeDom.Compiler.GeneratedCodeAttribute("PresentationBuildTasks", "4.0.0.0")]
    public partial class LayerWindow : System.Windows.Window, System.Windows.Markup.IComponentConnector {
        
        private bool _contentLoaded;
        
        /// <summary>
        /// InitializeComponent
        /// </summary>
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        public void InitializeComponent() {
            if (_contentLoaded) {
                return;
            }
            _contentLoaded = true;
            System.Uri resourceLocater = new System.Uri("/Wpfs;component/layerwindow.xaml", System.UriKind.Relative);
            
            #line 1 "..\..\..\LayerWindow.xaml"
            System.Windows.Application.LoadComponent(this, resourceLocater);
            
            #line default
            #line hidden
        }
        
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [System.ComponentModel.EditorBrowsableAttribute(System.ComponentModel.EditorBrowsableState.Never)]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Design", "CA1033:InterfaceMethodsShouldBeCallableByChildTypes")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Maintainability", "CA1502:AvoidExcessiveComplexity")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1800:DoNotCastUnnecessarily")]
        void System.Windows.Markup.IComponentConnector.Connect(int connectionId, object target) {
            this._contentLoaded = true;
        }
    }
}

﻿using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Windows;
using System.Windows.Controls;
using System.Windows.Data;
using System.Windows.Documents;
using System.Windows.Input;
using System.Windows.Media;
using System.Windows.Media.Imaging;
using System.Windows.Navigation;
using System.Windows.Shapes;

namespace Wpfs
{
    /// <summary>
    /// MainWindow.xaml 的交互逻辑
    /// </summary>
    public partial class LayerWindow : Window
    {
        public LayerWindow()
        {
            InitializeComponent();
        }
    }
}
﻿using System.IO;
using Autodesk.AutoCAD.ApplicationServices;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.EditorInput;
using Autodesk.AutoCAD.Runtime;
using DotNetARX;
namespace Layouts
{
    public class Layouts
    {
        [CommandMethod("CopyLayout")]
        public void CopyLayout()
        {
            // 打开模板图形
            Editor ed = Application.DocumentManager.MdiActiveDocument.Editor;
            string fileName = Tools.GetCurrentPath() + "\\布局模板图形.dwg";
            if (!File.Exists(fileName))
            {
                ed.WriteMessage("\n未找到需要的模板图形.");
                return;
            }
            Database templateDb = new Database(false, false);
            templateDb.ReadDwgFile(fileName, FileShare.ReadWrite, true, "");
            Database db = HostApplicationServices.WorkingDatabase;
            string layoutName = "新建打印布局";
            using (Transaction trans = db.TransactionManager.StartTransaction())
            {
                // 创建新布局
                LayoutManager lm = LayoutManager.Current;
                ObjectId layoutId = lm.GetLayoutId(layoutName);
                if (layoutId != ObjectId.Null) lm.DeleteLayout(layoutName);
                layoutId = lm.CreateLayout(layoutName);
                Layout layout = (Layout)layoutId.GetObject(OpenMode.ForWrite);
                layout.Initialize(); 
                lm.CurrentLayout = layoutName;
                // 删除布局中的所有实体
                ObjectIdCollection entIds = layout.GetEntsInLayout(true);
                foreach (ObjectId entId in entIds)
                {
                    Entity ent = entId.GetObject(OpenMode.ForWrite) as Entity;
                    ent.Erase();
                }
                // 获得模板图中的布局ID
                ObjectIdCollection entIdsInLayout = new ObjectIdCollection();
                ObjectId srcLayoutId = templateDb.GetLayoutId("模板布局", ref entIdsInLayout);
                ObjectId newBtrId = new ObjectId();
                if (srcLayoutId.IsValid)
                {
                    // 复制布局中的所有实体
                    Layout srcLayout = (Layout)srcLayoutId.GetObject(OpenMode.ForRead);
                    layout.CopyFrom(srcLayout);
                    newBtrId = layout.BlockTableRecordId;
                }
                // 将模板布局中的实体复制到新布局
                if (entIdsInLayout.Count > 0)
                {
                    IdMapping idMap = new IdMapping();
                    templateDb.WblockCloneObjects(entIdsInLayout, newBtrId, idMap, DuplicateRecordCloning.Replace, false);
                }
                trans.Commit();
            }
            templateDb.Dispose();
            // 布局和视口居中显示
            db.CenterLayoutViewport(layoutName);
        }
    }
}
﻿using System;
using System.Collections.Generic;
using System.Linq;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.Geometry;
namespace DotNetARX
{
    /// <summary>
    /// 布局操作类
    /// </summary>
    public static class LayoutTools
    {
        /// <summary>
        /// 获取数据库的所有布局
        /// </summary>
        /// <param name="db">数据库对象</param>
        /// <returns>返回所有布局</returns>
        public static List<Layout> GetAllLayouts(this Database db)
        {
            List<Layout> layouts = new List<Layout>();
            BlockTable bt = (BlockTable)db.BlockTableId.GetObject(OpenMode.ForRead);
            foreach (ObjectId id in bt)
            {
                BlockTableRecord btr = (BlockTableRecord)id.GetObject(OpenMode.ForRead);
                if (btr.IsLayout && btr.Name.ToUpper() != BlockTableRecord.ModelSpace.ToUpper())
                {
                    Layout layout = (Layout)btr.LayoutId.GetObject(OpenMode.ForRead);
                    layouts.Add(layout);
                }
            }
            return layouts.OrderBy(layout => layout.TabOrder).ToList();
        }

        /// <summary>
        /// 用于获得指定布局上的所有实体
        /// </summary>
        /// <param name="layout">布局对象</param>
        /// <param name="bIncludeFirstViewport">是否将第一个视口包含在内</param>
        /// <returns>返回所有实体的Id集合</returns>
        public static ObjectIdCollection GetEntsInLayout(this Layout layout, bool bIncludeFirstViewport)
        {
            ObjectIdCollection entIds = new ObjectIdCollection();
            ObjectId blkDefId = layout.BlockTableRecordId;
            BlockTableRecord btr = blkDefId.GetObject(OpenMode.ForRead) as BlockTableRecord;
            if (btr == null) return null;
            bool bFirstViewport = true;
            foreach (ObjectId entId in btr)
            {
                Viewport vp = entId.GetObject(OpenMode.ForRead) as Viewport;
                if (vp != null && bFirstViewport)
                {
                    if (bIncludeFirstViewport) entIds.Add(entId);
                    bFirstViewport = false;
                }
                else entIds.Add(entId);
                ObjectId dictId = vp.ExtensionDictionary;
                if (dictId.IsValid)
                {
                    DBDictionary dict = (DBDictionary)dictId.GetObject(OpenMode.ForWrite);
                    dict.TreatElementsAsHard = true;
                }
            }
            return entIds;
        }

        /// <summary>
        /// 在指定的图形数据库中寻找特定名称的布局，并且输出该布局中包含的所有实体
        /// </summary>
        /// <param name="db">数据库对象</param>
        /// <param name="name">布局名称</param>
        /// <param name="entIds">布局中包含的所有实体的Id集合</param>
        /// <returns>返回布局的Id</returns>
        public static ObjectId GetLayoutId(this Database db, string name, ref ObjectIdCollection entIds)
        {
            ObjectId layoutId = new ObjectId();
            BlockTable bt = db.BlockTableId.GetObject(OpenMode.ForRead) as BlockTable;
            foreach (ObjectId btrId in bt)
            {
                BlockTableRecord btr = (BlockTableRecord)btrId.GetObject(OpenMode.ForRead);
                if (btr.IsLayout)
                {
                    Layout layout = (Layout)btr.LayoutId.GetObject(OpenMode.ForRead);
                    if (layout.LayoutName.CompareTo(name) == 0)
                    {
                        layoutId = btr.LayoutId;
                        // 获取布局中的所有实体
                        entIds = layout.GetEntsInLayout(true);
                        break;
                    }
                }
            }
            return layoutId;
        }

        /// <summary>
        /// 确保布局中的图纸显示在布局中的中间，而不需要使用缩放命令来显示
        /// </summary>
        /// <param name="db">数据库对象</param>
        /// <param name="layoutName">布局的名称</param>
        public static void CenterLayoutViewport(this Database db, string layoutName)
        {
            Extents3d ext = db.GetAllEntsExtent();
            using (Transaction trans = db.TransactionManager.StartTransaction())
            {
                BlockTable bt = db.BlockTableId.GetObject(OpenMode.ForRead) as BlockTable;
                foreach (ObjectId btrId in bt)
                {
                    BlockTableRecord btr = btrId.GetObject(OpenMode.ForRead) as BlockTableRecord;
                    if (btr.IsLayout)
                    {
                        Layout layout = btr.LayoutId.GetObject(OpenMode.ForRead) as Layout;
                        if (layout.LayoutName.CompareTo(layoutName) == 0)
                        {
                            int vpIndex = 0;
                            ObjectId firstViewportId = new ObjectId();
                            ObjectId secondViewportId = new ObjectId();
                            foreach (ObjectId entId in btr)
                            {
                                Entity ent = entId.GetObject(OpenMode.ForWrite) as Entity;
                                if (ent is Viewport)
                                {
                                    if (vpIndex == 0)
                                    {
                                        firstViewportId = entId;
                                        vpIndex++;
                                    }
                                    else if (vpIndex == 1)
                                    {
                                        secondViewportId = entId;
                                    }
                                }
                            }
                            // 布局复制过来之后得到了两个视口，第一个视口与模型空间关联，第二个视口则是在正确的位置上
                            if (firstViewportId.IsValid && secondViewportId.IsValid)
                            {
                                Viewport secondVP = secondViewportId.GetObject(OpenMode.ForWrite) as Viewport;
                                secondVP.ColorIndex = 1;
                                secondVP.Erase();
                                Viewport firstVP = firstViewportId.GetObject(OpenMode.ForWrite) as Viewport;
                                firstVP.CenterPoint = secondVP.CenterPoint;
                                firstVP.Height = secondVP.Height;
                                firstVP.Width = secondVP.Width;
                                firstVP.ColorIndex = 5;
                                Point3d midPt = GeTools.MidPoint(ext.MinPoint, ext.MaxPoint);
                                firstVP.ViewCenter = new Point2d(midPt.X, midPt.Y); ;
                                double xScale = secondVP.Width / ((ext.MaxPoint.X - ext.MinPoint.X) * 1.1);
                                double yScale = secondVP.Height / ((ext.MaxPoint.Y - ext.MinPoint.Y) * 1.1);
                                firstVP.CustomScale = Math.Min(xScale, yScale);
                            }
                        }
                    }
                }
                trans.Commit();
            }
        }
    }
}
﻿using System;
using System.Collections.Generic;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.Geometry;
using Autodesk.AutoCAD.Runtime;
using DotNetARX;
namespace Leaders
{
    public class Leaders
    {
        [CommandMethod("AddLeader")]
        public void AddLeader()
        {
            Database db=HostApplicationServices.WorkingDatabase;
            using (Transaction trans=db.TransactionManager.StartTransaction())
            {
                //创建一个在原点直径为0.219的圆。
                Circle circle=new Circle();
                circle.Center = Point3d.Origin;
                circle.Diameter = 0.219;
                //创建一个多行文本并设置其内容为4Xφd±0.005（其中d为圆的直径）
                MText txt=new MText();
                txt.Contents = "4X" + TextSpecialSymbol.Diameter + circle.Diameter + TextSpecialSymbol.Tolerance + "0.005";
                txt.Location = new Point3d(1, 1, 0);//文本位置
                txt.TextHeight = 0.2;//文本高度 
                db.AddToModelSpace(circle, txt);//将圆和文本添加到模型空间中                                
                Leader leader=new Leader();//创建一个引线对象
                //将圆上一点及文本位置作为引线的顶点
                leader.AppendVertex(circle.Center.PolarPoint(Math.PI / 3, circle.Radius));
                leader.AppendVertex(txt.Location);
                db.AddToModelSpace(leader);//将引线添加到模型空间中
                leader.Dimgap = 0.1;//设置引线的文字偏移为0.1
                leader.Dimasz = 0.1;//设置引线的箭头大小为0.1
                leader.Annotation = txt.ObjectId;//设置引线的注释对象为文本
                leader.EvaluateLeader();//计算引线及其关联注释之间的关系
                trans.Commit();//提交更改
            }
        }
        [CommandMethod("AddCoordMLeader")]
        public void AddCoordMLeader()
        {
            Database db=HostApplicationServices.WorkingDatabase;
            //获取符号为无的箭头块的ObjectId
            ObjectId arrowId=db.GetArrowObjectId(DimArrowBlock.None);
            //如果当前图形中还未加入上述箭头块，则加入并获取其ObjectId
            if (arrowId == ObjectId.Null)
            {
                DimTools.ArrowBlock = DimArrowBlock.None;
                arrowId = db.GetArrowObjectId(DimArrowBlock.None);
            }
            using (Transaction trans=db.TransactionManager.StartTransaction())
            {
                Point3d ptCoord=new Point3d(80, 30, 0);//要标注的坐标点
                MText mtext=new MText();//新建多行文本
                //设置多行文本的内容为点的坐标值，并且分两行表示
                mtext.Contents = "X:" + ptCoord.X.ToString("0.000") + @"\PY:" + ptCoord.Y.ToString("0.000");
                mtext.LineSpacingFactor = 0.8;//多行文本的行间距
                MLeader leader=new MLeader();//创建多重引线
                //为多重引线添加引线束，引线束由基线和一些单引线构成
                int leaderIndex=leader.AddLeader();
                //在引线束中添加单引线
                int lineIndex=leader.AddLeaderLine(leaderIndex);
                //在单引线中添加引线头点（引线箭头所指向的点），位置为要进行标注的点
                leader.AddFirstVertex(lineIndex, ptCoord);
                //在单引线中添加引线终点
                leader.AddLastVertex(lineIndex, ptCoord.PolarPoint(Math.PI / 4, 10));
                //设置单引线的注释类型为多行文本
                leader.ContentType = ContentType.MTextContent;
                leader.MText = mtext;//设置单引线的注释文字
                //将多重引线添加到模型空间
                db.AddToModelSpace(leader);
                leader.ArrowSymbolId = arrowId;//设置单引线的箭头块ObjectId
                leader.DoglegLength = 0;//设置单引线的基线长度为0
                //将基线连接到引线文字的下方并且绘制下划线
                leader.TextAttachmentType = TextAttachmentType.AttachmentBottomOfTopLine;
                trans.Commit();
            }
        }
        [CommandMethod("AddMLeader")]
        public void AddMLeader()
        {
            Database db=HostApplicationServices.WorkingDatabase;
            using (Transaction trans=db.TransactionManager.StartTransaction())
            {
                //创建3个点，分别表示引线的终点和两个头点
                Point3d ptEnd=new Point3d(90, 0, 0);
                Point3d pt1=new Point3d(80, 20, 0);
                Point3d pt2=new Point3d(100, 20, 0);
                MText mtext=new MText();//新建多行文本
                mtext.Contents = "多重引线示例";//文本内容
                MLeader mleader=new MLeader();//创建多重引线
                //为多重引线添加引线束，引线束由基线和一些单引线构成
                int leaderIndex=mleader.AddLeader();
                //在引线束中添加一单引线
                int lineIndex=mleader.AddLeaderLine(leaderIndex);
                mleader.AddFirstVertex(lineIndex, pt1); //在单引线中添加引线头点

                mleader.AddLastVertex(lineIndex, ptEnd); //在单引线中添加引线终点
                //在引线束中再添加一单引线，并只设置引线头点
                lineIndex = mleader.AddLeaderLine(leaderIndex);
                mleader.AddFirstVertex(lineIndex, pt2);
                //设置多重引线的注释为多行文本
                mleader.ContentType = ContentType.MTextContent;
                mleader.MText = mtext;
                //将多重引线添加到模型空间
                db.AddToModelSpace(mleader);
                trans.Commit();
            }
        }
        [CommandMethod("AddRoadMLeader")]
        public void AddRoadMLeader()
        {
            Database db=HostApplicationServices.WorkingDatabase;
            //获取符号为点的箭头块的ObjectId
            ObjectId arrowId=db.GetArrowObjectId(DimArrowBlock.Dot);
            //如果当前图形中还未加入上述箭头块，则加入并获取其ObjectId
            if (arrowId == ObjectId.Null)
            {
                DimTools.ArrowBlock = DimArrowBlock.Dot;
                arrowId = db.GetArrowObjectId(DimArrowBlock.Dot);
            }
            //创建一个点列表，在其中添加4个要标注的点
            List<Point3d> pts=new List<Point3d>();
            pts.Add(new Point3d(150, 0, 0));
            pts.Add(new Point3d(150, 15, 0));
            pts.Add(new Point3d(150, 18, 0));
            pts.Add(new Point3d(150, 20, 0));
            //各标注点对应的文字
            List<string> contents=new List<string> { "道路中心线", "机动车道", "人行道", "绿化带" };
            using (Transaction trans=db.TransactionManager.StartTransaction())
            {
                for (int i = 0; i < pts.Count; i++)//遍历标注点
                {
                    MText txt=new MText();//创建多行文本
                    txt.Contents = contents[i];//文本内容
                    MLeader mleader=new MLeader();//创建多重引线
                    //为多重引线添加引线束，引线束由基线和一些单引线构成
                    int leaderIndex=mleader.AddLeader();
                    //在引线束中添加一单引线，并设置引线头点和终点
                    int lineIndex=mleader.AddLeaderLine(leaderIndex);
                    mleader.AddFirstVertex(lineIndex, pts[i]);
                    mleader.AddLastVertex(lineIndex, pts[0].PolarPoint(Math.PI / 2, 20 + (i + 1) * 5));
                    mleader.ArrowSymbolId = arrowId;//设置单引线的箭头块ObjectId
                    //设置多重引线的注释为多行文本
                    mleader.ContentType = ContentType.MTextContent;
                    mleader.MText = txt;
                    db.AddToModelSpace(mleader);
                    mleader.ArrowSize = 1;//多重引线箭头大小
                    mleader.DoglegLength = 0;//多重引线基线长度设为0
                    //将基线连接到引线文字的下方并且绘制下划线
                    mleader.TextAttachmentType = TextAttachmentType.AttachmentBottomLine;
                }
                trans.Commit();
            }
        }
        [CommandMethod("AddTolerance")]
        public void AddTolerance()
        {
            Database db=HostApplicationServices.WorkingDatabase;
            using (Transaction trans=db.TransactionManager.StartTransaction())
            {
                //创建一个形位公差特征控制框
                FeatureControlFrame frame=new FeatureControlFrame();
                //形位公差的几何特征为位置
                string geometricSym=DimFormatCode.Position;
                //形位公差值为0.20，且带直径符号，包容条件为最大实体要求
                string torlerance=DimFormatCode.Diameter + "0.20" + DimFormatCode.CircleM;
                //形位公差的第一级基准符号,包容条件为最大实体要求
                string firstDatum="A" + DimFormatCode.CircleM;
                //形位公差的第二级基准符号,包容条件为不考虑特征尺寸
                string secondDatum="B" + DimFormatCode.CircleS;
                //形位公差的第三级基准符号,包容条件为最小实体要求
                string thirdDatum="C" + DimFormatCode.CircleL;
                //设置公差特征控制框的内容为形位公差
                frame.CreateTolerance(geometricSym, torlerance, firstDatum, secondDatum, thirdDatum);
                frame.Location = new Point3d(1, 0.5, 0);//控制框的位置
                frame.Dimscale = 0.05;//控制框的大小
                db.AddToModelSpace(frame);//控制框添加到模型空间中
                trans.Commit();//提交更改
            }
        }

    }
}
﻿using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.Geometry;
using Autodesk.AutoCAD.Runtime;
using DotNetARX;
namespace Lines
{
    public class Lines
    {
        [CommandMethod("FirstLine")]
        public static void FirstLine()
        {
            //获取当前活动图形数据库
            Database db= HostApplicationServices.WorkingDatabase;
            Point3d startPoint=new Point3d(0, 100, 0);  //直线起点
            Point3d endPoint=new Point3d(100, 100, 0); //直线终点
            Line line=new Line(startPoint, endPoint); //新建一直线对象   
            //定义一个指向当前数据库的事务处理，以添加直线
            using (Transaction trans=db.TransactionManager.StartTransaction())
            {
                BlockTable bt=(BlockTable)trans.GetObject(db.BlockTableId, OpenMode.ForRead); //以读方式打开块表.
                //以写方式打开模型空间块表记录.
                BlockTableRecord btr=(BlockTableRecord)trans.GetObject(bt[BlockTableRecord.ModelSpace], OpenMode.ForWrite);
                //将图形对象的信息添加到块表记录中,并返回ObjectId对象.
                btr.AppendEntity(line);
                trans.AddNewlyCreatedDBObject(line, true); //把对象添加到事务处理中.
                trans.Commit(); //提交事务处理
            }
        }

        [CommandMethod("SecondLine")]
        public static void SecondLine()
        {
            Database db=HostApplicationServices.WorkingDatabase;
            Point3d startPoint=new Point3d(0, 100, 0);
            double angle=GeTools.DegreeToRadian(90);
            Line line=new Line(startPoint, startPoint.PolarPoint(angle, 100));
            db.AddToModelSpace(line);
        }
    }
}
﻿using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.EditorInput;
using Autodesk.AutoCAD.Geometry;
using Autodesk.AutoCAD.Runtime;
using DotNetARX;
namespace LineTypes
{
    public class LineTypes
    {
        [CommandMethod("NewLineType")]
        public void NewLineType()
        {
            Database db=HostApplicationServices.WorkingDatabase;
            using (Transaction trans=db.TransactionManager.StartTransaction())
            {
                //添加虚线线型
                ObjectId ltId=db.AddLineType("DashLines");
                LinetypeTableRecord ltrDashLine=(LinetypeTableRecord)trans.GetObject(ltId, OpenMode.ForWrite);
                ltrDashLine.AsciiDescription = "虚线";//线型说明
                ltrDashLine.PatternLength = 0.95;//组成线型的图案长度（划线、空格、点）
                ltrDashLine.NumDashes = 4;//组成线型的图案数目
                ltrDashLine.SetDashLengthAt(0, 0.5);//0.5个单位的划线
                ltrDashLine.SetDashLengthAt(1, -0.25);//0.25个单位的空格
                ltrDashLine.SetDashLengthAt(2, 0);//一个点
                ltrDashLine.SetDashLengthAt(3, -0.25);//0.25个单位的空格
                //打开文字样式表，用于文字类型的线型
                TextStyleTable tst=(TextStyleTable)trans.GetObject(db.TextStyleTableId, OpenMode.ForRead);
                //添加带文字的线型
                ObjectId ltTextId=db.AddLineType("Texts");
                LinetypeTableRecord ltrText=(LinetypeTableRecord)trans.GetObject(ltTextId, OpenMode.ForWrite);
                ltrText.AsciiDescription = "文字";//线型说明
                ltrText.PatternLength = 0.9;//组成线型的图案长度（划线、空格、点）
                ltrText.NumDashes = 3;//组成线型的图案数目
                ltrText.SetDashLengthAt(0, 0.5);//0.5个单位的划线
                ltrText.SetDashLengthAt(1, -0.2);//0.2个单位的空格
                ltrText.SetShapeStyleAt(1, tst["Standard"]);//设置文字的文字样式
                //文字在线型的 X 轴方向上向左移动0.1个单位，在Y轴方向向下移动0.05个单位。
                ltrText.SetShapeOffsetAt(1, new Vector2d(-0.1, -0.05));
                ltrText.SetShapeScaleAt(1, 0.1);//文字的缩放比例
                ltrText.SetShapeRotationAt(1, 0);//文字的旋转角度为0（不旋转）
                ltrText.SetTextAt(1, "CAD");//文字内容
                ltrText.SetDashLengthAt(2, -0.2);//0.2个单位的空格
                //将ltypeshp.shx文件添加到当前数据库，该文件包含圆形图案
                ObjectId txtStyleId=db.AddShapeTextStyle("ShpText", "ltypeshp.shx");
                //添加圆型线型
                ObjectId ltCirId=db.AddLineType("Circles");
                LinetypeTableRecord ltrCir=(LinetypeTableRecord)trans.GetObject(ltCirId, OpenMode.ForWrite);
                ltrCir.AsciiDescription = "圆";//线型说明
                ltrCir.PatternLength = 1.45;//组成线型的图案长度（划线、空格、点）
                ltrCir.NumDashes = 4;//组成线型的图案数目
                ltrCir.SetDashLengthAt(0, 0.25);//0.25个单位的划线
                ltrCir.SetDashLengthAt(1, -0.1);//0.1个单位的空格
                ltrCir.SetShapeStyleAt(1, txtStyleId);//设置空格处的图形文件
                //设置空格处要包含的图形为圆形
                ltrCir.SetShapeNumberAt(1, (int)LineTypeTools.Shape.Circle);
                //图形在线型的 X 轴方向上向左移动0.1个单位，在Y轴方向不移动。
                ltrCir.SetShapeOffsetAt(1, new Vector2d(-0.1, 0.0));
                ltrCir.SetShapeScaleAt(1, 0.1);//图形的缩放比例
                ltrCir.SetShapeRotationAt(1, 0);//文字的旋转角度为0（不旋转）
                ltrCir.SetDashLengthAt(2, -0.1);//0.1个单位的空格
                ltrCir.SetDashLengthAt(3, 1.0);//1个单位的划线 
                db.Celtype = ltId;//设置当前线型为虚线
                trans.Commit();
            }
        }
        [CommandMethod("AddLines")]
        public void AddLines()
        {
            Database db=HostApplicationServices.WorkingDatabase;
            Editor ed=db.GetEditor();
            using (Transaction trans=db.TransactionManager.StartTransaction())
            {
                //点列表用于各直线的起点和终点
                Point3dList startPts=new Point3dList();
                Point3dList endPts=new Point3dList();
                for (int i = 0; i < 5; i++)
                {
                    startPts.Add(new Point3d(0, 0.5 * i, 0));
                    endPts.Add(new Point3d(5, 0.5 * i, 0));
                }
                //虚线
                Line dashLine1=new Line(startPts[0], endPts[0]);
                dashLine1.Linetype = "DashLines";
                //设置线型比例为2的虚线（未指定线型，则设置为当前线型：虚线）
                Line dashLine2=new Line(startPts[1], endPts[1]);
                dashLine2.LinetypeScale = 2;
                //文字线型
                Line textLine=new Line(startPts[2], endPts[2]);
                textLine.Linetype = "Texts";
                Line circleLine=new Line(startPts[3], endPts[3]);
                //圆形线型，并设置线宽为0.3
                circleLine.Linetype = "Circles";
                circleLine.LineWeight = LineWeight.LineWeight030;
                //加载系统自带的Center线型
                Line centerLine=new Line(startPts[4], endPts[4]);
                ObjectId centerId=db.LoadLineType("Center");
                if (centerId != null) centerLine.LinetypeId = centerId;
                //将所有的直线添加到模型空间
                db.AddToModelSpace(dashLine1, dashLine2, textLine, circleLine, centerLine);
                trans.Commit();
            }
            db.LineWeightDisplay = true;//显示线宽
        }
    }
}
﻿using Autodesk.AutoCAD.DatabaseServices;

namespace DotNetARX
{
    /// <summary>
    /// 线型操作类
    /// </summary>
    public static class LineTypeTools
    {
        /// <summary>
        /// 用于形定义文件的图案
        /// </summary>
        public enum Shape
        {
            /// <summary>
            /// 竖线
            /// </summary>
            Track = 130,
            /// <summary>
            /// Z字型
            /// </summary>
            Zig,
            /// <summary>
            /// 矩形
            /// </summary>
            Box,
            /// <summary>
            /// 圆
            /// </summary>
            Circle,
            /// <summary>
            /// S型
            /// </summary>
            Bat
        }

        /// <summary>
        /// 创建一个新的线型
        /// </summary>
        /// <param name="db">数据库对象</param>
        /// <param name="typeName">线型名</param>
        /// <returns>返回新建线型的Id</returns>
        public static ObjectId AddLineType(this Database db, string typeName)
        {
            //打开线型表
            LinetypeTable lt=(LinetypeTable)db.LinetypeTableId.GetObject(OpenMode.ForRead);
            if (!lt.Has(typeName))//如果存在名为typeName的线型表记录
            {
                lt.UpgradeOpen();//切换线型表为写
                //新建一个线型表记录
                LinetypeTableRecord ltr=new LinetypeTableRecord();
                ltr.Name = typeName;//设置线型表记录的名称
                lt.Add(ltr);//将新的线型表记录的信息添加到的线型表中
                db.TransactionManager.AddNewlyCreatedDBObject(ltr, true);
                lt.DowngradeOpen();//为了安全，将线型表的状态切换为读
            }
            return lt[typeName];//返回新添加的线型表记录的ObjectId
        }

        /// <summary>
        /// 从“acadiso.lin”线型文件中装载指定线型
        /// </summary>
        /// <param name="db">数据库对象</param>
        /// <param name="typeName">线型名</param>
        /// <returns>返回装载的线型的Id</returns>
        public static ObjectId LoadLineType(this Database db, string typeName)
        {
            //打开线型表
            LinetypeTable lt=(LinetypeTable)db.LinetypeTableId.GetObject(OpenMode.ForRead);
            if (!lt.Has(typeName))//如果不存在名为typeName的线型
            {
                //加载typeName线型
                db.LoadLineTypeFile(typeName, "acad.lin");
            }
            return lt[typeName];//返回加载的线型的ObjectId
        }

        /// <summary>
        /// 设置当前线型
        /// </summary>
        /// <param name="db">数据库对象</param>
        /// <param name="typeName">要设置的线型名</param>
        public static void SetCurrentLineType(this Database db, string typeName)
        {
            var trans=db.TransactionManager;
            //打开线型表
            LinetypeTable lt=(LinetypeTable)trans.GetObject(db.LinetypeTableId, OpenMode.ForRead);
            if (lt.Has(typeName))//如果存在名为typeName的线型
            {
                db.Celtype = lt[typeName];//设置当前线型
            }
        }
    }
}
﻿using System.Collections.Generic;
using Autodesk.AutoCAD.ApplicationServices;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.EditorInput;
using Autodesk.AutoCAD.Geometry;
using Autodesk.AutoCAD.Runtime;
namespace DotNetARX
{
    /// <summary>
    /// LINQ操作类
    /// </summary>
    public static partial class LinqToCAD
    {
        /// <summary>
        /// 获取数据库中类型为T的所有实体(对象打开为读）
        /// </summary>
        /// <typeparam name="T">实体的类型</typeparam>
        /// <param name="db">数据库对象</param>
        /// <returns>返回数据库中类型为T的实体</returns>
        public static List<T> GetEntsInDatabase<T>(this Database db) where T : Entity
        {
            return GetEntsInDatabase<T>(db, OpenMode.ForRead, false);
        }

        /// <summary>
        ///  获取数据库中类型为T的所有实体
        /// </summary>
        /// <typeparam name="T">实体的类型</typeparam>
        /// <param name="db">数据库对象</param>
        /// <param name="mode">实体打开方式</param>
        /// <param name="openErased">是否打开已删除的实体</param>
        /// <returns>返回数据库中类型为T的实体</returns>
        public static List<T> GetEntsInDatabase<T>(this Database db, OpenMode mode, bool openErased) where T : Entity
        {
            Editor ed = Application.DocumentManager.MdiActiveDocument.Editor;
            //声明一个List类的变量，用于返回类型为T为的实体列表
            List<T> ents = new List<T>();
            //获取类型T代表的DXF代码名用于构建选择集过滤器
            string dxfname = RXClass.GetClass(typeof(T)).DxfName;
            //构建选择集过滤器        
            TypedValue[] values = { new TypedValue((int)DxfCode.Start, dxfname) };
            SelectionFilter filter = new SelectionFilter(values);
            //选择符合条件的所有实体
            PromptSelectionResult entSelected = ed.SelectAll(filter);
            if (entSelected.Status == PromptStatus.OK)
            {
                //循环遍历符合条件的实体
                foreach (var id in entSelected.Value.GetObjectIds())
                {
                    //将实体强制转化为T类型的对象
                    //不能将实体直接转化成泛型T，必须首先转换成object类
                    T t = (T)(object)id.GetObject(mode, openErased);
                    ents.Add(t);//将实体添加到返回列表中
                }
            }
            return ents;//返回类型为T为的实体列表
        }

        /// <summary>
        /// 获取用户选择的类型为T的所有实体
        /// </summary>
        /// <typeparam name="T">实体的类型</typeparam>
        /// <param name="db">数据库对象</param>
        /// <returns>返回类型为T的实体</returns>
        public static List<T> GetSelection<T>(this Database db) where T : Entity
        {
            return GetSelection<T>(db, OpenMode.ForRead, false);
        }

        /// <summary>
        /// 获取用户选择的类型为T的所有实体
        /// </summary>
        /// <typeparam name="T">实体的类型</typeparam>
        /// <param name="db">数据库对象</param>
        /// <param name="mode">实体的打开方式</param>
        /// <param name="openErased">是否打开已删除的实体</param>
        /// <returns>返回类型为T的实体</returns>
        public static List<T> GetSelection<T>(this Database db, OpenMode mode, bool openErased) where T : Entity
        {
            var trans = db.TransactionManager;
            string dxfname = RXClass.GetClass(typeof(T)).DxfName;
            List<T> ents = new List<T>();
            Editor ed = Application.DocumentManager.MdiActiveDocument.Editor;
            TypedValue[] values = { new TypedValue((int)DxfCode.Start, dxfname) };
            var filter = new SelectionFilter(values);
            var entSelected = ed.GetSelection(filter);
            if (entSelected.Status == PromptStatus.OK)
            {
                foreach (var id in entSelected.Value.GetObjectIds())
                {
                    T t = (T)(object)trans.GetObject(id, mode, openErased);
                    ents.Add(t);
                }
            }
            return ents;
        }

        /// <summary>
        /// 选择窗口中及和窗口四条边界相交的实体，实体类型为T
        /// </summary>
        /// <typeparam name="T">实体的类型</typeparam>
        /// <param name="db">数据库对象</param>
        /// <param name="pt1">窗口的一个角点</param>
        /// <param name="pt2">窗口的另一个角点</param>
        /// <returns>返回类型为T的实体</returns>
        public static List<T> SelectCrossingWindow<T>(this Database db, Point3d pt1, Point3d pt2) where T : Entity
        {
            return SelectCrossingWindow<T>(db, pt1, pt2, OpenMode.ForRead, false);
        }

        /// <summary>
        /// 选择窗口中及和窗口四条边界相交的实体，实体类型为T
        /// </summary>
        /// <typeparam name="T">实体的类型</typeparam>
        /// <param name="db">数据库对象</param>
        /// <param name="pt1">窗口的一个角</param>
        /// <param name="pt2">窗口的另一个角点</param>
        /// <param name="mode">实体的打开方式</param>
        /// <param name="openErased">是否打开已删除的实体</param>
        /// <returns>返回类型为T的实体</returns>
        public static List<T> SelectCrossingWindow<T>(this Database db, Point3d pt1, Point3d pt2, OpenMode mode, bool openErased) where T : Entity
        {
            var trans = db.TransactionManager;
            string dxfname = RXClass.GetClass(typeof(T)).DxfName;
            List<T> ents = new List<T>();
            Editor ed = Application.DocumentManager.MdiActiveDocument.Editor;
            TypedValue[] values = { new TypedValue((int)DxfCode.Start, dxfname) };
            var filter = new SelectionFilter(values);
            var entSelected = ed.SelectCrossingWindow(pt1, pt2, filter);
            if (entSelected.Status == PromptStatus.OK)
            {
                foreach (var id in entSelected.Value.GetObjectIds())
                {
                    T t = (T)(object)trans.GetObject(id, mode, openErased);
                    ents.Add(t);
                }
            }
            return ents;
        }

        /// <summary>
        /// 获取模型空间中类型为T的所有实体(对象打开为读）
        /// </summary>
        /// <typeparam name="T">实体的类型</typeparam>
        /// <param name="db">数据库对象</param>
        /// <returns>返回模型空间中类型为T的实体</returns>
        public static List<T> GetEntsInModelSpace<T>(this Database db) where T : Entity
        {
            return GetEntsInModelSpace<T>(db, OpenMode.ForRead, false);
        }

        /// <summary>
        /// 获取模型空间中类型为T的所有实体
        /// </summary>
        /// <typeparam name="T">实体的类型</typeparam>
        /// <param name="db">数据库对象</param>
        /// <param name="mode">实体打开方式</param>
        /// <param name="openErased">是否打开已删除的实体</param>
        /// <returns>返回模型空间中类型为T的实体</returns>
        public static List<T> GetEntsInModelSpace<T>(this Database db, OpenMode mode, bool openErased) where T : Entity
        {
            Editor ed = Application.DocumentManager.MdiActiveDocument.Editor;
            //声明一个List类的变量，用于返回类型为T为的实体列表
            List<T> ents = new List<T>();
            //获取类型T代表的DXF代码名用于构建选择集过滤器
            string dxfname = RXClass.GetClass(typeof(T)).DxfName;
            //构建选择集过滤器        
            TypedValue[] values = { new TypedValue((int)DxfCode.Start, dxfname),
                                    new TypedValue((int)DxfCode.LayoutName,"Model")};
            SelectionFilter filter = new SelectionFilter(values);
            //选择符合条件的所有实体
            PromptSelectionResult entSelected = ed.SelectAll(filter);
            if (entSelected.Status == PromptStatus.OK)
            {
                //循环遍历符合条件的实体
                foreach (var id in entSelected.Value.GetObjectIds())
                {
                    //将实体强制转化为T类型的对象
                    //不能将实体直接转化成泛型T，必须首先转换成object类
                    T t = (T)(object)id.GetObject(mode, openErased);
                    ents.Add(t);//将实体添加到返回列表中
                }
            }
            return ents;//返回类型为T为的实体列表
        }

        /// <summary>
        /// 获取图纸空间中类型为T的所有实体
        /// </summary>
        /// <typeparam name="T">实体的类型</typeparam>
        /// <param name="db">数据库对象</param>
        /// <returns>返回图纸空间中类型为T的实体</returns>
        public static List<T> GetEntsInPaperSpace<T>(this Database db) where T : Entity
        {
            return GetEntsInPaperSpace<T>(db, OpenMode.ForRead, false);
        }

        /// <summary>
        /// 获取图纸空间中类型为T的所有实体
        /// </summary>
        /// <typeparam name="T">实体的类型</typeparam>
        /// <param name="db">数据库对象</param>
        /// <param name="mode">实体打开方式</param>
        /// <param name="openErased">是否打开已删除的实体</param>
        /// <returns>返回图纸空间中类型为T的实体</returns>
        public static List<T> GetEntsInPaperSpace<T>(this Database db, OpenMode mode, bool openErased) where T : Entity
        {
            var trans = db.TransactionManager;
            string dxfname = RXClass.GetClass(typeof(T)).DxfName;
            List<T> ents = new List<T>();
            Editor ed = Application.DocumentManager.MdiActiveDocument.Editor;
            TypedValue[] values = { new TypedValue((int)DxfCode.Start, dxfname),
                                    new TypedValue((int)DxfCode.ViewportVisibility,1)};
            var filter = new SelectionFilter(values);
            var entSelected = ed.SelectAll(filter);
            if (entSelected.Status == PromptStatus.OK)
            {
                foreach (var id in entSelected.Value.GetObjectIds())
                {
                    T t = (T)(object)trans.GetObject(id, mode, openErased);
                    ents.Add(t);
                }
            }
            return ents;
        }

        /// <summary>
        /// 获取数据库中所有的实体
        /// </summary>
        /// <param name="db">数据库对象</param>
        /// <returns>返回数据库中所有的实体</returns>
        public static List<Entity> GetEntsInDatabase(this Database db)
        {
            return GetEntsInDatabase(db, OpenMode.ForRead, false);
        }

        /// <summary>
        /// 获取数据库中所有的实体
        /// </summary>
        /// <param name="db">数据库对象</param>
        /// <param name="mode">实体打开方式</param>
        /// <param name="openErased">是否打开已删除的实体</param>
        /// <returns>返回数据库中所有的实体</returns>
        public static List<Entity> GetEntsInDatabase(this Database db, OpenMode mode, bool openErased)
        {
            var trans = db.TransactionManager;
            //声明一个List类的变量，用于返回所有实体
            List<Entity> ents = new List<Entity>();
            Editor ed = Application.DocumentManager.MdiActiveDocument.Editor;
            var entSelected = ed.SelectAll();
            if (entSelected.Status == PromptStatus.OK)
            {
                //循环遍历符合条件的实体
                foreach (var id in entSelected.Value.GetObjectIds())
                {
                    Entity ent = (Entity)(object)trans.GetObject(id, mode, openErased);
                    ents.Add(ent);
                }
            }
            return ents;
        }

        /// <summary>
        /// 获取用户选择的实体
        /// </summary>
        /// <param name="db">数据库对象</param>
        /// <returns>返回用户选择的实体</returns>
        public static List<Entity> GetSelection(this Database db)
        {
            return GetSelection(db, OpenMode.ForRead, false);
        }

        /// <summary>
        /// 获取用户选择的实体
        /// </summary>
        /// <param name="db">数据库对象</param>
        /// <param name="mode">实体打开方式</param>
        /// <param name="openErased">是否打开已删除的实体</param>
        /// <returns>返回用户选择的实体</returns>
        public static List<Entity> GetSelection(this Database db, OpenMode mode, bool openErased)
        {
            var trans = db.TransactionManager;
            List<Entity> ents = new List<Entity>();
            Editor ed = Application.DocumentManager.MdiActiveDocument.Editor;
            var entSelected = ed.GetSelection();
            if (entSelected.Status == PromptStatus.OK)
            {
                foreach (var id in entSelected.Value.GetObjectIds())
                {
                    Entity ent = (Entity)(object)trans.GetObject(id, mode, openErased);
                    ents.Add(ent);
                }
            }
            return ents;
        }

        /// <summary>
        /// 选择窗口中及和窗口四条边界相交的实体
        /// </summary>
        /// <param name="db">数据库对象</param>
        /// <param name="pt1">窗口的一个角点</param>
        /// <param name="pt2">窗口的另一个角点</param>
        /// <returns>返回选择的实体</returns>
        public static List<Entity> SelectCrossingWindow(this Database db, Point3d pt1, Point3d pt2)
        {
            return SelectCrossingWindow(db, pt1, pt2, OpenMode.ForRead, false);
        }

        /// <summary>
        /// 选择窗口中及和窗口四条边界相交的实体
        /// </summary>
        /// <param name="db">数据库对象</param>
        /// <param name="pt1">窗口的一个角点</param>
        /// <param name="pt2">窗口的另一个角点</param>
        /// <param name="mode">实体打开方式</param>
        /// <param name="openErased">是否打开已删除的实体</param>
        /// <returns>返回选择的实体</returns>
        public static List<Entity> SelectCrossingWindow(this Database db, Point3d pt1, Point3d pt2, OpenMode mode, bool openErased)
        {
            var trans = db.TransactionManager;
            List<Entity> ents = new List<Entity>();
            Editor ed = Application.DocumentManager.MdiActiveDocument.Editor;
            var entSelected = ed.SelectCrossingWindow(pt1, pt2);
            if (entSelected.Status == PromptStatus.OK)
            {
                foreach (var id in entSelected.Value.GetObjectIds())
                {
                    Entity ent = (Entity)(object)trans.GetObject(id, mode, openErased);
                    ents.Add(ent);
                }
            }
            return ents;
        }

        /// <summary>
        /// 获取模型空间中的所有实体
        /// </summary>
        /// <param name="db">数据库对象</param>
        /// <returns>返回模型空间中的所有实体</returns>
        public static List<Entity> GetEntsInModelSpace(this Database db)
        {
            return GetEntsInModelSpace(db, OpenMode.ForRead, false);
        }

        /// <summary>
        /// 获取模型空间中的所有实体
        /// </summary>
        /// <param name="db">数据库对象</param>
        /// <param name="mode">实体打开方式</param>
        /// <param name="openErased">是否打开已删除的实体</param>
        /// <returns>返回模型空间中的所有实体</returns>
        public static List<Entity> GetEntsInModelSpace(this Database db, OpenMode mode, bool openErased)
        {
            var trans = db.TransactionManager;
            List<Entity> ents = new List<Entity>();
            Editor ed = Application.DocumentManager.MdiActiveDocument.Editor;
            TypedValue[] values = { new TypedValue((int)DxfCode.ViewportVisibility, 0) };
            var filter = new SelectionFilter(values);
            var entSelected = ed.SelectAll(filter);
            if (entSelected.Status == PromptStatus.OK)
            {
                foreach (var id in entSelected.Value.GetObjectIds())
                {
                    Entity ent = (Entity)(object)trans.GetObject(id, mode, openErased);
                    ents.Add(ent);
                }
            }
            return ents;
        }

        /// <summary>
        /// 获取图纸空间中的所有实体
        /// </summary>
        /// <param name="db">数据库对象</param>
        /// <returns>返回图纸空间中的所有实体</returns>
        public static List<Entity> GetEntsInPaperSpace(this Database db)
        {
            return GetEntsInPaperSpace(db, OpenMode.ForRead, false);
        }

        /// <summary>
        /// 获取图纸空间中的所有实体
        /// </summary>
        /// <param name="db">数据库对象</param>
        /// <param name="mode">实体打开方式</param>
        /// <param name="openErased">是否打开已删除的实体</param>
        /// <returns>返回图纸空间中的所有实体</returns>
        public static List<Entity> GetEntsInPaperSpace(this Database db, OpenMode mode, bool openErased)
        {
            var trans = db.TransactionManager;
            List<Entity> ents = new List<Entity>();
            Editor ed = Application.DocumentManager.MdiActiveDocument.Editor;
            TypedValue[] values = { new TypedValue((int)DxfCode.ViewportVisibility, 1) };
            var filter = new SelectionFilter(values);
            var entSelected = ed.SelectAll(filter);
            if (entSelected.Status == PromptStatus.OK)
            {
                foreach (var id in entSelected.Value.GetObjectIds())
                {
                    Entity ent = (Entity)(object)trans.GetObject(id, mode, openErased);
                    ents.Add(ent);
                }
            }
            return ents;
        }
    }
}
﻿using System;
using System.Collections.Generic;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.EditorInput;
using Autodesk.AutoCAD.Geometry;
using Autodesk.AutoCAD.Runtime;

namespace DotNetARX
{
    /// <summary>
    /// TypedValue列表类，简化选择集过滤器的构造
    /// </summary>
    public class TypedValueList : List<TypedValue>
    {
        /// <summary>
        /// 接受可变参数的构造函数
        /// </summary>
        /// <param name="args">TypedValue对象</param>
        public TypedValueList(params TypedValue[] args)
        {
            AddRange(args);
        }

        /// <summary>
        /// 添加DXF组码及对应的类型
        /// </summary>
        /// <param name="typecode">DXF组码</param>
        /// <param name="value">类型</param>
        public void Add(int typecode, object value)
        {
            base.Add(new TypedValue(typecode, value));
        }

        /// <summary>
        /// 添加DXF组码
        /// </summary>
        /// <param name="typecode">DXF组码</param>
        public void Add(int typecode)
        {
            base.Add(new TypedValue(typecode));
        }

        /// <summary>
        /// 添加DXF组码及对应的类型
        /// </summary>
        /// <param name="typecode">DXF组码</param>
        /// <param name="value">类型</param>
        public void Add(DxfCode typecode, object value)
        {
            base.Add(new TypedValue((int)typecode, value));
        }

        /// <summary>
        /// 添加DXF组码
        /// </summary>
        /// <param name="typecode">DXF组码</param>
        public void Add(DxfCode typecode)
        {
            base.Add(new TypedValue((int)typecode));
        }

        /// <summary>
        /// 添加图元类型,DXF组码缺省为0
        /// </summary>
        /// <param name="entityType">图元类型</param>
        public void Add(Type entityType)
        {
            base.Add(new TypedValue(0, RXClass.GetClass(entityType).DxfName));
        }

        /// <summary>
        /// TypedValueList隐式转换为SelectionFilter
        /// </summary>
        /// <param name="src">要转换的TypedValueList对象</param>
        /// <returns>返回对应的SelectionFilter类对象</returns>
        public static implicit operator SelectionFilter(TypedValueList src)
        {
            return src != null ? new SelectionFilter(src) : null;
        }

        /// <summary>
        /// TypedValueList隐式转换为ResultBuffer
        /// </summary>
        /// <param name="src">要转换的TypedValueList对象</param>
        /// <returns>返回对应的ResultBuffer对象</returns>
        public static implicit operator ResultBuffer(TypedValueList src)
        {
            return src != null ? new ResultBuffer(src) : null;
        }

        /// <summary>
        /// TypedValueList隐式转换为TypedValue数组
        /// </summary>
        /// <param name="src">要转换的TypedValueList对象</param>
        /// <returns>返回对应的TypedValue数组</returns>
        public static implicit operator TypedValue[](TypedValueList src)
        {
            return src != null ? src.ToArray() : null;
        }

        /// <summary>
        /// TypedValue数组隐式转换为TypedValueList
        /// </summary>
        /// <param name="src">要转换的TypedValue数组</param>
        /// <returns>返回对应的TypedValueList</returns>
        public static implicit operator TypedValueList(TypedValue[] src)
        {
            return src != null ? new TypedValueList(src) : null;
        }

        /// <summary>
        /// SelectionFilter隐式转换为TypedValueList
        /// </summary>
        /// <param name="src">要转换的SelectionFilter</param>
        /// <returns>返回对应的TypedValueList</returns>
        public static implicit operator TypedValueList(SelectionFilter src)
        {
            return src != null ? new TypedValueList(src.GetFilter()) : null;
        }

        /// <summary>
        /// ResultBuffer隐式转换为TypedValueList
        /// </summary>
        /// <param name="src">要转换的ResultBuffer</param>
        /// <returns>返回对应的TypedValueList</returns>
        public static implicit operator TypedValueList(ResultBuffer src)
        {
            return src != null ? new TypedValueList(src.AsArray()) : null;
        }

    }

    /// <summary>
    /// Point3d列表类
    /// </summary>
    public class Point3dList : List<Point3d>
    {
        /// <summary>
        /// 接受可变参数的构造函数
        /// </summary>
        /// <param name="args">Point3d类对象</param>
        public Point3dList(params Point3d[] args)
        {
            AddRange(args);
        }

        /// <summary>
        /// Point3dList隐式转换为Point3d数组
        /// </summary>
        /// <param name="src">要转换的Point3dList对象</param>
        /// <returns>返回对应的Point3d数组</returns>
        public static implicit operator Point3d[](Point3dList src)
        {
            return src != null ? src.ToArray() : null;
        }

        /// <summary>
        /// Point3dList隐式转换为Point3dCollection
        /// </summary>
        /// <param name="src">要转换的Point3dList对象</param>
        /// <returns>返回对应的Point3dCollection</returns>
        public static implicit operator Point3dCollection(Point3dList src)
        {
            return src != null ? new Point3dCollection(src) : null;
        }

        /// <summary>
        /// Point3d数组隐式转换为Point3dList
        /// </summary>
        /// <param name="src">要转换的Point3d数组</param>
        /// <returns>返回对应的Point3dList</returns>
        public static implicit operator Point3dList(Point3d[] src)
        {
            return src != null ? new Point3dList(src) : null;
        }

        /// <summary>
        /// Point3dCollection隐式转换为Point3dList
        /// </summary>
        /// <param name="src">要转换的Point3dCollection</param>
        /// <returns>返回对应的Point3dList</returns>
        public static implicit operator Point3dList(Point3dCollection src)
        {
            if (src != null)
            {
                Point3d[] ids = new Point3d[src.Count];
                src.CopyTo(ids, 0);
                return new Point3dList(ids);
            }
            else
            {
                return null;
            }
        }
    }

    /// <summary>
    /// ObjectId列表
    /// </summary>
    public class ObjectIdList : List<ObjectId>
    {
        /// <summary>
        /// 接受可变参数的构造函数
        /// </summary>
        /// <param name="args">ObjectId对象</param>
        public ObjectIdList(params ObjectId[] args)
        {
            AddRange(args);
        }

        /// <summary>
        /// ObjectIdList隐式转换为ObjectId数组
        /// </summary>
        /// <param name="src">要转换的ObjectIdList对象</param>
        /// <returns>返回对应的ObjectId数组</returns>
        public static implicit operator ObjectId[](ObjectIdList src)
        {
            return src != null ? src.ToArray() : null;
        }

        /// <summary>
        /// ObjectIdList隐式转换为ObjectIdCollection
        /// </summary>
        /// <param name="src">要转换的ObjectIdList对象</param>
        /// <returns>返回对应的ObjectIdCollection</returns>
        public static implicit operator ObjectIdCollection(ObjectIdList src)
        {
            return src != null ? new ObjectIdCollection(src) : null;
        }

        /// <summary>
        /// ObjectId数组隐式转换为ObjectIdList
        /// </summary>
        /// <param name="src">要转换的ObjectId数组</param>
        /// <returns>返回对应的ObjectIdList</returns>
        public static implicit operator ObjectIdList(ObjectId[] src)
        {
            return src != null ? new ObjectIdList(src) : null;
        }

        /// <summary>
        /// ObjectIdCollection隐式转换为ObjectIdList
        /// </summary>
        /// <param name="src">要转换的ObjectIdCollection</param>
        /// <returns>返回对应的ObjectIdList</returns>
        public static implicit operator ObjectIdList(ObjectIdCollection src)
        {
            if (src != null)
            {
                ObjectId[] ids = new ObjectId[src.Count];
                src.CopyTo(ids, 0);
                return new ObjectIdList(ids);
            }
            else
            {
                return null;
            }
        }
    }

    /// <summary>
    /// Entity列表
    /// </summary>
    public class EntityList : List<Entity>
    {
        /// <summary>
        /// 接受可变参数的构造函数
        /// </summary>
        /// <param name="args">实体对象</param>
        public EntityList(params Entity[] args)
        {
            AddRange(args);
        }

        /// <summary>
        /// EntityList隐式转换为Entity数组
        /// </summary>
        /// <param name="src">要转换的EntityList</param>
        /// <returns>返回对应的Entity数组</returns>
        public static implicit operator Entity[](EntityList src)
        {
            return src != null ? src.ToArray() : null;
        }

        /// <summary>
        /// Entity数组隐式转换为EntityList
        /// </summary>
        /// <param name="src">要转换的Entity数组</param>
        /// <returns>返回对应的EntityList</returns>
        public static implicit operator EntityList(Entity[] src)
        {
            return src != null ? new EntityList(src) : null;
        }

    }
}
﻿#pragma checksum "..\..\..\MainWindow.xaml" "{406ea660-64cf-4c82-b6f0-42d48172a799}" "70FF10BC0BE020E9C089D889A43609C5"
//------------------------------------------------------------------------------
// <auto-generated>
//     此代码由工具生成。
//     运行时版本:4.0.30319.488
//
//     对此文件的更改可能会导致不正确的行为，并且如果
//     重新生成代码，这些更改将会丢失。
// </auto-generated>
//------------------------------------------------------------------------------

using System;
using System.Diagnostics;
using System.Windows;
using System.Windows.Automation;
using System.Windows.Controls;
using System.Windows.Controls.Primitives;
using System.Windows.Data;
using System.Windows.Documents;
using System.Windows.Ink;
using System.Windows.Input;
using System.Windows.Markup;
using System.Windows.Media;
using System.Windows.Media.Animation;
using System.Windows.Media.Effects;
using System.Windows.Media.Imaging;
using System.Windows.Media.Media3D;
using System.Windows.Media.TextFormatting;
using System.Windows.Navigation;
using System.Windows.Shapes;
using System.Windows.Shell;


namespace Wpfs {
    
    
    /// <summary>
    /// MainWindow
    /// </summary>
    [System.CodeDom.Compiler.GeneratedCodeAttribute("PresentationBuildTasks", "4.0.0.0")]
    public partial class MainWindow : System.Windows.Window, System.Windows.Markup.IComponentConnector {
        
        private bool _contentLoaded;
        
        /// <summary>
        /// InitializeComponent
        /// </summary>
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        public void InitializeComponent() {
            if (_contentLoaded) {
                return;
            }
            _contentLoaded = true;
            System.Uri resourceLocater = new System.Uri("/Wpfs;component/mainwindow.xaml", System.UriKind.Relative);
            
            #line 1 "..\..\..\MainWindow.xaml"
            System.Windows.Application.LoadComponent(this, resourceLocater);
            
            #line default
            #line hidden
        }
        
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [System.ComponentModel.EditorBrowsableAttribute(System.ComponentModel.EditorBrowsableState.Never)]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Design", "CA1033:InterfaceMethodsShouldBeCallableByChildTypes")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Maintainability", "CA1502:AvoidExcessiveComplexity")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1800:DoNotCastUnnecessarily")]
        void System.Windows.Markup.IComponentConnector.Connect(int connectionId, object target) {
            this._contentLoaded = true;
        }
    }
}

﻿using System.Windows.Forms;

namespace DotNetARX
{
    /// <summary>
    /// Windows消息过滤类
    /// </summary>
    public class MessageFilter : IMessageFilter
    {
        /// <summary>
        /// 按键消息
        /// </summary>
        public const int WM_KEYDOWN = 0x0100;
        /// <summary>
        /// 按下的键名
        /// </summary>
        public Keys KeyName { get; set; }

        /// <summary>
        /// 在调度消息之前将其筛选出来
        /// </summary>
        /// <param name="m">消息名</param>
        /// <returns>如果调试的是按键消息，则返回true,否则返回false</returns>
        public bool PreFilterMessage(ref Message m)
        {
            if (m.Msg == WM_KEYDOWN)//如果调度的消息是按键
            {
                //设置键名
                KeyName = (Keys)(int)m.WParam & Keys.KeyCode;
                //返回true表示调度的是按键消息
                return true;
            }
            return false;//返回false，表示非按键消息
        }
    }
}
﻿using Autodesk.AutoCAD.ApplicationServices;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.EditorInput;
using Autodesk.AutoCAD.Geometry;
using Autodesk.AutoCAD.GraphicsInterface;

namespace UseDrawJig
{
    class MirrorJig : DrawJig
    {
        private Point3d m_MirrorPt1, m_MirrorPt2;
        private Entity[] m_EntArr, m_EntCopyArr;
        private Matrix3d m_InverseMt = Matrix3d.Identity;

        // 初始化MirrorJig派生类
        public MirrorJig(Point3d mirrorPt1, Entity[] entArr, Entity[] entCopyArr)
        {
            m_MirrorPt2 = m_MirrorPt1 = mirrorPt1;
            m_EntArr = entArr;
            m_EntCopyArr = entCopyArr;
        }

        protected override bool WorldDraw(WorldDraw draw)
        {
            for (int i = 0; i < m_EntCopyArr.Length; i++)
            {
                draw.Geometry.Draw(m_EntCopyArr[i]);
            }
            return true;
        }

        protected override SamplerStatus Sampler(JigPrompts prompts)
        {
            Editor ed = Application.DocumentManager.MdiActiveDocument.Editor;
            Matrix3d mt = ed.CurrentUserCoordinateSystem;

            JigPromptPointOptions optJig = new JigPromptPointOptions("\n请指定镜像线第二点:");
            optJig.Cursor = CursorType.RubberBand;
            // 基点必须是WCS点. 
            Point3d wcsMirrorPt1 = m_MirrorPt1.TransformBy(mt);
            optJig.BasePoint = wcsMirrorPt1;
            optJig.UseBasePoint = true;

            PromptPointResult resJig = prompts.AcquirePoint(optJig);
            Point3d curPt = resJig.Value;

            if (m_MirrorPt2 != curPt)
            {
                m_MirrorPt2 = curPt;

                Matrix3d mirrorMt = Matrix3d.Mirroring(new Line3d(m_MirrorPt2, wcsMirrorPt1));
                for (int i = 0; i < m_EntCopyArr.Length; i++)
                {
                    m_EntCopyArr[i].TransformBy(m_InverseMt);
                    m_EntCopyArr[i].TransformBy(mirrorMt);
                }

                m_InverseMt = mirrorMt.Inverse();
                return SamplerStatus.OK;
            }
            else
            {
                return SamplerStatus.NoChange;
            }
        }

        public void Unhighlight()
        {
            // 取消源对象的高亮状态.
            for (int i = 0; i < m_EntArr.Length; i++)
            {
                m_EntArr[i].Unhighlight();
            }
        }
    }
}
﻿using System.Collections.Generic;
using Autodesk.AutoCAD.Colors;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.Geometry;
using Autodesk.AutoCAD.Runtime;
using DotNetARX;
namespace MLineStyles
{
    public class MLineStyles
    {
        [CommandMethod("AddMLineStyle")]
        public void AddMLineStyle()
        {
            Database db=HostApplicationServices.WorkingDatabase;
            using (Transaction trans=db.TransactionManager.StartTransaction())
            {
                //MlineStyleElement列表对象，用来存储需要设置多线样式的元素
                List<MlineStyleElement> elements=new List<MlineStyleElement>();
                //第一个元素（红色的中心线）
                Color red=Color.FromColorIndex(ColorMethod.ByAci, 1);
                ObjectId centerId=db.LoadLineType("CENTER");
                elements.Add(new MlineStyleElement(0, red, centerId));
                //第二个元素（蓝色的虚线）
                Color blue=Color.FromColorIndex(ColorMethod.ByAci, 5);
                ObjectId hiddenId=db.LoadLineType("HIDDEN");
                elements.Add(new MlineStyleElement(0.5, blue, hiddenId));
                //第三个元素（蓝色的虚线）
                elements.Add(new MlineStyleElement(-0.5, blue, hiddenId));
                //创建名为NewStyle的多线样式，并将其设置为默认样式
                db.CmlstyleID = db.CreateMLineStyle("NewStyle", elements);
                trans.Commit();
            }
        }

        [CommandMethod("AddMLine")]
        public void AddMLine()
        {
            Database db=HostApplicationServices.WorkingDatabase;
            using (Transaction trans=db.TransactionManager.StartTransaction())
            {
                Mline mline=new Mline(); // 创建多线对象
                mline.Normal = new Vector3d(0, 0, 1); // 多线的法向量
                mline.Style = db.CmlstyleID; //多线的样式
                mline.Justification = MlineJustification.Zero;// 多线的对齐方式
                // 添加多线的顶点
                mline.AppendSegment(Point3d.Origin);
                mline.AppendSegment(new Point3d(10, 0, 0));
                mline.AppendSegment(new Point3d(5, 5, 0));
                mline.IsClosed = true; // 多线闭合
                db.AddToModelSpace(mline); //将多线添加到模型空间中
                trans.Commit(); //提交事务处理
            }
        }

        [CommandMethod("DelMLineStyle")]
        public void DelMLineStyle()
        {
            Database db=HostApplicationServices.WorkingDatabase;
            using (Transaction trans=db.TransactionManager.StartTransaction())
            {
                db.RemoveMLineStyle("NewStyle");
                trans.Commit();
            }
        }
    }
}
﻿using System.Collections.Generic;
using Autodesk.AutoCAD.DatabaseServices;

namespace DotNetARX
{
    /// <summary>
    /// 多线样式操作类
    /// </summary>
    public static class MLineTools
    {
        /// <summary>
        /// 创建一个新的多线样式
        /// </summary>
        /// <param name="db">数据库对象</param>
        /// <param name="styleName">多线样式名</param>
        /// <param name="elements">加入到多线样式的元素集合</param>
        /// <returns>返回加入的多线样式的Id</returns>
        public static ObjectId CreateMLineStyle(this Database db, string styleName, List<MlineStyleElement> elements)
        {
            //打开当前数据库的多线样式字典对象
            DBDictionary dict=(DBDictionary)db.MLStyleDictionaryId.GetObject(OpenMode.ForRead);
            if (dict.Contains(styleName)) // 如果已经存在指定名称的多线样式
                return (ObjectId)dict[styleName]; // 返回该多线样式的Id
            MlineStyle mStyle=new MlineStyle();// 创建一个多线样式对象
            mStyle.Name = styleName;//设置多线样式的名称
            //为多线样式添加新的元素
            foreach (var element in elements)
            {
                mStyle.Elements.Add(element, true);
            }
            dict.UpgradeOpen(); //切换多线字典为写
            //在多线样式字典中加入新创建的多线样式对象，并指定搜索关键字为styleName
            dict.SetAt(styleName, mStyle);
            //通知事务处理完成多线样式对象的加入
            db.TransactionManager.AddNewlyCreatedDBObject(mStyle, true);
            dict.DowngradeOpen(); //为了安全，将多线样式字典切换成读
            return mStyle.ObjectId; // 返回该多线样式的Id
        }

        /// <summary>
        /// 删除多线样式
        /// </summary>
        /// <param name="db">数据库对象</param>
        /// <param name="styleName">多线样式名</param>
        public static void RemoveMLineStyle(this Database db, string styleName)
        {
            //打开当前数据库的多线样式字典对象
            DBDictionary dict=(DBDictionary)db.MLStyleDictionaryId.GetObject(OpenMode.ForRead);
            //在多线样式字典中搜索关键字为styleName的多线样式对象
            if (dict.Contains(styleName))
            {
                dict.UpgradeOpen();
                //如果找到名为styleName的多线样式，则从多线样式字典中删除
                dict.Remove(styleName);
                dict.DowngradeOpen();
            }
        }
    }
}
using System;
using System.IO;
using System.Windows.Forms;
using Autodesk.AutoCAD.ApplicationServices;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.Geometry;
using Autodesk.AutoCAD.Internal;
using DotNetARX;
using AcadApp = Autodesk.AutoCAD.ApplicationServices.Application;
using AcadWnd = Autodesk.AutoCAD.Windows;
namespace chap10
{
    public partial class ModalForm : Form
    {
        public ModalForm()
        {
            InitializeComponent();
        }

        private void buttonBrowse_Click(object sender, EventArgs e)
        {
            Database db = HostApplicationServices.WorkingDatabase;
            //ʾбе
            this.comboBoxBlockName.Items.Clear();
            //½һļԻ򣬲öԻıʾļΪdwgdxf            
            AcadWnd.OpenFileDialog dlg = new AcadWnd.OpenFileDialog("ѡͼļ", null, "dwg;dxf", null, AcadWnd.OpenFileDialog.OpenFileDialogFlags.AllowMultiple);
            //򿪶Իɹ
            if (dlg.ShowDialog() == System.Windows.Forms.DialogResult.OK)
            {
                //ʾѡļ·
                this.labelPathlabelPath.Text = "·:  " + dlg.Filename;
                //ѡļеĿ
                db.ImportBlocksFromDwg(dlg.Filename);
                //ʼ
                using (Transaction trans = db.TransactionManager.StartTransaction())
                {
                    //򿪿
                    BlockTable bt = (BlockTable)trans.GetObject(db.BlockTableId, OpenMode.ForRead);
                    //ѭеĿ¼
                    foreach (ObjectId blockRecordId in bt)
                    {
                        //򿪿¼
                        BlockTableRecord btr = (BlockTableRecord)trans.GetObject(blockRecordId, OpenMode.ForRead);
                        //бֻͷǲֿ
                        if (!btr.IsAnonymous && !btr.IsLayout)
                            this.comboBoxBlockName.Items.Add(btr.Name);
                    }
                }
                //бʾĸ˳ڵһĿ
                if (this.comboBoxBlockName.Items.Count > 0)
                    this.comboBoxBlockName.Text = this.comboBoxBlockName.Items[0].ToString();
            }
        }

        private void buttonCancel_Click(object sender, EventArgs e)
        {
            this.Close();
        }

        private void comboBoxBlockName_SelectedIndexChanged(object sender, EventArgs e)
        {
            Database db = HostApplicationServices.WorkingDatabase;
            //ȡб
            ComboBox blockNames = sender as ComboBox;
            //ȡбеǰѡĿ
            string blockName = blockNames.SelectedItem.ToString();
            //ʼ
            using (Transaction trans = db.TransactionManager.StartTransaction())
            {
                //򿪿
                BlockTable bt = (BlockTable)trans.GetObject(db.BlockTableId, OpenMode.ForRead);
                //ΪбеǰѡĿĿ
                BlockTableRecord btr = (BlockTableRecord)trans.GetObject(bt[blockName], OpenMode.ForRead);
                //ȡԤͼɹͼƬеͼΪԤͼ
                if (btr.HasPreviewIcon)
                {
                    //AutoCAD 2008°汾
                    this.pictureBoxBlock.Image = BlockThumbnailHelper.GetBlockThumbanail(btr.ObjectId);
                    //this.pictureBoxBlock.Image = btr.PreviewIcon; //AutoCAD 2009ϰ汾
                }
                //ݵǰѡĿ飬ÿĵλͱ
                switch (btr.Units)
                {
                    case UnitsValue.Inches:
                        this.textBoxBlockUnit.Text = "Ӣ";
                        this.textBoxBlockRatio.Text = "25.4";
                        break;
                    case UnitsValue.Meters:
                        this.textBoxBlockUnit.Text = "";
                        this.textBoxBlockRatio.Text = "1000";
                        break;
                    case UnitsValue.Millimeters:
                        this.textBoxBlockUnit.Text = "";
                        this.textBoxBlockRatio.Text = "1";
                        break;
                    case UnitsValue.Undefined:
                        this.textBoxBlockUnit.Text = "޵λ";
                        this.textBoxBlockRatio.Text = "1";
                        break;
                    default:
                        this.textBoxBlockUnit.Text = btr.Units.ToString();
                        this.textBoxBlockRatio.Text = "";
                        break;
                }
            }
        }

        private void checkBoxSameScale_CheckedChanged(object sender, EventArgs e)
        {
            //ȡ
            CheckBox uniformScale = sender as CheckBox;
            //ѡ״̬
            if (uniformScale.Checked == true)
            {
                //YZűXһ
                this.textBoxScaleY.Text = this.textBoxScaleX.Text;
                this.textBoxScaleZ.Text = this.textBoxScaleX.Text;
                //YZűı
                this.textBoxScaleY.Enabled = false;
                this.textBoxScaleZ.Enabled = false;
            }
            else
            {
                //YZűı
                this.textBoxScaleY.Enabled = true;
                this.textBoxScaleZ.Enabled = true;
            }
        }

        private void textBoxScaleX_TextChanged(object sender, EventArgs e)
        {
            //ѡ״̬YZűXһ
            if (this.checkBoxSameScale.Checked == true)
            {
                this.textBoxScaleY.Text = this.textBoxScaleX.Text;
                this.textBoxScaleZ.Text = this.textBoxScaleX.Text;
            }
        }

        private void checkBoxScale_CheckedChanged(object sender, EventArgs e)
        {
            //ȡ
            CheckBox bchecked = sender as CheckBox;
            //ѡ״̬űı
            if (bchecked.Checked == true)
            {
                this.textBoxScaleX.Enabled = false;
                this.textBoxScaleY.Enabled = false;
                this.textBoxScaleZ.Enabled = false;
            }
            //򣬿űı
            else
            {
                this.textBoxScaleX.Enabled = true;
                this.textBoxScaleY.Enabled = true;
                this.textBoxScaleZ.Enabled = true;
            }
        }

        private void checkBoxInsertPoint_CheckedChanged(object sender, EventArgs e)
        {
            //ȡ
            CheckBox bchecked = sender as CheckBox;
            //ѡ״̬òı
            if (bchecked.Checked == true)
            {
                this.textBoxInsertPointX.Enabled = false;
                this.textBoxInsertPointY.Enabled = false;
                this.textBoxInsertPointZ.Enabled = false;
            }
            //򣬿òı
            else
            {
                this.textBoxInsertPointX.Enabled = true;
                this.textBoxInsertPointY.Enabled = true;
                this.textBoxInsertPointZ.Enabled = true;
            }
        }

        private void checkBoxRotate_CheckedChanged(object sender, EventArgs e)
        {
            //ȡ
            CheckBox bchecked = sender as CheckBox;
            //ѡ״̬תǶȵı
            if (bchecked.Checked == true)
            {
                this.textBoxRotateAngle.Enabled = false;
            }
            //򣬿תǶȵı
            else
            {
                this.textBoxRotateAngle.Enabled = true;
            }
        }

        private void ModalForm_Load(object sender, EventArgs e)
        {
            //ʼ״̬ͼûп飬ʾΪ޵λͱΪ1
            this.textBoxBlockUnit.Text = "޵λ";
            this.textBoxBlockRatio.Text = "1";
        }

        private void buttonOK_Click(object sender, EventArgs e)
        {
            //ȡղ
            double insertPointX = Convert.ToDouble(this.textBoxInsertPointX.Text);
            double insertPointY = Convert.ToDouble(this.textBoxInsertPointY.Text);
            double insertPointZ = Convert.ToDouble(this.textBoxInsertPointZ.Text);
            Point3d insertPoint = new Point3d(insertPointX, insertPointY, insertPointZ);
            //ȡյű
            double scaleX = Convert.ToDouble(this.textBoxScaleX.Text);
            double scaleY = Convert.ToDouble(this.textBoxScaleY.Text);
            double scaleZ = Convert.ToDouble(this.textBoxScaleZ.Text);
            Scale3d scale = new Scale3d(scaleX, scaleY, scaleZ);
            //ȡյתǶ
            double rotationAngle = Convert.ToDouble(this.textBoxRotateAngle.Text);
            //رմ
            this.Close();
            Database db=HostApplicationServices.WorkingDatabase;
            using (Transaction trans=db.TransactionManager.StartTransaction())
            {
                ObjectId id=db.Clayer; //ǰId
                // ȡǰ
                LayerTableRecord ltr=(LayerTableRecord)id.GetObject(OpenMode.ForRead);
                ObjectId model=db.GetModelSpaceId(); // ȡģͿռId
                // ڵǰģͿռ
                model.InsertBlockReference(ltr.Name, this.comboBoxBlockName.Text, insertPoint, scale, rotationAngle);
            }
        }

        private void buttonHelp_Click(object sender, EventArgs e)
        {
            string fullHelpPath = Path.Combine(Tools.GetCurrentPath(), "acad_acr.chm");
            AcadApp.InvokeHelp(fullHelpPath, "d0e53397");
        }
    }
}

namespace chap10
{
    partial class ModalForm
    {
        /// <summary>
        /// Required designer variable.
        /// </summary>
        private System.ComponentModel.IContainer components = null;

        /// <summary>
        /// Clean up any resources being used.
        /// </summary>
        /// <param name="disposing">true if managed resources should be disposed; otherwise, false.</param>
        protected override void Dispose(bool disposing)
        {
            if (disposing && (components != null))
            {
                components.Dispose();
            }
            base.Dispose(disposing);
        }

        #region Windows Form Designer generated code

        /// <summary>
        /// Required method for Designer support - do not modify
        /// the contents of this method with the code editor.
        /// </summary>
        private void InitializeComponent()
        {
            this.pictureBoxBlock = new System.Windows.Forms.PictureBox();
            this.buttonCancel = new System.Windows.Forms.Button();
            this.buttonHelp = new System.Windows.Forms.Button();
            this.buttonOK = new System.Windows.Forms.Button();
            this.groupBox4 = new System.Windows.Forms.GroupBox();
            this.textBoxBlockRatio = new System.Windows.Forms.TextBox();
            this.textBoxBlockUnit = new System.Windows.Forms.TextBox();
            this.label10 = new System.Windows.Forms.Label();
            this.label9 = new System.Windows.Forms.Label();
            this.groupBox3 = new System.Windows.Forms.GroupBox();
            this.textBoxRotateAngle = new System.Windows.Forms.TextBox();
            this.label11 = new System.Windows.Forms.Label();
            this.checkBoxRotate = new System.Windows.Forms.CheckBox();
            this.groupBox2 = new System.Windows.Forms.GroupBox();
            this.textBoxScaleY = new System.Windows.Forms.TextBox();
            this.label6 = new System.Windows.Forms.Label();
            this.textBoxScaleZ = new System.Windows.Forms.TextBox();
            this.label7 = new System.Windows.Forms.Label();
            this.textBoxScaleX = new System.Windows.Forms.TextBox();
            this.label8 = new System.Windows.Forms.Label();
            this.checkBoxSameScale = new System.Windows.Forms.CheckBox();
            this.checkBoxScale = new System.Windows.Forms.CheckBox();
            this.groupBox1 = new System.Windows.Forms.GroupBox();
            this.textBoxInsertPointY = new System.Windows.Forms.TextBox();
            this.label5 = new System.Windows.Forms.Label();
            this.textBoxInsertPointZ = new System.Windows.Forms.TextBox();
            this.label4 = new System.Windows.Forms.Label();
            this.textBoxInsertPointX = new System.Windows.Forms.TextBox();
            this.label3 = new System.Windows.Forms.Label();
            this.checkBoxInsertPoint = new System.Windows.Forms.CheckBox();
            this.buttonBrowse = new System.Windows.Forms.Button();
            this.comboBoxBlockName = new System.Windows.Forms.ComboBox();
            this.labelPathlabelPath = new System.Windows.Forms.Label();
            this.label1 = new System.Windows.Forms.Label();
            ((System.ComponentModel.ISupportInitialize)(this.pictureBoxBlock)).BeginInit();
            this.groupBox4.SuspendLayout();
            this.groupBox3.SuspendLayout();
            this.groupBox2.SuspendLayout();
            this.groupBox1.SuspendLayout();
            this.SuspendLayout();
            // 
            // pictureBoxBlock
            // 
            this.pictureBoxBlock.BackColor = System.Drawing.SystemColors.Control;
            this.pictureBoxBlock.Location = new System.Drawing.Point(380, 16);
            this.pictureBoxBlock.Name = "pictureBoxBlock";
            this.pictureBoxBlock.Size = new System.Drawing.Size(75, 47);
            this.pictureBoxBlock.SizeMode = System.Windows.Forms.PictureBoxSizeMode.CenterImage;
            this.pictureBoxBlock.TabIndex = 32;
            this.pictureBoxBlock.TabStop = false;
            // 
            // buttonCancel
            // 
            this.buttonCancel.Location = new System.Drawing.Point(303, 226);
            this.buttonCancel.Name = "buttonCancel";
            this.buttonCancel.Size = new System.Drawing.Size(75, 23);
            this.buttonCancel.TabIndex = 31;
            this.buttonCancel.Text = "ȡ";
            this.buttonCancel.UseVisualStyleBackColor = true;
            this.buttonCancel.Click += new System.EventHandler(this.buttonCancel_Click);
            // 
            // buttonHelp
            // 
            this.buttonHelp.Location = new System.Drawing.Point(389, 226);
            this.buttonHelp.Name = "buttonHelp";
            this.buttonHelp.Size = new System.Drawing.Size(75, 23);
            this.buttonHelp.TabIndex = 29;
            this.buttonHelp.Text = "(&H)";
            this.buttonHelp.UseVisualStyleBackColor = true;
            this.buttonHelp.Click += new System.EventHandler(this.buttonHelp_Click);
            // 
            // buttonOK
            // 
            this.buttonOK.Location = new System.Drawing.Point(217, 227);
            this.buttonOK.Name = "buttonOK";
            this.buttonOK.Size = new System.Drawing.Size(75, 23);
            this.buttonOK.TabIndex = 30;
            this.buttonOK.Text = "ȷ";
            this.buttonOK.UseVisualStyleBackColor = true;
            this.buttonOK.Click += new System.EventHandler(this.buttonOK_Click);
            // 
            // groupBox4
            // 
            this.groupBox4.Controls.Add(this.textBoxBlockRatio);
            this.groupBox4.Controls.Add(this.textBoxBlockUnit);
            this.groupBox4.Controls.Add(this.label10);
            this.groupBox4.Controls.Add(this.label9);
            this.groupBox4.Location = new System.Drawing.Point(334, 148);
            this.groupBox4.Name = "groupBox4";
            this.groupBox4.Size = new System.Drawing.Size(130, 72);
            this.groupBox4.TabIndex = 27;
            this.groupBox4.TabStop = false;
            this.groupBox4.Text = "鵥λ";
            // 
            // textBoxBlockRatio
            // 
            this.textBoxBlockRatio.Location = new System.Drawing.Point(46, 44);
            this.textBoxBlockRatio.Name = "textBoxBlockRatio";
            this.textBoxBlockRatio.ReadOnly = true;
            this.textBoxBlockRatio.Size = new System.Drawing.Size(78, 21);
            this.textBoxBlockRatio.TabIndex = 2;
            // 
            // textBoxBlockUnit
            // 
            this.textBoxBlockUnit.Location = new System.Drawing.Point(46, 14);
            this.textBoxBlockUnit.Name = "textBoxBlockUnit";
            this.textBoxBlockUnit.ReadOnly = true;
            this.textBoxBlockUnit.Size = new System.Drawing.Size(78, 21);
            this.textBoxBlockUnit.TabIndex = 2;
            // 
            // label10
            // 
            this.label10.AutoSize = true;
            this.label10.Location = new System.Drawing.Point(5, 47);
            this.label10.Name = "label10";
            this.label10.Size = new System.Drawing.Size(35, 12);
            this.label10.TabIndex = 1;
            this.label10.Text = ":";
            // 
            // label9
            // 
            this.label9.AutoSize = true;
            this.label9.Location = new System.Drawing.Point(5, 17);
            this.label9.Name = "label9";
            this.label9.Size = new System.Drawing.Size(35, 12);
            this.label9.TabIndex = 1;
            this.label9.Text = "λ:";
            // 
            // groupBox3
            // 
            this.groupBox3.Controls.Add(this.textBoxRotateAngle);
            this.groupBox3.Controls.Add(this.label11);
            this.groupBox3.Controls.Add(this.checkBoxRotate);
            this.groupBox3.Location = new System.Drawing.Point(334, 69);
            this.groupBox3.Name = "groupBox3";
            this.groupBox3.Size = new System.Drawing.Size(130, 73);
            this.groupBox3.TabIndex = 28;
            this.groupBox3.TabStop = false;
            this.groupBox3.Text = "ת";
            // 
            // textBoxRotateAngle
            // 
            this.textBoxRotateAngle.Location = new System.Drawing.Point(55, 43);
            this.textBoxRotateAngle.Name = "textBoxRotateAngle";
            this.textBoxRotateAngle.Size = new System.Drawing.Size(69, 21);
            this.textBoxRotateAngle.TabIndex = 2;
            this.textBoxRotateAngle.Text = "0";
            // 
            // label11
            // 
            this.label11.AutoSize = true;
            this.label11.Location = new System.Drawing.Point(5, 46);
            this.label11.Name = "label11";
            this.label11.Size = new System.Drawing.Size(53, 12);
            this.label11.TabIndex = 1;
            this.label11.Text = "Ƕ(&A):";
            // 
            // checkBoxRotate
            // 
            this.checkBoxRotate.AutoSize = true;
            this.checkBoxRotate.Location = new System.Drawing.Point(7, 21);
            this.checkBoxRotate.Name = "checkBoxRotate";
            this.checkBoxRotate.Size = new System.Drawing.Size(114, 16);
            this.checkBoxRotate.TabIndex = 0;
            this.checkBoxRotate.Text = "Ļָ(&C)";
            this.checkBoxRotate.UseVisualStyleBackColor = true;
            this.checkBoxRotate.CheckedChanged += new System.EventHandler(this.checkBoxRotate_CheckedChanged);
            // 
            // groupBox2
            // 
            this.groupBox2.Controls.Add(this.textBoxScaleY);
            this.groupBox2.Controls.Add(this.label6);
            this.groupBox2.Controls.Add(this.textBoxScaleZ);
            this.groupBox2.Controls.Add(this.label7);
            this.groupBox2.Controls.Add(this.textBoxScaleX);
            this.groupBox2.Controls.Add(this.label8);
            this.groupBox2.Controls.Add(this.checkBoxSameScale);
            this.groupBox2.Controls.Add(this.checkBoxScale);
            this.groupBox2.Location = new System.Drawing.Point(177, 69);
            this.groupBox2.Name = "groupBox2";
            this.groupBox2.Size = new System.Drawing.Size(151, 151);
            this.groupBox2.TabIndex = 26;
            this.groupBox2.TabStop = false;
            this.groupBox2.Text = "ű";
            // 
            // textBoxScaleY
            // 
            this.textBoxScaleY.Location = new System.Drawing.Point(30, 70);
            this.textBoxScaleY.Name = "textBoxScaleY";
            this.textBoxScaleY.Size = new System.Drawing.Size(104, 21);
            this.textBoxScaleY.TabIndex = 2;
            this.textBoxScaleY.Text = "1";
            // 
            // label6
            // 
            this.label6.AutoSize = true;
            this.label6.Location = new System.Drawing.Point(7, 73);
            this.label6.Name = "label6";
            this.label6.Size = new System.Drawing.Size(17, 12);
            this.label6.TabIndex = 1;
            this.label6.Text = "&Y:";
            // 
            // textBoxScaleZ
            // 
            this.textBoxScaleZ.BackColor = System.Drawing.SystemColors.Window;
            this.textBoxScaleZ.Location = new System.Drawing.Point(30, 97);
            this.textBoxScaleZ.Name = "textBoxScaleZ";
            this.textBoxScaleZ.Size = new System.Drawing.Size(104, 21);
            this.textBoxScaleZ.TabIndex = 2;
            this.textBoxScaleZ.Text = "1";
            // 
            // label7
            // 
            this.label7.AutoSize = true;
            this.label7.Location = new System.Drawing.Point(7, 100);
            this.label7.Name = "label7";
            this.label7.Size = new System.Drawing.Size(17, 12);
            this.label7.TabIndex = 1;
            this.label7.Text = "&Z:";
            // 
            // textBoxScaleX
            // 
            this.textBoxScaleX.Location = new System.Drawing.Point(30, 43);
            this.textBoxScaleX.Name = "textBoxScaleX";
            this.textBoxScaleX.Size = new System.Drawing.Size(104, 21);
            this.textBoxScaleX.TabIndex = 2;
            this.textBoxScaleX.Text = "1";
            this.textBoxScaleX.TextChanged += new System.EventHandler(this.textBoxScaleX_TextChanged);
            // 
            // label8
            // 
            this.label8.AutoSize = true;
            this.label8.Location = new System.Drawing.Point(7, 46);
            this.label8.Name = "label8";
            this.label8.Size = new System.Drawing.Size(17, 12);
            this.label8.TabIndex = 1;
            this.label8.Text = "&X:";
            // 
            // checkBoxSameScale
            // 
            this.checkBoxSameScale.AutoSize = true;
            this.checkBoxSameScale.Location = new System.Drawing.Point(30, 128);
            this.checkBoxSameScale.Name = "checkBoxSameScale";
            this.checkBoxSameScale.Size = new System.Drawing.Size(72, 16);
            this.checkBoxSameScale.TabIndex = 0;
            this.checkBoxSameScale.Text = "ͳһ";
            this.checkBoxSameScale.UseVisualStyleBackColor = true;
            this.checkBoxSameScale.CheckedChanged += new System.EventHandler(this.checkBoxSameScale_CheckedChanged);
            // 
            // checkBoxScale
            // 
            this.checkBoxScale.AutoSize = true;
            this.checkBoxScale.Location = new System.Drawing.Point(7, 21);
            this.checkBoxScale.Name = "checkBoxScale";
            this.checkBoxScale.Size = new System.Drawing.Size(114, 16);
            this.checkBoxScale.TabIndex = 0;
            this.checkBoxScale.Text = "Ļָ(&E)";
            this.checkBoxScale.UseVisualStyleBackColor = true;
            this.checkBoxScale.CheckedChanged += new System.EventHandler(this.checkBoxScale_CheckedChanged);
            // 
            // groupBox1
            // 
            this.groupBox1.Controls.Add(this.textBoxInsertPointY);
            this.groupBox1.Controls.Add(this.label5);
            this.groupBox1.Controls.Add(this.textBoxInsertPointZ);
            this.groupBox1.Controls.Add(this.label4);
            this.groupBox1.Controls.Add(this.textBoxInsertPointX);
            this.groupBox1.Controls.Add(this.label3);
            this.groupBox1.Controls.Add(this.checkBoxInsertPoint);
            this.groupBox1.Location = new System.Drawing.Point(20, 69);
            this.groupBox1.Name = "groupBox1";
            this.groupBox1.Size = new System.Drawing.Size(151, 151);
            this.groupBox1.TabIndex = 25;
            this.groupBox1.TabStop = false;
            this.groupBox1.Text = "";
            // 
            // textBoxInsertPointY
            // 
            this.textBoxInsertPointY.BackColor = System.Drawing.SystemColors.Window;
            this.textBoxInsertPointY.Location = new System.Drawing.Point(30, 70);
            this.textBoxInsertPointY.Name = "textBoxInsertPointY";
            this.textBoxInsertPointY.Size = new System.Drawing.Size(104, 21);
            this.textBoxInsertPointY.TabIndex = 2;
            this.textBoxInsertPointY.Text = "0";
            // 
            // label5
            // 
            this.label5.AutoSize = true;
            this.label5.Location = new System.Drawing.Point(7, 73);
            this.label5.Name = "label5";
            this.label5.Size = new System.Drawing.Size(17, 12);
            this.label5.TabIndex = 1;
            this.label5.Text = "&Y:";
            // 
            // textBoxInsertPointZ
            // 
            this.textBoxInsertPointZ.BackColor = System.Drawing.SystemColors.Window;
            this.textBoxInsertPointZ.Location = new System.Drawing.Point(30, 97);
            this.textBoxInsertPointZ.Name = "textBoxInsertPointZ";
            this.textBoxInsertPointZ.Size = new System.Drawing.Size(104, 21);
            this.textBoxInsertPointZ.TabIndex = 2;
            this.textBoxInsertPointZ.Text = "0";
            // 
            // label4
            // 
            this.label4.AutoSize = true;
            this.label4.Location = new System.Drawing.Point(7, 100);
            this.label4.Name = "label4";
            this.label4.Size = new System.Drawing.Size(17, 12);
            this.label4.TabIndex = 1;
            this.label4.Text = "&Z:";
            // 
            // textBoxInsertPointX
            // 
            this.textBoxInsertPointX.BackColor = System.Drawing.SystemColors.Window;
            this.textBoxInsertPointX.Location = new System.Drawing.Point(30, 43);
            this.textBoxInsertPointX.Name = "textBoxInsertPointX";
            this.textBoxInsertPointX.Size = new System.Drawing.Size(104, 21);
            this.textBoxInsertPointX.TabIndex = 2;
            this.textBoxInsertPointX.Text = "0";
            // 
            // label3
            // 
            this.label3.AutoSize = true;
            this.label3.Location = new System.Drawing.Point(7, 46);
            this.label3.Name = "label3";
            this.label3.Size = new System.Drawing.Size(17, 12);
            this.label3.TabIndex = 1;
            this.label3.Text = "&X:";
            // 
            // checkBoxInsertPoint
            // 
            this.checkBoxInsertPoint.AutoSize = true;
            this.checkBoxInsertPoint.Location = new System.Drawing.Point(7, 21);
            this.checkBoxInsertPoint.Name = "checkBoxInsertPoint";
            this.checkBoxInsertPoint.Size = new System.Drawing.Size(114, 16);
            this.checkBoxInsertPoint.TabIndex = 0;
            this.checkBoxInsertPoint.Text = "Ļָ(&S)";
            this.checkBoxInsertPoint.UseVisualStyleBackColor = true;
            this.checkBoxInsertPoint.CheckedChanged += new System.EventHandler(this.checkBoxInsertPoint_CheckedChanged);
            // 
            // buttonBrowse
            // 
            this.buttonBrowse.Location = new System.Drawing.Point(284, 22);
            this.buttonBrowse.Name = "buttonBrowse";
            this.buttonBrowse.Size = new System.Drawing.Size(74, 23);
            this.buttonBrowse.TabIndex = 24;
            this.buttonBrowse.Text = "(&B)...";
            this.buttonBrowse.UseVisualStyleBackColor = true;
            this.buttonBrowse.Click += new System.EventHandler(this.buttonBrowse_Click);
            // 
            // comboBoxBlockName
            // 
            this.comboBoxBlockName.FormattingEnabled = true;
            this.comboBoxBlockName.Location = new System.Drawing.Point(77, 24);
            this.comboBoxBlockName.MaxDropDownItems = 20;
            this.comboBoxBlockName.Name = "comboBoxBlockName";
            this.comboBoxBlockName.Size = new System.Drawing.Size(188, 20);
            this.comboBoxBlockName.Sorted = true;
            this.comboBoxBlockName.TabIndex = 23;
            this.comboBoxBlockName.SelectedIndexChanged += new System.EventHandler(this.comboBoxBlockName_SelectedIndexChanged);
            // 
            // labelPathlabelPath
            // 
            this.labelPathlabelPath.Location = new System.Drawing.Point(18, 54);
            this.labelPathlabelPath.Name = "labelPathlabelPath";
            this.labelPathlabelPath.Size = new System.Drawing.Size(340, 12);
            this.labelPathlabelPath.TabIndex = 21;
            this.labelPathlabelPath.Text = "·:";
            // 
            // label1
            // 
            this.label1.AutoSize = true;
            this.label1.Location = new System.Drawing.Point(18, 27);
            this.label1.Name = "label1";
            this.label1.Size = new System.Drawing.Size(53, 12);
            this.label1.TabIndex = 22;
            this.label1.Text = "(&N):";
            // 
            // ModalForm
            // 
            this.AutoScaleDimensions = new System.Drawing.SizeF(6F, 12F);
            this.AutoScaleMode = System.Windows.Forms.AutoScaleMode.Font;
            this.ClientSize = new System.Drawing.Size(482, 266);
            this.Controls.Add(this.pictureBoxBlock);
            this.Controls.Add(this.buttonCancel);
            this.Controls.Add(this.buttonHelp);
            this.Controls.Add(this.buttonOK);
            this.Controls.Add(this.groupBox4);
            this.Controls.Add(this.groupBox3);
            this.Controls.Add(this.groupBox2);
            this.Controls.Add(this.groupBox1);
            this.Controls.Add(this.buttonBrowse);
            this.Controls.Add(this.comboBoxBlockName);
            this.Controls.Add(this.labelPathlabelPath);
            this.Controls.Add(this.label1);
            this.MaximizeBox = false;
            this.MinimizeBox = false;
            this.Name = "ModalForm";
            this.Text = "ģ̬Իʾ";
            this.Load += new System.EventHandler(this.ModalForm_Load);
            ((System.ComponentModel.ISupportInitialize)(this.pictureBoxBlock)).EndInit();
            this.groupBox4.ResumeLayout(false);
            this.groupBox4.PerformLayout();
            this.groupBox3.ResumeLayout(false);
            this.groupBox3.PerformLayout();
            this.groupBox2.ResumeLayout(false);
            this.groupBox2.PerformLayout();
            this.groupBox1.ResumeLayout(false);
            this.groupBox1.PerformLayout();
            this.ResumeLayout(false);
            this.PerformLayout();

        }

        #endregion

        private System.Windows.Forms.PictureBox pictureBoxBlock;
        private System.Windows.Forms.Button buttonCancel;
        private System.Windows.Forms.Button buttonHelp;
        private System.Windows.Forms.Button buttonOK;
        private System.Windows.Forms.GroupBox groupBox4;
        private System.Windows.Forms.TextBox textBoxBlockRatio;
        private System.Windows.Forms.TextBox textBoxBlockUnit;
        private System.Windows.Forms.Label label10;
        private System.Windows.Forms.Label label9;
        private System.Windows.Forms.GroupBox groupBox3;
        private System.Windows.Forms.TextBox textBoxRotateAngle;
        private System.Windows.Forms.Label label11;
        private System.Windows.Forms.CheckBox checkBoxRotate;
        private System.Windows.Forms.GroupBox groupBox2;
        private System.Windows.Forms.TextBox textBoxScaleY;
        private System.Windows.Forms.Label label6;
        private System.Windows.Forms.TextBox textBoxScaleZ;
        private System.Windows.Forms.Label label7;
        private System.Windows.Forms.TextBox textBoxScaleX;
        private System.Windows.Forms.Label label8;
        private System.Windows.Forms.CheckBox checkBoxSameScale;
        private System.Windows.Forms.CheckBox checkBoxScale;
        private System.Windows.Forms.GroupBox groupBox1;
        private System.Windows.Forms.TextBox textBoxInsertPointY;
        private System.Windows.Forms.Label label5;
        private System.Windows.Forms.TextBox textBoxInsertPointZ;
        private System.Windows.Forms.Label label4;
        private System.Windows.Forms.TextBox textBoxInsertPointX;
        private System.Windows.Forms.Label label3;
        private System.Windows.Forms.CheckBox checkBoxInsertPoint;
        private System.Windows.Forms.Button buttonBrowse;
        private System.Windows.Forms.ComboBox comboBoxBlockName;
        private System.Windows.Forms.Label labelPathlabelPath;
        private System.Windows.Forms.Label label1;


    }
}﻿using Autodesk.AutoCAD.ApplicationServices;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.EditorInput;
using Autodesk.AutoCAD.Runtime;
using DotNetARX;

namespace MouseTip
{
    public class MouseTip
    {
        //存储鼠标停留处的块参照的ObjectId
        static ObjectIdCollection blockIds=new ObjectIdCollection();
        static string blockName="";//存储鼠标停留处的块名
        [CommandMethod("StartMonitor")]
        public static void StartMonitor()
        {
            Editor ed=Application.DocumentManager.MdiActiveDocument.Editor;
            //添加鼠标监视事件
            ed.PointMonitor += new PointMonitorEventHandler(ed_PointMonitor);
        }
        static void ed_PointMonitor(object sender, PointMonitorEventArgs e)
        {
            string blockInfo=""; //用于存储块参照的信息：名称和个数
            //获取命令行对象（鼠标监视事件的发起者），用于获取文档对象
            Editor ed=(Editor)sender;
            Document doc=ed.Document;
            //获取鼠标停留处的实体
            FullSubentityPath[] paths=e.Context.GetPickedEntities();
            using (Transaction trans=doc.TransactionManager.StartTransaction())
            {
                //如果鼠标停留处有实体
                if (paths.Length > 0)
                {
                    //获取鼠标停留处的实体
                    FullSubentityPath path=paths[0];
                    BlockReference blockRef=trans.GetObject(path.GetObjectIds()[0], OpenMode.ForRead) as BlockReference;
                    if (blockRef != null)//如果鼠标停留处为块参照
                    {
                        //获取块参照所属的块表记录并以写的方式打开
                        ObjectId blockId=blockRef.BlockTableRecord;
                        BlockTableRecord btr=trans.GetObject(blockId, OpenMode.ForRead) as BlockTableRecord;
                        //获取属于同一块表记录的所有块参照
                        ObjectIdCollection ids=btr.GetBlockReferenceIds(true, false);
                        //若鼠标停留处的块参照的块表记录与上一次的不同
                        if (blockName != btr.Name)
                        {
                            blockName = btr.Name;//重新设置块表记录名
                            blockIds.UnHighlightEntities();//取消上一次块表记录的块参照的亮显
                            blockIds.Clear(); //清空块参照ObjectId列表
                            blockIds = ids;  //设置需要亮显的块参照的ObjectId列表
                            blockIds.HighlightEntities();//亮显所有同名的块参照                            
                        }
                        blockInfo += "块名：" + btr.Name + "\n个数:" + blockIds.Count.ToString();
                    }

                }
                trans.Commit();
            }
            if (blockInfo != "")
            {
                e.AppendToolTipText(blockInfo);//在鼠标停留处显示提示信息                  
            }
        }
        [CommandMethod("StopMonitor")]
        public static void StopMonitor()
        {
            Editor ed = Application.DocumentManager.MdiActiveDocument.Editor;
            //不亮显块参照
            blockIds.UnHighlightEntities();
            blockIds.Clear();
            //停止鼠标监视事件
            ed.PointMonitor -= new PointMonitorEventHandler(ed_PointMonitor);
        }
    }
}
﻿using System;
using System.Collections.Generic;
using System.Text;
using Autodesk.AutoCAD.Runtime;
using Autodesk.AutoCAD.ApplicationServices;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.EditorInput;
using Autodesk.AutoCAD.Geometry;
namespace MoveCircleEvent
{
    public class MoveCircleEvent
    {
        Database db = HostApplicationServices.WorkingDatabase;
        Document doc = Application.DocumentManager.MdiActiveDocument;
        Editor ed = Application.DocumentManager.MdiActiveDocument.Editor;
        bool bMove;
        Point3d startPoint;

        void commandWillStart(object sender, CommandEventArgs e)
        {
            //如果AutoCAD命令为MOVE。
            if (e.GlobalCommandName == "MOVE")
            {
                //设置全局变量bMove为True，表示移动命令开始
                bMove = true;
            }
        }

        void objectOpenedForModify(object sender, ObjectEventArgs e)
        {
            //判断AutoCAD命令是否为移动
            if (bMove == false)
                //如果AutoCAD命令为非移动，则返回
                return;
            Circle circle = e.DBObject as Circle;
            //判断将要移动的对象是否为圆
            if (circle != null)
            {
                //获取圆的中心，就是同心圆的圆心
                startPoint = circle.Center;
            }
        }

        void objectModified(object sender, ObjectEventArgs e)
        {
            //判断AutoCAD命令是否为移动
            if (bMove == false)
                //如果AutoCAD命令为非移动，则返回
                return;
            //断开所有的事件处理函数
            removeEvents();
            //判断移动过的对象是否为圆
            Circle startCirlce = e.DBObject as Circle;
            if (startCirlce == null)
                return;
            //设置选择集过滤器，只选择图形中的圆
            TypedValue[] values = { new TypedValue((int)DxfCode.Start, "Circle") };
            SelectionFilter filter = new SelectionFilter(values);
            PromptSelectionResult resSel = ed.SelectAll(filter);
            //如果选择的是圆
            if (resSel.Status == PromptStatus.OK)
            {
                //获取选择集中的圆对象
                SelectionSet sSet = resSel.Value;
                ObjectId[] ids = sSet.GetObjectIds();
                //开始事务处理
                using (Transaction trans = db.TransactionManager.StartTransaction())
                {
                    //循环遍历选择集中的圆
                    foreach (ObjectId id in ids)
                    {
                        //以读的方式打开圆对象
                        Circle followedCirlce = (Circle)trans.GetObject(id, OpenMode.ForRead);
                        //通过判断圆的圆心与所移动的圆的圆心是否相同，来移动所有的同心圆
                        if (followedCirlce.Center == startPoint)
                        {
                            //因为上面以读的方式打开了圆，所以为了改变圆的圆心必须改变为写
                            followedCirlce.UpgradeOpen();
                            //改变圆的圆心，以达到移动的目的
                            followedCirlce.Center = startCirlce.Center;
                        }
                    }
                    //提交事务处理
                    trans.Commit();
                }
            }
            //连接所有的事件处理函数
            AddEvents();
        }

        void commandEnded(object sender, CommandEventArgs e)
        {
            if (bMove == true)//判断AutoCAD命令是否为移动
                bMove = false;//设置全局变量bMove为False，表示移动命令结束
        }

        [CommandMethod("AddEvents")]
        public void AddEvents()
        {
            //把事件处理函数与相应的事件进行连接
            db.ObjectOpenedForModify += objectOpenedForModify;
            db.ObjectModified += objectModified;
            doc.CommandWillStart += commandWillStart;
            doc.CommandEnded += commandEnded;
        }

        [CommandMethod("RemoveEvents")]
        public void removeEvents()
        {
            //断开所有的事件处理函数
            db.ObjectOpenedForModify -= objectOpenedForModify;
            db.ObjectModified -= objectModified;
            doc.CommandWillStart -= commandWillStart;
            doc.CommandEnded -= commandEnded;
        }
    }
}
﻿using System.Linq;
using Autodesk.AutoCAD.ApplicationServices;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.EditorInput;
using Autodesk.AutoCAD.Runtime;
using DotNetARX;
namespace MyXData
{
    public class MyXData
    {
        [CommandMethod("AddX")]
        public void AddX()
        {
            Document doc=Application.DocumentManager.MdiActiveDocument;
            Database db=doc.Database;
            Editor ed=doc.Editor;
            //提示用户选择一个表示董事长的多行文本
            PromptEntityOptions opt=new PromptEntityOptions("\n请选择表示董事长的多行文本");
            opt.SetRejectMessage("\n您选择的不是多行文本，请重新选择");
            opt.AddAllowedClass(typeof(MText), true);
            PromptEntityResult entResult=ed.GetEntity(opt);
            if (entResult.Status != PromptStatus.OK) return;
            ObjectId id=entResult.ObjectId;//用户选择的多行文本的ObjectId
            using (Transaction trans=db.TransactionManager.StartTransaction())
            {
                TypedValueList values=new TypedValueList();//定义一个TypedValue列表
                //添加整型（表示员工编号）和字符串（表示职位）扩展数据项
                values.Add(DxfCode.ExtendedDataInteger32, 1002);
                values.Add(DxfCode.ExtendedDataAsciiString, "董事长");
                //为实体添加应用程序名为"EMPLOYEE"的扩展数据
                id.AddXData("EMPLOYEE", values);
                trans.Commit();
            }
        }

        [CommandMethod("ModX")]
        public void ModX()
        {
            Document doc=Application.DocumentManager.MdiActiveDocument;
            Database db=doc.Database;
            Editor ed=doc.Editor;
            //提示用户选择一个多行文本
            PromptEntityOptions opt=new PromptEntityOptions("\n请选择多行文本");
            opt.SetRejectMessage("\n您选择的不是多行文本，请重新选择");
            opt.AddAllowedClass(typeof(MText), true);
            PromptEntityResult entResult=ed.GetEntity(opt);
            if (entResult.Status != PromptStatus.OK) return;
            ObjectId id=entResult.ObjectId;//用户选择的多行文本的ObjectId
            using (Transaction trans=db.TransactionManager.StartTransaction())
            {
                //如果扩展数据项（员工编号）为1002，则将其修改为1001
                id.ModXData("EMPLOYEE", DxfCode.ExtendedDataInteger32, 1002, 1001);
                trans.Commit();
            }
        }

        [CommandMethod("DelX")]
        public void DelX()
        {
            Document doc=Application.DocumentManager.MdiActiveDocument;
            Database db=doc.Database;
            Editor ed=doc.Editor;
            //提示用户选择一个多行文本
            PromptEntityOptions opt=new PromptEntityOptions("\n请选择多行文本");
            opt.SetRejectMessage("\n您选择的不是多行文本，请重新选择");
            opt.AddAllowedClass(typeof(MText), true);
            PromptEntityResult entResult=ed.GetEntity(opt);
            if (entResult.Status != PromptStatus.OK) return;
            ObjectId id=entResult.ObjectId;//用户选择的多行文本的ObjectId
            using (Transaction trans=db.TransactionManager.StartTransaction())
            {
                id.RemoveXData("EMPLOYEE"); // 删除EMPLOYEE扩展数据
                trans.Commit();
            }
        }

        [CommandMethod("StartMonitor")]
        public void StartMonitor()
        {
            Editor ed=Application.DocumentManager.MdiActiveDocument.Editor;
            //开始鼠标监控事件
            ed.PointMonitor += new PointMonitorEventHandler(ed_PointMonitor);
        }

        void ed_PointMonitor(object sender, PointMonitorEventArgs e)
        {
            string employeeInfo="";//用于存储员工的信息：编号和职位
            //获取命令行对象（鼠标监视事件的发起者），用于获取文档对象
            Editor ed=(Editor)sender;
            Document doc=ed.Document;
            //获取鼠标停留处的实体
            FullSubentityPath[] paths=e.Context.GetPickedEntities();
            using (Transaction trans=doc.TransactionManager.StartTransaction())
            {
                //如果鼠标停留处有实体
                if (paths.Length > 0)
                {
                    //获取鼠标停留处的实体
                    FullSubentityPath path=paths[0];
                    MText mtext=trans.GetObject(path.GetObjectIds()[0], OpenMode.ForRead) as MText;
                    if (mtext != null)//如果鼠标停留处为多行文本
                    {
                        //获取多行文本中应用程序名为“EMPLOYEE”的扩展数据
                        TypedValueList xdata=mtext.ObjectId.GetXData("EMPLOYEE");
                        if (xdata != null)
                        {
                            employeeInfo += "员工编号：" + xdata[1].Value.ToString() + "\n职位：" + xdata[2].Value.ToString();
                        }
                    }
                }
                trans.Commit();
            }
            if (employeeInfo != "")
            {
                e.AppendToolTipText(employeeInfo);//在鼠标停留处显示提示信息
            }
        }

        [CommandMethod("StopMonitor")]
        public void StopMonitor()
        {
            Editor ed=Application.DocumentManager.MdiActiveDocument.Editor;
            //停止鼠标监控事件
            ed.PointMonitor -= new PointMonitorEventHandler(ed_PointMonitor);
        }
    }
}
﻿using System.Linq;
using Autodesk.AutoCAD.ApplicationServices;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.EditorInput;
using Autodesk.AutoCAD.Geometry;
using Autodesk.AutoCAD.Runtime;
using DotNetARX;
namespace NetSelection
{
    public class NetSelection
    {
        [CommandMethod("TestGetSelect")]
        public static void TestGetSelect()
        {
            Document doc=Application.DocumentManager.MdiActiveDocument;
            Database db=doc.Database;
            Editor ed=doc.Editor;
            //生成三个同心圆并添加到当前模型空间
            Circle cir1=new Circle(Point3d.Origin, Vector3d.ZAxis, 10);
            Circle cir2=new Circle(Point3d.Origin, Vector3d.ZAxis, 20);
            Circle cir3=new Circle(Point3d.Origin, Vector3d.ZAxis, 30);
            db.AddToModelSpace(new Circle[] { cir1, cir2, cir3 });
            //提示用户选择对象
            PromptSelectionResult psr = ed.GetSelection();
            if (psr.Status != PromptStatus.OK) return;//如果未选择，则返回
            //获取选择集
            SelectionSet ss=psr.Value;
            //信息提示框，给出选择集中包含实体个数的提示
            Application.ShowAlertDialog("选择集中实体的数量：" + ss.Count.ToString());
        }

        [CommandMethod("MergeSelection")]
        public static void MergeSelection()
        {
            Document doc=Application.DocumentManager.MdiActiveDocument;
            Editor ed=doc.Editor;
            //第一次选择
            PromptSelectionResult ss1=ed.GetSelection();
            if (ss1.Status != PromptStatus.OK) return; //若选择不成功，返回
            Application.ShowAlertDialog("第一个选择集中实体的数量：" + ss1.Value.Count.ToString());
            //第二次选择
            PromptSelectionResult ss2=ed.GetSelection();
            if (ss2.Status != PromptStatus.OK) return;
            Application.ShowAlertDialog("第二个选择集中实体的数量：" + ss2.Value.Count.ToString());
            //第二个选择集的ObjectId加入到第一个选择集中
            var ss3=ss1.Value.GetObjectIds().Union(ss2.Value.GetObjectIds());
            Application.ShowAlertDialog("合并后选择集中实体的数量：" + ss3.Count().ToString());
        }

        [CommandMethod("DelFromSelection")]
        public static void DelFromSelection()
        {
            Document doc=Application.DocumentManager.MdiActiveDocument;
            Editor ed=doc.Editor;
            //第一次选择
            PromptSelectionResult ss1=ed.GetSelection();
            if (ss1.Status != PromptStatus.OK) return; //若选择不成功，返回
            Application.ShowAlertDialog("第一个选择集中实体的数量：" + ss1.Value.Count.ToString());
            //第二次选择
            PromptSelectionResult ss2=ed.GetSelection();
            if (ss2.Status != PromptStatus.OK) return;
            Application.ShowAlertDialog("第二个选择集中实体的数量：" + ss2.Value.Count.ToString());
            //若第二次选择的实体位于第一个选择集中，则删除该实体的ObjectId
            var ss3=ss1.Value.GetObjectIds().Except(ss2.Value.GetObjectIds());
            Application.ShowAlertDialog("删除第二个选择集后第一个选择集中实体的数量：" + ss3.Count().ToString());
        }

        [CommandMethod("TestPickFirst", CommandFlags.UsePickSet)]
        public static void TestPickFirst()
        {
            Document doc=Application.DocumentManager.MdiActiveDocument;
            Editor ed=doc.Editor;
            //获取当前已选择的实体
            PromptSelectionResult psr=ed.SelectImplied();
            //在命令发出前已有实体被选中
            if (psr.Status == PromptStatus.OK)
            {
                SelectionSet ss1=psr.Value; //获取选择集
                //显示当前已选择的实体个数
                Application.ShowAlertDialog("PickFirst示例：当前已选择的实体个数：" + ss1.Count.ToString());
                //清空当前选择集
                ed.SetImpliedSelection(new ObjectId[0]);
                psr = ed.GetSelection();//提示用户进行新的选择
                if (psr.Status == PromptStatus.OK)
                {
                    //设置当前已选择的实体
                    ed.SetImpliedSelection(psr.Value.GetObjectIds());
                    SelectionSet ss2=psr.Value;
                    Application.ShowAlertDialog("PickFirst示例：当前已选择的实体个数：" + ss2.Count.ToString());
                }
            }
            else
            {
                Application.ShowAlertDialog("PickFirst示例：当前已选择的实体个数：0");
            }
        }

        [CommandMethod("TestPolygonSelect")]
        public static void TestPolygonSelect()
        {
            Document doc=Application.DocumentManager.MdiActiveDocument;
            Editor ed=doc.Editor;
            //声明一个Point3d类列表对象，用于存储多段线的顶点
            Point3dList pts=new Point3dList();
            //提示用户选择多段线
            PromptEntityResult per=ed.GetEntity("请选择多段线");
            if (per.Status != PromptStatus.OK) return;//选择错误，返回
            using (Transaction trans=doc.TransactionManager.StartTransaction())
            {
                //转换为Polyline对象
                Polyline pline=trans.GetObject(per.ObjectId, OpenMode.ForRead) as Polyline;
                if (pline != null)
                {
                    //遍历所选多段线的顶点并添加到Point3d类列表
                    for (int i = 0; i < pline.NumberOfVertices; i++)
                    {
                        Point3d point=pline.GetPoint3dAt(i);
                        pts.Add(point);
                    }
                    //窗口选择，仅选择完全位于多边形区域中的对象
                    PromptSelectionResult psr=ed.SelectWindowPolygon(pts);
                    if (psr.Status == PromptStatus.OK)
                    {
                        Application.ShowAlertDialog("选择集中实体的数量：" + psr.Value.Count.ToString());
                    }
                }
                trans.Commit();
            }
        }

        [CommandMethod("TestSelectException")]
        public static void TestSelectException()
        {
            Document doc=Application.DocumentManager.MdiActiveDocument;
            Editor ed=doc.Editor;
            Point3d pt1=Point3d.Origin;
            Point3d pt2=new Point3d(100, 100, 0);
            //交叉窗口选择，选择由pt1和pt2组成的矩形窗口包围的或相交的对象
            PromptSelectionResult psr=ed.SelectCrossingWindow(pt1, pt2);
            if (psr.Status == PromptStatus.OK)
            {
                Application.ShowAlertDialog("选择集中实体的数量：" + psr.Value.Count.ToString());
            }
        }

        [CommandMethod("TestFilter")]
        public static void TestFilter()
        {
            Document doc=Application.DocumentManager.MdiActiveDocument;
            Editor ed=doc.Editor;
            //创建一个自定义的TypedValue列表对象，用于构建过滤器列表
            TypedValueList values=new TypedValueList();
            //选择图层1上的直线对象
            values.Add(DxfCode.LayerName, "图层1");
            values.Add(typeof(Line));
            //构建过滤器列表，注意这里使用自定义类型转换
            SelectionFilter filter=new SelectionFilter(values);
            //选择图形中所有满足过滤器的对象，即位于图层1上的直线
            PromptSelectionResult psr=ed.SelectAll(filter);
            if (psr.Status == PromptStatus.OK)
            {
                Application.ShowAlertDialog("选择集中实体的数量：" + psr.Value.Count.ToString());
            }
        }
    }
}
﻿using System.Collections.Generic;
using System.Linq;
using Autodesk.AutoCAD.DatabaseServices;
namespace AutoNumBlock
{
    /// <summary>
    /// 用来管理自动编号的类
    /// </summary>
    public class NumManager
    {
        public int BaseNum { get; set; }//起始编号
        public int Increment { get; set; }//编号增量
        public int MaxNum { get; set; }//最大编号
        public bool IsRowDirection { get; set; }//是否按行进行编号
        public string Prefix { get; set; }//编号前缀
        public string Suffix { get; set; }//编号后缀
        public string BlockName { get; set; }//自动编号使用的块名
        public string AttName { get; set; }//自动编号使用的块属性
        public string LayerName { get; set; }//自动编号所在的层名
        //存储编号及其对应的块参照的Id的有序字典对象
        public SortedDictionary<int, ObjectId> Numbers { get; set; }
        public NumManager()
        {
            BaseNum = Increment = 1;//起始编号及增量设为1
            IsRowDirection = true;//按行进行编号
            //初始化有序字典对象
            Numbers = new SortedDictionary<int, ObjectId>();
            Database db=HostApplicationServices.WorkingDatabase;
            using (Transaction trans=db.TransactionManager.StartTransaction())
            {
                //将自动编号放置在当前图层上
                LayerTableRecord ltr=(LayerTableRecord)trans.GetObject(db.Clayer, OpenMode.ForRead);
                LayerName = ltr.Name;
                trans.Commit();
            }
        }
    }
}
﻿using Autodesk.AutoCAD.ApplicationServices;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.EditorInput;
using Autodesk.AutoCAD.Runtime;
using DotNetARX;
namespace ObjectRule
{
    public class ObjectRule : ObjectOverrule
    {
        public override void Erase(DBObject dbObject, bool erasing)
        {
            base.Erase(dbObject, erasing);//调用基类函数删除对象
            Editor ed=Application.DocumentManager.MdiActiveDocument.Editor;
            ed.WriteMessage("\n不能删除门");//提示用户不能删除重定义的门
            //抛出异常，阻止门被删除
            throw new Autodesk.AutoCAD.Runtime.Exception(ErrorStatus.NotApplicable);
        }

        public override DBObject DeepClone(DBObject dbObject, DBObject ownerObject, IdMapping idMap, bool isPrimary)
        {
            //调用基类函数复制对象
            DBObject obj=base.DeepClone(dbObject, ownerObject, idMap, isPrimary);
            Database db=obj.Database;
            Document doc=db.GetDocument();
            Editor ed=doc.Editor;
            using (Transaction trans=db.TransactionManager.StartTransaction())
            {
                string doorType="木门";//门类型
                //提示用户输入表示门类型的关键字
                PromptKeywordOptions opt=new PromptKeywordOptions("\n请输入门的类型[木门(M)/铁门(T)/铝合金门(L)]<M>");
                opt.Keywords.Add("M", "M", "M", false, true);
                opt.Keywords.Add("T", "T", "T", false, true);
                opt.Keywords.Add("L", "L", "L", false, true);
                opt.Keywords.Default = "M";//缺省关键字
                PromptResult result=ed.GetKeywords(opt);
                //根据用户输入的关键字，设置门的类型
                if (result.Status == PromptStatus.OK)
                {
                    switch (result.StringResult)
                    {
                        case "M":
                            break;
                        case "T":
                            doorType = "铁门";
                            break;
                        case "L":
                            doorType = "铝合金门";
                            break;
                    }
                }
                TypedValueList values=new TypedValueList();
                values.Add(DxfCode.ExtendedDataAsciiString, doorType);//门类型
                values.Add(DxfCode.ExtendedDataReal, Commands.doors[doorType]);//门价格
                obj.ObjectId.AddXData(Commands.appName, values);//添加扩展数据
                trans.Commit();
            }
            return obj;
        }
    }
}
namespace SQLCAD
{
    partial class officeDataContext
    {
    }
}
﻿#pragma warning disable 1591
//------------------------------------------------------------------------------
// <auto-generated>
//     此代码由工具生成。
//     运行时版本:4.0.30319.488
//
//     对此文件的更改可能会导致不正确的行为，并且如果
//     重新生成代码，这些更改将会丢失。
// </auto-generated>
//------------------------------------------------------------------------------

namespace SQLCAD
{
	using System.Data.Linq;
	using System.Data.Linq.Mapping;
	using System.Data;
	using System.Collections.Generic;
	using System.Reflection;
	using System.Linq;
	using System.Linq.Expressions;
	using System.ComponentModel;
	using System;
	
	
	[global::System.Data.Linq.Mapping.DatabaseAttribute(Name="db_sample")]
	public partial class officeDataContext : System.Data.Linq.DataContext
	{
		
		private static System.Data.Linq.Mapping.MappingSource mappingSource = new AttributeMappingSource();
		
    #region 可扩展性方法定义
    partial void OnCreated();
    partial void InsertEmployee(Employee instance);
    partial void UpdateEmployee(Employee instance);
    partial void DeleteEmployee(Employee instance);
    partial void InsertRoom(Room instance);
    partial void UpdateRoom(Room instance);
    partial void DeleteRoom(Room instance);
    #endregion
		
		public officeDataContext() : 
				base(global::SQLCAD.Properties.Settings.Default.db_sampleConnectionString1, mappingSource)
		{
			OnCreated();
		}
		
		public officeDataContext(string connection) : 
				base(connection, mappingSource)
		{
			OnCreated();
		}
		
		public officeDataContext(System.Data.IDbConnection connection) : 
				base(connection, mappingSource)
		{
			OnCreated();
		}
		
		public officeDataContext(string connection, System.Data.Linq.Mapping.MappingSource mappingSource) : 
				base(connection, mappingSource)
		{
			OnCreated();
		}
		
		public officeDataContext(System.Data.IDbConnection connection, System.Data.Linq.Mapping.MappingSource mappingSource) : 
				base(connection, mappingSource)
		{
			OnCreated();
		}
		
		public System.Data.Linq.Table<Employee> Employee
		{
			get
			{
				return this.GetTable<Employee>();
			}
		}
		
		public System.Data.Linq.Table<Room> Room
		{
			get
			{
				return this.GetTable<Room>();
			}
		}
	}
	
	[global::System.Data.Linq.Mapping.TableAttribute(Name="dbo.Employee")]
	public partial class Employee : INotifyPropertyChanging, INotifyPropertyChanged
	{
		
		private static PropertyChangingEventArgs emptyChangingEventArgs = new PropertyChangingEventArgs(String.Empty);
		
		private int _Id;
		
		private string _Last_Name;
		
		private string _First_Name;
		
		private string _Room_No;
		
		private EntityRef<Room> _Room;
		
    #region 可扩展性方法定义
    partial void OnLoaded();
    partial void OnValidate(System.Data.Linq.ChangeAction action);
    partial void OnCreated();
    partial void OnIdChanging(int value);
    partial void OnIdChanged();
    partial void OnLast_NameChanging(string value);
    partial void OnLast_NameChanged();
    partial void OnFirst_NameChanging(string value);
    partial void OnFirst_NameChanged();
    partial void OnRoom_NoChanging(string value);
    partial void OnRoom_NoChanged();
    #endregion
		
		public Employee()
		{
			this._Room = default(EntityRef<Room>);
			OnCreated();
		}
		
		[global::System.Data.Linq.Mapping.ColumnAttribute(Storage="_Id", AutoSync=AutoSync.OnInsert, DbType="Int NOT NULL IDENTITY", IsPrimaryKey=true, IsDbGenerated=true)]
		public int Id
		{
			get
			{
				return this._Id;
			}
			set
			{
				if ((this._Id != value))
				{
					this.OnIdChanging(value);
					this.SendPropertyChanging();
					this._Id = value;
					this.SendPropertyChanged("Id");
					this.OnIdChanged();
				}
			}
		}
		
		[global::System.Data.Linq.Mapping.ColumnAttribute(Storage="_Last_Name", DbType="NVarChar(50) NOT NULL", CanBeNull=false)]
		public string Last_Name
		{
			get
			{
				return this._Last_Name;
			}
			set
			{
				if ((this._Last_Name != value))
				{
					this.OnLast_NameChanging(value);
					this.SendPropertyChanging();
					this._Last_Name = value;
					this.SendPropertyChanged("Last_Name");
					this.OnLast_NameChanged();
				}
			}
		}
		
		[global::System.Data.Linq.Mapping.ColumnAttribute(Storage="_First_Name", DbType="NVarChar(50) NOT NULL", CanBeNull=false)]
		public string First_Name
		{
			get
			{
				return this._First_Name;
			}
			set
			{
				if ((this._First_Name != value))
				{
					this.OnFirst_NameChanging(value);
					this.SendPropertyChanging();
					this._First_Name = value;
					this.SendPropertyChanged("First_Name");
					this.OnFirst_NameChanged();
				}
			}
		}
		
		[global::System.Data.Linq.Mapping.ColumnAttribute(Storage="_Room_No", DbType="NVarChar(50)")]
		public string Room_No
		{
			get
			{
				return this._Room_No;
			}
			set
			{
				if ((this._Room_No != value))
				{
					if (this._Room.HasLoadedOrAssignedValue)
					{
						throw new System.Data.Linq.ForeignKeyReferenceAlreadyHasValueException();
					}
					this.OnRoom_NoChanging(value);
					this.SendPropertyChanging();
					this._Room_No = value;
					this.SendPropertyChanged("Room_No");
					this.OnRoom_NoChanged();
				}
			}
		}
		
		[global::System.Data.Linq.Mapping.AssociationAttribute(Name="Room_Employee", Storage="_Room", ThisKey="Room_No", OtherKey="Room_No", IsForeignKey=true)]
		public Room Room
		{
			get
			{
				return this._Room.Entity;
			}
			set
			{
				Room previousValue = this._Room.Entity;
				if (((previousValue != value) 
							|| (this._Room.HasLoadedOrAssignedValue == false)))
				{
					this.SendPropertyChanging();
					if ((previousValue != null))
					{
						this._Room.Entity = null;
						previousValue.Employee.Remove(this);
					}
					this._Room.Entity = value;
					if ((value != null))
					{
						value.Employee.Add(this);
						this._Room_No = value.Room_No;
					}
					else
					{
						this._Room_No = default(string);
					}
					this.SendPropertyChanged("Room");
				}
			}
		}
		
		public event PropertyChangingEventHandler PropertyChanging;
		
		public event PropertyChangedEventHandler PropertyChanged;
		
		protected virtual void SendPropertyChanging()
		{
			if ((this.PropertyChanging != null))
			{
				this.PropertyChanging(this, emptyChangingEventArgs);
			}
		}
		
		protected virtual void SendPropertyChanged(String propertyName)
		{
			if ((this.PropertyChanged != null))
			{
				this.PropertyChanged(this, new PropertyChangedEventArgs(propertyName));
			}
		}
	}
	
	[global::System.Data.Linq.Mapping.TableAttribute(Name="dbo.Room")]
	public partial class Room : INotifyPropertyChanging, INotifyPropertyChanged
	{
		
		private static PropertyChangingEventArgs emptyChangingEventArgs = new PropertyChangingEventArgs(String.Empty);
		
		private string _Room_No;
		
		private string _Room_Type;
		
		private string _Entity_Handle;
		
		private EntitySet<Employee> _Employee;
		
    #region 可扩展性方法定义
    partial void OnLoaded();
    partial void OnValidate(System.Data.Linq.ChangeAction action);
    partial void OnCreated();
    partial void OnRoom_NoChanging(string value);
    partial void OnRoom_NoChanged();
    partial void OnRoom_TypeChanging(string value);
    partial void OnRoom_TypeChanged();
    partial void OnEntity_HandleChanging(string value);
    partial void OnEntity_HandleChanged();
    #endregion
		
		public Room()
		{
			this._Employee = new EntitySet<Employee>(new Action<Employee>(this.attach_Employee), new Action<Employee>(this.detach_Employee));
			OnCreated();
		}
		
		[global::System.Data.Linq.Mapping.ColumnAttribute(Storage="_Room_No", DbType="NVarChar(50) NOT NULL", CanBeNull=false, IsPrimaryKey=true)]
		public string Room_No
		{
			get
			{
				return this._Room_No;
			}
			set
			{
				if ((this._Room_No != value))
				{
					this.OnRoom_NoChanging(value);
					this.SendPropertyChanging();
					this._Room_No = value;
					this.SendPropertyChanged("Room_No");
					this.OnRoom_NoChanged();
				}
			}
		}
		
		[global::System.Data.Linq.Mapping.ColumnAttribute(Storage="_Room_Type", DbType="NVarChar(50)")]
		public string Room_Type
		{
			get
			{
				return this._Room_Type;
			}
			set
			{
				if ((this._Room_Type != value))
				{
					this.OnRoom_TypeChanging(value);
					this.SendPropertyChanging();
					this._Room_Type = value;
					this.SendPropertyChanged("Room_Type");
					this.OnRoom_TypeChanged();
				}
			}
		}
		
		[global::System.Data.Linq.Mapping.ColumnAttribute(Storage="_Entity_Handle", DbType="NVarChar(50)")]
		public string Entity_Handle
		{
			get
			{
				return this._Entity_Handle;
			}
			set
			{
				if ((this._Entity_Handle != value))
				{
					this.OnEntity_HandleChanging(value);
					this.SendPropertyChanging();
					this._Entity_Handle = value;
					this.SendPropertyChanged("Entity_Handle");
					this.OnEntity_HandleChanged();
				}
			}
		}
		
		[global::System.Data.Linq.Mapping.AssociationAttribute(Name="Room_Employee", Storage="_Employee", ThisKey="Room_No", OtherKey="Room_No")]
		public EntitySet<Employee> Employee
		{
			get
			{
				return this._Employee;
			}
			set
			{
				this._Employee.Assign(value);
			}
		}
		
		public event PropertyChangingEventHandler PropertyChanging;
		
		public event PropertyChangedEventHandler PropertyChanged;
		
		protected virtual void SendPropertyChanging()
		{
			if ((this.PropertyChanging != null))
			{
				this.PropertyChanging(this, emptyChangingEventArgs);
			}
		}
		
		protected virtual void SendPropertyChanged(String propertyName)
		{
			if ((this.PropertyChanged != null))
			{
				this.PropertyChanged(this, new PropertyChangedEventArgs(propertyName));
			}
		}
		
		private void attach_Employee(Employee entity)
		{
			this.SendPropertyChanging();
			entity.Room = this;
		}
		
		private void detach_Employee(Employee entity)
		{
			this.SendPropertyChanging();
			entity.Room = null;
		}
	}
}
#pragma warning restore 1591
﻿using Autodesk.AutoCAD.ApplicationServices;
using Autodesk.AutoCAD.EditorInput;
using Autodesk.AutoCAD.Runtime;
namespace InitAndOpt
{
    public class OptimizeClass
    {
        [CommandMethod("OptCommand")]
        public void OptCommand()
        {
            Editor ed = Application.DocumentManager.MdiActiveDocument.Editor;
            string fileName = "C:\\Hello.dll";// Hello.dll程序集的文件名
            ExtensionLoader.Load(fileName); // 载入Hello.dll程序集
            // 在命令行上显示信息，提示用户Hello.dll程序集已经被载入
            ed.WriteMessage("\n" + fileName + "被载入，请输入Hello进行测试！");
        }
    }
}
﻿using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using Autodesk.AutoCAD.Runtime;
using Autodesk.AutoCAD.Windows;
using Autodesk.AutoCAD.EditorInput;
using Autodesk.AutoCAD.ApplicationServices;
using AcadApp = Autodesk.AutoCAD.ApplicationServices.Application;
using System.Windows.Forms;
using Autodesk.AutoCAD.DatabaseServices;
using System.Drawing;
using Autodesk.AutoCAD.Geometry;
using DotNetARX;
namespace Palettes
{
    public class Palettes
    {
        internal static PaletteSet ps=null;
        static UCTreeView treeControl=null;
        static UCDockDrag dockControl=null;
        [CommandMethod("ShowPalette")]
        public void ShowPalette()
        {
            if (ps == null)//如果面板没有被创建
            {
                //新建一个面板对象，标题为"工作空间"
                ps = new PaletteSet("工作空间", typeof(Palettes).GUID);
                //添加标题为“门窗统计”的面板项（树形列表）
                treeControl = new UCTreeView();
                ps.Add("门窗统计", treeControl);
                //添加标题为“停靠及拖放”的面板项（组合框及文本框）
                dockControl = new UCDockDrag();
                ps.Add("停靠及拖放", dockControl);
                //添加文档打开事件
                AcadApp.DocumentManager.DocumentCreated += new DocumentCollectionEventHandler(DocumentManager_DocumentCreated);
                //添加文档关闭事件
                AcadApp.DocumentManager.DocumentDestroyed += new DocumentDestroyedEventHandler(DocumentManager_DocumentDestroyed);
                //添加面板装载事件，用于获取用户数据
                ps.Load += new PalettePersistEventHandler(ps_Load);
                //添加面板保存事件，在AutoCAD关闭时，保存用户数据
                ps.Save += new PalettePersistEventHandler(ps_Save);
            }
            ps.Visible = true;//面板可见
            updateTree();//填充树形列表
        }
        void ps_Save(object sender, PalettePersistEventArgs e)
        {
            //将文本框中的文本保存到配置文件中
            e.ConfigurationSection.WriteProperty("Drag", dockControl.textBoxDrag.Text);
        }
        void ps_Load(object sender, PalettePersistEventArgs e)
        {
            //如果配置文件中包含指定的用户数据，则将文本框内容设置为用户数据
            if (e.ConfigurationSection.Contains("Drag"))
                dockControl.textBoxDrag.Text = e.ConfigurationSection.ReadProperty("Drag", "test").ToString();
        }
        void DocumentManager_DocumentDestroyed(object sender, DocumentDestroyedEventArgs e)
        {
            updateTree();//有文档关闭，须重新更新树形列表
        }
        void DocumentManager_DocumentCreated(object sender, DocumentCollectionEventArgs e)
        {
            updateTree();//有文档打开，须重新更新树形列表
        }
        private static void updateTree()
        {
            //清空树形列表中的内容
            treeControl.treeViewEnts.Nodes.Clear();
            //遍历AutoCAD中的文档
            foreach (Document doc in AcadApp.DocumentManager)
            {
                TreeNode nodeDoor = new TreeNode("门");//门节点
                nodeDoor.ImageIndex = 1;//门节点图标
                nodeDoor.SelectedImageIndex = 1;//门节点选中后的图标
                TreeNode nodeWindow = new TreeNode("窗");//窗节点
                nodeWindow.ImageIndex = 2;//窗节点图标
                nodeWindow.SelectedImageIndex = 2;//窗节点选中后的图标
                TreeNode[] nodes = new TreeNode[] { nodeDoor, nodeWindow };
                //定义一个以文档名称为标题的节点，该节点包含两个子节点：门、窗
                TreeNode nodeDoc=new TreeNode(doc.Name, nodes);
                nodeDoc.ImageIndex = 0;//文档节点图标
                //将文档节点添加到树形列表控件中
                treeControl.treeViewEnts.Nodes.Add(nodeDoc);
            }
        }
    }
    public class MyDropTarget : DropTarget
    {
        static string dropText;//拖放文本
        Database db=HostApplicationServices.WorkingDatabase;
        Document doc=AcadApp.DocumentManager.MdiActiveDocument;
        public override void OnDrop(DragEventArgs e)
        {
            //如果拖放的是字符串对象
            if (e.Data.GetDataPresent(typeof(string)))
            {
                //获取拖放的字符串
                dropText = (string)e.Data.GetData(typeof(string));
                //调用命令，在当前鼠标位置拖放的字符串
                string cmd=string.Format("Drop\n{0},{1},0\n", e.X, e.Y);
                doc.SendStringToExecute(cmd, false, false, false);
            }
        }
        [CommandMethod("Drop")]
        public void Drop()
        {
            Editor ed=doc.Editor;
            if (dropText != null)//如果有拖放文本
            {
                //提示输入文本要放置的位置
                PromptPointOptions opt=new PromptPointOptions("请输入文本放置的位置");
                PromptPointResult ppr=ed.GetPoint(opt);
                if (ppr.Status != PromptStatus.OK) return;
                Point3d pos=ppr.Value;//获取输入的位置（拖放操作的鼠标位置，为屏幕坐标）
                using (Transaction trans=db.TransactionManager.StartTransaction())
                {
                    DBText txt=new DBText();//新建文本对象
                    txt.TextString = dropText;//设置文本内容为拖放文本
                    //将屏幕坐标转换为AutoCAD的点坐标，再将该坐标值设置为文本的位置
                    txt.Position = ed.PointToWorld(new Point((int)pos.X, (int)pos.Y));
                    db.AddToModelSpace(txt);//将文本添加到模型空间
                    trans.Commit();
                }
                dropText = null;
            }
        }
    }
}
﻿#pragma checksum "..\..\..\PanelBinding.xaml" "{406ea660-64cf-4c82-b6f0-42d48172a799}" "6395FBB319C5301B53457945079D395D"
//------------------------------------------------------------------------------
// <auto-generated>
//     此代码由工具生成。
//     运行时版本:4.0.30319.488
//
//     对此文件的更改可能会导致不正确的行为，并且如果
//     重新生成代码，这些更改将会丢失。
// </auto-generated>
//------------------------------------------------------------------------------

using System;
using System.Diagnostics;
using System.Windows;
using System.Windows.Automation;
using System.Windows.Controls;
using System.Windows.Controls.Primitives;
using System.Windows.Data;
using System.Windows.Documents;
using System.Windows.Forms.Integration;
using System.Windows.Ink;
using System.Windows.Input;
using System.Windows.Markup;
using System.Windows.Media;
using System.Windows.Media.Animation;
using System.Windows.Media.Effects;
using System.Windows.Media.Imaging;
using System.Windows.Media.Media3D;
using System.Windows.Media.TextFormatting;
using System.Windows.Navigation;
using System.Windows.Shapes;
using System.Windows.Shell;


namespace Wpfs {
    
    
    /// <summary>
    /// BindingPanel
    /// </summary>
    [System.CodeDom.Compiler.GeneratedCodeAttribute("PresentationBuildTasks", "4.0.0.0")]
    public partial class BindingPanel : System.Windows.Controls.UserControl, System.Windows.Markup.IComponentConnector {
        
        
        #line 10 "..\..\..\PanelBinding.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.ComboBox comboBoxDoors;
        
        #line default
        #line hidden
        
        
        #line 20 "..\..\..\PanelBinding.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.ListView listViewBlocks;
        
        #line default
        #line hidden
        
        private bool _contentLoaded;
        
        /// <summary>
        /// InitializeComponent
        /// </summary>
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        public void InitializeComponent() {
            if (_contentLoaded) {
                return;
            }
            _contentLoaded = true;
            System.Uri resourceLocater = new System.Uri("/Wpfs;component/panelbinding.xaml", System.UriKind.Relative);
            
            #line 1 "..\..\..\PanelBinding.xaml"
            System.Windows.Application.LoadComponent(this, resourceLocater);
            
            #line default
            #line hidden
        }
        
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [System.ComponentModel.EditorBrowsableAttribute(System.ComponentModel.EditorBrowsableState.Never)]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Design", "CA1033:InterfaceMethodsShouldBeCallableByChildTypes")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Maintainability", "CA1502:AvoidExcessiveComplexity")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1800:DoNotCastUnnecessarily")]
        void System.Windows.Markup.IComponentConnector.Connect(int connectionId, object target) {
            switch (connectionId)
            {
            case 1:
            
            #line 8 "..\..\..\PanelBinding.xaml"
            ((System.Windows.Controls.Grid)(target)).Loaded += new System.Windows.RoutedEventHandler(this.Grid_Loaded);
            
            #line default
            #line hidden
            return;
            case 2:
            this.comboBoxDoors = ((System.Windows.Controls.ComboBox)(target));
            
            #line 10 "..\..\..\PanelBinding.xaml"
            this.comboBoxDoors.DropDownClosed += new System.EventHandler(this.comboBoxDoors_DropDownClosed);
            
            #line default
            #line hidden
            return;
            case 3:
            this.listViewBlocks = ((System.Windows.Controls.ListView)(target));
            return;
            }
            this._contentLoaded = true;
        }
    }
}

﻿using System;
using System.Drawing;
using System.Runtime.InteropServices;
using System.Security;
using System.Text;
using Autodesk.AutoCAD.ApplicationServices;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.EditorInput;
using Autodesk.AutoCAD.Geometry;
using Autodesk.AutoCAD.Runtime;
namespace DotNetARX
{

    /// <summary>
    /// P/Invoke操作类
    /// </summary>
    public static class PInvoke
    {
        #region 动态P/Invoke
        private const uint LOAD_WITH_ALTERED_SEARCH_PATH = 0x00000008;

        //允许托管代码不进行安全检查即调入非托管代码,从而提高程序的运行效率。只须在类内声明一次。
        [SuppressUnmanagedCodeSecurity]
        [DllImport("kernel32.dll", CharSet = CharSet.Auto)]
        private static extern IntPtr LoadLibraryEx(string lpFileName, IntPtr hFile, uint dwFlags);

        [DllImport("kernel32.dll", CharSet = CharSet.Auto)]
        private static extern bool FreeLibrary(IntPtr dllPointer);

        [DllImport("kernel32.dll", CharSet = CharSet.Auto)]
        private static extern IntPtr GetProcAddress(IntPtr dllPointer, string functionName);

        /// <summary>
        /// 判断系统是32位还是64位
        /// </summary>
        public static bool Is32Bit { get { return 4 == IntPtr.Size; } }

        /// <summary>
        /// 将非托管函数指针转换为委托。
        /// </summary>
        /// <param name="acdb">true表示非托管函数为acdb**.dll中定义的，false表示函数为acad.exe中定义的</param>
        /// <param name="funcName32">32位函数的重整名称</param>
        /// <param name="funcName64">64位函数的重整名称</param>
        /// <param name="t">要返回的委托的类型</param>
        /// <returns>委托实例，可强制转换为适当的委托类型。</returns>
        public static Delegate GetDelegateForFunction(bool acdb, string funcName32, string funcName64, Type t)
        {
            Delegate delegateFunc = null; // 用来作为返回值的代理对象
            string lpFileName = "acad.exe"; // 缺省认为函数位于acad.exe中
            // 根据系统的位数（32或64位）设定要调用的函数名
            string functionName = Is32Bit ? funcName32 : funcName64;
            if (acdb) // 如果非托管函数为acdb**.dll中定义的
            {
                // 获取acdb**.dll的主版本号
                string dllName = Register.GetACDBDLL_NAME();
                switch (dllName) //根据主版本号确定acdb**.dll的具体名称
                {
                    case "R17":
                        lpFileName = "acdb17.dll";
                        break;
                    case "R18":
                        lpFileName = "acdb18.dll";
                        break;
                    case "R19":
                        lpFileName = "acdb19.dll";
                        break;
                }
            }
            // 装载指定的动态链接库（acad.exe或acdb**.dll）
            IntPtr moduleHandle = LoadLibraryEx(lpFileName, IntPtr.Zero, LOAD_WITH_ALTERED_SEARCH_PATH);
            if (moduleHandle != IntPtr.Zero) // 如果装载成功
            {
                // 检索指定的动态链接库中的输出库函数地址
                IntPtr pProc = GetProcAddress(moduleHandle, functionName);
                if (pProc != IntPtr.Zero) // 如果找到
                {
                    // 将非托管函数指针转换为委托
                    delegateFunc = Marshal.GetDelegateForFunctionPointer(pProc, t);
                }
                FreeLibrary(moduleHandle); // 释放动态链接库
            }
            return delegateFunc; // 返回委托
        }
        #endregion

        [DllImport("acad.exe", CharSet = CharSet.Auto, CallingConvention = CallingConvention.Cdecl)]
        private static extern int acedGetEnv(string envName, StringBuilder result);
        /// <summary>
        /// 获取环境变量值
        /// </summary>
        /// <param name="ed">命令行对象，无意义，只是为了创建扩展函数</param>
        /// <param name="symbol">环境变量名</param>
        /// <returns>返回环境变量值</returns>
        public static string GetEnvVariable(this Editor ed, string symbol)
        {
            StringBuilder ret = new StringBuilder(1024);
            acedGetEnv(symbol, ret);
            return ret.ToString();
        }

        [DllImport("acad.exe", CharSet = CharSet.Auto, CallingConvention = CallingConvention.Cdecl)]
        private static extern int acedSetEnv(string envName, StringBuilder value);
        /// <summary>
        /// 设置环境变量值
        /// </summary>
        /// <param name="ed">命令行对象，无意义，只是为了创建扩展函数</param>
        /// <param name="symbol">环境变量名</param>
        /// <param name="value">要设置的值</param>
        /// <returns>如果设置成功，则返回true,否则返回false</returns>
        public static bool SetEnvVariable(this Editor ed, string symbol, string value)
        {
            StringBuilder newValue = new StringBuilder(value);
            if (acedSetEnv(symbol, newValue) == 5100)
                return true;
            else return false;
        }

        [UnmanagedFunctionPointer(CallingConvention.Cdecl)]
        private delegate bool acdbGetPreviewBitmapFromDwg([MarshalAs(UnmanagedType.LPWStr)] string pszDwgfilename, ref IntPtr pPreviewBmp, ref IntPtr pRetPal);
        /// <summary>
        /// 获取dwg文件的预览图案
        /// </summary>
        /// <param name="db">数据库对象，无意义，只是为了创建扩展函数</param>
        /// <param name="fileName">dwg文件名</param>
        /// <returns>返回dwg文件的预览图案</returns>
        public static Bitmap GetPreviewBitmapFromDwg(this Database db, string fileName)
        {
            // 初始化IntPtr
            IntPtr hBmp = default(IntPtr);
            IntPtr hPal = default(IntPtr);
            // 32位和64位acdbGetPreviewBitmapFromDwg函数的重整名称
            string func32 = "?acdbGetPreviewBitmapFromDwg@@YA_NPB_WPAPAUHBITMAP__@@PAPAUHPALETTE__@@@Z";
            string func64 = "?acdbGetPreviewBitmapFromDwg@@YA_NPEB_WPEAPEAUHBITMAP__@@PEAPEAUHPALETTE__@@@Z";
            // 获取表示acdbGetPreviewBitmapFromDwg函数的委托
            acdbGetPreviewBitmapFromDwg delegateFunc = (acdbGetPreviewBitmapFromDwg)GetDelegateForFunction(true, func32, func64, typeof(acdbGetPreviewBitmapFromDwg));
            // 调用委托，执行acdbGetPreviewBitmapFromDwg函数
            delegateFunc(fileName, ref hBmp, ref hPal);
            if (hBmp.Equals(IntPtr.Zero)) // 如果没有预览图则返回空
            {
                return null;
            }
            else
            {
                return Bitmap.FromHbitmap(hBmp); // 返回预览图
            }
        }
        [UnmanagedFunctionPointer(CallingConvention.ThisCall)]
        private delegate void addPersistentReactor(IntPtr dbObject, ObjectId objId);
        /// <summary>
        /// 为对象添加永久反应器
        /// </summary>
        /// <param name="dbObject">对象</param>
        /// <param name="objId">永久反应器的Id</param>
        public static void AddPersistentReactor(this DBObject dbObject, ObjectId objId)
        {
            string func = "?addPersistentReactor@AcDbObject@@UAEXVAcDbObjectId@@@Z";
            addPersistentReactor delegateFunc = (addPersistentReactor)GetDelegateForFunction(true, func, func, typeof(addPersistentReactor));
            delegateFunc(dbObject.UnmanagedObject, objId);
        }

        [DllImport("acad.exe", CallingConvention = CallingConvention.Cdecl, EntryPoint = "?acedGenerateThumbnailBitmap@@YAPAUtagABITMAPINFO@@XZ")]
        private static extern IntPtr acedGenerateThumbnailBitmap();
        /// <summary>
        /// 为当前图形生成缩略图
        /// </summary>
        /// <param name="ed">命令行对象，无意义，只是为了创建扩展函数</param>
        public static void GenerateThumbnailBitmap(this Editor ed)
        {
            acedGenerateThumbnailBitmap();
        }

        [UnmanagedFunctionPointer(CallingConvention.ThisCall)]
        private delegate bool annotativeDwg(IntPtr pdb);
        /// <summary>
        /// 当图形数据库插入到另外一个图形时，是否将其看作为可缩放块
        /// </summary>
        /// <param name="db">数据库对象</param>
        /// <returns>若为true,则表示将数据库看为可缩放块</returns>
        public static bool AnnotativeDwg(this Database db)
        {
            // 32位和64位annotativeDwg函数的重整名称
            string func32 = "?annotativeDwg@AcDbDatabase@@QBE_NXZ";
            string func64 = "?annotativeDwg@AcDbDatabase@@QEBA_NXZ";
            // 获取表示annotativeDwg函数的委托
            annotativeDwg delegateFunc = (annotativeDwg)GetDelegateForFunction(true, func32, func64, typeof(annotativeDwg));
            // 调用委托，执行annotativeDwg函数
            return delegateFunc(db.UnmanagedObject);            
        }
    }
}
﻿using System;
using System.Runtime.InteropServices;
using System.Security;
using Autodesk.AutoCAD.ApplicationServices;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.EditorInput;
using Autodesk.AutoCAD.Geometry;
using Autodesk.AutoCAD.Runtime;
using DotNetARX;
using System.Text;
namespace PInvokeTest
{
    [SuppressUnmanagedCodeSecurity]
    public class PInvokeTest
    {
        #region P/Invoke全局函数
        [DllImport("acad.exe", EntryPoint = "?acedGetUserFavoritesDir@@YAHPA_W@Z", CharSet = CharSet.Auto)]
        private static extern bool acedGetUserFavoritesDir([MarshalAs(UnmanagedType.LPWStr)] StringBuilder szFavoritesDir);
        public bool GetUserFavoritesDir(StringBuilder favoritesDir)
        {
            return acedGetUserFavoritesDir(favoritesDir);
        }
        #endregion

        #region P/Invoke对象函数
        [DllImport("acdb17.dll", CallingConvention = CallingConvention.ThisCall, CharSet = CharSet.Auto, EntryPoint = "?originPoint@AcDbHatch@@QBE?AVAcGePoint2d@@XZ")]
        private static extern Point2d originPoint(IntPtr hatch);

        //获取填充的原点
        public static Point2d GetOrigin(Hatch hatch)
        {
            return originPoint(hatch.UnmanagedObject);
        }

        // 设置一个指向setOriginPoint函数的委托，并指定委托的调用约定为调用对象函数
        [UnmanagedFunctionPointer(CallingConvention.ThisCall)]
        private delegate ErrorStatus setOriginPoint(IntPtr hatch, ref Point2d pt);
        public static void SetOrigin(Hatch hatch, Point2d pt)
        {
            // 32位和64位setOriginPoint函数的重整名称
            string func32 = "?setOriginPoint@AcDbHatch@@QAE?AW4ErrorStatus@Acad@@ABVAcGePoint2d@@@Z";
            string func64 = "?setOriginPoint@AcDbHatch@@QEAA?AW4ErrorStatus@Acad@@AEBVAcGePoint2d@@@Z";
            // 获取表示setOriginPoint函数的委托
            setOriginPoint delegateFunc = (setOriginPoint)PInvoke.GetDelegateForFunction(true, func32, func64, typeof(setOriginPoint));
            // 调用委托，执行setOriginPoint函数
            delegateFunc(hatch.UnmanagedObject, ref pt);
        }
        #endregion

        [CommandMethod("PInvoke1",CommandFlags.Defun)]
        public void PInvoke1()
        {
            Editor ed = Application.DocumentManager.MdiActiveDocument.Editor;
            StringBuilder dir = new StringBuilder(256);
            if (GetUserFavoritesDir(dir) && dir.Length > 0)
                ed.WriteMessage("\nWindows收藏夹是" + dir);
        }

        [CommandMethod("PInvoke2")]
        public void PInvoke2()
        {
            Document doc = Application.DocumentManager.MdiActiveDocument;
            Editor ed = doc.Editor;
            // 提示用户选择一个填充对象
            PromptEntityOptions opt = new PromptEntityOptions("\n请选择一个填充");
            opt.SetRejectMessage("必须是填充对象");
            opt.AddAllowedClass(typeof(Hatch), false);
            PromptEntityResult result = ed.GetEntity(opt);
            // 如果用户未选择，则返回
            if (result.Status != PromptStatus.OK) return;
            using (Transaction trans = doc.TransactionManager.StartTransaction())
            {
                ObjectId id = result.ObjectId;// 填充对象的Id
                // 打开填充对象
                Hatch hatch = (Hatch)id.GetObject(OpenMode.ForRead);
                Point2d origin = GetOrigin(hatch); // 获取填充的原点
                ed.WriteMessage(origin.ToString()); //在命令行上显示原点值 
                trans.Commit(); // 提交事务处理
            }
        }

        [CommandMethod("PInvoke3")]
        public void PInvoke3()
        {
            Document doc = Application.DocumentManager.MdiActiveDocument;
            Editor ed = doc.Editor;
            // 提示用户选择一个填充对象
            PromptEntityOptions opt = new PromptEntityOptions("\n请选择一个填充");
            opt.SetRejectMessage("必须是填充对象");
            opt.AddAllowedClass(typeof(Hatch), false);
            PromptEntityResult result = ed.GetEntity(opt);
            // 如果用户未选择，则返回
            if (result.Status != PromptStatus.OK) return;
            using (Transaction trans = doc.TransactionManager.StartTransaction())
            {
                ObjectId id = result.ObjectId;// 填充对象的Id
                // 由于要修改填充对象的原点，因此将其打开为写的状态
                Hatch hatch = (Hatch)id.GetObject(OpenMode.ForWrite);
                SetOrigin(hatch, new Point2d(10, 10)); // 设置填充的原点
                trans.Commit(); // 提交事务处理
            }
        }
    }
}
﻿using System;
using System.Collections.Generic;
using System.Linq;
using System.Windows.Forms;
using Autodesk.AutoCAD.ApplicationServices;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.EditorInput;
using Autodesk.AutoCAD.Geometry;
using Autodesk.AutoCAD.PlottingServices;
using DotNetARX;
using AcadApp = Autodesk.AutoCAD.ApplicationServices.Application;
namespace Plots
{
    public partial class PlotForm : Form
    {
        PlotSettingsEx ps=null;//声明增强型打印设置对象
        Layout layout=null;//当前布局对象
        public PlotForm()
        {
            InitializeComponent();
            Database  db = HostApplicationServices.WorkingDatabase;
            using (Transaction trans = db.TransactionManager.StartTransaction())
            {
                LayoutManager lm=LayoutManager.Current;//获取当前布局管理器
                //获取当前布局
                ObjectId layoutId=lm.GetLayoutId(lm.CurrentLayout);
                layout = (Layout)layoutId.GetObject(OpenMode.ForRead);
                //获取当前布局名称
                string layoutName=layout.ModelType ? "模型" : layout.LayoutName;
                this.Text = "打印 - " + layoutName;//设置窗口标题
                ps = new PlotSettingsEx(layout);//创建增强型打印设置对象
                trans.Commit();
            }
        }
        private void PlotForm_Load(object sender, EventArgs e)
        {
            //绑定打印机列表框
            this.comboBoxDevice.DataSource = ps.DeviceList;
            this.comboBoxDevice.DataBindings.Add("SelectedItem", ps, "PlotConfigurationName", true, DataSourceUpdateMode.OnPropertyChanged);
            //绑定打印到文件复选框
            this.checkBoxToFile.DataBindings.Add("Checked", ps, "IsPlotToFile", true, DataSourceUpdateMode.OnPropertyChanged);
            this.checkBoxToFile.DataBindings.Add("Enabled", ps, "NoPlotToFile", true, DataSourceUpdateMode.OnPropertyChanged);
            //绑定图纸尺寸组合框
            this.comboBoxMedia.DataBindings.Add("SelectedItem", ps, "CanonicalMediaName", true, DataSourceUpdateMode.OnPropertyChanged);
            //绑定打印范围组合框
            this.comboBoxPlotArea.DataSource = ps.PlotTypeList;
            this.comboBoxPlotArea.DataBindings.Add("SelectedItem", ps, "PlotTypeLocal", true, DataSourceUpdateMode.OnPropertyChanged);
            //绑定X方向打印偏移文本框
            this.textBoxOffsetX.DataBindings.Add("Text", ps, "PlotOriginX", true, DataSourceUpdateMode.OnPropertyChanged);
            this.textBoxOffsetX.DataBindings[0].FormatString = "0.00";
            //绑定Y方向打印偏移文本框
            this.textBoxOffsetY.DataBindings.Add("Text", ps, "PlotOriginY", true, DataSourceUpdateMode.OnPropertyChanged);
            this.textBoxOffsetY.DataBindings[0].FormatString = "0.00";
            //绑定X方向打印偏移单位标签
            this.labelOffsetXUnit.DataBindings.Add("Text", ps, "PlotPaperUnitsLocal", true, DataSourceUpdateMode.OnPropertyChanged);
            //绑定X方向打印偏移单位标签
            this.labelOffsetYUnit.DataBindings.Add("Text", ps, "PlotPaperUnitsLocal", true, DataSourceUpdateMode.OnPropertyChanged);
            //绑定居中打印复选框
            this.checkBoxPlotCentered.DataBindings.Add("Checked", ps, "PlotCentered", true, DataSourceUpdateMode.OnPropertyChanged);
            //绑定打印样式表组合框
            this.comboBoxStyleSheet.DataSource = ps.ColorDependentPlotStyles;
            this.comboBoxStyleSheet.DataBindings.Add("SelectedItem", ps, "CurrentStyleSheet", true, DataSourceUpdateMode.OnPropertyChanged);
            //绑定按样式打印复选框
            this.checkBoxPlotStyles.DataBindings.Add("Checked", ps, "PlotPlotStyles");
            //绑定图形方向为横向的单选按钮
            this.radioButtonHorizontal.DataBindings.Add("Checked", ps, "PlotHorizontal", true, DataSourceUpdateMode.OnPropertyChanged);
            //绑定图形方向为反向打印的单选按钮
            this.checkBoxReverse.DataBindings.Add("Checked", ps, "PlotReverse", true, DataSourceUpdateMode.OnPropertyChanged);
            //绑定布满图纸复选框
            this.checkBoxExtent.DataBindings.Add("Checked", ps, "PlotExtent", true, DataSourceUpdateMode.OnPropertyChanged);
            //绑定打印比例组合框
            this.comboBoxStdScaleType.DataSource = ps.StdScaleTypeList.Values.ToList();
            this.comboBoxStdScaleType.DataBindings.Add("SelectedItem", ps, "StdScaleTypeLocal", true, DataSourceUpdateMode.OnPropertyChanged);
            //绑定图形单位文本框
            this.textBoxDenominator.DataBindings.Add("Text", ps, "Denominator", true, DataSourceUpdateMode.OnPropertyChanged);
            this.textBoxDenominator.DataBindings[0].FormatString = "#.##";
            //绑定图纸单位文本框
            this.textBoxNumerator.DataBindings.Add("Text", ps, "Numerator", true, DataSourceUpdateMode.OnPropertyChanged);
            this.textBoxNumerator.DataBindings[0].FormatString = "#.##";
            //绑定打印单位组合框
            this.comboBoxPlotPaperUnits.DataBindings.Add("SelectedItem", ps, "PlotPaperUnitsLocal", true, DataSourceUpdateMode.OnPropertyChanged);
            this.buttonApply.Enabled = false;//“应用到布局”按钮刚开始为不可用状态
        }

        private void control_ValueChanged(object sender, EventArgs e)
        {
            //当控件的值改变，表示用户修改了打印设置，则“应用到布局”按钮变为可用状态
            this.buttonApply.Enabled = true;
        }
        private void checkBoxPlotCentered_CheckedChanged(object sender, EventArgs e)
        {
            //根据居中打印复选框的选定状态设置打印偏移文本框的可用状态
            this.textBoxOffsetX.Enabled = !this.checkBoxPlotCentered.Checked;
            this.textBoxOffsetY.Enabled = !this.checkBoxPlotCentered.Checked;
            this.buttonApply.Enabled = true;//内容有改变，“应用到布局”按钮可用
        }

        private void checkBoxExtent_CheckedChanged(object sender, EventArgs e)
        {
            //根据布满图纸复选框的选定状态，设置与打印比例有关按钮的可用状态
            this.comboBoxStdScaleType.Enabled = !this.checkBoxExtent.Checked;
            this.textBoxDenominator.Enabled = !this.checkBoxExtent.Checked;
            this.textBoxNumerator.Enabled = !this.checkBoxExtent.Checked;
            this.buttonApply.Enabled = true;//内容有改变，应用到布局按钮可用
        }
        private void buttonPlotWindow_Click(object sender, EventArgs e)
        {
            setPlotWindowArea();//如果打印范围为窗口，则设置窗口的范围
        }
        private void setPlotWindowArea()
        {
            this.Hide();//隐藏窗体
            Editor ed=AcadApp.DocumentManager.MdiActiveDocument.Editor;
            //提示用户输入打印窗口的两个角点
            PromptPointResult result=ed.GetPoint("\n指定第一个角点");
            if (result.Status != PromptStatus.OK) return;
            Point3d basePt=result.Value;
            result = ed.GetCorner("指定对角点", basePt);
            if (result.Status != PromptStatus.OK) return;
            Point3d cornerPt=result.Value;
            //将用户输入的点从UCS坐标转换为DCS坐标
            basePt = basePt.TranslateCoordinates(UCSTools.CoordSystem.UCS, UCSTools.CoordSystem.DCS);
            cornerPt = cornerPt.TranslateCoordinates(UCSTools.CoordSystem.UCS, UCSTools.CoordSystem.DCS);
            //根据DCS坐标下的点创建Extents2d对象，并赋值给表示打印范围对象
            ps.PlotWindowArea = new Extents2d(basePt.X, basePt.Y, cornerPt.X, cornerPt.Y);
            this.Show();//显示窗体
        }

        private void comboBoxDevice_SelectedIndexChanged(object sender, EventArgs e)
        {
            comboBox_UpdateDataBinding(sender, e);//必须手动调用组合框的绑定程序
            this.comboBoxMedia.DataSource = ps.MediaList;//设置“图纸尺寸列表”组合框的数据源
            //设置“图纸单位列表”组合框的数据源
            this.comboBoxPlotPaperUnits.DataSource = ps.PlotUnitList;
            this.buttonApply.Enabled = true;//内容有改变，“应用到布局”按钮可用
        }

        private void comboBox_UpdateDataBinding(object sender, EventArgs e)
        {
            ComboBox comboBox=sender as ComboBox;
            if (comboBox == null) return;//若控件不是复选框，则返回
            //使用LINQ筛选复选框绑定属性为SelectedItem的绑定对象
            var binds=from Binding b in comboBox.DataBindings
                      where b.PropertyName == "SelectedItem"
                      select b;
            foreach (var bind in binds)
            {
                //读取复选框的“当前选定项”的属性值，将其写入绑定数据源
                bind.WriteValue();
            }
        }

        private void comboBoxPlotArea_SelectedIndexChanged(object sender, EventArgs e)
        {
            if (this.comboBoxPlotArea.SelectedItem.ToString() == "窗口")//如果打印范围是窗口
            {
                //如果“窗口”按钮不可见
                if (this.buttonPlotWindow.Visible == false)
                {
                    setPlotWindowArea();//设置窗口的范围
                    this.buttonPlotWindow.Visible = true;//“窗口”按钮可见
                }
            }
            else this.buttonPlotWindow.Visible = false;//“窗口”按钮不可见
            //如果打印范围不是布局，则“居中打印”复选框不可用
            this.checkBoxPlotCentered.Enabled = (this.comboBoxPlotArea.SelectedItem.ToString() != "布局");
            comboBox_UpdateDataBinding(sender, e);//必须手动调用组合框的绑定程序
            this.buttonApply.Enabled = true;//内容有改变，“应用到布局”按钮可用
        }
        private void buttonApply_Click(object sender, EventArgs e)
        {
            LayoutManager lm=LayoutManager.Current;//获取当前布局管理器
            //获取当前布局的ObjectId
            ObjectId layoutId=lm.GetLayoutId(lm.CurrentLayout);
            ps.UpdatePlotSettings(layoutId);//更新当前布局的打印设置
            this.buttonApply.Enabled = false;//应用到布局按钮为不可用状态
        }
        private void buttonPreview_Click(object sender, EventArgs e)
        {
            //如果有打印进程在运行，则返回
            if (PlotFactory.ProcessPlotState != ProcessPlotState.NotPlotting) return;
            this.Hide();
            //创建一个打印预览引擎
            PlotEngine previewEngine=PlotFactory.CreatePreviewEngine((int)PreviewEngineFlags.Plot);
            //打印预览当前布局
            PreviewEndPlotStatus status=previewEngine.Plot(layout, ps, null, 1, true, true, false);
            previewEngine.Destroy(); //销毁打印预览引擎
            //如果用户在打印预览对话框中选择了打印
            if (status == PreviewEndPlotStatus.Plot)
            {
                Plot();
            }
            else
                this.Show();
        }

        private void buttonPlot_Click(object sender, EventArgs e)
        {
            Plot();
        }
        public void Plot()
        {
            PlotConfig config=PlotConfigManager.CurrentConfig;
            Document doc=AcadApp.DocumentManager.MdiActiveDocument;
            Editor ed=doc.Editor;
            //获取去除扩展名后的文件名（不含路径）
            string fileName=SymbolUtilityServices.GetSymbolNameFromPathName(doc.Name, "dwg");
            //定义保存文件对话框
            PromptSaveFileOptions opt=new PromptSaveFileOptions("文件名");
            //保存文件对话框的文件扩展名列表
            opt.Filter = "*" + config.DefaultFileExtension + "|*" + config.DefaultFileExtension;
            opt.DialogCaption = "浏览打印文件";//保存文件对话框的标题
            opt.InitialDirectory = @"C:\";//缺省保存目录
            opt.InitialFileName = fileName + "-" + layout.LayoutName;//缺省保存文件名
            //根据保存对话框中用户的选择，获取保存文件名
            PromptFileNameResult result=ed.GetFileNameForSave(opt);
            if (result.Status != PromptStatus.OK) return;
            fileName = result.StringResult;
            this.Hide();
            //为了防止后台打印问题，必须在调用打印API时设置BACKGROUNDPLOT系统变量为0
            short backPlot=(short)AcadApp.GetSystemVariable("BACKGROUNDPLOT");
            AcadApp.SetSystemVariable("BACKGROUNDPLOT", 0);
            PlotEngine plotEngine=PlotFactory.CreatePublishEngine();//创建一个打印引擎            
            //打印当前布局为一个文件，以“图形文件名-布局名”的形式作为文件名
            plotEngine.Plot(layout, ps, fileName, (int)this.numericCopies.Value, false, true, ps.IsPlotToFile);
            plotEngine.Destroy();//销毁打印引擎 
            //恢复BACKGROUNDPLOT系统变量的值
            AcadApp.SetSystemVariable("BACKGROUNDPLOT",backPlot);
            this.Dispose(); //关闭窗体
        }
        private void buttonPlotLayouts_Click(object sender, EventArgs e)
        {
            Document doc=AcadApp.DocumentManager.MdiActiveDocument;
            Database db=HostApplicationServices.WorkingDatabase;
            using (doc.LockDocument())
            using (Transaction trans=db.TransactionManager.StartTransaction())
            {

                List<Layout> layouts=db.GetAllLayouts();
                //如果有打印进程在运行，则返回
                if (PlotFactory.ProcessPlotState != ProcessPlotState.NotPlotting) return;
                this.Hide();
                bool isReadyForPlot=MultiPlotPreView(layouts);
                if (isReadyForPlot)
                {
                    MultiPlot(layouts);
                    this.Dispose();
                }
                else
                    this.Show();
                trans.Commit();
            }
        }
        public bool MultiPlotPreView(List<Layout> layouts)
        {
            int layoutNum=1;//布局序号
            bool isFinished=false;//打印预览是否完成
            bool isReadyForPlot=false;//是否准备打印
            bool isFirst=true;//是否第一次进行打印预览
            while (!isFinished)//如果预览未完成，则一直处于预览状态
            {
                //设置预览状态为打印
                PreviewEngineFlags flags=PreviewEngineFlags.Plot;
                //如果不是第一个布局，则预览状态可以为打印或下一页
                if (layoutNum > 1) flags |= PreviewEngineFlags.PreviousSheet;
                //如果不是最后一个布局，则预览状态可以为打印或下一页
                if (layoutNum < layouts.Count)
                    flags |= PreviewEngineFlags.NextSheet;
                //创建一个打印预览引擎
                PlotEngine previewEngine=PlotFactory.CreatePreviewEngine((int)flags);
                //打印预览当前布局，如果为第一次预览，则显示打印进度框
                PreviewEndPlotStatus status=previewEngine.MPlot(layouts, ps, "", layoutNum, 1, isFirst, false);
                switch (status)//判断打印预览结束时的状态，以切换布局
                {
                    case PreviewEndPlotStatus.Normal://结束预览
                    case PreviewEndPlotStatus.Cancel://取消预览
                        isFinished = true;//预览结束
                        break;
                    case PreviewEndPlotStatus.Previous://上一页
                        layoutNum--;//切换到上一个布局
                        break;
                    case PreviewEndPlotStatus.Next://下一页
                        layoutNum++;//切换到下一个布局
                        break;
                    case PreviewEndPlotStatus.Plot://打印
                        isFinished = true;//预览结束
                        isReadyForPlot = true;//可以打印
                        break;
                }
                previewEngine.Destroy();//销毁打印预览引擎
                isFirst = false;//已经不是第一次预览
            }
            return isReadyForPlot;
        }
        private void MultiPlot(List<Layout> layouts)
        {
            PlotConfig config=PlotConfigManager.CurrentConfig;
            Document doc=AcadApp.DocumentManager.MdiActiveDocument;
            Editor ed=doc.Editor;
            //获取去除扩展名后的文件名（不含路径）
            string fileName=SymbolUtilityServices.GetSymbolNameFromPathName(doc.Name, "dwg");
            //定义保存文件对话框
            PromptSaveFileOptions opt=new PromptSaveFileOptions("文件名");
            //保存文件对话框的文件扩展名列表
            opt.Filter = "*" + config.DefaultFileExtension + "|*" + config.DefaultFileExtension;
            opt.DialogCaption = "浏览打印文件";//保存文件对话框的标题
            opt.InitialDirectory = @"C:\";//缺省保存目录
            opt.InitialFileName = fileName;//缺省保存文件名
            //根据保存对话框中用户的选择，获取保存文件名
            PromptFileNameResult result=ed.GetFileNameForSave(opt);
            if (result.Status != PromptStatus.OK) return;
            fileName = result.StringResult;
            //创建一个打印引擎
            PlotEngine plotEngine=PlotFactory.CreatePublishEngine();
            //打印所有布局为一个多页文件，并以图形文件名的形式作为文件名
            plotEngine.MPlot(layouts, ps, fileName, 0, (int)this.numericCopies.Value, true, ps.IsPlotToFile);
            plotEngine.Destroy();//销毁打印引擎
        }
        private void buttonCancel_Click(object sender, EventArgs e)
        {
            this.Dispose();//销毁窗体
        }
    }
}
﻿namespace Plots
{
    partial class PlotForm
    {
        /// <summary>
        /// Required designer variable.
        /// </summary>
        private System.ComponentModel.IContainer components = null;

        /// <summary>
        /// Clean up any resources being used.
        /// </summary>
        /// <param name="disposing">true if managed resources should be disposed; otherwise, false.</param>
        protected override void Dispose(bool disposing)
        {
            if (disposing && (components != null))
            {
                components.Dispose();
            }
            base.Dispose(disposing);
        }

        #region Windows Form Designer generated code

        /// <summary>
        /// Required method for Designer support - do not modify
        /// the contents of this method with the code editor.
        /// </summary>
        private void InitializeComponent()
        {
            this.comboBoxDevice = new System.Windows.Forms.ComboBox();
            this.comboBoxMedia = new System.Windows.Forms.ComboBox();
            this.buttonPreview = new System.Windows.Forms.Button();
            this.buttonPlot = new System.Windows.Forms.Button();
            this.buttonCancel = new System.Windows.Forms.Button();
            this.groupBoxOrientation = new System.Windows.Forms.GroupBox();
            this.checkBoxReverse = new System.Windows.Forms.CheckBox();
            this.radioButtonHorizontal = new System.Windows.Forms.RadioButton();
            this.radioButtonVertical = new System.Windows.Forms.RadioButton();
            this.groupBox3 = new System.Windows.Forms.GroupBox();
            this.checkBoxPlotStyles = new System.Windows.Forms.CheckBox();
            this.comboBoxStyleSheet = new System.Windows.Forms.ComboBox();
            this.groupBox4 = new System.Windows.Forms.GroupBox();
            this.buttonPlotWindow = new System.Windows.Forms.Button();
            this.label3 = new System.Windows.Forms.Label();
            this.comboBoxPlotArea = new System.Windows.Forms.ComboBox();
            this.groupBox5 = new System.Windows.Forms.GroupBox();
            this.checkBoxPlotCentered = new System.Windows.Forms.CheckBox();
            this.labelOffsetYUnit = new System.Windows.Forms.Label();
            this.labelOffsetXUnit = new System.Windows.Forms.Label();
            this.textBoxOffsetY = new System.Windows.Forms.TextBox();
            this.textBoxOffsetX = new System.Windows.Forms.TextBox();
            this.label5 = new System.Windows.Forms.Label();
            this.label4 = new System.Windows.Forms.Label();
            this.groupBox6 = new System.Windows.Forms.GroupBox();
            this.label10 = new System.Windows.Forms.Label();
            this.comboBoxPlotPaperUnits = new System.Windows.Forms.ComboBox();
            this.comboBoxStdScaleType = new System.Windows.Forms.ComboBox();
            this.label9 = new System.Windows.Forms.Label();
            this.textBoxDenominator = new System.Windows.Forms.TextBox();
            this.textBoxNumerator = new System.Windows.Forms.TextBox();
            this.label8 = new System.Windows.Forms.Label();
            this.checkBoxExtent = new System.Windows.Forms.CheckBox();
            this.groupBox7 = new System.Windows.Forms.GroupBox();
            this.groupBox8 = new System.Windows.Forms.GroupBox();
            this.numericCopies = new System.Windows.Forms.NumericUpDown();
            this.groupBox9 = new System.Windows.Forms.GroupBox();
            this.checkBoxToFile = new System.Windows.Forms.CheckBox();
            this.label2 = new System.Windows.Forms.Label();
            this.buttonApply = new System.Windows.Forms.Button();
            this.buttonPlotLayouts = new System.Windows.Forms.Button();
            this.groupBoxOrientation.SuspendLayout();
            this.groupBox3.SuspendLayout();
            this.groupBox4.SuspendLayout();
            this.groupBox5.SuspendLayout();
            this.groupBox6.SuspendLayout();
            this.groupBox7.SuspendLayout();
            this.groupBox8.SuspendLayout();
            ((System.ComponentModel.ISupportInitialize)(this.numericCopies)).BeginInit();
            this.groupBox9.SuspendLayout();
            this.SuspendLayout();
            // 
            // comboBoxDevice
            // 
            this.comboBoxDevice.FormattingEnabled = true;
            this.comboBoxDevice.Location = new System.Drawing.Point(58, 22);
            this.comboBoxDevice.Name = "comboBoxDevice";
            this.comboBoxDevice.Size = new System.Drawing.Size(237, 20);
            this.comboBoxDevice.TabIndex = 0;
            this.comboBoxDevice.SelectedIndexChanged += new System.EventHandler(this.comboBoxDevice_SelectedIndexChanged);
            // 
            // comboBoxMedia
            // 
            this.comboBoxMedia.FormattingEnabled = true;
            this.comboBoxMedia.Location = new System.Drawing.Point(11, 19);
            this.comboBoxMedia.Name = "comboBoxMedia";
            this.comboBoxMedia.Size = new System.Drawing.Size(284, 20);
            this.comboBoxMedia.TabIndex = 3;
            this.comboBoxMedia.SelectedIndexChanged += new System.EventHandler(this.comboBox_UpdateDataBinding);
            // 
            // buttonPreview
            // 
            this.buttonPreview.Location = new System.Drawing.Point(20, 398);
            this.buttonPreview.Name = "buttonPreview";
            this.buttonPreview.Size = new System.Drawing.Size(87, 23);
            this.buttonPreview.TabIndex = 4;
            this.buttonPreview.Text = "预览当前布局";
            this.buttonPreview.UseVisualStyleBackColor = true;
            this.buttonPreview.Click += new System.EventHandler(this.buttonPreview_Click);
            // 
            // buttonPlot
            // 
            this.buttonPlot.Location = new System.Drawing.Point(238, 398);
            this.buttonPlot.Name = "buttonPlot";
            this.buttonPlot.Size = new System.Drawing.Size(93, 23);
            this.buttonPlot.TabIndex = 5;
            this.buttonPlot.Text = "打印当前布局";
            this.buttonPlot.UseVisualStyleBackColor = true;
            this.buttonPlot.Click += new System.EventHandler(this.buttonPlot_Click);
            // 
            // buttonCancel
            // 
            this.buttonCancel.DialogResult = System.Windows.Forms.DialogResult.Cancel;
            this.buttonCancel.Location = new System.Drawing.Point(479, 398);
            this.buttonCancel.Name = "buttonCancel";
            this.buttonCancel.Size = new System.Drawing.Size(75, 23);
            this.buttonCancel.TabIndex = 6;
            this.buttonCancel.Text = "取消";
            this.buttonCancel.UseVisualStyleBackColor = true;
            this.buttonCancel.Click += new System.EventHandler(this.buttonCancel_Click);
            // 
            // groupBoxOrientation
            // 
            this.groupBoxOrientation.Controls.Add(this.checkBoxReverse);
            this.groupBoxOrientation.Controls.Add(this.radioButtonHorizontal);
            this.groupBoxOrientation.Controls.Add(this.radioButtonVertical);
            this.groupBoxOrientation.Location = new System.Drawing.Point(348, 103);
            this.groupBoxOrientation.Name = "groupBoxOrientation";
            this.groupBoxOrientation.Size = new System.Drawing.Size(97, 100);
            this.groupBoxOrientation.TabIndex = 7;
            this.groupBoxOrientation.TabStop = false;
            this.groupBoxOrientation.Text = "图形方向";
            // 
            // checkBoxReverse
            // 
            this.checkBoxReverse.AutoSize = true;
            this.checkBoxReverse.Location = new System.Drawing.Point(7, 67);
            this.checkBoxReverse.Name = "checkBoxReverse";
            this.checkBoxReverse.Size = new System.Drawing.Size(72, 16);
            this.checkBoxReverse.TabIndex = 2;
            this.checkBoxReverse.Text = "反向打印";
            this.checkBoxReverse.UseVisualStyleBackColor = true;
            this.checkBoxReverse.CheckedChanged += new System.EventHandler(this.control_ValueChanged);
            // 
            // radioButtonHorizontal
            // 
            this.radioButtonHorizontal.AutoSize = true;
            this.radioButtonHorizontal.Location = new System.Drawing.Point(7, 40);
            this.radioButtonHorizontal.Name = "radioButtonHorizontal";
            this.radioButtonHorizontal.Size = new System.Drawing.Size(47, 16);
            this.radioButtonHorizontal.TabIndex = 1;
            this.radioButtonHorizontal.TabStop = true;
            this.radioButtonHorizontal.Text = "横向";
            this.radioButtonHorizontal.UseVisualStyleBackColor = true;
            this.radioButtonHorizontal.CheckedChanged += new System.EventHandler(this.control_ValueChanged);
            // 
            // radioButtonVertical
            // 
            this.radioButtonVertical.AutoSize = true;
            this.radioButtonVertical.Checked = true;
            this.radioButtonVertical.Location = new System.Drawing.Point(7, 18);
            this.radioButtonVertical.Name = "radioButtonVertical";
            this.radioButtonVertical.Size = new System.Drawing.Size(47, 16);
            this.radioButtonVertical.TabIndex = 0;
            this.radioButtonVertical.TabStop = true;
            this.radioButtonVertical.Text = "纵向";
            this.radioButtonVertical.UseVisualStyleBackColor = true;
            this.radioButtonVertical.CheckedChanged += new System.EventHandler(this.control_ValueChanged);
            // 
            // groupBox3
            // 
            this.groupBox3.Controls.Add(this.checkBoxPlotStyles);
            this.groupBox3.Controls.Add(this.comboBoxStyleSheet);
            this.groupBox3.Location = new System.Drawing.Point(348, 12);
            this.groupBox3.Name = "groupBox3";
            this.groupBox3.Size = new System.Drawing.Size(250, 85);
            this.groupBox3.TabIndex = 9;
            this.groupBox3.TabStop = false;
            this.groupBox3.Text = "打印样式表";
            // 
            // checkBoxPlotStyles
            // 
            this.checkBoxPlotStyles.AutoSize = true;
            this.checkBoxPlotStyles.Location = new System.Drawing.Point(7, 54);
            this.checkBoxPlotStyles.Name = "checkBoxPlotStyles";
            this.checkBoxPlotStyles.Size = new System.Drawing.Size(84, 16);
            this.checkBoxPlotStyles.TabIndex = 0;
            this.checkBoxPlotStyles.Text = "按样式打印";
            this.checkBoxPlotStyles.UseVisualStyleBackColor = true;
            this.checkBoxPlotStyles.CheckedChanged += new System.EventHandler(this.control_ValueChanged);
            // 
            // comboBoxStyleSheet
            // 
            this.comboBoxStyleSheet.FormattingEnabled = true;
            this.comboBoxStyleSheet.Location = new System.Drawing.Point(6, 27);
            this.comboBoxStyleSheet.Name = "comboBoxStyleSheet";
            this.comboBoxStyleSheet.Size = new System.Drawing.Size(226, 20);
            this.comboBoxStyleSheet.TabIndex = 0;
            this.comboBoxStyleSheet.SelectedIndexChanged += new System.EventHandler(this.comboBox_UpdateDataBinding);
            this.comboBoxStyleSheet.TabIndexChanged += new System.EventHandler(this.control_ValueChanged);
            // 
            // groupBox4
            // 
            this.groupBox4.Controls.Add(this.buttonPlotWindow);
            this.groupBox4.Controls.Add(this.label3);
            this.groupBox4.Controls.Add(this.comboBoxPlotArea);
            this.groupBox4.Location = new System.Drawing.Point(18, 210);
            this.groupBox4.Name = "groupBox4";
            this.groupBox4.Size = new System.Drawing.Size(259, 76);
            this.groupBox4.TabIndex = 10;
            this.groupBox4.TabStop = false;
            this.groupBox4.Text = "打印区域";
            // 
            // buttonPlotWindow
            // 
            this.buttonPlotWindow.Location = new System.Drawing.Point(155, 39);
            this.buttonPlotWindow.Name = "buttonPlotWindow";
            this.buttonPlotWindow.Size = new System.Drawing.Size(75, 23);
            this.buttonPlotWindow.TabIndex = 2;
            this.buttonPlotWindow.Text = "窗口<";
            this.buttonPlotWindow.UseVisualStyleBackColor = true;
            this.buttonPlotWindow.Click += new System.EventHandler(this.buttonPlotWindow_Click);
            // 
            // label3
            // 
            this.label3.AutoSize = true;
            this.label3.Location = new System.Drawing.Point(7, 21);
            this.label3.Name = "label3";
            this.label3.Size = new System.Drawing.Size(65, 12);
            this.label3.TabIndex = 1;
            this.label3.Text = "打印范围：";
            // 
            // comboBoxPlotArea
            // 
            this.comboBoxPlotArea.FormattingEnabled = true;
            this.comboBoxPlotArea.Location = new System.Drawing.Point(8, 41);
            this.comboBoxPlotArea.Name = "comboBoxPlotArea";
            this.comboBoxPlotArea.Size = new System.Drawing.Size(121, 20);
            this.comboBoxPlotArea.TabIndex = 0;
            this.comboBoxPlotArea.SelectedIndexChanged += new System.EventHandler(this.comboBoxPlotArea_SelectedIndexChanged);
            // 
            // groupBox5
            // 
            this.groupBox5.Controls.Add(this.checkBoxPlotCentered);
            this.groupBox5.Controls.Add(this.labelOffsetYUnit);
            this.groupBox5.Controls.Add(this.labelOffsetXUnit);
            this.groupBox5.Controls.Add(this.textBoxOffsetY);
            this.groupBox5.Controls.Add(this.textBoxOffsetX);
            this.groupBox5.Controls.Add(this.label5);
            this.groupBox5.Controls.Add(this.label4);
            this.groupBox5.Location = new System.Drawing.Point(16, 292);
            this.groupBox5.Name = "groupBox5";
            this.groupBox5.Size = new System.Drawing.Size(261, 79);
            this.groupBox5.TabIndex = 11;
            this.groupBox5.TabStop = false;
            this.groupBox5.Text = "打印偏移（原点设置在可打印区域）";
            // 
            // checkBoxPlotCentered
            // 
            this.checkBoxPlotCentered.AutoSize = true;
            this.checkBoxPlotCentered.Location = new System.Drawing.Point(174, 29);
            this.checkBoxPlotCentered.Name = "checkBoxPlotCentered";
            this.checkBoxPlotCentered.Size = new System.Drawing.Size(72, 16);
            this.checkBoxPlotCentered.TabIndex = 6;
            this.checkBoxPlotCentered.Text = "居中打印";
            this.checkBoxPlotCentered.UseVisualStyleBackColor = true;
            this.checkBoxPlotCentered.CheckedChanged += new System.EventHandler(this.checkBoxPlotCentered_CheckedChanged);
            // 
            // labelOffsetYUnit
            // 
            this.labelOffsetYUnit.AutoSize = true;
            this.labelOffsetYUnit.Location = new System.Drawing.Point(137, 50);
            this.labelOffsetYUnit.Name = "labelOffsetYUnit";
            this.labelOffsetYUnit.Size = new System.Drawing.Size(29, 12);
            this.labelOffsetYUnit.TabIndex = 5;
            this.labelOffsetYUnit.Text = "毫米";
            // 
            // labelOffsetXUnit
            // 
            this.labelOffsetXUnit.AutoSize = true;
            this.labelOffsetXUnit.Location = new System.Drawing.Point(138, 29);
            this.labelOffsetXUnit.Name = "labelOffsetXUnit";
            this.labelOffsetXUnit.Size = new System.Drawing.Size(29, 12);
            this.labelOffsetXUnit.TabIndex = 4;
            this.labelOffsetXUnit.Text = "毫米";
            // 
            // textBoxOffsetY
            // 
            this.textBoxOffsetY.Location = new System.Drawing.Point(31, 47);
            this.textBoxOffsetY.Name = "textBoxOffsetY";
            this.textBoxOffsetY.Size = new System.Drawing.Size(100, 21);
            this.textBoxOffsetY.TabIndex = 3;
            this.textBoxOffsetY.Leave += new System.EventHandler(this.control_ValueChanged);
            // 
            // textBoxOffsetX
            // 
            this.textBoxOffsetX.Location = new System.Drawing.Point(31, 21);
            this.textBoxOffsetX.Name = "textBoxOffsetX";
            this.textBoxOffsetX.Size = new System.Drawing.Size(100, 21);
            this.textBoxOffsetX.TabIndex = 2;
            this.textBoxOffsetX.Leave += new System.EventHandler(this.control_ValueChanged);
            // 
            // label5
            // 
            this.label5.AutoSize = true;
            this.label5.Location = new System.Drawing.Point(7, 47);
            this.label5.Name = "label5";
            this.label5.Size = new System.Drawing.Size(17, 12);
            this.label5.TabIndex = 1;
            this.label5.Text = "Y:";
            // 
            // label4
            // 
            this.label4.AutoSize = true;
            this.label4.Location = new System.Drawing.Point(7, 21);
            this.label4.Name = "label4";
            this.label4.Size = new System.Drawing.Size(17, 12);
            this.label4.TabIndex = 0;
            this.label4.Text = "X:";
            // 
            // groupBox6
            // 
            this.groupBox6.Controls.Add(this.label10);
            this.groupBox6.Controls.Add(this.comboBoxPlotPaperUnits);
            this.groupBox6.Controls.Add(this.comboBoxStdScaleType);
            this.groupBox6.Controls.Add(this.label9);
            this.groupBox6.Controls.Add(this.textBoxDenominator);
            this.groupBox6.Controls.Add(this.textBoxNumerator);
            this.groupBox6.Controls.Add(this.label8);
            this.groupBox6.Controls.Add(this.checkBoxExtent);
            this.groupBox6.Location = new System.Drawing.Point(348, 210);
            this.groupBox6.Name = "groupBox6";
            this.groupBox6.Size = new System.Drawing.Size(250, 162);
            this.groupBox6.TabIndex = 12;
            this.groupBox6.TabStop = false;
            this.groupBox6.Text = "打印比例";
            // 
            // label10
            // 
            this.label10.AutoSize = true;
            this.label10.Location = new System.Drawing.Point(209, 86);
            this.label10.Name = "label10";
            this.label10.Size = new System.Drawing.Size(11, 12);
            this.label10.TabIndex = 10;
            this.label10.Text = "=";
            // 
            // comboBoxPlotPaperUnits
            // 
            this.comboBoxPlotPaperUnits.FormattingEnabled = true;
            this.comboBoxPlotPaperUnits.Location = new System.Drawing.Point(131, 83);
            this.comboBoxPlotPaperUnits.Name = "comboBoxPlotPaperUnits";
            this.comboBoxPlotPaperUnits.Size = new System.Drawing.Size(72, 20);
            this.comboBoxPlotPaperUnits.TabIndex = 9;
            this.comboBoxPlotPaperUnits.SelectedIndexChanged += new System.EventHandler(this.comboBox_UpdateDataBinding);
            // 
            // comboBoxStdScaleType
            // 
            this.comboBoxStdScaleType.FormattingEnabled = true;
            this.comboBoxStdScaleType.Location = new System.Drawing.Point(75, 46);
            this.comboBoxStdScaleType.Name = "comboBoxStdScaleType";
            this.comboBoxStdScaleType.Size = new System.Drawing.Size(157, 20);
            this.comboBoxStdScaleType.TabIndex = 8;
            this.comboBoxStdScaleType.SelectedIndexChanged += new System.EventHandler(this.comboBox_UpdateDataBinding);
            // 
            // label9
            // 
            this.label9.AutoSize = true;
            this.label9.Location = new System.Drawing.Point(129, 112);
            this.label9.Name = "label9";
            this.label9.Size = new System.Drawing.Size(29, 12);
            this.label9.TabIndex = 6;
            this.label9.Text = "单位";
            // 
            // textBoxDenominator
            // 
            this.textBoxDenominator.Location = new System.Drawing.Point(75, 109);
            this.textBoxDenominator.Name = "textBoxDenominator";
            this.textBoxDenominator.Size = new System.Drawing.Size(49, 21);
            this.textBoxDenominator.TabIndex = 5;
            this.textBoxDenominator.Leave += new System.EventHandler(this.control_ValueChanged);
            // 
            // textBoxNumerator
            // 
            this.textBoxNumerator.Location = new System.Drawing.Point(75, 82);
            this.textBoxNumerator.Name = "textBoxNumerator";
            this.textBoxNumerator.Size = new System.Drawing.Size(49, 21);
            this.textBoxNumerator.TabIndex = 3;
            this.textBoxNumerator.Leave += new System.EventHandler(this.control_ValueChanged);
            // 
            // label8
            // 
            this.label8.AutoSize = true;
            this.label8.Location = new System.Drawing.Point(17, 49);
            this.label8.Name = "label8";
            this.label8.Size = new System.Drawing.Size(41, 12);
            this.label8.TabIndex = 1;
            this.label8.Text = "比例：";
            // 
            // checkBoxExtent
            // 
            this.checkBoxExtent.AutoSize = true;
            this.checkBoxExtent.Location = new System.Drawing.Point(17, 23);
            this.checkBoxExtent.Name = "checkBoxExtent";
            this.checkBoxExtent.Size = new System.Drawing.Size(72, 16);
            this.checkBoxExtent.TabIndex = 0;
            this.checkBoxExtent.Text = "布满图纸";
            this.checkBoxExtent.UseVisualStyleBackColor = true;
            this.checkBoxExtent.CheckedChanged += new System.EventHandler(this.checkBoxExtent_CheckedChanged);
            // 
            // groupBox7
            // 
            this.groupBox7.Controls.Add(this.comboBoxMedia);
            this.groupBox7.Location = new System.Drawing.Point(18, 127);
            this.groupBox7.Name = "groupBox7";
            this.groupBox7.Size = new System.Drawing.Size(313, 48);
            this.groupBox7.TabIndex = 13;
            this.groupBox7.TabStop = false;
            this.groupBox7.Text = "图纸尺寸";
            // 
            // groupBox8
            // 
            this.groupBox8.Controls.Add(this.numericCopies);
            this.groupBox8.Location = new System.Drawing.Point(473, 103);
            this.groupBox8.Name = "groupBox8";
            this.groupBox8.Size = new System.Drawing.Size(119, 48);
            this.groupBox8.TabIndex = 14;
            this.groupBox8.TabStop = false;
            this.groupBox8.Text = "打印份数";
            // 
            // numericCopies
            // 
            this.numericCopies.Location = new System.Drawing.Point(22, 17);
            this.numericCopies.Minimum = new decimal(new int[] {
            1,
            0,
            0,
            0});
            this.numericCopies.Name = "numericCopies";
            this.numericCopies.Size = new System.Drawing.Size(57, 21);
            this.numericCopies.TabIndex = 0;
            this.numericCopies.Value = new decimal(new int[] {
            1,
            0,
            0,
            0});
            // 
            // groupBox9
            // 
            this.groupBox9.Controls.Add(this.checkBoxToFile);
            this.groupBox9.Controls.Add(this.label2);
            this.groupBox9.Controls.Add(this.comboBoxDevice);
            this.groupBox9.Location = new System.Drawing.Point(18, 12);
            this.groupBox9.Name = "groupBox9";
            this.groupBox9.Size = new System.Drawing.Size(313, 85);
            this.groupBox9.TabIndex = 15;
            this.groupBox9.TabStop = false;
            this.groupBox9.Text = "打印机/绘图仪";
            // 
            // checkBoxToFile
            // 
            this.checkBoxToFile.AutoSize = true;
            this.checkBoxToFile.Location = new System.Drawing.Point(13, 54);
            this.checkBoxToFile.Name = "checkBoxToFile";
            this.checkBoxToFile.Size = new System.Drawing.Size(84, 16);
            this.checkBoxToFile.TabIndex = 2;
            this.checkBoxToFile.Text = "打印到文件";
            this.checkBoxToFile.UseVisualStyleBackColor = true;
            // 
            // label2
            // 
            this.label2.AutoSize = true;
            this.label2.Location = new System.Drawing.Point(11, 25);
            this.label2.Name = "label2";
            this.label2.Size = new System.Drawing.Size(41, 12);
            this.label2.TabIndex = 1;
            this.label2.Text = "名称：";
            // 
            // buttonApply
            // 
            this.buttonApply.Enabled = false;
            this.buttonApply.Location = new System.Drawing.Point(119, 398);
            this.buttonApply.Name = "buttonApply";
            this.buttonApply.Size = new System.Drawing.Size(100, 23);
            this.buttonApply.TabIndex = 16;
            this.buttonApply.Text = "应用到当前布局";
            this.buttonApply.UseVisualStyleBackColor = true;
            this.buttonApply.Click += new System.EventHandler(this.buttonApply_Click);
            // 
            // buttonPlotLayouts
            // 
            this.buttonPlotLayouts.Location = new System.Drawing.Point(354, 398);
            this.buttonPlotLayouts.Name = "buttonPlotLayouts";
            this.buttonPlotLayouts.Size = new System.Drawing.Size(95, 23);
            this.buttonPlotLayouts.TabIndex = 11;
            this.buttonPlotLayouts.Text = "打印所有布局";
            this.buttonPlotLayouts.UseVisualStyleBackColor = true;
            this.buttonPlotLayouts.Click += new System.EventHandler(this.buttonPlotLayouts_Click);
            // 
            // PlotForm
            // 
            this.AutoScaleDimensions = new System.Drawing.SizeF(6F, 12F);
            this.AutoScaleMode = System.Windows.Forms.AutoScaleMode.Font;
            this.CancelButton = this.buttonCancel;
            this.ClientSize = new System.Drawing.Size(611, 428);
            this.Controls.Add(this.buttonPlotLayouts);
            this.Controls.Add(this.buttonApply);
            this.Controls.Add(this.groupBox9);
            this.Controls.Add(this.groupBox8);
            this.Controls.Add(this.groupBox7);
            this.Controls.Add(this.groupBox6);
            this.Controls.Add(this.groupBox5);
            this.Controls.Add(this.groupBox4);
            this.Controls.Add(this.buttonPlot);
            this.Controls.Add(this.groupBox3);
            this.Controls.Add(this.groupBoxOrientation);
            this.Controls.Add(this.buttonCancel);
            this.Controls.Add(this.buttonPreview);
            this.FormBorderStyle = System.Windows.Forms.FormBorderStyle.FixedSingle;
            this.HelpButton = true;
            this.MaximizeBox = false;
            this.MinimizeBox = false;
            this.Name = "PlotForm";
            this.ShowInTaskbar = false;
            this.StartPosition = System.Windows.Forms.FormStartPosition.CenterScreen;
            this.Text = "PlotForm";
            this.Load += new System.EventHandler(this.PlotForm_Load);
            this.groupBoxOrientation.ResumeLayout(false);
            this.groupBoxOrientation.PerformLayout();
            this.groupBox3.ResumeLayout(false);
            this.groupBox3.PerformLayout();
            this.groupBox4.ResumeLayout(false);
            this.groupBox4.PerformLayout();
            this.groupBox5.ResumeLayout(false);
            this.groupBox5.PerformLayout();
            this.groupBox6.ResumeLayout(false);
            this.groupBox6.PerformLayout();
            this.groupBox7.ResumeLayout(false);
            this.groupBox8.ResumeLayout(false);
            ((System.ComponentModel.ISupportInitialize)(this.numericCopies)).EndInit();
            this.groupBox9.ResumeLayout(false);
            this.groupBox9.PerformLayout();
            this.ResumeLayout(false);

        }

        #endregion

        private System.Windows.Forms.ComboBox comboBoxDevice;
        private System.Windows.Forms.ComboBox comboBoxMedia;
        private System.Windows.Forms.Button buttonPreview;
        private System.Windows.Forms.Button buttonPlot;
        private System.Windows.Forms.Button buttonCancel;
        private System.Windows.Forms.GroupBox groupBoxOrientation;
        private System.Windows.Forms.CheckBox checkBoxReverse;
        private System.Windows.Forms.RadioButton radioButtonHorizontal;
        private System.Windows.Forms.RadioButton radioButtonVertical;
        private System.Windows.Forms.GroupBox groupBox3;
        private System.Windows.Forms.ComboBox comboBoxStyleSheet;
        private System.Windows.Forms.GroupBox groupBox4;
        private System.Windows.Forms.Label label3;
        private System.Windows.Forms.ComboBox comboBoxPlotArea;
        private System.Windows.Forms.GroupBox groupBox5;
        private System.Windows.Forms.CheckBox checkBoxPlotCentered;
        private System.Windows.Forms.Label labelOffsetYUnit;
        private System.Windows.Forms.Label labelOffsetXUnit;
        private System.Windows.Forms.TextBox textBoxOffsetY;
        private System.Windows.Forms.TextBox textBoxOffsetX;
        private System.Windows.Forms.Label label5;
        private System.Windows.Forms.Label label4;
        private System.Windows.Forms.GroupBox groupBox6;
        private System.Windows.Forms.Label label10;
        private System.Windows.Forms.ComboBox comboBoxPlotPaperUnits;
        private System.Windows.Forms.ComboBox comboBoxStdScaleType;
        private System.Windows.Forms.Label label9;
        private System.Windows.Forms.TextBox textBoxDenominator;
        private System.Windows.Forms.TextBox textBoxNumerator;
        private System.Windows.Forms.Label label8;
        private System.Windows.Forms.CheckBox checkBoxExtent;
        private System.Windows.Forms.Button buttonPlotWindow;
        private System.Windows.Forms.GroupBox groupBox7;
        private System.Windows.Forms.GroupBox groupBox8;
        private System.Windows.Forms.NumericUpDown numericCopies;
        private System.Windows.Forms.GroupBox groupBox9;
        private System.Windows.Forms.CheckBox checkBoxToFile;
        private System.Windows.Forms.Label label2;
        private System.Windows.Forms.Button buttonApply;
        private System.Windows.Forms.CheckBox checkBoxPlotStyles;
        private System.Windows.Forms.Button buttonPlotLayouts;
    }
}﻿using System;
using Autodesk.AutoCAD.ApplicationServices;
using Autodesk.AutoCAD.Runtime;
namespace Plots
{
    public class Plots
    {
        [CommandMethod("ShowPlotForm")]
        public void ShowPlotForm()
        {
            PlotForm plotForm = new PlotForm();//新建对话框
            Application.ShowModelessDialog(plotForm);//显示无模式对话框
        }
    }
}
﻿using System;
using System.Collections.Generic;
using System.Collections.Specialized;
using System.ComponentModel;
using System.Linq;
using Autodesk.AutoCAD.ApplicationServices;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.Geometry;
using Autodesk.AutoCAD.PlottingServices;

namespace DotNetARX
{
    /// <summary>
    /// 增强型打印设置类，支持数据绑定
    /// </summary>
    public class PlotSettingsEx : PlotSettings, INotifyPropertyChanged
    {
        #region INotifyPropertyChanged接口的实现
        /// <summary>
        /// 在更改属性值时发生的事件
        /// </summary>
        public event PropertyChangedEventHandler  PropertyChanged;

        /// <summary>
        /// 处理属性更改事件的函数
        /// </summary>
        /// <param name="info">属性名</param>
        private void NotifyPropertyChanged(String info)
        {
            if (PropertyChanged != null)
            {
                PropertyChanged(this, new PropertyChangedEventArgs(info));
            }
        } 
        #endregion

        //获取当前打印设置验证类
        private PlotSettingsValidator validator=PlotSettingsValidator.Current;

        /// <summary>
        /// 复制构造函数，从已有打印设置中获取打印设置
        /// </summary>
        /// <param name="ps">已有打印设置</param>
        public PlotSettingsEx(PlotSettings ps)
            : base(ps.ModelType)
        {
            this.CopyFrom(ps);//从已有打印设置中获取打印设置
            //更新打印设备、图纸尺寸和打印样式表信息
            validator.RefreshLists(this);
        }

        #region 覆盖基类属性
        /// <summary>
        /// 获取或设置当前图纸尺寸（中文表示）
        /// </summary>
        public new string CanonicalMediaName
        {
            get
            {
                //将图纸尺寸从英文名改为中文名
                string mediaLocal=base.CanonicalMediaName.Replace("_", " ").Replace("MM", "毫米").Replace("Inches", "英寸").Replace("Pixels", "像素");
                return mediaLocal;//返回中文名的图纸尺寸 
            }
            set
            {
                if (value != CanonicalMediaName)//如果图纸尺寸有变化
                {
                    //将图纸尺寸从中文名改为英文名
                    string mediaName=value.Replace(" ", "_").Replace("毫米", "MM").Replace("英寸", "Inches").Replace("像素", "Pixels");
                    //设置当前图纸尺寸
                    validator.SetCanonicalMediaName(this, mediaName);
                    //向客户端发出某一属性值已更改的通知
                    NotifyPropertyChanged("CanonicalMediaName");
                }
            }
        }
        /// <summary>
        /// 获取或设置当前打印样式表
        /// </summary>
        public new string CurrentStyleSheet
        {
            get { return base.CurrentStyleSheet; }
            set
            {
                if (value != CurrentStyleSheet)
                {
                    if (value != "无")
                    {
                        validator.SetCurrentStyleSheet(this, value);
                    }
                    else validator.SetCurrentStyleSheet(this, "");
                    NotifyPropertyChanged("CurrentStyleSheet");
                }
            }
        }
        /// <summary>
        /// 获取或设置自定义打印比例
        /// </summary>
        public new CustomScale CustomPrintScale
        {
            get { return base.CustomPrintScale; }
            set
            {
                if (value != CustomPrintScale)
                {
                    validator.SetCustomPrintScale(this, value);
                    NotifyPropertyChanged("CustomPrintScale");
                }
            }
        }
        /// <summary>
        /// 获取或设置是否居中打印
        /// </summary>
        public new bool PlotCentered
        {
            get { return base.PlotCentered; }
            set
            {
                if (value != PlotCentered)
                {
                    validator.SetPlotCentered(this, value);
                    NotifyPropertyChanged("PlotCentered");
                }
            }
        }
        /// <summary>
        /// 获取或设置当前打印设备名称
        /// </summary>
        public new string PlotConfigurationName
        {
            get { return base.PlotConfigurationName; }
            set
            {
                if (value != PlotConfigurationName)
                {
                    validator.SetPlotConfigurationName(this, value, null);
                    NotifyPropertyChanged("PlotConfigurationName");
                }
            }
        }
        /// <summary>
        /// 获取或设置当前打印原点（原点是从图纸边界的介质边缘偏移而来的）。
        /// </summary>
        public new Point2d PlotOrigin
        {
            get { return base.PlotOrigin; }
            set
            {
                if (value != PlotOrigin)
                {
                    validator.SetPlotOrigin(this, value);
                    NotifyPropertyChanged("PlotOrigin");
                }
            }
        }
        /// <summary>
        /// 获取或设置打印比例
        /// </summary>
        public new PlotPaperUnit PlotPaperUnits
        {
            get { return base.PlotPaperUnits; }
            set
            {
                if (value != PlotPaperUnits)
                {
                    validator.SetPlotPaperUnits(this, value);
                    NotifyPropertyChanged("PlotPaperUnits");
                }
            }
        }
        /// <summary>
        /// 获取或设置图形方向
        /// </summary>
        public new PlotRotation PlotRotation
        {
            get { return base.PlotRotation; }
            set
            {
                if (value != PlotRotation)
                {
                    validator.SetPlotRotation(this, value);
                    NotifyPropertyChanged("PlotRotation");
                }
            }
        }
        /// <summary>
        /// 获取或设置打印范围
        /// </summary>
        public new Autodesk.AutoCAD.DatabaseServices.PlotType PlotType
        {
            get { return base.PlotType; }
            set
            {
                if (value != PlotType)
                {
                    validator.SetPlotType(this, value);
                    NotifyPropertyChanged("PlotType");
                }
            }
        }
        /// <summary>
        /// 获取或设置打印视口名
        /// </summary>
        public new string PlotViewName
        {
            get { return base.PlotViewName; }
            set
            {
                if (value != PlotViewName)
                {
                    validator.SetPlotViewName(this, value);
                    NotifyPropertyChanged("PlotViewName");
                }
            }
        }
        /// <summary>
        /// 获取或设置打印窗口的范围
        /// </summary>
        public new Extents2d PlotWindowArea
        {
            get { return base.PlotWindowArea; }
            set
            {
                if (value != PlotWindowArea)
                {
                    validator.SetPlotWindowArea(this, value);
                    NotifyPropertyChanged("PlotWindowArea");
                }
            }
        }
        /// <summary>
        /// 获取或设置当前标准比例（实数形式）
        /// </summary>
        public new double StdScale
        {
            get { return base.StdScale; }
            set
            {
                if (value != StdScale)
                {
                    validator.SetStdScale(this, value);
                    NotifyPropertyChanged("StdScale");
                }
            }
        }
        /// <summary>
        /// 获取或设置当前标准比例（枚举形式）
        /// </summary>
        public new StdScaleType StdScaleType
        {
            get { return base.StdScaleType; }
            set
            {
                if (value != StdScaleType)
                {
                    validator.SetStdScaleType(this, value);
                    NotifyPropertyChanged("StdScaleType");
                }
            }
        }
        /// <summary>
        /// 获取或设置是否选用标准比例
        /// </summary>
        public new bool UseStandardScale
        {
            get { return base.UseStandardScale; }
            set
            {
                if (value != UseStandardScale)
                {
                    validator.SetUseStandardScale(this, value);
                    NotifyPropertyChanged("UseStandardScale");
                }
            }
        }
        #endregion
        /// <summary>
        /// 获取或设置当前图形单位
        /// </summary>
        public double Denominator
        {
            get { return base.CustomPrintScale.Denominator; }
            set
            {
                if (value != Denominator)
                {
                    CustomScale newScale=new CustomScale(CustomPrintScale.Numerator, value);
                    validator.SetCustomPrintScale(this, newScale);
                    NotifyPropertyChanged("Denominator");
                }
            }
        }
        /// <summary>
        /// 获取或设置当前图纸单位
        /// </summary>
        public double Numerator
        {
            get { return base.CustomPrintScale.Numerator; }
            set
            {
                if (value != Numerator)
                {
                    CustomScale newScale=new CustomScale(value, CustomPrintScale.Denominator);
                    validator.SetCustomPrintScale(this, newScale);
                    NotifyPropertyChanged("Numerator");
                }
            }
        }
        /// <summary>
        /// 获取或设置当前X方向的打印偏移
        /// </summary>
        public double PlotOriginX
        {
            get { return base.PlotOrigin.X; }
            set
            {
                if (value != PlotOriginX)
                {
                    Point2d newOrigin=new Point2d(value, PlotOrigin.Y);
                    validator.SetPlotOrigin(this, newOrigin);
                    NotifyPropertyChanged("PlotOriginX");
                }
            }
        }
        /// <summary>
        /// 获取或设置当前Y方向的打印偏移
        /// </summary>
        public double PlotOriginY
        {
            get { return base.PlotOrigin.Y; }
            set
            {
                if (value != PlotOriginY)
                {
                    Point2d newOrigin=new Point2d(PlotOrigin.X, value);
                    validator.SetPlotOrigin(this, newOrigin);
                    NotifyPropertyChanged("PlotOriginY");
                }
            }
        }
        /// <summary>
        /// 获取或设置打印时是否布满图纸
        /// </summary>
        public bool PlotExtent
        {
            get
            {
                if (this.UseStandardScale && this.StdScaleType == StdScaleType.ScaleToFit)
                    return true;
                else return false;
            }
            set
            {
                if (value != PlotExtent)
                {
                    if (value)
                    {
                        validator.SetUseStandardScale(this, true);
                        validator.SetStdScaleType(this, StdScaleType.ScaleToFit);
                    }
                    else validator.SetUseStandardScale(this, false);
                    NotifyPropertyChanged("PlotExtent");
                }
            }
        }
        /// <summary>
        /// 获取或设置是否反向打印
        /// </summary>
        public bool PlotReverse
        {
            get
            {
                if (PlotRotation == PlotRotation.Degrees180 || PlotRotation == PlotRotation.Degrees270) return true;
                else return false;
            }
            set
            {
                if (value != PlotReverse)
                {
                    int numRotation=(int)PlotRotation;
                    if (value == true)
                    {
                        numRotation += 2;
                    }
                    else
                        numRotation -= 2;
                    validator.SetPlotRotation(this, (Autodesk.AutoCAD.DatabaseServices.PlotRotation)numRotation);
                    NotifyPropertyChanged("PlotReverse");
                }
            }
        }
        #region 列表类属性
        /// <summary>
        /// 获取当前打印设备列表
        /// </summary>
        public List<string> DeviceList
        {
            get
            {
                StringCollection deviceCollection=validator.GetPlotDeviceList();
                List<string> deviceList=new List<string>();
                foreach (string device in deviceCollection)
                {
                    deviceList.Add(device);
                }
                return deviceList;
            }
        }
        /// <summary>
        /// 获取当前图纸尺寸列表（中文表示）
        /// </summary>
        public List<string> MediaList
        {
            get
            {
                StringCollection mediaCollection=validator.GetCanonicalMediaNameList(this);
                List<string> mediaList=new List<string>();
                foreach (string media in mediaCollection)
                {
                    string mediaLocal=media.Replace("_", " ").Replace("MM", "毫米").Replace("Inches", "英寸").Replace("Pixels", "像素");
                    mediaList.Add(mediaLocal);
                }
                return mediaList; ;
            }
        }
        /// <summary>
        /// 获取当前打印范围列表（中文表示）
        /// </summary>
        public List<string> PlotTypeList
        {
            get
            {
                if (ModelType)//模型空间
                    return (new List<string> { "窗口", "图形界限", "显示" });
                else//图纸空间
                    return (new List<string> { "布局", "窗口", "范围", "显示" });
            }
        }
        /// <summary>
        /// 获取当前打印单位列表（中文表示）
        /// </summary>
        public List<string> PlotUnitList
        {
            get
            {
                if (PlotPaperUnits == PlotPaperUnit.Pixels)
                    return (new List<string> { "像素" });
                else
                    return (new List<string> { "毫米", "英寸" });
            }
        }
        /// <summary>
        /// 获取颜色相关打印样式列表
        /// </summary>
        public List<string> ColorDependentPlotStyles
        {
            get
            {
                List<string> styleSheetList=(from string style in validator.GetPlotStyleSheetList()
                                             where style.EndsWith("ctb")
                                             select style).ToList();
                styleSheetList.Insert(0, "无");
                return styleSheetList;
            }
        }
        /// <summary>
        /// 获取命名打印样式列表
        /// </summary>
        public List<string> NamedPlotStyles
        {
            get
            {
                List<string> styleSheetList=(from string style in validator.GetPlotStyleSheetList()
                                             where style.EndsWith("stb")
                                             select style).ToList();
                styleSheetList.Insert(0, "无");
                return styleSheetList;
            }
        }
        /// <summary>
        /// 获取标准打印比例列表
        /// </summary>
        public Dictionary<StdScaleType, string> StdScaleTypeList
        {
            get
            {
                var scaleTypeDict=new Dictionary<StdScaleType, string>();
                List<string> scaleTypeList=new List<string>() 
                {
                    "自定义","1/128'' = 1'-0''","1/64'' = 1'-0''","1/32'' = 1'-0''","1/16'' = 1'-0''","3/32'' = 1'-0''",
                    "1/8'' = 1'-0''","3/16'' = 1'-0''","1/4'' = 1'-0''","3/8'' = 1'-0''","1/2'' = 1'-0''","3/4'' = 1'-0''",
                    "1'' = 1'-0''","3'' = 1'-0''","6'' = 1'-0''","1'-0'''' = 1'-0''",
                    "1:1","1:2","1:4","1:8","1:10","1:16","1:20","1:30","1:40","1:50","1:100",
                    "2:1","4:1","8:1","10:1","100:1","1000:1"
                };
                scaleTypeDict.Add(StdScaleType.ScaleToFit, scaleTypeList[0]);
                for (int i = 16; i <= 32; i++)
                {
                    scaleTypeDict.Add((StdScaleType)i, scaleTypeList[i]);
                }
                for (int i = 1; i < 16; i++)
                {
                    scaleTypeDict.Add((StdScaleType)i, scaleTypeList[i]);
                }
                return scaleTypeDict;
            }
        }
        #endregion
        #region 中文属性
        /// <summary>
        /// 获取或设置打印范围（中文）
        /// </summary>
        public string PlotTypeLocal
        {
            get
            {
                string plotTypeLocal="";
                switch (base.PlotType)
                {
                    case Autodesk.AutoCAD.DatabaseServices.PlotType.Display:
                        plotTypeLocal = "显示";
                        break;
                    case Autodesk.AutoCAD.DatabaseServices.PlotType.Extents:
                        plotTypeLocal = "范围";
                        break;
                    case Autodesk.AutoCAD.DatabaseServices.PlotType.Layout:
                        plotTypeLocal = "布局";
                        break;
                    case Autodesk.AutoCAD.DatabaseServices.PlotType.Limits:
                        plotTypeLocal = "图形界限";
                        break;
                    case Autodesk.AutoCAD.DatabaseServices.PlotType.View:
                        plotTypeLocal = "视图";
                        break;
                    case Autodesk.AutoCAD.DatabaseServices.PlotType.Window:
                        plotTypeLocal = "窗口";
                        break;
                }
                return plotTypeLocal;
            }
            set
            {
                if (value != PlotTypeLocal)
                {
                    switch (value)
                    {
                        case "显示":
                            PlotType = Autodesk.AutoCAD.DatabaseServices.PlotType.Display;
                            break;
                        case "范围":
                            PlotType = Autodesk.AutoCAD.DatabaseServices.PlotType.Extents;
                            break;
                        case "布局":
                            PlotType = Autodesk.AutoCAD.DatabaseServices.PlotType.Layout;
                            break;
                        case "图形界限":
                            PlotType = Autodesk.AutoCAD.DatabaseServices.PlotType.Limits;
                            break;
                        case "视图":
                            PlotType = Autodesk.AutoCAD.DatabaseServices.PlotType.View;
                            break;
                        case "窗口":
                            PlotType = Autodesk.AutoCAD.DatabaseServices.PlotType.Window;
                            break;
                    }
                    NotifyPropertyChanged("PlotTypeLocal");
                }
            }
        }

        /// <summary>
        /// 获取或设置打印单位（中文）
        /// </summary>
        public string PlotPaperUnitsLocal
        {
            get
            {
                string plotUnitLocal="";
                switch (base.PlotPaperUnits)
                {
                    case PlotPaperUnit.Inches: plotUnitLocal = "英寸"; break;
                    case PlotPaperUnit.Millimeters: plotUnitLocal = "毫米"; break;
                    case PlotPaperUnit.Pixels: plotUnitLocal = "像素"; break;
                }
                return plotUnitLocal;
            }
            set
            {
                if (value != PlotPaperUnitsLocal)
                {
                    switch (value)
                    {
                        case "英寸": validator.SetPlotPaperUnits(this, PlotPaperUnit.Inches); break;
                        case "毫米": validator.SetPlotPaperUnits(this, PlotPaperUnit.Millimeters); break;
                        case "像素": validator.SetPlotPaperUnits(this, PlotPaperUnit.Pixels); break;
                    }
                    NotifyPropertyChanged("PlotPaperUnitsLocal");
                }
            }
        }

        /// <summary>
        /// 获取或设置当前标准打印比例（中文）
        /// </summary>
        public string StdScaleTypeLocal
        {
            get
            {
                if (!UseStandardScale) return "自定义";
                else
                    return StdScaleTypeList[StdScaleType];
            }
            set
            {
                if (value != StdScaleTypeLocal)
                {

                    StdScaleType newScaleType=StdScaleTypeList.First(s => s.Value == value).Key;
                    validator.SetStdScaleType(this, newScaleType);
                    NotifyPropertyChanged("StdScaleTypeLocal");
                }
            }
        }
        #endregion
        /// <summary>
        /// 是否打印到文件
        /// </summary>
        public bool IsPlotToFile
        {
            get
            {
                //如果未选择打印设备，则直接返回
                if (PlotConfigurationName == "无") return false;
                //获取当前打印配置，并返回其是否打印到文件属性
                PlotConfig config=PlotConfigManager.CurrentConfig;
                return config.IsPlotToFile;
            }
        }
        /// <summary>
        /// 可以不打印到文件
        /// </summary>
        public bool NoPlotToFile
        {
            get
            {
                //如果未选择打印设备，则直接返回
                if (PlotConfigurationName == "无") return false;
                //获取当前打印配置，并返回其是否必须打印到文件
                PlotConfig config=PlotConfigManager.CurrentConfig;
                if (config.PlotToFileCapability == PlotToFileCapability.MustPlotToFile)
                    return false;
                else return true;
            }
        }
        /// <summary>
        /// 获取或设置是否横向打印
        /// </summary>
        public bool PlotHorizontal
        {
            get
            {
                if (base.PlotRotation == PlotRotation.Degrees090 || base.PlotRotation == PlotRotation.Degrees270) return true;
                else return false;
            }
            set
            {
                if (value != PlotHorizontal)
                {
                    if (value == true)
                    {
                        if (PlotReverse)
                            validator.SetPlotRotation(this, PlotRotation.Degrees270);
                        else
                            validator.SetPlotRotation(this, PlotRotation.Degrees090);
                    }
                    else
                    {
                        if (PlotReverse)
                            validator.SetPlotRotation(this, PlotRotation.Degrees180);
                        else
                            validator.SetPlotRotation(this, PlotRotation.Degrees000);
                    }
                }
                NotifyPropertyChanged("PlotHorizontal");
            }
        }

        /// <summary>
        /// 更新其它的打印设置
        /// </summary>
        /// <param name="psId">打印设置对象</param>
        public void UpdatePlotSettings(ObjectId psId)
        {
            Document doc=Application.DocumentManager.MdiActiveDocument;
            using (doc.LockDocument())
            using (Transaction trans = doc.TransactionManager.StartTransaction())
            {
                PlotSettings ps=psId.GetObject(OpenMode.ForWrite) as PlotSettings;
                if (ps != null)
                {
                    ps.CopyFrom(this);//复制当前打印设置
                }
                trans.Commit();
            }
        }
    }
}
﻿using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using Autodesk.AutoCAD.PlottingServices;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.ApplicationServices;
using System.Xml.Linq;
using Autodesk.AutoCAD.EditorInput;
using System.Collections.Specialized;
using Autodesk.AutoCAD.Geometry;

namespace DotNetARX
{
    /// <summary>
    /// 打印操作类
    /// </summary>
    public static class PlotTools
    {
        /// <summary>
        /// 执行单一布局打印
        /// </summary>
        /// <param name="engine">打印引擎对象</param>
        /// <param name="layout">要打印的布局</param>
        /// <param name="ps">打印设置</param>
        /// <param name="fileName">打印文件名</param>
        /// <param name="copies">打印份数</param>
        /// <param name="isPreview">是否预览打印</param>
        /// <param name="showProgressDialog">是否显示打印进度框</param>
        /// <param name="plotToFile">是否打印到文件</param>
        /// <returns>返回打印状态</returns>
        public static PreviewEndPlotStatus Plot(this PlotEngine engine, Layout layout, PlotSettings ps, string fileName, int copies, bool isPreview, bool showProgressDialog, bool plotToFile)
        {
            PlotProgressDialog plotDlg=null;//声明一个打印进度框对象
            if (showProgressDialog)//如果需要显示打印进度框，则创建
            {
                plotDlg = new PlotProgressDialog(isPreview, 1, true);
                //获取去除扩展名后的文件名（不含路径）
                string plotFileName=SymbolUtilityServices.GetSymbolNameFromPathName(fileName, "dwg");
                //在打印进度框中显示的图纸名称：当前打印布局的名称（含文档名）
                plotDlg.set_PlotMsgString(PlotMessageIndex.SheetName, "正在处理图纸：" + layout.LayoutName + "(" + plotFileName + ".dwg)");
            }
            //设置打印的状态为停止
            PreviewEndPlotStatus status=PreviewEndPlotStatus.Cancel;
            PlotInfo pi=new PlotInfo();//创建打印信息
            pi.Layout = layout.ObjectId;//要打印的布局
            pi.OverrideSettings = ps;//使用ps中的打印设置
            //验证打印信息是否有效
            PlotInfoValidator piv=new PlotInfoValidator();
            piv.MediaMatchingPolicy = MatchingPolicy.MatchEnabled;
            piv.Validate(pi);
            //启动打印进度框
            if (showProgressDialog) plotDlg.StartPlotProgress(isPreview);
            engine.BeginPlot(plotDlg, null);//开启打印引擎进行打印任务
            //开始打印文档
            engine.BeginDocument(pi, layout.Database.GetDocument().Name, null, copies, plotToFile, fileName);
            //启动打印图纸进程
            if (plotDlg != null) plotDlg.StartSheetProgress();
            //开始打印页面
            PlotPageInfo ppi=new PlotPageInfo();
            engine.BeginPage(ppi, pi, true, null);
            engine.BeginGenerateGraphics(null);//开始打印内容
            //设置打印进度
            if (plotDlg != null) plotDlg.SheetProgressPos = 50;
            engine.EndGenerateGraphics(null);//内容打印结束
            //结束页面打印
            PreviewEndPlotInfo pepi=new PreviewEndPlotInfo();
            engine.EndPage(pepi);
            status = pepi.Status;//打印预览结束时的状态
            //终止显示打印图纸进程
            if (plotDlg != null) plotDlg.EndSheetProgress();
            engine.EndDocument(null);//文档打印结束
            //终止显示打印进度框
            if (plotDlg != null) plotDlg.EndPlotProgress();
            engine.EndPlot(null);//结束打印任务
            return status;//打印预览结束时的状态
        }
        /// <summary>
        /// 执行多布局打印
        /// </summary>
        /// <param name="engine">打印引擎对象</param>
        /// <param name="layouts">要打印的布局列表</param>
        /// <param name="ps">打印设置</param>
        /// <param name="fileName">打印文件名</param>
        /// <param name="previewNum">预览的布局号，小于1表示打印</param>
        /// <param name="copies">打印份数</param>
        /// <param name="showProgressDialog">是否显示打印进度框</param>
        /// <param name="plotToFile">是否打印到文件</param>
        /// <returns>返回打印状态</returns>
        public static PreviewEndPlotStatus MPlot(this PlotEngine engine, List<Layout> layouts, PlotSettings ps, string fileName, int previewNum, int copies, bool showProgressDialog, bool plotToFile)
        {
            int numSheet=1;//表示当前打印的图纸序号
            //设置是否为预览
            bool isPreview=previewNum >= 1 ? true : false;
            Document doc=Application.DocumentManager.MdiActiveDocument;
            PlotProgressDialog plotDlg=null;//声明一个打印进度框对象
            if (showProgressDialog)//如果需要显示打印进度框，则创建
                plotDlg = new PlotProgressDialog(isPreview, layouts.Count, true);
            //设置打印的状态为停止
            PreviewEndPlotStatus status=PreviewEndPlotStatus.Cancel;
            //重建一个布局列表，因为打印预览只能是单页的
            List<Layout> layoutList=new List<Layout>();
            if (isPreview && previewNum >= 1)//如果为打印预览
                layoutList.Add(layouts[previewNum - 1]);//只对预览的布局进行操作
            else layoutList.AddRange(layouts);//如果为打印，则需对所有的布局进行操作
            foreach (Layout layout in layoutList)//遍历布局
            {
                PlotInfo pi=new PlotInfo();//创建打印信息
                pi.Layout = layout.ObjectId;//要打印的布局
                //要多文档打印，必须将要打印的布局设置为当前布局
                LayoutManager.Current.CurrentLayout = layout.LayoutName;
                pi.OverrideSettings = ps;//使用ps中的打印设置
                //验证打印信息是否有效
                PlotInfoValidator piv=new PlotInfoValidator();
                piv.MediaMatchingPolicy = MatchingPolicy.MatchEnabled;
                piv.Validate(pi);
                if (plotDlg != null)//如果显示打印进度框
                {
                    //获取去除扩展名后的文件名（不含路径）
                    string plotFileName=SymbolUtilityServices.GetSymbolNameFromPathName(doc.Name, "dwg");
                    //在打印进度框中显示的图纸名称：当前打印布局的名称（含文档名）
                    plotDlg.set_PlotMsgString(PlotMessageIndex.SheetName, plotFileName + "-" + layout.LayoutName);
                }
                //如果打印的是第一张图纸则启动下面的操作，以后就不再需要再次进行
                if (numSheet == 1)
                {
                    //启动打印进度框
                    if (showProgressDialog) plotDlg.StartPlotProgress(isPreview);
                    engine.BeginPlot(plotDlg, null);//开启打印引擎进行打印任务
                    //开始打印文档
                    engine.BeginDocument(pi, doc.Name, null, copies, plotToFile, fileName);
                }
                //启动打印图纸进程
                if (plotDlg != null) plotDlg.StartSheetProgress();
                //开始打印页面
                PlotPageInfo ppi=new PlotPageInfo();
                engine.BeginPage(ppi, pi, (numSheet == layoutList.Count), null);
                engine.BeginGenerateGraphics(null);//开始打印内容
                //设置打印进度
                if (plotDlg != null) plotDlg.SheetProgressPos = 50;
                engine.EndGenerateGraphics(null);//内容打印结束
                //结束页面打印
                PreviewEndPlotInfo pepi=new PreviewEndPlotInfo();
                engine.EndPage(pepi);
                status = pepi.Status;//打印预览结束时的状态
                //终止显示打印图纸进程
                if (plotDlg != null) plotDlg.EndSheetProgress();
                numSheet++;//将要打印的图纸序号设置为下一个
                //更新打印进程
                if (plotDlg != null)
                    plotDlg.PlotProgressPos += (100 / layouts.Count);
            }
            engine.EndDocument(null);//文档打印结束
            if (plotDlg != null) plotDlg.EndPlotProgress();//终止显示打印进度框
            engine.EndPlot(null);//结束打印任务
            return status;//返回打印预览结束时的状态
        }
        /// <summary>
        /// 启动打印图纸进程
        /// </summary>
        /// <param name="plotDlg">打印进度框对象</param>
        public static void StartSheetProgress(this PlotProgressDialog plotDlg)
        {
            plotDlg.LowerSheetProgressRange = 0;//开始的打印进度
            plotDlg.UpperSheetProgressRange = 100;//线束时的打印进度
            plotDlg.SheetProgressPos = 0;//当前进度为0，表示开始
            plotDlg.OnBeginSheet();//图纸打印开始，进度框开始工作            
        }
        /// <summary>
        /// 终止打印图纸进程
        /// </summary>
        /// <param name="plotDlg">打印进度框对象</param>
        public static void EndSheetProgress(this PlotProgressDialog plotDlg)
        {
            plotDlg.SheetProgressPos = 100;//设置当前进度为100
            plotDlg.OnEndSheet();//图纸打印结束,进度框停止工作
        }
        /// <summary>
        /// 启动打印进度框
        /// </summary>
        /// <param name="plotDlg">打印进度框对象</param>
        /// <param name="isPreview">是否为预览打印</param>
        public static void StartPlotProgress(this PlotProgressDialog plotDlg, bool isPreview)
        {
            Document doc=Application.DocumentManager.MdiActiveDocument;
            //获取去除扩展名后的文件名（不含路径）
            string plotFileName=SymbolUtilityServices.GetSymbolNameFromPathName(doc.Name, "dwg");
            //设置打印进度框中的提示信息
            string dialogTitle=isPreview ? "预览作业进度" : "打印作业进度";
            plotDlg.set_PlotMsgString(PlotMessageIndex.DialogTitle, dialogTitle);
            plotDlg.set_PlotMsgString(PlotMessageIndex.SheetProgressCaption, "正在处理图纸:" + plotFileName);
            plotDlg.set_PlotMsgString(PlotMessageIndex.CancelJobButtonMessage, "取消打印任务");
            plotDlg.set_PlotMsgString(PlotMessageIndex.CancelSheetButtonMessage, "取消文档");
            plotDlg.set_PlotMsgString(PlotMessageIndex.SheetProgressCaption, "进度：");
            plotDlg.LowerPlotProgressRange = 0;//开始的打印进度
            plotDlg.UpperPlotProgressRange = 100;//线束时的打印进度
            plotDlg.PlotProgressPos = 0;//当前进度为0，表示开始
            plotDlg.OnBeginPlot();//打印开始，进程框开始工作
            plotDlg.IsVisible = true;//显示打印进度框
        }
        /// <summary>
        /// 终止打印进度框
        /// </summary>
        /// <param name="plotDlg">打印进度框对象</param>
        public static void EndPlotProgress(this PlotProgressDialog plotDlg)
        {
            plotDlg.PlotProgressPos = 100;//设置当前进度为100
            plotDlg.OnEndPlot();//结束打印
            plotDlg.Dispose();//销毁打印进度框
        }
        /// <summary>
        /// 将打印设备及标准图纸尺寸清单存储到XML文件
        /// </summary>
        /// <param name="fileName">XML文件名</param>
        public static void DeviceMeidaToXML(string fileName)
        {
            XElement xroot=new XElement("Root");//创建一个XML根元素
            //获取当前打印设备列表
            PlotSettingsValidator psv=PlotSettingsValidator.Current;
            StringCollection devices=psv.GetPlotDeviceList();
            //创建打印设置对象，以获取设备拥有的图纸尺寸
            PlotSettings ps=new PlotSettings(true);
            foreach (string device in devices)//遍历打印设备
            {
                //创建一个名为Device的新元素
                XElement xDevice=new XElement("Device");
                //在Device元素下添加表示设备名称的属性
                xDevice.Add(new XAttribute("Name", device));
                //更新打印设备、图纸尺寸，以反映当前系统状态。
                psv.SetPlotConfigurationName(ps, device, null);
                psv.RefreshLists(ps);
                //获取打印设备的所有可用标准图纸尺寸的名称
                StringCollection medias=psv.GetCanonicalMediaNameList(ps);
                foreach (string media in medias)
                {
                    //如果为用户自定义图纸尺寸，则结束本次循环
                    if (media == "UserDefinedMetric") continue;
                    //创建一个名为Media的新元素
                    XElement xMedia=new XElement("Media");
                    //在Media元素下添加表示图纸尺寸的属性
                    xMedia.Add(new XAttribute("Name", media));
                    xDevice.Add(xMedia);//添加Media元素到Device元素中
                }
                xroot.Add(xDevice);//添加Device元素到根元素中
            }
            xroot.Save(fileName);//保存XML文件
        }
        /// <summary>
        /// 从XML文件中读取打印设备及标准图纸尺寸清单
        /// </summary>
        /// <param name="fileName">XML文件名</param>
        /// <param name="deviceName">打印设备名</param>
        /// <returns>返回打印设备及其对应的标准图纸尺寸清单</returns>
        public static List<string> MeidasFromXML(string fileName, string deviceName)
        {
            List<string> medias=new List<string>();
            XElement xroot=XElement.Load(fileName);//载入XML文件
            var devices=from d in xroot.Elements("Device")
                        where d.Attribute("Name").Value == deviceName
                        select d;
            if (devices.Count() != 1) return medias;
            medias = (from m in devices.First().Elements("Media")
                      select m.Attribute("Name").Value).ToList();
            return medias;//返回标准图纸尺寸清单的字典对象
        }

        /// <summary>
        /// 从XML文件读取打印设备名列表
        /// </summary>
        /// <param name="fileName">XML文件名</param>
        /// <returns>返回打印设备名列表</returns>
        public static List<string> DevicesFromXML(string fileName)
        {
            XElement xroot=XElement.Load(fileName);//载入XML文件
            List<string> devices=(from d in xroot.Elements("Device")
                                  select d.Attribute("Name").Value).ToList();
            return devices;
        }
        /// <summary>
        /// 从其它图形数据库中复制打印设置
        /// </summary>
        /// <param name="destdb">目的图形数据库</param>
        /// <param name="sourceDb">源图形数据库</param>
        /// <param name="plotSettingName">打印设置名称</param>
        public static void CopyPlotSettings(this Database destdb, Database sourceDb, string plotSettingName)
        {
            using (Transaction trSource = sourceDb.TransactionManager.StartTransaction())
            {
                using (Transaction trDest =destdb.TransactionManager.StartTransaction())
                {
                    //获取源图形数据库的打印设置字典
                    DBDictionary dict = trSource.GetObject(sourceDb.PlotSettingsDictionaryId, OpenMode.ForRead) as DBDictionary;
                    if (dict != null && dict.Contains(plotSettingName))
                    {
                        //获取指定名称的打印设置
                        ObjectId settingsId = dict.GetAt(plotSettingName);
                        PlotSettings settings = trSource.GetObject(settingsId, OpenMode.ForRead) as PlotSettings;
                        //新建一个打印设置对象
                        PlotSettings newSettings = new PlotSettings(settings.ModelType);
                        newSettings.CopyFrom(settings);//复制打印设置
                        //将新建的打印设置对象添加到目的数据库的打印设置字典中
                        newSettings.AddToPlotSettingsDictionary(destdb);
                        trDest.AddNewlyCreatedDBObject(newSettings, true);
                    }
                    trDest.Commit();
                }
                trSource.Commit();
            }
        }
        /// <summary>
        /// 复制另一个图形数据库中的所有打印设置
        /// </summary>
        /// <param name="destdb">目的图形数据库</param>
        /// <param name="sourceDb">源图形数据库</param>
        public static void CopyPlotSettings(this Database destdb, Database sourceDb)
        {
            using (Transaction trSource = sourceDb.TransactionManager.StartTransaction())
            {
                using (Transaction trDest=destdb.TransactionManager.StartTransaction())
                {
                    //获取源图形数据库的打印设置字典
                    DBDictionary dict = trSource.GetObject(sourceDb.PlotSettingsDictionaryId, OpenMode.ForRead) as DBDictionary;
                    //对打印设置字典中的条目进行遍历
                    foreach (DBDictionaryEntry entry in dict)
                    {
                        //获取指定名称的打印设置
                        ObjectId settingsId = entry.Value;
                        PlotSettings settings = trSource.GetObject(settingsId, OpenMode.ForRead) as PlotSettings;
                        //新建一个打印设置对象
                        PlotSettings newSettings = new PlotSettings(settings.ModelType);
                        newSettings.CopyFrom(settings);//复制打印设置
                        //将新建的打印设置对象添加到目的数据库的打印设置字典中
                        newSettings.AddToPlotSettingsDictionary(destdb);
                        trDest.AddNewlyCreatedDBObject(newSettings, true);
                    }
                    trDest.Commit();
                }
                trSource.Commit();
            }
        }
    }
}
﻿using System;
using System.Diagnostics;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.EditorInput;
using Autodesk.AutoCAD.Geometry;
using Autodesk.AutoCAD.Runtime;

namespace PointIsInPolyline
{
    public class PointIsInPolyline
    {
        // 测试许多点是否在多段线内部
        [CommandMethod("TestPtInPoly")]
        public void TestPtInPoly()
        {
            // 随机点测试的数量
            int count = 100000;
            //if (GetInputInteger("\n输入需要测试的点数量:", ref count))
            {
                // 提示用户选择一条多段线
                ObjectId polyId = new ObjectId();
                Point3d pt = new Point3d();
                if (PromptSelectEntity("\n选择需要进行测试的多段线:", ref polyId, ref pt))
                {
                    Database db = HostApplicationServices.WorkingDatabase;
                    using (Transaction trans = db.TransactionManager.StartTransaction())
                    {
                        Polyline poly = trans.GetObject(polyId, OpenMode.ForWrite) as Polyline;
                        if (poly != null)
                        {
                            BlockTable bt = (BlockTable)trans.GetObject(db.BlockTableId, OpenMode.ForRead);
                            BlockTableRecord btr = (BlockTableRecord)trans.GetObject(bt[BlockTableRecord.ModelSpace], OpenMode.ForWrite);

                            // 在多段线包围框范围内随机生成点，测试点和多段线的位置关系
                            Extents3d ext = poly.GeometricExtents;
                            double margin = 10;
                            double xmin = ext.MinPoint.X - margin;
                            double ymin = ext.MinPoint.Y - margin;
                            double xSpan = ext.MaxPoint.X - ext.MinPoint.X + 2 * margin;
                            double ySpan = ext.MaxPoint.Y - ext.MinPoint.Y + 2 * margin;

                            for (int i = 0; i < count; i++)
                            {
                                Random rand = new Random(GetRandomSeed());
                                int xRand = rand.Next();
                                int yRand = rand.Next();
                                Point2d ptTest = new Point2d(xmin + (Convert.ToDouble(xRand) / int.MaxValue) * xSpan,
                                    ymin + (Convert.ToDouble(yRand) / int.MaxValue) * ySpan);
                                int relation = PtRelationToPoly(poly, ptTest, 1.0E-4);

                                DBPoint dbPoint = new DBPoint(ToPoint3d(ptTest));
                                switch (relation)
                                {
                                    case -1:
                                        dbPoint.ColorIndex = 1;
                                        break;
                                    case 0:
                                        dbPoint.ColorIndex = 5;
                                        break;
                                    case 1:
                                        dbPoint.ColorIndex = 6;
                                        break;
                                    default:
                                        break;
                                }
                                btr.AppendEntity(dbPoint);
                                trans.AddNewlyCreatedDBObject(dbPoint, true);
                            }

                            trans.Commit();
                        }
                        else
                        {
                            Editor ed = Autodesk.AutoCAD.ApplicationServices.Application.DocumentManager.MdiActiveDocument.Editor;
                            ed.WriteMessage("\n选择的实体不是多段线.");
                        }
                    }
                }
            }
        }

        // 获得随机数种子
        static int GetRandomSeed()
        {
            byte[] bytes = new byte[4];
            System.Security.Cryptography.RNGCryptoServiceProvider rng = new System.Security.Cryptography.RNGCryptoServiceProvider();
            rng.GetBytes(bytes);

            return BitConverter.ToInt32(bytes, 0);
        }

        // 判断点和多段线的位置关系
        // 返回值：-1表示在多段线外部，0表示在多段线上，1表示在多段线内部
        private int PtRelationToPoly(Polyline pPoly, Point2d pt, double tol)
        {
            Debug.Assert(pPoly != null);

            // 1.如果点到多段线的最近点和给定的点重合，表示点在多段线上
            Point3d closestPoint = pPoly.GetClosestPointTo(ToPoint3d(pt, pPoly.Elevation), false);		// 多段线上与给定点距离最近的点	
            if (Math.Abs(closestPoint.X - pt.X) < tol && Math.Abs(closestPoint.Y - pt.Y) < tol)			// 点在多段线上
            {
                return 0;
            }

            // 2.第一个射线的方向是从最近点到当前点，起点是当前点
            Ray pRay = new Ray();
            pRay.BasePoint = new Point3d(pt.X, pt.Y, pPoly.Elevation);
            // 射线的起点是pt，方向为从最近点到pt，如果反向做判断，则最近点距离pt太近的时候，最近点也会被作为一个交点（这个交点不太容易被排除掉）
            // 此外，这样的射线方向很容易判断出点不在内部的情况
            Vector3d vec = new Vector3d(-(closestPoint.X - pt.X), -(closestPoint.Y - pt.Y), 0);
            pRay.UnitDir = vec;

            // 3.射线与多段线计算交点
            Point3dCollection intPoints = new Point3dCollection();
            
            pPoly.IntersectWith(pRay, Intersect.OnBothOperands, intPoints, 0, 0);
            // IntersectWith函数经常会得到很近的交点，这些点必须进行过滤
            FilterEqualPoints(intPoints, 1.0E-4);

            // 4.判断点和多段线的位置关系
        RETRY:
            Point3d[] pts = new Point3d[10];		//////////////////////////////////////////////////////////////////////////
            if (intPoints.Count > 0)
            {
                pts[0] = intPoints[0];
            }
            if (intPoints.Count > 1)
            {
                pts[1] = intPoints[1];
            }
            if (intPoints.Count > 2)
            {
                pts[2] = intPoints[2];
            }
            if (intPoints.Count > 3)
            {
                pts[3] = intPoints[3];
            }
            // 4.1 如果射线和多段线没有交点，表示点在多段线的外部
            if (intPoints.Count == 0)
            {
                pRay.Dispose();
                return -1;
            }
            else
            {
                // 3.1 过滤掉由于射线被反向延长带来的影响
                FilterEqualPoints(intPoints, ToPoint2d(closestPoint), 1.0E-4);		// 2008-0907修订记录：当pt距离最近点比较近的时候，最近点竟然被作为一个交点！
                // 3.2 如果某个交点与最近点在给定点的同一方向，要去掉这个点（这个点明显不是交点，还是由于intersectwith函数的Bug）	
                for (int i = intPoints.Count - 1; i >= 0; i--)
                {
                    if ((intPoints[i].X - pt.X) * (closestPoint.X - pt.X) >= 0 &&
                        (intPoints[i].Y - pt.Y) * (closestPoint.Y - pt.Y) >= 0)
                    {
                        intPoints.RemoveAt(i);
                    }
                }

                int count = intPoints.Count;
                for (int i = 0; i < intPoints.Count; i++)
                {
                    if (PointIsPolyVert(pPoly, ToPoint2d(intPoints[i]), 1.0E-4))		// 只要有交点是多段线的顶点就重新进行判断
                    {
                        // 处理给定点很靠近多段线顶点的情况(如果与顶点距离很近，就认为这个点在多段线上，因为这种情况没有什么好的判断方法)
                        if (PointIsPolyVert(pPoly, new Point2d(pt.X, pt.Y), 1.0E-4))
                        {
                            return 0;
                        }

                        // 将射线旋转一个极小的角度(2度)再次判断（假定这样不会再通过上次判断到的顶点）
                        vec = vec.RotateBy(0.035, Vector3d.ZAxis);
                        pRay.UnitDir = vec;
                        intPoints.Clear();
                        pPoly.IntersectWith(pRay, Intersect.OnBothOperands, intPoints, 0, 0);
                        goto RETRY;		// 继续判断结果
                    }
                }

                pRay.Dispose();

                if (count % 2 == 0)
                {
                    return -1;
                }
                else
                {
                    return 1;
                }
            }
        }

        // 三维点转二维点
        private static Point2d ToPoint2d(Point3d point3d)
        {
            return new Point2d(point3d.X, point3d.Y);
        }

        // 二维点转三维点
        private static Point3d ToPoint3d(Point2d point2d)
        {
            return new Point3d(point2d.X, point2d.Y, 0);
        }

        private static Point3d ToPoint3d(Point2d point2d, double elevation)
        {
            return new Point3d(point2d.X, point2d.Y, elevation);
        }

        // 从点数组中删除与给定点平面位置重合的点
        // tol: 判断点重合时的精度（两点之间的距离小于tol认为这两个点重合）
        static void FilterEqualPoints(Point3dCollection points, Point2d pt, double tol)
        {
            Point3dCollection tempPoints = new Point3dCollection();
            for (int i = 0; i < points.Count; i++)
            {
                if (ToPoint2d(points[i]).GetDistanceTo(pt) > tol)
                {
                    tempPoints.Add(points[i]);
                }
            }

            points = tempPoints;
        }

        // 从点数组中删除与其他点重合的点
        static void FilterEqualPoints(Point3dCollection points, double tol)
        {
            for (int i = points.Count - 1; i > 0; i--)
            {
                for (int j = 0; j < i; j++)
                {
                    if (IsEqual(points[i].X, points[j].X, tol) && IsEqual(points[i].Y, points[j].Y, tol))
                    {
                        points.RemoveAt(i);
                        break;
                    }
                }
            }
        }

        // 点是否是多段线的顶点
        static bool PointIsPolyVert(Polyline pPoly, Point2d pt, double tol)
        {
            for (int i = 0; i < pPoly.NumberOfVertices; i++)
            {
                Point3d vert = pPoly.GetPoint3dAt(i);

                if (IsEqual(ToPoint2d(vert), pt, tol))
                {
                    return true;
                }
            }

            return false;
        }

        // 二维点是否相同
        static bool IsEqual(Point2d firstPoint, Point2d secondPoint, double tol)
        {
            return (Math.Abs(firstPoint.X - secondPoint.X) < tol && Math.Abs(firstPoint.Y - secondPoint.Y) < tol);
        }

        // 两个实数是否相等
        static bool IsEqual(double a, double b, double tol)
        {
            return (Math.Abs(a - b) < tol);
        }

        // 提示用户选择一个实体
        public static bool PromptSelectEntity(string prompt, ref ObjectId entId, ref Point3d pt)
        {
            Editor ed = Autodesk.AutoCAD.ApplicationServices.Application.DocumentManager.MdiActiveDocument.Editor;
            PromptEntityOptions peo = new PromptEntityOptions(prompt);
            PromptEntityResult per = ed.GetEntity(peo);
            if (per.Status == PromptStatus.OK)
            {
                pt = per.PickedPoint;
                entId = per.ObjectId;
                return true;
            }
            else
            {
                return false;
            }
        }

        // 提示用户输入整数
        public static bool GetInputInteger(string prompt, ref int val)
        {
            Editor ed = Autodesk.AutoCAD.ApplicationServices.Application.DocumentManager.MdiActiveDocument.Editor;
            PromptIntegerOptions pio = new PromptIntegerOptions(prompt);
            pio.LowerLimit = 1;
            pio.UpperLimit = 1000000;
            PromptIntegerResult pir = ed.GetInteger(pio);
            if (pir.Status == PromptStatus.OK)
            {
                val = pir.Value;
                return true;
            }
            else
            {
                return false;
            }
        }
    }
}
﻿using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.Geometry;
using Autodesk.AutoCAD.Runtime;
using DotNetARX;
namespace Polylines
{
    public class Polylines
    {
        [CommandMethod("AddPolyline")]
        public void AddPolyline()
        {
            Database db=HostApplicationServices.WorkingDatabase;
            using (Transaction trans=db.TransactionManager.StartTransaction())
            {
                Point2d startPoint=Point2d.Origin;
                Point2d endPoint=new Point2d(100, 100);
                Point2d pt=new Point2d(60, 70);
                Point2d center=new Point2d(50, 50);
                //创建直线
                Polyline pline=new Polyline();
                pline.CreatePolyline(startPoint, endPoint);
                //创建矩形
                Polyline rectangle=new Polyline();
                rectangle.CreateRectangle(pt, endPoint);
                //创建正六边形
                Polyline polygon=new Polyline();
                polygon.CreatePolygon(Point2d.Origin, 6, 30);
                //创建半径为30的圆
                Polyline circle=new Polyline();
                circle.CreatePolyCircle(center, 30);
                //创建圆弧，起点角度为45度，终点角度为225度
                Polyline arc=new Polyline();
                double startAngle=45;
                double endAngle=225;
                arc.CreatePolyArc(center, 50, startAngle.DegreeToRadian(), endAngle.DegreeToRadian());
                //添加对象到模型空间
                db.AddToModelSpace(pline, rectangle, polygon, circle, arc);
                trans.Commit();
            }
        }
    }
}
﻿using System;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.Geometry;

namespace DotNetARX
{
    /// <summary>
    /// 多段线操作类
    /// </summary>
    public static class PolylineTools
    {
        /// <summary>
        /// 通过三维点集合创建多段线
        /// </summary>
        /// <param name="pline">多段线对象</param>
        /// <param name="pts">多段线的顶点</param>
        public static void CreatePolyline(this Polyline pline, Point3dCollection pts)
        {
            for (int i = 0; i < pts.Count; i++)
            {
                //添加多段线的顶点
                pline.AddVertexAt(i, new Point2d(pts[i].X, pts[i].Y), 0, 0, 0);
            }
        }

        /// <summary>
        /// 通过二维点集合创建多段线
        /// </summary>
        /// <param name="pline">多段线对象</param>
        /// <param name="pts">多段线的顶点</param>
        public static void CreatePolyline(this Polyline pline, Point2dCollection pts)
        {
            for (int i = 0; i < pts.Count; i++)
            {
                //添加多段线的顶点
                pline.AddVertexAt(i, pts[i], 0, 0, 0);
            }
        }

        /// <summary>
        /// 通过不固定的点创建多段线
        /// </summary>
        /// <param name="pline">多段线对象</param>
        /// <param name="pts">多段线的顶点</param>
        public static void CreatePolyline(this Polyline pline, params Point2d[] pts)
        {
            pline.CreatePolyline(new Point2dCollection(pts));
        }

        /// <summary>
        /// 创建矩形
        /// </summary>
        /// <param name="pline">多段线对象</param>
        /// <param name="pt1">矩形的角点</param>
        /// <param name="pt2">矩形的角点</param>
        public static void CreateRectangle(this Polyline pline, Point2d pt1, Point2d pt2)
        {
            //设置矩形的4个顶点
            double minX = Math.Min(pt1.X, pt2.X);
            double maxX = Math.Max(pt1.X, pt2.X);
            double minY = Math.Min(pt1.Y, pt2.Y);
            double maxY = Math.Max(pt1.Y, pt2.Y);
            Point2dCollection pts = new Point2dCollection();
            pts.Add(new Point2d(minX, minY));
            pts.Add(new Point2d(minX, maxY));
            pts.Add(new Point2d(maxX, maxY));
            pts.Add(new Point2d(maxX, minY));
            pline.CreatePolyline(pts);
            pline.Closed = true;//闭合多段线以形成矩形
        }

        /// <summary>
        /// 创建多边形
        /// </summary>
        /// <param name="pline">多段线对象</param>
        /// <param name="centerPoint">多边形中心点</param>
        /// <param name="number">边数</param>
        /// <param name="radius">外接圆半径</param>
        public static void CreatePolygon(this Polyline pline, Point2d centerPoint, int number, double radius)
        {
            Point2dCollection pts = new Point2dCollection(number);
            double angle = 2 * Math.PI / number;//计算每条边对应的角度
            //计算多边形的顶点
            for (int i = 0; i < number; i++)
            {
                Point2d pt = new Point2d(centerPoint.X + radius * Math.Cos(i * angle), centerPoint.Y + radius * Math.Sin(i * angle));
                pts.Add(pt);
            }
            pline.CreatePolyline(pts);
            pline.Closed = true;//闭合多段线以形成多边形
        }

        /// <summary>
        /// 创建多段线形式的圆
        /// </summary>
        /// <param name="pline">多段线对象</param>
        /// <param name="centerPoint">圆心</param>
        /// <param name="radius">半径</param>
        public static void CreatePolyCircle(this Polyline pline, Point2d centerPoint, double radius)
        {
            //计算多段线的顶点
            Point2d pt1 = new Point2d(centerPoint.X + radius, centerPoint.Y);
            Point2d pt2 = new Point2d(centerPoint.X - radius, centerPoint.Y);
            Point2d pt3 = new Point2d(centerPoint.X + radius, centerPoint.Y);
            Point2dCollection pts = new Point2dCollection();
            //添加多段线的顶点
            pline.AddVertexAt(0, pt1, 1, 0, 0);
            pline.AddVertexAt(1, pt2, 1, 0, 0);
            pline.AddVertexAt(2, pt3, 1, 0, 0);
            pline.Closed = true;//闭合曲线以形成圆
        }

        /// <summary>
        /// 创建多段线形式的圆弧
        /// </summary>
        /// <param name="pline">多段线对象</param>
        /// <param name="centerPoint">圆弧的圆心</param>
        /// <param name="radius">圆弧的半径</param>
        /// <param name="startAngle">起始角度</param>
        /// <param name="endAngle">终止角度</param>
        public static void CreatePolyArc(this Polyline pline, Point2d centerPoint, double radius, double startAngle, double endAngle)
        {
            //计算多段线的顶点
            Point2d pt1 = new Point2d(centerPoint.X + radius * Math.Cos(startAngle),
                                    centerPoint.Y + radius * Math.Sin(startAngle));
            Point2d pt2 = new Point2d(centerPoint.X + radius * Math.Cos(endAngle),
                                    centerPoint.Y + radius * Math.Sin(endAngle));
            //添加多段线的顶点
            pline.AddVertexAt(0, pt1, Math.Tan((endAngle - startAngle) / 4), 0, 0);
            pline.AddVertexAt(1, pt2, 0, 0, 0);
        }
    }
}
﻿using System;
using System.Collections.Generic;
using System.Linq;
using System.Windows.Forms;

namespace AutoNetLoad
{
    static class Program
    {
        /// <summary>
        /// 应用程序的主入口点。
        /// </summary>
        [STAThread]
        static void Main()
        {
            Application.EnableVisualStyles();
            Application.SetCompatibleTextRenderingDefault(false);
            Application.Run(new FormAutoLoad());
        }
    }
}
﻿using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using Autodesk.AutoCAD.Runtime;

namespace DotNetARX
{
    /// <summary>
    /// 进度条管理类，可以解决常规进度条显示闪烁的问题
    /// </summary>
    public class ProgressManager : IDisposable
    {
        //更新进度条的次数，由于一些特殊原因，你必须把它设置为600
        const int progressMeterIncrements = 600;
        private ProgressMeter pm;//进度条对象
        private long updateIncrement;//进度条需要更新的增量，即更新一次需要多少进度
        private long currentInc;//当前进度

        /// <summary>
        /// 构造函数
        /// </summary>
        /// <param name="message">进度条的显示信息</param>
        public ProgressManager(string message)
        {
            pm = new ProgressMeter();//新建一个进度条
            pm.Start(message);//进度条开始
            //设置进度条需要更新的次数
            pm.SetLimit(progressMeterIncrements);
            //设置当前进度为0
            currentInc = 0;
        }

        /// <summary>
        /// 程序结束时调用的函数，用以释放资源
        /// </summary>
        public void Dispose()
        {
            pm.Stop();//停止进度条的更新
            pm.Dispose();//销毁进度条对象
        }

        /// <summary>
        /// 设置进度条需要更新，一般为循环次数
        /// </summary>
        /// <param name="totalOps">循环次数</param>
        public void SetTotalOperations(long totalOps)
        {
            // 设置进度条需要更新的增量
            updateIncrement =
              (totalOps > progressMeterIncrements ?
                totalOps / progressMeterIncrements :
                totalOps
              );
        }

        /// <summary>
        /// 当进度增量达到需要更新的量时，则更新进度条
        /// </summary>
        public void Tick()
        {
            //当进度增量达到需要更新的量时，则更新进度条
            if (++currentInc == updateIncrement)
            {
                pm.MeterProgress();//更新进度条
                currentInc = 0;//更新完毕，重置进度增量为0
                //让AutoCAD在长时间任务处理时仍然能接收消息
                System.Windows.Forms.Application.DoEvents();
            }
        }

    }
}
﻿using System.Windows.Forms;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.EditorInput;
using Autodesk.AutoCAD.Internal;
using Autodesk.AutoCAD.Runtime;
using DotNetARX;
using AcadApp = Autodesk.AutoCAD.ApplicationServices.Application;
namespace ProgessMeters
{
    public class ProgessMeters
    {
[CommandMethod("ProgressUtils")]
public void ProgressUtils()
{
    Database db=HostApplicationServices.WorkingDatabase;
            
    Editor ed=AcadApp.DocumentManager.MdiActiveDocument.Editor;
    //创建消息过滤类
    MessageFilter filter=new MessageFilter();
    //为程序添加消息过滤
    System.Windows.Forms.Application.AddMessageFilter(filter);
    bool esc=false;//标识是否按下了Esc键
    using (Transaction trans=db.TransactionManager.StartTransaction())
    {
        // 获取模型空间中所有的点对象
        var points=db.GetEntsInModelSpace<DBPoint>();
        //进度条开始工作并设置进度条前要显示的提示文字
        Utils.SetApplicationStatusBarProgressMeter("更改点的颜色", 0, points.Count);
        for (int i = 0; i < points.Count; i++)
        {
            //设置进度
            Utils.SetApplicationStatusBarProgressMeter(i);
            points[i].UpgradeOpen();//切换点对象的状态为写
            points[i].ColorIndex = 2;//设置点对象的颜色为黄色            
            //如果用户按下了Esc键，则结束遍历
            if (filter.KeyName == Keys.Escape)
            {
                esc = true;
                break;
            }
            //让AutoCAD在长时间任务处理时仍然能接收消息
            System.Windows.Forms.Application.DoEvents();
        }
        Utils.RestoreApplicationStatusBar();//恢复状态栏
        if (esc) trans.Abort();//如果按下了Esc键，则放弃所有的更改
        else trans.Commit(); //否则程序能完成所有点的变色工作，提交事务处理
    }
    //移除对按键消息的过滤
    System.Windows.Forms.Application.RemoveMessageFilter(filter);
}
[CommandMethod("Progress")]
public void Progress()
{
    Database db=HostApplicationServices.WorkingDatabase;
    Editor ed=AcadApp.DocumentManager.MdiActiveDocument.Editor;
    //设置进度条对象
    ProgressMeter pm=new ProgressMeter();
    //创建消息过滤类
    MessageFilter filter=new MessageFilter();
    //为程序添加消息过滤
    System.Windows.Forms.Application.AddMessageFilter(filter);
    bool esc=false;//标识是否按下了Esc键
    using (Transaction trans=db.TransactionManager.StartTransaction())
    {
        // 获取模型空间中所有的点对象
        var points=db.GetEntsInModelSpace<DBPoint>();
        //进度条开始工作并设置进度条前要显示的提示文字
        pm.Start("更改点的颜色");
        //设置进度条需要更新的次数
        pm.SetLimit(points.Count);
        foreach (var point in points)//遍历点
        {
            pm.MeterProgress();//更新进度条
            point.UpgradeOpen();//切换点对象的状态为写
            point.ColorIndex = 1;//设置点对象的颜色为红色
            //如果用户按下了Esc键，则结束遍历
            if (filter.KeyName == Keys.Escape)
            {
                esc = true;
                break;
            }
            //让AutoCAD在长时间任务处理时仍然能接收消息
            System.Windows.Forms.Application.DoEvents();
        }
        pm.Stop();//停止进度条的更新
        if (esc) trans.Abort();//如果按下了Esc键，则放弃所有的更改
        else trans.Commit(); //否则程序能完成所有点的变色工作，提交事务处理
    }
    //移除对按键消息的过滤
    System.Windows.Forms.Application.RemoveMessageFilter(filter);
}
[CommandMethod("ProgressManager")]
public void TestProgressManager()
{
    Database db=HostApplicationServices.WorkingDatabase;
    Editor ed=AcadApp.DocumentManager.MdiActiveDocument.Editor;
    //创建消息过滤类
    MessageFilter filter=new MessageFilter();
    //为程序添加消息过滤
    System.Windows.Forms.Application.AddMessageFilter(filter);
    bool esc=false;//标识是否按下了Esc键
    //开始事务处理并新建一个进度条管理类
    using (Transaction trans=db.TransactionManager.StartTransaction())
    using (ProgressManager manager=new ProgressManager("更改点的颜色"))
    {
        // 获取模型空间中所有的点对象
        var points=db.GetEntsInModelSpace<DBPoint>();
        //设置进度条需要更新的次数，一般为循环次数
        manager.SetTotalOperations(points.Count);
        foreach (var point in points)//遍历点
        {
            manager.Tick();//进度条更新进度
            point.UpgradeOpen();//切换点对象的状态为写
            point.ColorIndex = 3;//设置点对象的颜色为绿色
            //如果用户按下了Esc键，则结束遍历
            if (filter.KeyName == Keys.Escape)
            {
                esc = true;
                break;
            }
        }
        if (esc) trans.Abort();//如果按下了Esc键，则放弃所有的更改
        else trans.Commit(); //否则程序能完成所有点的变色工作，提交事务处理
    }
    //移除对按键消息的过滤
    System.Windows.Forms.Application.RemoveMessageFilter(filter);
}
    }
}
﻿using System.Collections.Generic;
using System.Linq;
using Autodesk.AutoCAD.ApplicationServices;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.EditorInput;
using Autodesk.AutoCAD.Geometry;
using Autodesk.AutoCAD.Runtime;
using DotNetARX;
namespace Regions
{
    public class Regions
    {
        [CommandMethod("AddRegion")]
        public void AddRegion()
        {
            Database db=HostApplicationServices.WorkingDatabase;
            using (Transaction trans=db.TransactionManager.StartTransaction())
            {
                //创建一个三角形
                Polyline triangle=new Polyline();
                triangle.CreatePolygon(new Point2d(550, 200), 3, 30);
                //根据三角形创建面域
                List<Region> regions=RegionTools.CreateRegion(triangle);
                if (regions.Count == 0) return;//如果面域创建未成功，则返回
                Region region=regions[0];
                db.AddToModelSpace(region);//将创建的面域添加到数据库中
                //获取面域的质量特性
                getAreaProp(region);
                trans.Commit();//提交更改
            }
        }

        [CommandMethod("AddComplexRegion")]
        public void AddComplexRegion()
        {
            Database db = HostApplicationServices.WorkingDatabase;
            using (Transaction trans = db.TransactionManager.StartTransaction())
            {
                //创建一个正六边形
                Polyline polygon=new Polyline();
                polygon.CreatePolygon(new Point2d(500, 200), 6, 30);
                //创建一个圆
                Circle circle=new Circle();
                circle.Center = new Point3d(500, 200, 0);
                circle.Radius = 10;
                //根据正六边形和圆创建面域
                List<Region> regions=RegionTools.CreateRegion(polygon, circle);
                if (regions.Count == 0) return;//如果面域创建未成功，则返回
                //使用LINQ按面积对面域进行排序
                List<Region> orderRegions=(from r in regions
                                           orderby r.Area
                                           select r).ToList();
                //对面域进行布尔操作，获取正六边形减去圆后的部分
                orderRegions[1].BooleanOperation(BooleanOperationType.BoolSubtract, orderRegions[0]);
                db.AddToModelSpace(regions[1]);//将上面操作好的面域添加到数据库中            
                trans.Commit();//提交更改
            }
        }

        private void getAreaProp(Region region)
        {
            Editor ed=Application.DocumentManager.MdiActiveDocument.Editor;
            ed.WriteMessage("\n ----------------    面域   ----------------");
            ed.WriteMessage("\n面积:{0} ", region.Area);
            ed.WriteMessage("\n周长:{0} ", region.Perimeter);
            ed.WriteMessage("\n边界框上限:{0} ", region.GetExtentsHigh());
            ed.WriteMessage("\n边界框下限:{0} ", region.GetExtentsLow());
            ed.WriteMessage("\n质心: {0} ", region.GetCentroid());
            ed.WriteMessage("\n惯性矩为: {0}; {1} ", region.GetMomInertia()[0], region.GetMomInertia()[1]);
            ed.WriteMessage("\n惯性积为: {0} ", region.GetProdInertia());
            ed.WriteMessage("\n主力矩为: {0}; {1} ", region.GetPrinMoments()[0], region.GetPrinMoments()[1]);
            ed.WriteMessage("\n主方向为: {0}; {1} ", region.GetPrinAxes()[0], region.GetPrinAxes()[1]);
            ed.WriteMessage("\n旋转半径为: {0}; {1} ", region.GetRadiiGyration()[0], region.GetRadiiGyration()[1]);
        }
    }
}
﻿using System;
using System.Collections.Generic;
using System.Runtime.InteropServices;
using Autodesk.AutoCAD.ApplicationServices;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.EditorInput;
using Autodesk.AutoCAD.Geometry;
using Autodesk.AutoCAD.Runtime;

namespace DotNetARX
{
    /// <summary>
    /// 面域操作类
    /// </summary>
    public static class RegionTools
    {
        #region 面域特性
        [DllImport("acdb17.dll", CallingConvention = CallingConvention.ThisCall, EntryPoint = "?getAreaProp@AcDbRegion@@UBE?AW4ErrorStatus@Acad@@ABVAcGePoint3d@@ABVAcGeVector3d@@1AAN2AAVAcGePoint2d@@QAN24QAVAcGeVector2d@@433@Z")]
        private static extern ErrorStatus getAreaProp(IntPtr region,
                                                ref Point3d origin,
                                                ref Vector3d xAxis,
                                                ref Vector3d yAxis,
                                                out double perimeter,
                                                out double area,
                                                out Point2d centroid,
                                                double[] momInertia,
                                                out double prodInertia,
                                                double[] prinMoments,
                                                Vector2d[] prinAxes,
                                                double[] radiiGyration,
                                                out Point2d extentsLow,
                                                out Point2d extentsHigh);
        static double perimeter;
        static double area;
        static Point2d centroid;
        static double[] momInertia=new double[2];
        static double prodInertia;
        static double[] prinMoments=new double[2];
        static Vector2d[] prinAxes=new Vector2d[2];
        static double[] radiiGyration=new double[2];
        static Point2d extentsLow;
        static Point2d extentsHigh;
        /// <summary>
        /// 获取面域的质心
        /// </summary>
        /// <param name="region">面域对象</param>
        /// <returns>返回质心的坐标</returns>
        public static Point2d GetCentroid(this Region region)
        {
            Editor ed = Application.DocumentManager.MdiActiveDocument.Editor;
            CoordinateSystem3d coord= ed.CurrentUserCoordinateSystem.CoordinateSystem3d;
            Point3d origin=coord.Origin;
            Vector3d xAxis=coord.Xaxis;
            Vector3d yAxis=coord.Yaxis;
            getAreaProp(region.UnmanagedObject, ref origin, ref xAxis, ref yAxis, out perimeter, out area, out centroid,
                       momInertia, out prodInertia, prinMoments, prinAxes, radiiGyration, out extentsLow, out extentsHigh);
            return centroid;
        }
        /// <summary>
        /// 获取面域的惯性矩
        /// </summary>
        /// <param name="region">面域对象</param>
        /// <returns>返回惯性矩</returns>
        public static double[] GetMomInertia(this Region region)
        {
            Editor ed = Application.DocumentManager.MdiActiveDocument.Editor;
            CoordinateSystem3d coord= ed.CurrentUserCoordinateSystem.CoordinateSystem3d;
            Point3d origin=coord.Origin;
            Vector3d xAxis=coord.Xaxis;
            Vector3d yAxis=coord.Yaxis;
            getAreaProp(region.UnmanagedObject, ref origin, ref xAxis, ref yAxis, out perimeter, out area, out centroid,
                       momInertia, out prodInertia, prinMoments, prinAxes, radiiGyration, out extentsLow, out extentsHigh);
            return momInertia;
        }
        /// <summary>
        /// 获取面域的惯性积
        /// </summary>
        /// <param name="region">面域对象</param>
        /// <returns>返回惯性积</returns>
        public static double GetProdInertia(this Region region)
        {
            Editor ed = Application.DocumentManager.MdiActiveDocument.Editor;
            CoordinateSystem3d coord= ed.CurrentUserCoordinateSystem.CoordinateSystem3d;
            Point3d origin=coord.Origin;
            Vector3d xAxis=coord.Xaxis;
            Vector3d yAxis=coord.Yaxis;
            getAreaProp(region.UnmanagedObject, ref origin, ref xAxis, ref yAxis, out perimeter, out area, out centroid,
                       momInertia, out prodInertia, prinMoments, prinAxes, radiiGyration, out extentsLow, out extentsHigh);
            return prodInertia;
        }
        /// <summary>
        /// 获取面域的主力矩
        /// </summary>
        /// <param name="region">面域对象</param>
        /// <returns>返回主力矩</returns>
        public static double[] GetPrinMoments(this Region region)
        {
            Editor ed = Application.DocumentManager.MdiActiveDocument.Editor;
            CoordinateSystem3d coord= ed.CurrentUserCoordinateSystem.CoordinateSystem3d;
            Point3d origin=coord.Origin;
            Vector3d xAxis=coord.Xaxis;
            Vector3d yAxis=coord.Yaxis;
            getAreaProp(region.UnmanagedObject, ref origin, ref xAxis, ref yAxis, out perimeter, out area, out centroid,
                       momInertia, out prodInertia, prinMoments, prinAxes, radiiGyration, out extentsLow, out extentsHigh);
            return prinMoments;
        }
        /// <summary>
        /// 获取面域的主方向
        /// </summary>
        /// <param name="region">面域对象</param>
        /// <returns>返回主方向</returns>
        public static Vector2d[] GetPrinAxes(this Region region)
        {
            Editor ed = Application.DocumentManager.MdiActiveDocument.Editor;
            CoordinateSystem3d coord= ed.CurrentUserCoordinateSystem.CoordinateSystem3d;
            Point3d origin=coord.Origin;
            Vector3d xAxis=coord.Xaxis;
            Vector3d yAxis=coord.Yaxis;
            getAreaProp(region.UnmanagedObject, ref origin, ref xAxis, ref yAxis, out perimeter, out area, out centroid,
                       momInertia, out prodInertia, prinMoments, prinAxes, radiiGyration, out extentsLow, out extentsHigh);
            return prinAxes;
        }
        /// <summary>
        /// 获取面域的旋转半径
        /// </summary>
        /// <param name="region">面域对象</param>
        /// <returns>返回旋转半径</returns>
        public static double[] GetRadiiGyration(this Region region)
        {
            Editor ed = Application.DocumentManager.MdiActiveDocument.Editor;
            CoordinateSystem3d coord= ed.CurrentUserCoordinateSystem.CoordinateSystem3d;
            Point3d origin=coord.Origin;
            Vector3d xAxis=coord.Xaxis;
            Vector3d yAxis=coord.Yaxis;
            getAreaProp(region.UnmanagedObject, ref origin, ref xAxis, ref yAxis, out perimeter, out area, out centroid,
                       momInertia, out prodInertia, prinMoments, prinAxes, radiiGyration, out extentsLow, out extentsHigh);
            return radiiGyration;
        }
        /// <summary>
        /// 获取面域边界框的下限
        /// </summary>
        /// <param name="region">面域对象</param>
        /// <returns>返回边界框的下限</returns>
        public static Point2d GetExtentsLow(this Region region)
        {
            Editor ed = Application.DocumentManager.MdiActiveDocument.Editor;
            CoordinateSystem3d coord= ed.CurrentUserCoordinateSystem.CoordinateSystem3d;
            Point3d origin=coord.Origin;
            Vector3d xAxis=coord.Xaxis;
            Vector3d yAxis=coord.Yaxis;
            getAreaProp(region.UnmanagedObject, ref origin, ref xAxis, ref yAxis, out perimeter, out area, out centroid,
                       momInertia, out prodInertia, prinMoments, prinAxes, radiiGyration, out extentsLow, out extentsHigh);
            return extentsLow;
        }
        /// <summary>
        /// 获取面域边界框的上限
        /// </summary>
        /// <param name="region">面域对象</param>
        /// <returns>返回边界框的上限</returns>
        public static Point2d GetExtentsHigh(this Region region)
        {
            Editor ed = Application.DocumentManager.MdiActiveDocument.Editor;
            CoordinateSystem3d coord= ed.CurrentUserCoordinateSystem.CoordinateSystem3d;
            Point3d origin=coord.Origin;
            Vector3d xAxis=coord.Xaxis;
            Vector3d yAxis=coord.Yaxis;
            getAreaProp(region.UnmanagedObject, ref origin, ref xAxis, ref yAxis, out perimeter, out area, out centroid,
                       momInertia, out prodInertia, prinMoments, prinAxes, radiiGyration, out extentsLow, out extentsHigh);
            return extentsHigh;
        } 
        #endregion

        /// <summary>
        /// 根据曲线创建面域
        /// </summary>
        /// <param name="curves">曲线</param>
        /// <returns>返回创建的面域列表</returns>
        public static List<Region> CreateRegion(params Curve[] curves)
        {
            //新建面域列表，存储创建的面域
            List<Region> regionList=new List<Region>();
            //将可变数组转化为集合类，用于面域的创建
            DBObjectCollection curveCollection=new DBObjectCollection();
            foreach (Curve curve in curves)//遍历曲线
            {
                //如果曲线已经被加入到数据库且为写的状态，则返回
                if (!curve.IsNewObject && curve.IsWriteEnabled)
                    return null;
                curveCollection.Add(curve);//将曲线添加到集合中
            }
            try
            {
                //根据曲线集合，在内存中创建面域对象集合
                DBObjectCollection regionObjs=Region.CreateFromCurves(curveCollection);
                //将面域对象集合复制到面域列表
                foreach (Region region in regionObjs)
                {
                    regionList.Add(region);
                }
                return regionList;
            }
            catch //面域创建失败
            {
                regionList.Clear();//清空面域列表
                return regionList;//返回空的面域列表
            }
        }
    }
}
﻿using System.Linq;
using Microsoft.Win32;

namespace DotNetARX
{
    /// <summary>
    /// AutoCAD注册表操作类
    /// </summary>
    public class Register
    {
        /// <summary>
        /// 获取当前AutoCAD的主版本号
        /// </summary>
        /// <returns>返回当前AutoCAD的主版本号</returns>
        public static string GetACDBDLL_NAME()
        {
            // 获取AutoCAD的版本号
            string acadVer = GetAutoCADVersion();
            if (acadVer.Contains("R16"))
            {
                return "R16";
            }
            else if (acadVer.Contains("R17"))
            {
                return "R17";
            }
            else if (acadVer.Contains("R18"))
            {
                return "R18";
            }
            else if (acadVer.Contains("R19"))
            {
                return "R19";
            }
            else
            {
                return null;
            }

        }

        /// <summary>
        /// 获取AutoCAD的注册表键值
        /// </summary>
        /// <returns>返回AutoCAD的注册表键值</returns>
        public static string GetAutoCADKey()
        {
            // 获取当前用户的注册表键值
            RegistryKey hive = Registry.CurrentUser;
            //打开AutoCAD的注册表键值
            RegistryKey ack = hive.OpenSubKey("Software\\Autodesk\\AutoCAD");
            using (ack)
            {
                // 获取AutoCAD主版本的注册表键值
                string ver = ack.GetValue("CurVer") as string;
                if (ver == null)
                {
                    return "";
                }
                else
                {
                    RegistryKey verk = ack.OpenSubKey(ver);
                    using (verk)
                    {
                        // 获取对应语言版本的注册表键值
                        string lng = verk.GetValue("CurVer") as string;
                        if (lng == null)
                        {
                            return "";
                        }
                        else
                        {
                            RegistryKey lngk = verk.OpenSubKey(lng);
                            using (lngk)
                            {
                                // 返回无前缀的注册表键值
                                return lngk.Name.Substring(hive.Name.Length + 1);
                            }
                        }
                    }
                }
            }
        }

        /// <summary>
        /// 获取AutoCAD的版本号
        /// </summary>
        /// <returns></returns>
        public static string GetAutoCADVersion()
        {
            return GetAutoCADKey().Split('\\')[3];
        }

        /// <summary>
        /// 获取AutoCAD所属的注册表键名
        /// </summary>
        /// <returns>返回AutoCAD所属的注册表键名</returns>
        public static string GetAutoCADKeyName()
        {
            // 获取HKEY_CURRENT_USER键
            RegistryKey keyCurrentUser = Registry.CurrentUser;
            // 打开AutoCAD所属的注册表键:HKEY_CURRENT_USER\Software\Autodesk\AutoCAD
            RegistryKey keyAutoCAD = keyCurrentUser.OpenSubKey("Software\\Autodesk\\AutoCAD");
            //获得表示当前的AutoCAD版本的注册表键值:R18.2
            string valueCurAutoCAD = keyAutoCAD.GetValue("CurVer").ToString();
            if (valueCurAutoCAD == null) return "";//如果未安装AutoCAD，则返回
            //获取当前的AutoCAD版本的注册表键:HKEY_LOCAL_MACHINE\Software\Autodesk\AutoCAD\R18.2
            RegistryKey keyCurAutoCAD = keyAutoCAD.OpenSubKey(valueCurAutoCAD);
            //获取表示AutoCAD当前语言的注册表键值:ACAD-a001:804
            string language = keyCurAutoCAD.GetValue("CurVer").ToString();
            //获取AutoCAD当前语言的注册表键:HKEY_LOCAL_MACHINE\Software\Autodesk\AutoCAD\R18.2\ACAD-a001:804
            RegistryKey keyLanguage = keyCurAutoCAD.OpenSubKey(language);
            //返回去除HKEY_LOCAL_MACHINE前缀的当前AutoCAD注册表项的键名:Software\Autodesk\AutoCAD\R18.2\ACAD-a001:804
            return keyLanguage.Name.Substring(keyCurrentUser.Name.Length + 1);
        }

        /// <summary>
        /// 创建自动加载.NET程序所需要的注册表项
        /// </summary>
        /// <param name="appName">.NET程序名</param>
        /// <param name="appDesc">描述程序用途的字符串</param>
        /// <param name="appPath">.NET程序的路径</param>
        /// <param name="currentUser">注册表项是创建在HKEY_CURRENT_USER键下还是HKEY_LOCAL_MACHINE健下</param>
        /// <param name="overwrite">是否覆盖同名的程序</param>
        /// <param name="flagLOADCTRLS">LOADCTRLS键的值，用来描述装载程序的原因</param>
        /// <returns>如果创建注册表项成功则返回true,否则返回false</returns>
        public static bool CreateDemandLoadingEntries(string appName, string appDesc, string appPath, bool currentUser, bool overwrite, int flagLOADCTRLS)
        {
            //获取AutoCAD所属的注册表键名
            var autoCADKeyName = GetAutoCADKeyName();
            //确定是HKEY_CURRENT_USER还是HKEY_LOCAL_MACHINE
            RegistryKey keyRoot = currentUser ? Registry.CurrentUser : Registry.LocalMachine;
            // 由于某些AutoCAD版本的HKEY_CURRENT_USER可能不包括Applications键值，因此要创建该键值
            // 如果已经存在该鍵，无须担心可能的覆盖操作问题，因为CreateSubKey函数会以写的方式打开它而不会执行覆盖操作
            RegistryKey keyApp = keyRoot.CreateSubKey(autoCADKeyName + "\\" + "Applications");
            //若存在同名的程序且选择不覆盖则返回
            if (!overwrite && keyApp.GetSubKeyNames().Contains(appName))
                return false;
            //创建相应的键并设置自动加载应用程序的选项
            RegistryKey keyUserApp = keyApp.CreateSubKey(appName);
            keyUserApp.SetValue("DESCRIPTION", appName, RegistryValueKind.String);
            keyUserApp.SetValue("LOADCTRLS", flagLOADCTRLS, RegistryValueKind.DWord);
            keyUserApp.SetValue("LOADER", appPath, RegistryValueKind.String);
            keyUserApp.SetValue("MANAGED", 1, RegistryValueKind.DWord);
            return true;//创建键成功则返回
        }

        /// <summary>
        /// 删除自动加载.NET程序所需要的注册表项
        /// </summary>
        /// <param name="appName">.NET程序名</param>
        /// <param name="currentUser">注册表项是创建在HKEY_CURRENT_USER键下还是HKEY_LOCAL_MACHINE健下</param>
        /// <returns>如果删除注册表项成功则返回true，否则返回false</returns>
        public static bool RemoveDemandLoadingEntries(string appName, bool currentUser)
        {
            try
            {
                // 获取AutoCAD所属的注册表键名
                string cadName = GetAutoCADKeyName();
                // 确定是HKEY_CURRENT_USER还是HKEY_LOCAL_MACHINE
                RegistryKey keyRoot = currentUser ? Registry.CurrentUser : Registry.LocalMachine;
                // 以写的方式打开Applications注册表键
                RegistryKey keyApp = keyRoot.OpenSubKey(cadName + "\\" + "Applications", true);
                //删除指定名称的注册表键
                keyApp.DeleteSubKeyTree(appName);
            }
            catch
            {
                return false;
            }
            return true;
        }
    }
}
﻿//------------------------------------------------------------------------------
// <auto-generated>
//     此代码由工具生成。
//     运行时版本:4.0.30319.488
//
//     对此文件的更改可能会导致不正确的行为，并且如果
//     重新生成代码，这些更改将会丢失。
// </auto-generated>
//------------------------------------------------------------------------------

namespace Wpfs.Properties {
    using System;
    
    
    /// <summary>
    ///   一个强类型的资源类，用于查找本地化的字符串等。
    /// </summary>
    // 此类是由 StronglyTypedResourceBuilder
    // 类通过类似于 ResGen 或 Visual Studio 的工具自动生成的。
    // 若要添加或移除成员，请编辑 .ResX 文件，然后重新运行 ResGen
    // (以 /str 作为命令选项)，或重新生成 VS 项目。
    [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Resources.Tools.StronglyTypedResourceBuilder", "4.0.0.0")]
    [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
    [global::System.Runtime.CompilerServices.CompilerGeneratedAttribute()]
    internal class Resources {
        
        private static global::System.Resources.ResourceManager resourceMan;
        
        private static global::System.Globalization.CultureInfo resourceCulture;
        
        [global::System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1811:AvoidUncalledPrivateCode")]
        internal Resources() {
        }
        
        /// <summary>
        ///   返回此类使用的缓存的 ResourceManager 实例。
        /// </summary>
        [global::System.ComponentModel.EditorBrowsableAttribute(global::System.ComponentModel.EditorBrowsableState.Advanced)]
        internal static global::System.Resources.ResourceManager ResourceManager {
            get {
                if (object.ReferenceEquals(resourceMan, null)) {
                    global::System.Resources.ResourceManager temp = new global::System.Resources.ResourceManager("Wpfs.Properties.Resources", typeof(Resources).Assembly);
                    resourceMan = temp;
                }
                return resourceMan;
            }
        }
        
        /// <summary>
        ///   使用此强类型资源类，为所有资源查找
        ///   重写当前线程的 CurrentUICulture 属性。
        /// </summary>
        [global::System.ComponentModel.EditorBrowsableAttribute(global::System.ComponentModel.EditorBrowsableState.Advanced)]
        internal static global::System.Globalization.CultureInfo Culture {
            get {
                return resourceCulture;
            }
            set {
                resourceCulture = value;
            }
        }
    }
}
﻿using System;
using System.Windows;
using System.Windows.Media.Imaging;
using Autodesk.AutoCAD.ApplicationServices;
using Autodesk.AutoCAD.Runtime;
using Autodesk.Windows;
using AcadApp = Autodesk.AutoCAD.ApplicationServices.Application;
using WinApp = System.Windows.Application;
namespace Ribbons
{
    public class Ribbons
    {
        //调用资源字典
        ResourceDictionary resourceDictionary=(ResourceDictionary)WinApp.LoadComponent(new Uri("/Ribbons;component/RibbonDictionary.xaml", UriKind.Relative));
        [CommandMethod("AddRibbon")]
        public void AddRibbon()
        {
            RibbonControl control=ComponentManager.Ribbon;//获取Ribbon界面
            RibbonTab tab=new RibbonTab();//创建选项卡
            tab.Title = "C# Ribbon";//设置选项卡的标题
            tab.Id = "ID_TabMyRibbon";//设置选项卡的AutoCAD标识符
            control.Tabs.Add(tab);//将选项卡添加到Ribbon界面中
            addPanel(tab);//为选项卡添加Ribbon面板
            tab.IsActive = true;//设置当前活动选项卡
        }
        [CommandMethod("AddRibbonXAML")]
        public void AddRibbonXAML()
        {
            //获取由XAML定义的选项卡
            RibbonTab tab=resourceDictionary["TabXaml"] as RibbonTab;
            //查找Ribbon按钮并添加命令事件
            RibbonItemCollection items= tab.Panels[0].Source.Items;
            foreach (RibbonItem item in items)
            {
                if (item is RibbonButton)
                    ((RibbonButton)item).CommandHandler = new RibbonCommandHandler();
                else if (item is RibbonRowPanel)
                {
                    RibbonRowPanel row=(RibbonRowPanel)item;
                    foreach (RibbonItem rowItem in row.Items)
                    {
                        if (rowItem is RibbonButton)
                            ((RibbonButton)rowItem).CommandHandler = new RibbonCommandHandler();
                    }
                }
            }
            RibbonControl ribbonControl = ComponentManager.Ribbon;//获取Ribbon界面
            ribbonControl.Tabs.Add(tab);//将选项卡添加到Ribbon界面中
            ribbonControl.ActiveTab = tab;//设置当前活动选项卡
        }
        private void addPanel(RibbonTab tab)
        {
            //创建RibbonPanelSource对象，用来加入Ribbon元素（如按钮）
            RibbonPanelSource sourcePanel=new RibbonPanelSource();
            sourcePanel.Title = "演示";//Ribbon面板的标题
            RibbonPanel ribPanel=new RibbonPanel();//创建Ribbon面板
            ribPanel.Source = sourcePanel;//设置Ribbon面板的内容
            tab.Panels.Add(ribPanel);//将Ribbon面板添加到选项卡中
            RibbonButton buttonLine=new RibbonButton();//创建按钮
            buttonLine.Name = "直线";//按钮名称 
            buttonLine.Text = "直线";//按钮显示的文字
            buttonLine.ShowImage = true;//按钮显示图像
            buttonLine.ShowText = true;//按钮显示文字
            //设置按钮的大小图像
            buttonLine.Image = resourceDictionary["LineImage"] as BitmapImage;
            buttonLine.LargeImage = resourceDictionary["LineImage"] as BitmapImage;
            buttonLine.Size = RibbonItemSize.Large;//以大图像的形式表示按钮
            //按钮文字和图像的方向为竖直
            buttonLine.Orientation = System.Windows.Controls.Orientation.Vertical;
            buttonLine.CommandParameter = "Line ";//设置按钮的命令参数
            //设置按钮的命令处理程序
            buttonLine.CommandHandler = new RibbonCommandHandler();
            RibbonToolTip toolTipLine=new RibbonToolTip();//创建按钮提示
            toolTipLine.Command = "Line";//设置提示中显示的命令名
            toolTipLine.Title = "直线";//设置提示的标题
            toolTipLine.Content = "创建直线段";//设置提示的内容
            //设置提示的附加内容
            toolTipLine.ExpandedContent = "使用Line命令，可以创建一系列连续的直线段。每条线段都是可以单独进行编辑的直线对象。";
            //设置在提示附加内容下显示的图像
            toolTipLine.ExpandedImage = resourceDictionary["TooltipLineImage"] as BitmapImage;
            buttonLine.ToolTip = toolTipLine;//设置“直线”按钮的提示
            //创建“单行文字”按钮
            RibbonButton buttonText=new RibbonButton();
            buttonText.Name = "单行文字";
            buttonText.Text = "文字";
            buttonText.ShowImage = true;
            buttonText.LargeImage = resourceDictionary["TextImage"] as BitmapImage;
            buttonText.Image = resourceDictionary["TextImage"] as BitmapImage;
            buttonText.Size = RibbonItemSize.Large;
            buttonText.CommandParameter = "Text ";
            buttonText.CommandHandler = new RibbonCommandHandler();
            //创建“多行文字”按钮
            RibbonButton buttonMText=new RibbonButton();
            buttonMText.Name = "多行文字";
            buttonMText.Text = "文字";
            buttonMText.ShowImage = true;
            buttonMText.LargeImage = resourceDictionary["MTextImage"] as BitmapImage;
            buttonMText.Image = resourceDictionary["MTextImage"] as BitmapImage;
            buttonMText.Size = RibbonItemSize.Large;
            buttonMText.CommandParameter = "MText ";
            buttonMText.CommandHandler = new RibbonCommandHandler();
            //创建组合下拉按钮
            RibbonSplitButton splitButton=new RibbonSplitButton();
            splitButton.Text = "文字";
            splitButton.ShowText = true;
            splitButton.ShowImage = true;
            splitButton.Size = RibbonItemSize.Large;
            splitButton.Orientation = System.Windows.Controls.Orientation.Vertical;
            splitButton.Items.Add(buttonText);//添加“单行文本”按钮到组合下拉按钮
            splitButton.Items.Add(buttonMText);//添加“多行文本”按钮到组合下拉按钮
            //创建行面板
            RibbonRowPanel row1=new RibbonRowPanel();
            //创建“移动”按钮
            RibbonButton buttonMove=new RibbonButton
            {
                Name = "移动",
                Text = "移动",
                ShowImage = true,
                ShowText = true,
                Image = resourceDictionary["MoveImage"] as BitmapImage,
                Size = RibbonItemSize.Standard,
                CommandParameter = "Move ",
                CommandHandler = new RibbonCommandHandler(),
            };
            row1.Items.Add(buttonMove);//添加“移动”按钮到行面板
            row1.Items.Add(new RibbonRowBreak());//换行，这样可以使按钮多行排列
            //创建“复制”按钮
            RibbonButton buttonCopy=new RibbonButton
            {
                Name = "复制",
                Text = "复制",
                ShowImage = true,
                ShowText = true,
                Image = resourceDictionary["CopyImage"] as BitmapImage,
                Size = RibbonItemSize.Standard,
                CommandParameter = "Copy ",
                CommandHandler = new RibbonCommandHandler(),
            };
            row1.Items.Add(buttonCopy);
            row1.Items.Add(new RibbonRowBreak());
            //创建“拉伸”按钮
            RibbonButton buttonStretch=new RibbonButton
            {
                Name = "拉伸",
                Text = "拉伸",
                ShowImage = true,
                ShowText = true,
                Image = resourceDictionary["StretchImage"] as BitmapImage,
                Size = RibbonItemSize.Standard,
                CommandParameter = "Stretch ",
                CommandHandler = new RibbonCommandHandler()
            };
            row1.Items.Add(buttonStretch);
            row1.Items.Add(new RibbonRowBreak());
            //将“直线”按钮、组合下拉按钮、行面板添加到"演示"面板中
            sourcePanel.Items.Add(buttonLine);
            sourcePanel.Items.Add(splitButton);
            sourcePanel.Items.Add(row1);
        }
        public class RibbonCommandHandler : System.Windows.Input.ICommand
        {
            public bool CanExecute(object parameter)
            {
                return true;//确定此命令可以在其当前状态下执行
            }
            //当出现影响是否应执行该命令的更改时发生
            public event EventHandler CanExecuteChanged;

            public void Execute(object parameter)
            {
                //获取发出命令的按钮对象
                RibbonButton button = parameter as RibbonButton;
                //如果发出命令的不是按钮或按钮未定义命令参数，则返回
                if (button == null || button.CommandParameter == null) return;
                //根据按钮的命令参数，执行对应的AutoCAD命令
                Document doc = AcadApp.DocumentManager.MdiActiveDocument;
                doc.SendStringToExecute(button.CommandParameter.ToString(), true, false, true);
            }
        }
    }
}
﻿using Autodesk.AutoCAD.EditorInput;
using Autodesk.AutoCAD.Geometry;

namespace DotNetARX
{
    /// <summary>
    /// 选择操作类
    /// </summary>
    public static class SelectionTools
    {
        /// <summary>
        /// 选择过一点的所有实体
        /// </summary>
        /// <param name="ed">命令行对象</param>
        /// <param name="point">点</param>
        /// <param name="filter">选择过滤器</param>
        /// <returns>返回过指定点的所有实体</returns>
        public static PromptSelectionResult SelectAtPoint(this Editor ed, Point3d point, SelectionFilter filter)
        {
            return ed.SelectCrossingWindow(point, point, filter);
        }

        /// <summary>
        /// 选择过一点的所有实体
        /// </summary>
        /// <param name="ed">命令行对象</param>
        /// <param name="point">点</param>
        /// <returns>返回过指定点的所有实体</returns>
        public static PromptSelectionResult SelectAtPoint(this Editor ed, Point3d point)
        {
            return ed.SelectCrossingWindow(point, point);
        }

    }
}
﻿using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using Autodesk.AutoCAD.Geometry;
using Autodesk.AutoCAD.DatabaseServices;

namespace FileCAD
{
    //AutoCAD点的坐标值
    [Serializable]
    public class SerilizePoint
    {
        public double X { get; set; }
        public double Y { get; set; }
        public double Z { get; set; }
    }
}
﻿//------------------------------------------------------------------------------
// <auto-generated>
//     此代码由工具生成。
//     运行时版本:4.0.30319.488
//
//     对此文件的更改可能会导致不正确的行为，并且如果
//     重新生成代码，这些更改将会丢失。
// </auto-generated>
//------------------------------------------------------------------------------

namespace Wpfs.Properties {
    
    
    [global::System.Runtime.CompilerServices.CompilerGeneratedAttribute()]
    [global::System.CodeDom.Compiler.GeneratedCodeAttribute("Microsoft.VisualStudio.Editors.SettingsDesigner.SettingsSingleFileGenerator", "10.0.0.0")]
    internal sealed partial class Settings : global::System.Configuration.ApplicationSettingsBase {
        
        private static Settings defaultInstance = ((Settings)(global::System.Configuration.ApplicationSettingsBase.Synchronized(new Settings())));
        
        public static Settings Default {
            get {
                return defaultInstance;
            }
        }
    }
}
﻿using System.Collections.Generic;
using System.Linq;
using Autodesk.AutoCAD.ApplicationServices;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.Geometry;
using Autodesk.AutoCAD.Runtime;
using DotNetARX;
namespace SQLCAD
{
    public class SQLCAD
    {
        //提取CAD中的员工名字AutoCAD->数据库
        [CommandMethod("Employee")]
        public void Employee()
        {
            Database db=HostApplicationServices.WorkingDatabase;            
            using (officeDataContext office=new officeDataContext())// 连接数据库
            using (Transaction trans=db.TransactionManager.StartTransaction())
            {
                //使用Linq获取模型空间中位于EMPLOYEE图层上的多行文本对象
                var employeesInCAD=from m in db.GetEntsInModelSpace<MText>()
                                   where m.Layer == "EMPLOYEE"
                                   select m;
                List<Employee> employees=new List<Employee>();//员工列表
                foreach (MText employee in employeesInCAD)//遍历表示员工的多行文本
                {
                    string[] name=employee.Text.Split('\n');//分离出员工的姓和名
                    //设置一个员工对象，包括姓、名、房间号
                    Employee newEmployee=new Employee { Last_Name = name[0], First_Name = name[1], Room_No = GetNearstRoom(employee) };
                    //添加提取的员工信息到员工列表
                    employees.Add(newEmployee);
                }
                //一次性添加AutoCAD提取的员工信息到Employee表中
                office.Employee.InsertAllOnSubmit(employees);
                office.SubmitChanges();//对数据库提交更改，完成数据的添加
                trans.Commit();
            }
        }

        // 获取离指定员工（由多行文本表示）最近的房间号（RMNUM块的NUMBER属性）
        public string GetNearstRoom(MText mtext)
        {
            Database db=HostApplicationServices.WorkingDatabase;
            // 获取表示房间的RMNUM块
            var roomBlocks=from b in db.GetEntsInModelSpace<BlockReference>()
                           where b.Name == "RMNUM"
                           select b;
            // 获取表示员工的多行文本的左下角点
            Point3d pos=mtext.GeometricExtents.MinPoint;
            // 获取离多行文本最近的RMNUM块
            var nearsetLeftTop=from r in roomBlocks
                               let blockTop = r.GeometricExtents.MinPoint
                               let left = blockTop.X - pos.X
                               let top = blockTop.Y - pos.Y
                               where left < 0 && top > 0
                               select r;
            var q=(from n in nearsetLeftTop
                   let dist = n.GeometricExtents.MinPoint.DistanceTo(pos)
                   where dist > 0
                   orderby dist
                   select n).First();
            //返回员工所在的房间号（离多行文本最近的RMNUM块的NUMBER属性）
            return q.ObjectId.GetAttributeInBlockReference("NUMBER");
        }

        //提取CAD中的房间号码、类型、句柄,AutoCAD->数据库
        [CommandMethod("Room")]
        public void Room()
        {
            Database db=HostApplicationServices.WorkingDatabase;            
            using (Transaction trans=db.TransactionManager.StartTransaction())
            using (officeDataContext office=new officeDataContext())
            {
                //使用Linq获取模型空间中的RMNUM块
                var roomBlocks=from b in db.GetEntsInModelSpace<BlockReference>()
                               where b.Name == "RMNUM"
                               select b;
                //用于存储NUMBER属性为整数（代表房间号）的RMNUM块
                List<Room> roomsHasNum=new List<Room>();
                //若房间上方有房间类型，则存储该房间号及房间类型
                var roomsNumAndType=new List<KeyValuePair<string, string>>();
                foreach (var room in roomBlocks) //循环遍历表示房间的RMNUM块
                {
                    //获取表示房间号的块属性NUMBER
                    string roomNumber=room.ObjectId.GetAttributeInBlockReference("NUMBER");
                    string roomType="Office"; //设置默认房间类型为Office                   
                    if (!roomNumber.IsInt()) //如果NUMBER属性不是整数，则块表示它下方的房间类型
                    {
                        var q=(from rb in roomBlocks
                               let dist = rb.Position.DistanceTo(room.Position) //当前RMNUM块与其它RMNUM块的距离
                               where dist > 0
                               orderby dist //按距离排序
                               select rb).First(); //选择距离最近的RMNUM块
                        //获取最近的有房间号的房间
                        var roomNumberNearst=q.ObjectId.GetAttributeInBlockReference("NUMBER");
                        var roomAndType=new KeyValuePair<string, string>(roomNumberNearst, roomNumber);//设置房间号及房间类型
                        roomsNumAndType.Add(roomAndType);//加入列表，供后面操作
                        continue; //由于RMNUM块为非数字的，只是提供房间类型，因此返回
                    }
                    //如果NUMBER属性是整数，则生成一个新房间，对房间号、实体句柄、房间类型进行赋值
                    var newRoom=new Room { Room_No = roomNumber, Entity_Handle = room.Handle.ToString(), Room_Type = roomType };
                    roomsHasNum.Add(newRoom); //加入房间列表
                }
                foreach (var roomOther in roomsNumAndType)//对具有特殊类型的房间进行遍历
                {
                    var q=from r in roomsHasNum
                          where r.Room_No == roomOther.Key
                          select r; //选择具有特殊类型的房间
                    if (q.Count() == 1)//
                    {
                        q.First().Room_Type = roomOther.Value;//设置房间类型
                    }
                }
                office.Room.InsertAllOnSubmit(roomsHasNum);//一次性添加AutoCAD提取的房间信息到Room表中
                office.SubmitChanges(); //对数据库提交更改，完成数据的添加
                trans.Commit();
            }
        }

        //增加一个新员工,并在AutoCAD中表示
        [CommandMethod("NewEmp")]
        public void AddNewEmployee()
        {
            Database db=HostApplicationServices.WorkingDatabase;
            Application.ShowModalDialog(new EmpForm());// 显示员工情况输入窗口
            using (Transaction trans=db.TransactionManager.StartTransaction())
            using (var office=new officeDataContext())// 连接SQL Server数据库
            {
                // 查找数据库中最后一个员工
                var lastEmp=office.Employee.OrderBy(e => e.Id).ToList().Last();
                ObjectId roomId=ObjectId.Null;// 表示房间的RUMNUM块的Id
                //新建一个多行文本对象表示员工，文本内容设置为查找到的员工的姓名
                MText employee=new MText();
                employee.Contents = lastEmp.First_Name + "\n" + lastEmp.Last_Name;
                //查找到的员工所在的房间（Room表）
                var room=(from r in office.Room
                          where r.Room_No == lastEmp.Room_No
                          select r).ToList();
                //如果找到员工所在的房间号，则将其句柄转化为ObjectId
                if (room.Count() == 1)
                    roomId = db.HandleToObjectId(room.First().Entity_Handle);
                else return;//未找到房间号则返回
                //获取房间所代表的块
                BlockReference roomBlock=(BlockReference)roomId.GetObject(OpenMode.ForRead);
                //员工文本放置在房间块的右下方
                employee.Location = roomBlock.GeometricExtents.MaxPoint.Add(new Vector3d(3, -3, 0));
                //设置员工文本的层号
                employee.Layer = "Employee";
                db.AddToModelSpace(employee);
                trans.Commit();
            }
        }
    }
}
using System;
using System.Linq;
using Autodesk.AutoCAD.ApplicationServices;
using Autodesk.AutoCAD.Runtime;
using Autodesk.AutoCAD.Windows;
using Autodesk.AutoCAD.DatabaseServices;
using System.Collections.Generic;
using Autodesk.AutoCAD.EditorInput;
namespace StatusBars
{
    public class StatusBars
    {
        [CommandMethod("CreateAppPane")]
        public void AddApplicationPane()
        {
            //һ򴰸
            Pane appPaneButton = new Pane();
            //ô
            appPaneButton.Enabled = true;
            appPaneButton.Visible = true;
            //ôʼ״̬ǵ
            appPaneButton.Style = PaneStyles.Normal;
            //ôı
            appPaneButton.Text = "򴰸";
            //ʾʾϢ
            appPaneButton.ToolTipText = "ӭ.net磡";
            //MouseDown¼걻ʱ
            appPaneButton.MouseDown += OnAppMouseDown;
            //ѴӵAutoCAD״̬
            Application.StatusBar.Panes.Add(appPaneButton);
        }
        void OnAppMouseDown(object sender, StatusBarMouseDownEventArgs e)
        {
            //ȡť
            Pane paneButton = (Pane)sender;
            string alertMessage;
            //Ĳ򷵻
            if (e.Button != System.Windows.Forms.MouseButtons.Left)
            {
                return;
            }
            //лť״̬
            if (paneButton.Style == PaneStyles.PopOut)//ťǵģлΪ
            {
                paneButton.Style = PaneStyles.Normal;
                alertMessage = "򴰸ť";
            }
            else
            {
                paneButton.Style = PaneStyles.PopOut;
                alertMessage = "򴰸ťûб";
            }
            //״̬Էӳť״̬仯
            Application.StatusBar.Update();
            //ʾӳť仯Ϣ
            Application.ShowAlertDialog(alertMessage);
        }
        [CommandMethod("StatusBarBalloon")]
        public void StatusBarBalloon()
        {
            Document doc=Application.DocumentManager.MdiActiveDocument;
            Editor ed=doc.Editor;
            //ʾûҪıɫĶ
            ObjectId id=ed.GetEntity("ѡҪıɫĶ").ObjectId;
            TrayItem trayItem=new TrayItem();//½һĿ
            trayItem.ToolTipText = "ıɫ";//Ŀʾַ
            //Ŀͼ
            trayItem.Icon = doc.StatusBar.TrayItems[0].Icon;
            //ĿӵAutoCAD״̬
            Application.StatusBar.TrayItems.Add(trayItem);
            //½һ֪ͨ
            TrayItemBubbleWindow window=new TrayItemBubbleWindow();
            window.Title = "ıɫ";//ݴڵı
            window.HyperText = "ɫΪɫ";//ݴڵı
            window.Text = "ıɫ";//ݴڵı
            window.IconType = IconType.Information;//ݴڵͼ
            trayItem.ShowBubbleWindow(window);//ʾݴ
            Application.StatusBar.Update();//״̬
            //עݴڹر¼
            window.Closed += (sender, e) =>
            {
                //ûݴеӣöɫΪɫ
                if (e.CloseReason == TrayItemBubbleWindowCloseReason.HyperlinkClicked)
                {
                    using (doc.LockDocument())
                    using (Transaction trans=doc.TransactionManager.StartTransaction())
                    {
                        Entity ent=(Entity)trans.GetObject(id, OpenMode.ForWrite);
                        ent.ColorIndex = 1;
                        trans.Commit();
                    }
                }
                //ݴڹرպ󣬽̴״̬ɾ
                Application.StatusBar.TrayItems.Remove(trayItem);
                Application.StatusBar.Update();//״̬
            };
        }
    }
}
﻿using Autodesk.AutoCAD.ApplicationServices;
using Autodesk.AutoCAD.BoundaryRepresentation;
using Autodesk.AutoCAD.Colors;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.EditorInput;
using Autodesk.AutoCAD.Geometry;
using Autodesk.AutoCAD.Runtime;
using Autodesk.AutoCAD.Windows;
using AcBr = Autodesk.AutoCAD.BoundaryRepresentation;

namespace SubSolid3d
{
    public class Sub3dSolid
    {
        // 着色边
        [CommandMethod("EdgeColor")]
        public void EdgeColorTest()
        {
            Database db = HostApplicationServices.WorkingDatabase;
            Editor ed = Application.DocumentManager.MdiActiveDocument.Editor;

            PromptSelectionOptions pso = new PromptSelectionOptions();
            pso.MessageForAdding = "\n请选择三维实体的边:";
            pso.SingleOnly = true;          // 单选
            pso.ForceSubSelections = true;  // 强制子实体选择

            PromptSelectionResult psr = ed.GetSelection(pso);
            if (psr.Status != PromptStatus.OK || psr.Value.Count == 0)
            {
                return;
            }

            SelectionSet sSet = psr.Value;    // 得到选择集
            SelectedObject sObj = sSet[0];    // 得到选择集的唯一对象
            // 得到选择集唯一对象的子实体集合
            SelectedSubObject[] sSubObjs = sObj.GetSubentities();
            // 得到子实体Id
            SubentityId edgeSubId = sSubObjs[0].FullSubentityPath.SubentId;

            // 检查子实体类型
            if (edgeSubId.Type != SubentityType.Edge)
            {
                ed.WriteMessage("\n没有选择三维实体的边!");
                return;
            }

            using (Transaction tr = db.TransactionManager.StartTransaction())
            {
                Solid3d solid3d = tr.GetObject(sObj.ObjectId, OpenMode.ForWrite) as Solid3d;
                if (solid3d == null)
                {
                    return;
                }

                // 得到边的子实体全路径
                ObjectId[] solid3dIds = new ObjectId[] { solid3d.ObjectId };
                FullSubentityPath edgePath = new FullSubentityPath(solid3dIds, edgeSubId);

                
                // 子实体高亮
                solid3d.Highlight(edgePath, false);
                ed.GetString("\n子实体选择成功, 按回车键继续...");

                // 打开颜色对话框
                ColorDialog dialogObj = new ColorDialog();
                if (dialogObj.ShowDialog() != System.Windows.Forms.DialogResult.OK)
                {
                    solid3d.Unhighlight(edgePath, false);
                    return;
                }
                Color newColor = dialogObj.Color;

                // 对子实体进行着色
                solid3d.SetSubentityColor(edgeSubId, newColor);
                solid3d.Unhighlight(edgePath, false);
                tr.Commit();
            }
        }

        // 拉伸面
        [CommandMethod("FaceExtrude")]
        public void FaceExtrudeTest()
        {
            Database db = HostApplicationServices.WorkingDatabase;
            Editor ed = Application.DocumentManager.MdiActiveDocument.Editor;

            PromptSelectionOptions pso = new PromptSelectionOptions();
            pso.MessageForAdding = "\n请选择三维实体的面:";
            pso.SingleOnly = true;            // 单选
            pso.ForceSubSelections = true;    // 强制子实体选择
            pso.SinglePickInSpace = true;     // 允许在一个“空白”处拾取
            PromptSelectionResult psr = ed.GetSelection(pso);

            if (psr.Status != PromptStatus.OK)
            {
                return;
            }

            SelectionSet sSet = psr.Value;
            SelectedObject sObj = sSet[0];
            SelectedSubObject[] sSubObjs = sObj.GetSubentities();
            SubentityId faceSubId = sSubObjs[0].FullSubentityPath.SubentId;

            if (faceSubId.Type != SubentityType.Face)
            {
                ed.WriteMessage("\n没有选择三维实体的面!");
                return;
            }

            using (Transaction tr = db.TransactionManager.StartTransaction())
            {
                Solid3d solid3d = tr.GetObject(sObj.ObjectId, OpenMode.ForWrite) as Solid3d;
                if (solid3d == null)
                {
                    return;
                }
                SubentityId[] faceSubIds = new SubentityId[] { faceSubId };
                double height = 100.0;   // 拉伸高度
                double taper = 0.0;      // 拉伸角度
                solid3d.ExtrudeFaces(faceSubIds, height, taper);
                tr.Commit();
            }
        }

        // 三维实体圆角
        [CommandMethod("EdgeFillet")]
        public void FilletEdgeTest()
        {
            Database db = HostApplicationServices.WorkingDatabase;
            Editor ed = Application.DocumentManager.MdiActiveDocument.Editor;

            PromptSelectionOptions pso = new PromptSelectionOptions();
            pso.MessageForAdding = "\n请选择三维实体的边:";
            pso.SingleOnly = true;
            pso.ForceSubSelections = true;   // 强制进行子实体选择

            PromptSelectionResult psr = ed.GetSelection(pso);
            if (psr.Status != PromptStatus.OK || psr.Value.Count == 0)
            {
                return;
            }

            SelectionSet sSet = psr.Value;    // 得到选择集
            SelectedObject sObj = sSet[0];    // 得到选择集的唯一对象
            // 得到选择集唯一对象的子实体集合
            SelectedSubObject[] sSubObjs = sObj.GetSubentities();
            // 得到子实体Id
            SubentityId edgeSubId = sSubObjs[0].FullSubentityPath.SubentId;

            if (edgeSubId.Type != SubentityType.Edge)
            {
                ed.WriteMessage("\n没有选择三维实体的边!");
                return;
            }

            using (Transaction tr = db.TransactionManager.StartTransaction())
            {
                // 得到三维实体
                Solid3d solid3dEnt = (Solid3d)tr.GetObject(sObj.ObjectId,
                    OpenMode.ForWrite);

                // 得到边的子实体全路径
                ObjectId[] objIds = new ObjectId[] { solid3dEnt.ObjectId };
                FullSubentityPath edgePath = new FullSubentityPath(objIds, edgeSubId);
                // 子实体高亮
                solid3dEnt.Highlight(edgePath, false);

                // 输入圆角半径
                PromptDoubleOptions pdo = new PromptDoubleOptions("\n输入圆角半径");
                pdo.DefaultValue = 50.0;
                pdo.AllowZero = false;
                pdo.AllowNegative = false;
                PromptDoubleResult res = ed.GetDouble(pdo);

                if (res.Status != PromptStatus.OK)
                {
                    solid3dEnt.Unhighlight(edgePath, false);
                    return;
                }
                double rauidsValue = res.Value;

                DoubleCollection rauidsArr = new DoubleCollection();
                rauidsArr.Add(rauidsValue);
                DoubleCollection startDouArr = new DoubleCollection();
                startDouArr.Add(0.0);
                DoubleCollection endDouArr = new DoubleCollection();
                endDouArr.Add(0.0);

                SubentityId[] edgeIds = new SubentityId[1] { edgeSubId };
                try
                {
                    // 三维实体圆角
                    solid3dEnt.FilletEdges(edgeIds, rauidsArr, startDouArr, endDouArr);
                }
                catch
                {
                    solid3dEnt.Unhighlight(edgePath, false); // 取消子实体高亮
                    ed.WriteMessage("\n圆角失败!");
                }

                solid3dEnt.Unhighlight(edgePath, false);     // 取消子实体高亮
                tr.Commit();
            }
        }

        // 三维实体倒角
        [CommandMethod("EdgeChamfer")]
        public void ChamferEdgeTest()
        {
            Database db = HostApplicationServices.WorkingDatabase;
            Editor ed = Application.DocumentManager.MdiActiveDocument.Editor;

            PromptSelectionOptions pso = new PromptSelectionOptions();
            pso.MessageForAdding = "\n请选择三维实体的边:";
            pso.SingleOnly = true;
            pso.ForceSubSelections = true; // 强制进行子实体选择

            PromptSelectionResult psr = ed.GetSelection(pso);
            if (psr.Status != PromptStatus.OK || psr.Value.Count == 0)
            {
                return;
            }

            SelectionSet sSet = psr.Value;    // 得到选择集
            SelectedObject sObj = sSet[0];    // 得到选择集的唯一对象
            // 得到选择集唯一对象的子实体集合
            SelectedSubObject[] sSubObjs = sObj.GetSubentities();
            // 得到子实体Id
            SubentityId edgeSubId = sSubObjs[0].FullSubentityPath.SubentId;

            if (edgeSubId.Type != SubentityType.Edge)
            {
                ed.WriteMessage("\n没有选择三维实体的边!");
                return;
            }

            using (Transaction tr = db.TransactionManager.StartTransaction())
            {
                Solid3d solid3dEnt = (Solid3d)tr.GetObject(sObj.ObjectId, OpenMode.ForWrite);

                // 得到边的子实体全路径
                ObjectId[] objIds = new ObjectId[] { solid3dEnt.ObjectId };
                FullSubentityPath edgePath = new FullSubentityPath(objIds, edgeSubId);

                // 得到“边”
                Edge edgeSubEnt = new Edge(edgePath);
                // 得到“边环”集合
                EdgeLoopCollection loops = edgeSubEnt.Loops;
                // 得到“边环”遍历器
                EdgeLoopEnumerator edgeLoopEnumerator = loops.GetEnumerator();
                // 声明“面”子实体全路径
                FullSubentityPath facePath = FullSubentityPath.Null;

                bool isNext = false;
                while (!isNext)
                {
                    // “边环”遍历器复位
                    edgeLoopEnumerator.Reset();
                    // “边环”遍历器跳到下一个节点
                    bool moveNext = edgeLoopEnumerator.MoveNext();

                    while (moveNext)
                    {
                        // 得到“边环”遍历器的当前节点
                        BoundaryLoop loopSubEnt = edgeLoopEnumerator.Current;
                        // 由“边环”得到“面”
                        AcBr.Face faceSubEnt = loopSubEnt.Face;
                        // 得到“面”子实体全路径
                        facePath = faceSubEnt.SubentityPath;
                        // 高亮面
                        solid3dEnt.Highlight(facePath, false);

                        PromptKeywordOptions optKey = new PromptKeywordOptions
                            ("\n请指定曲面选项[下一个(N)/当前(OK)]<OK>");
                        optKey.Keywords.Add("N", "N", "N", false, true);
                        optKey.Keywords.Add("O", "O", "O", false, true);
                        optKey.Keywords.Default = "O";
                        PromptResult resKey = ed.GetKeywords(optKey);

                        if (resKey.Status == PromptStatus.Cancel)
                        {
                            // 取消, 则退出高亮.
                            solid3dEnt.Unhighlight(facePath, false);
                            return;
                        }

                        if (resKey.Status == PromptStatus.OK)
                        {
                            switch (resKey.StringResult)
                            {
                                case "N":
                                    // 选择“下一个”, 则当前面退出高亮.
                                    solid3dEnt.Unhighlight(facePath, false);
                                    // 并将“边环”遍历器指向下一个节点.
                                    moveNext = edgeLoopEnumerator.MoveNext();
                                    break;
                                case "O":
                                    // 选择“当前”, 则跳出循环.
                                    moveNext = false;
                                    isNext = true;
                                    break;
                            }
                        }
                    }
                }

                // 输入基面倒角距离
                PromptDoubleOptions pdo = new PromptDoubleOptions("\n指定基面倒角距离");
                pdo.DefaultValue = 10.0;
                pdo.AllowZero = false;
                pdo.AllowNegative = false;
                PromptDoubleResult res = ed.GetDouble(pdo);

                if (res.Status != PromptStatus.OK)
                {
                    solid3dEnt.Unhighlight(facePath, false);
                    return;
                }
                double baseDisValue = res.Value;

                // 输入其他曲面倒角距离
                pdo = new PromptDoubleOptions("\n指定其他曲面倒角距离");
                pdo.DefaultValue = 50.0;
                pdo.AllowZero = false;
                pdo.AllowNegative = false;
                res = ed.GetDouble(pdo);

                if (res.Status != PromptStatus.OK)
                {
                    solid3dEnt.Unhighlight(facePath, false);
                    return;
                }
                double otherDisValue = res.Value;

                // 倒角边的子实体Id数组
                SubentityId[] edgeIds = new SubentityId[1] { edgeSubId };
                // 基面的面子实体Id
                SubentityId baseFaceId = facePath.SubentId;
                try
                {
                    // 三维实体倒角
                    solid3dEnt.ChamferEdges(edgeIds, baseFaceId, baseDisValue, otherDisValue);
                }
                catch
                {
                    ed.WriteMessage("\n倒角失败!");
                    solid3dEnt.Unhighlight(facePath, false);
                }

                solid3dEnt.Unhighlight(facePath, false);
                tr.Commit();
            }
        }
    }
}



﻿using System;
using ahlzl;
using Autodesk.AutoCAD.ApplicationServices;
using Autodesk.AutoCAD.Colors;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.EditorInput;
using Autodesk.AutoCAD.Geometry;
using Autodesk.AutoCAD.Runtime;
using Autodesk.AutoCAD.Windows;

namespace SubSolid3d
{
    public class SubSolid3dClass
    {
        // 着色边
        [CommandMethod("T1")]
        public void T1()
        {
            Database db = HostApplicationServices.WorkingDatabase;
            Editor ed = Application.DocumentManager.MdiActiveDocument.Editor;

            ObjectId solid3dId = ObjectId.Null;
            int gsMarker = 0;

            // 得到ObjectId和gs标记
            Express3D.GetgsMarker("\n请选择三维实体的边:", ref solid3dId, ref gsMarker);

            if(solid3dId == ObjectId.Null || gsMarker == 0)
            {
                ed.WriteMessage("\n选择失败!");
                return;
            }

            using (Transaction trans = db.TransactionManager.StartTransaction())
            {
                Solid3d solid3dEnt = trans.GetObject(solid3dId, OpenMode.ForWrite) as Solid3d;
                if (solid3dEnt == null)
                {
                    ed.WriteMessage("\n没用选择三维实体!");
                    return;
                }

                Point3d pickPoint = new Point3d(0, 0, 0);
                Matrix3d xform = Matrix3d.Identity;
                IntPtr resbuf = IntPtr.Zero;
                FullSubentityPath[] edgePathes = null;
                try
                {
                    edgePathes = solid3dEnt.GetSubentityPathsAtGraphicsMarker
                        (SubentityType.Edge, gsMarker, pickPoint, xform, 0, null);
                }
                catch
                {
                    ed.WriteMessage("\n选择失败!");
                    return;
                }

                // 高亮边.
                solid3dEnt.Highlight(edgePathes[0], false);
                ed.GetString("\n按回车键继续...");
                solid3dEnt.Unhighlight(edgePathes[0], false);

                // 打开颜色对话框
                ColorDialog dialogObj = new ColorDialog();
                if (dialogObj.ShowDialog() != System.Windows.Forms.DialogResult.OK)
                {
                    solid3dEnt.Unhighlight(edgePathes[0], false);
                    return;
                }
                Color newColor = dialogObj.Color;

                // 着色边.
                SubentityId edgeId = edgePathes[0].SubentId;
                solid3dEnt.SetSubentityColor(edgeId, newColor);
                trans.Commit();
            }    
        }

        // 拉伸面
        [CommandMethod("T2")]
        public void T2()
        {
            Express3D.Solid3dExtrudeFaces(20.0, 0.0);
        }

        // 三维实体圆角
        [CommandMethod("EdgeFillet")]
        public void FilletEdgeTest()
        {
            Database db = HostApplicationServices.WorkingDatabase;
            Editor ed = Application.DocumentManager.MdiActiveDocument.Editor;

            PromptSelectionOptions pso = new PromptSelectionOptions();
            pso.MessageForAdding = "\n请选择三维实体的边:";
            pso.SingleOnly = true;
            pso.ForceSubSelections = true;   // 强制进行子实体选择

            PromptSelectionResult psr = ed.GetSelection(pso);
            if (psr.Status != PromptStatus.OK || psr.Value.Count == 0)
            {
                return;
            }

            SelectionSet sSet = psr.Value;    // 得到选择集
            SelectedObject sObj = sSet[0];    // 得到选择集的唯一对象
            // 得到选择集唯一对象的子实体集合
            SelectedSubObject[] sSubObjs = sObj.GetSubentities();
            // 得到子实体Id
            SubentityId edgeSubId = sSubObjs[0].FullSubentityPath.SubentId;

            if (edgeSubId.Type != SubentityType.Edge)
            {
                ed.WriteMessage("\n没有选择三维实体的边!");
                return;
            }

            using (Transaction tr = db.TransactionManager.StartTransaction())
            {
                // 得到三维实体
                Solid3d solid3dEnt = (Solid3d)tr.GetObject(sObj.ObjectId,
                    OpenMode.ForWrite);

                // 得到边的子实体全路径
                ObjectId[] objIds = new ObjectId[] { solid3dEnt.ObjectId };
                FullSubentityPath edgePath = new FullSubentityPath(objIds, edgeSubId);
                // 子实体高亮
                solid3dEnt.Highlight(edgePath, false);

                // 输入圆角半径
                PromptDoubleOptions pdo = new PromptDoubleOptions("\n输入圆角半径");
                pdo.DefaultValue = 50.0;
                pdo.AllowZero = false;
                pdo.AllowNegative = false;
                PromptDoubleResult res = ed.GetDouble(pdo);

                if (res.Status != PromptStatus.OK)
                {
                    solid3dEnt.Unhighlight(edgePath, false);
                    return;
                }
                double rauidsValue = res.Value;

                DoubleCollection rauidsArr = new DoubleCollection();
                rauidsArr.Add(rauidsValue);
                DoubleCollection startDouArr = new DoubleCollection();
                startDouArr.Add(0.0);
                DoubleCollection endDouArr = new DoubleCollection();
                endDouArr.Add(0.0);

                SubentityId[] edgeIds = new SubentityId[1] { edgeSubId };
                try
                {
                    // 三维实体圆角
                    solid3dEnt.FilletEdges(edgeIds, rauidsArr, startDouArr, endDouArr);
                }
                catch
                {
                    solid3dEnt.Unhighlight(edgePath, false); // 取消子实体高亮
                    ed.WriteMessage("\n圆角失败!");
                }

                solid3dEnt.Unhighlight(edgePath, false);     // 取消子实体高亮
                tr.Commit();
            }
        }

        // 三维实体倒角
        [CommandMethod("EdgeChamfer")]
        public void ChamferEdgeTest()
        {
            Database db = HostApplicationServices.WorkingDatabase;
            Editor ed = Application.DocumentManager.MdiActiveDocument.Editor;

            PromptSelectionOptions pso = new PromptSelectionOptions();
            pso.MessageForAdding = "\n请选择三维实体的边:";
            pso.SingleOnly = true;
            pso.ForceSubSelections = true; // 强制进行子实体选择

            PromptSelectionResult psr = ed.GetSelection(pso);
            if (psr.Status != PromptStatus.OK || psr.Value.Count == 0)
            {
                return;
            }

            SelectionSet sSet = psr.Value;    // 得到选择集
            SelectedObject sObj = sSet[0];    // 得到选择集的唯一对象
            // 得到选择集唯一对象的子实体集合
            SelectedSubObject[] sSubObjs = sObj.GetSubentities();
            // 得到子实体Id
            SubentityId edgeSubId = sSubObjs[0].FullSubentityPath.SubentId;

            if (edgeSubId.Type != SubentityType.Edge)
            {
                ed.WriteMessage("\n没有选择三维实体的边!");
                return;
            }

            //using (Transaction tr = db.TransactionManager.StartTransaction())
            //{
            //    Solid3d solid3dEnt = (Solid3d)tr.GetObject(sObj.ObjectId, OpenMode.ForWrite);

            //    // 得到边的子实体全路径
            //    ObjectId[] objIds = new ObjectId[] { solid3dEnt.ObjectId };
            //    FullSubentityPath edgePath = new FullSubentityPath(objIds, edgeSubId);

            //    // 得到“边”
            //    Edge edgeSubEnt = new Edge(edgePath);
            //    // 得到“边环”集合
            //    EdgeLoopCollection loops = edgeSubEnt.Loops;
            //    // 得到“边环”遍历器
            //    EdgeLoopEnumerator edgeLoopEnumerator = loops.GetEnumerator();
            //    // 声明“面”子实体全路径
            //    FullSubentityPath facePath = FullSubentityPath.Null;

            //    bool isNext = false;
            //    while (!isNext)
            //    {
            //        // “边环”遍历器复位
            //        edgeLoopEnumerator.Reset();
            //        // “边环”遍历器跳到下一个节点
            //        bool moveNext = edgeLoopEnumerator.MoveNext();

            //        while (moveNext)
            //        {
            //            // 得到“边环”遍历器的当前节点
            //            BoundaryLoop loopSubEnt = edgeLoopEnumerator.Current;
            //            // 由“边环”得到“面”
            //            AcBr.Face faceSubEnt = loopSubEnt.Face;
            //            // 得到“面”子实体全路径
            //            facePath = faceSubEnt.SubentityPath;
            //            // 高亮面
            //            solid3dEnt.Highlight(facePath, false);

            //            PromptKeywordOptions optKey = new PromptKeywordOptions
            //                ("\n请指定曲面选项[下一个(N)/当前(OK)]<OK>");
            //            optKey.Keywords.Add("N", "N", "N", false, true);
            //            optKey.Keywords.Add("O", "O", "O", false, true);
            //            optKey.Keywords.Default = "O";
            //            PromptResult resKey = ed.GetKeywords(optKey);

            //            if (resKey.Status == PromptStatus.Cancel)
            //            {
            //                // 取消, 则退出高亮.
            //                solid3dEnt.Unhighlight(facePath, false);
            //                return;
            //            }

            //            if (resKey.Status == PromptStatus.OK)
            //            {
            //                switch (resKey.StringResult)
            //                {
            //                    case "N":
            //                        // 选择“下一个”, 则当前面退出高亮.
            //                        solid3dEnt.Unhighlight(facePath, false);
            //                        // 并将“边环”遍历器指向下一个节点.
            //                        moveNext = edgeLoopEnumerator.MoveNext();
            //                        break;
            //                    case "O":
            //                        // 选择“当前”, 则跳出循环.
            //                        moveNext = false;
            //                        isNext = true;
            //                        break;
            //                }
            //            }
            //        }
            //    }

            //    // 输入基面倒角距离
            //    PromptDoubleOptions pdo = new PromptDoubleOptions("\n指定基面倒角距离");
            //    pdo.DefaultValue = 10.0;
            //    pdo.AllowZero = false;
            //    pdo.AllowNegative = false;
            //    PromptDoubleResult res = ed.GetDouble(pdo);

            //    if (res.Status != PromptStatus.OK)
            //    {
            //        solid3dEnt.Unhighlight(facePath, false);
            //        return;
            //    }
            //    double baseDisValue = res.Value;

            //    // 输入其他曲面倒角距离
            //    pdo = new PromptDoubleOptions("\n指定其他曲面倒角距离");
            //    pdo.DefaultValue = 50.0;
            //    pdo.AllowZero = false;
            //    pdo.AllowNegative = false;
            //    res = ed.GetDouble(pdo);

            //    if (res.Status != PromptStatus.OK)
            //    {
            //        solid3dEnt.Unhighlight(facePath, false);
            //        return;
            //    }
            //    double otherDisValue = res.Value;

            //    // 倒角边的子实体Id数组
            //    SubentityId[] edgeIds = new SubentityId[1] { edgeSubId };
            //    // 基面的面子实体Id
            //    SubentityId baseFaceId = facePath.SubentId;
            //    try
            //    {
            //        // 三维实体倒角
            //        solid3dEnt.ChamferEdges(edgeIds, baseFaceId, baseDisValue, otherDisValue);
            //    }
            //    catch
            //    {
            //        ed.WriteMessage("\n倒角失败!");
            //        solid3dEnt.Unhighlight(facePath, false);
            //    }

            //    solid3dEnt.Unhighlight(facePath, false);
            //    tr.Commit();
            //}
        }
    }
}



﻿using System;
using System.Collections;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using Autodesk.AutoCAD.ApplicationServices;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.EditorInput;
using Autodesk.AutoCAD.Runtime;
using DotNetARX;
namespace SummaryInfos
{
    public class SummaryInfos
    {
[CommandMethod("AddSummaryInfo")]
public void AddSummaryInfo()
{
    Database db=HostApplicationServices.WorkingDatabase;
    //如果当前图形包含摘要信息，则返回
    if (db.HasSummaryInfo()) return;
    //新建一个摘要信息管理器
    var info=new DatabaseSummaryInfoBuilder(db.SummaryInfo);
    info.Author = "ObjectARX编程站";//作者
    info.Comments = "书配套Dwg文件";//注释
    info.HyperlinkBase = "http://www.objectarx.net";//超链接地址
    info.Keywords = "ObjectARX";//关键字
    info.LastSavedBy = "才鸟";//最近编辑者
    info.RevisionNumber = "V1.0";//修订次数
    info.Subject = "二次开发";//主题
    info.Title = "AutoCAD .NET开发基础与实例教程";//标题
    info.CustomProperties.Add("Size", "A4");//自定义属性
    info.CustomProperties.Add("Language", "Chinese");//自定义属性            
    db.SummaryInfo=info.ToDatabaseSummaryInfo();//保存摘要信息            
}
[CommandMethod("EditSummaryInfo")]
public void EditSummaryInfo()
{
    Database db=HostApplicationServices.WorkingDatabase;
    string propKey="Size";//自定义属性名
    //如果不存在名为Size的自定义属性，则返回
    if(!db.HasCustomProperty(propKey)) return;
    //新建一个摘要信息管理器
    var info=new DatabaseSummaryInfoBuilder(db.SummaryInfo);
    info.CustomProperties["Size"] = "A3";//自定义属性值
    db.SummaryInfo = info.ToDatabaseSummaryInfo();//保存摘要信息
}
[CommandMethod("ShowTime")]
public void ShowTime()
{
    Database db=HostApplicationServices.WorkingDatabase;
    Editor ed=Application.DocumentManager.MdiActiveDocument.Editor;
    //在命令行输出文件的各种时间
    ed.WriteMessage("文件创建时间为："+db.CreationTime()+"\n");
    ed.WriteMessage("文件修改时间为：" + db.ModifyTime() + "\n");
    ed.WriteMessage("文件总编辑时间为：" + Math.Floor(db.TotalEditTime().TotalMinutes) + "分钟\n");
}
    }
}
﻿using System;
using Autodesk.AutoCAD.ApplicationServices;
using Autodesk.AutoCAD.DatabaseServices;
namespace DotNetARX
{
    /// <summary>
    /// 摘要信息操作类
    /// </summary>
    public static class SummaryInfoTools
    {
        /// <summary>
        /// 获取摘要信息中的自定义属性个数
        /// </summary>
        /// <param name="db">数据库对象</param>
        /// <returns>返回自定义属性个数</returns>
        public static int NumCustomProperties(this Database db)
        {
            DatabaseSummaryInfo info = db.SummaryInfo; //获取数据库摘要信息
            //获取摘要信息中的自定义属性集合
            System.Collections.IDictionaryEnumerator props = info.CustomProperties;
            int count = 0;//计数器，用于统计自定义属性个数
            while (props.MoveNext())//遍历自定义属性
            {
                count++;//计数器累加
            }
            return count;//返回自定义属性个数
        }

        /// <summary>
        /// 判断图形中是否存在指定的自定义属性
        /// </summary>
        /// <param name="db">数据库对象</param>
        /// <param name="key">自定义属性的名称</param>
        /// <returns>如果存在指定的自定义属性，返回true，否则返回false</returns>
        public static bool HasCustomProperty(this Database db, string key)
        {
            DatabaseSummaryInfo info = db.SummaryInfo; //获取数据库摘要信息
            //获取摘要信息中的自定义属性集合
            System.Collections.IDictionaryEnumerator props = info.CustomProperties;
            while (props.MoveNext())//遍历自定义属性
            {
                //如果存在指定的自定义属性，返回true
                if (props.Key.ToString().ToUpper() == key.ToUpper()) return true;
            }
            return false;//不存在指定的自定义属性，返回false
        }

        /// <summary>
        /// 判断图形中是否存在摘要信息
        /// </summary>
        /// <param name="db">数据库对象</param>
        /// <returns>如果存在摘要信息，返回true，否则返回false</returns>
        public static bool HasSummaryInfo(this Database db)
        {
            //如果存在自定义属性，则说明肯定有摘要信息
            if (db.NumCustomProperties() > 0) return true;
            DatabaseSummaryInfo info = db.SummaryInfo;//数据库的摘要信息
            //如果存在摘要信息，则返回true
            if (!info.Author.IsNullOrWhiteSpace() && !info.Comments.IsNullOrWhiteSpace()
                && !info.HyperlinkBase.IsNullOrWhiteSpace() && !info.Keywords.IsNullOrWhiteSpace()
                && !info.RevisionNumber.IsNullOrWhiteSpace()
                && !info.Subject.IsNullOrWhiteSpace() && !info.Title.IsNullOrWhiteSpace())
                return true;
            return false;//不存在摘要信息，返回false
        }

        /// <summary>
        /// 获取图形创建的时间
        /// </summary>
        /// <param name="db">数据库对象</param>
        /// <returns>返回图形创建的时间</returns>
        public static DateTime CreationTime(this Database db)
        {
            //获取TDCREATE系统变量，该变量存储图形的创建时间（儒略日格式）
            double creationTime = (double)Application.GetSystemVariable("TDCREATE");
            //将儒略日时间格式转换为DateTime格式，并返回
            return ConvertAcadJulianToDateTime(creationTime);
        }

        /// <summary>
        /// 获取图形的上次修改时间
        /// </summary>
        /// <param name="db">数据库对象</param>
        /// <returns>返回图形的上次修改时间</returns>
        public static DateTime ModifyTime(this Database db)
        {
            //获取TDUPDATE系统变量，该变量存储图形上次修改的时间（儒略日格式）
            double creationTime = (double)Application.GetSystemVariable("TDUPDATE");
            //将儒略日时间格式转换为DateTime格式，并返回
            return ConvertAcadJulianToDateTime(creationTime);
        }

        /// <summary>
        /// 获取编辑图形的总时间
        /// </summary>
        /// <param name="db">数据库对象</param>
        /// <returns>返回编辑图形的总时间</returns>
        public static TimeSpan TotalEditTime(this Database db)
        {
            //获取TDINDWG系统变量，该变量存储编辑图形的总时间，该时间格式为<天数>.<天的小数部分> 
            double day = (double)Application.GetSystemVariable("TDINDWG");
            return TimeSpan.FromDays(day);//返回一个时间间隔对象
        }

        /// <summary>
        /// 将儒略日时间格式转换为DateTime格式
        /// </summary>
        /// <param name="julianDate">儒略日时间</param>
        /// <returns>返回DateTime格式的时间</returns>
        public static DateTime ConvertAcadJulianToDateTime(double julianDate)
        {
            DateTime date;
            try
            {
                double z = Math.Floor(julianDate);
                double w = Math.Floor((z - 1867216.25) / 36524.25);
                double x = Math.Floor(w / 4);

                double a = (z + 1 + w - x);
                double b = a + 1524;
                double c = Math.Floor((b - 122.1) / 365.25);

                double d = Math.Floor(365.25 * c);
                double e = Math.Floor((b - d) / 30.6001);
                double f = Math.Floor(30.6001 * e);

                int day = Convert.ToInt32(b - d - f);

                int m = Convert.ToInt32((e < 14) ? (e - 2) : (e - 14));
                int month = (m + 1);

                int y = Convert.ToInt32((m > 1) ? (c - 4716) : (c - 4715));
                int year = (y == 0) ? (y - 1) : y;
                //
                // strip the integer
                double t = (julianDate - z);
                // hours since midnight
                double hours = Math.Floor(t * 24.0);
                // temp value
                double mins = t - (hours / 24.0);
                // 1440 minutes per day
                double minutes = Math.Floor(mins * 1440.0);
                //
                double seconds = Math.Floor((mins - (minutes / 1440.0)) * 86400.0);

                date = new DateTime(year, month, day, Convert.ToInt32(hours), Convert.ToInt32(minutes), Convert.ToInt32(seconds));
                return date;
            }
            catch (ArgumentOutOfRangeException ex)
            {
                Application.ShowAlertDialog(ex.Message);
                date = new DateTime(0);
            }
            catch (Exception ex)
            {
                Application.ShowAlertDialog(ex.Message);
                date = new DateTime(0);
            }
            return date;
        }
    }
}
﻿using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Drawing;
using System.Data;
using System.Linq;
using System.Text;
using System.Windows.Forms;
using Autodesk.AutoCAD.ApplicationServices;

namespace TabDialog
{
    public partial class TabControl : UserControl
    {
        public TabControl()
        {
            InitializeComponent();
        }

        private void propertyGridOwner_PropertyValueChanged(object s, PropertyValueChangedEventArgs e)
        {
            //当用户在属性网格内修改项目内容后，属性窗口进行更新
            TabbedDialogExtension.SetDirty(this, true);
        }
    }
}
﻿namespace TabDialog
{
    partial class TabControl
    {
        /// <summary> 
        /// 必需的设计器变量。
        /// </summary>
        private System.ComponentModel.IContainer components = null;

        /// <summary> 
        /// 清理所有正在使用的资源。
        /// </summary>
        /// <param name="disposing">如果应释放托管资源，为 true；否则为 false。</param>
        protected override void Dispose(bool disposing)
        {
            if (disposing && (components != null))
            {
                components.Dispose();
            }
            base.Dispose(disposing);
        }

        #region 组件设计器生成的代码

        /// <summary> 
        /// 设计器支持所需的方法 - 不要
        /// 使用代码编辑器修改此方法的内容。
        /// </summary>
        private void InitializeComponent()
        {
            this.propertyGridOwner = new System.Windows.Forms.PropertyGrid();
            this.SuspendLayout();
            // 
            // propertyGridOwner
            // 
            this.propertyGridOwner.Dock = System.Windows.Forms.DockStyle.Fill;
            this.propertyGridOwner.Location = new System.Drawing.Point(0, 0);
            this.propertyGridOwner.Name = "propertyGridOwner";
            this.propertyGridOwner.PropertySort = System.Windows.Forms.PropertySort.Categorized;
            this.propertyGridOwner.Size = new System.Drawing.Size(213, 258);
            this.propertyGridOwner.TabIndex = 0;
            this.propertyGridOwner.PropertyValueChanged += new System.Windows.Forms.PropertyValueChangedEventHandler(this.propertyGridOwner_PropertyValueChanged);
            // 
            // TabControl
            // 
            this.AutoScaleDimensions = new System.Drawing.SizeF(6F, 12F);
            this.AutoScaleMode = System.Windows.Forms.AutoScaleMode.Font;
            this.Controls.Add(this.propertyGridOwner);
            this.Name = "TabControl";
            this.Size = new System.Drawing.Size(213, 258);
            this.ResumeLayout(false);

        }

        #endregion

        internal System.Windows.Forms.PropertyGrid propertyGridOwner;

    }
}
﻿using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using Autodesk.AutoCAD.ApplicationServices;
using Autodesk.AutoCAD.Runtime;
using Autodesk.AutoCAD.EditorInput;
using DotNetARX;
namespace TabDialog
{
    public class TabDialog
    {
        static Document doc=Application.DocumentManager.MdiActiveDocument;
        static Editor ed=Application.DocumentManager.MdiActiveDocument.Editor;
        //声明一个用于属性网格中要显示属性的对象
        static Drawing dwg=null;
        [CommandMethod("CreateNewOptionsTab")]
        public void CreateNewOptionsTab()
        {
            //当DisplayingOptionDialog事件被触发时（即选项对话框显示），运行对应的处理函数
            Application.DisplayingOptionDialog += new TabbedDialogEventHandler(Application_DisplayingOptionDialog);
        }
        private void OnOK()
        {
            SaveDwg();//保存在属性网格中所做的更改，并关闭选项对话框
        }


        private void OnCancel()
        {
            LoadDwg();//取消在属性网格中所做的更改，并关闭选项对话框
        }
        private void OnHelp()
        {
            //这里你可以添加一些帮助说明性的程序            
        }
        private void OnApply()
        {
            SaveDwg();//保存在属性网格中所做的更改，且不关闭选项对话框
        }
        void Application_DisplayingOptionDialog(object sender, TabbedDialogEventArgs e)
        {
            //如果没有为属性网格指定对象，则指定对象
            if (dwg == null) LoadDwg();
            //创建一个自定义控件的实例，这里使用的是显示个人信息的自定义控件
            TabControl tab=new TabControl();
            //设置对象属性窗口中需要显示的对象
            tab.propertyGridOwner.SelectedObject = dwg;
            //更新对象属性窗口
            tab.propertyGridOwner.Update();
            //为控件的确定、取消、帮助、应用按钮添加动作
            TabbedDialogExtension tabExtension=new TabbedDialogExtension(
                tab,
                new TabbedDialogAction(OnOK),
                new TabbedDialogAction(OnCancel),
                new TabbedDialogAction(OnHelp),
                new TabbedDialogAction(OnApply));
            //将控件作为标签页添加到选项对话框
            e.AddTab("自定义", tabExtension);
        }

        private static void LoadDwg()
        {
            dwg = new Drawing();//创建一个用于属性网格中要显示属性的对象
            //根据程序的配置文件内容设置当前图形的作者信息
            dwg.Name = Properties.Settings.Default.Name;
            dwg.Age = Convert.ToInt32(Properties.Settings.Default.Age);
            dwg.City = (CityName)Enum.Parse(typeof(CityName), Properties.Settings.Default.City);
            //设置属性窗口的颜色为当前图形模型空间的背景颜色
            dwg.BackgroundColor = Preferences.Display.GraphicsWinModelBackgrndColor;
        }
        private static void SaveDwg()
        {
            //根据属性网格中的属性更新程序的配置文件中
            Properties.Settings.Default.Name = dwg.Name;
            Properties.Settings.Default.Age = dwg.Age;
            Properties.Settings.Default.City = dwg.City.ToString();
            //设置当前图形模型空间的颜色为属性窗口指定的颜色
            Preferences.Display.GraphicsWinModelBackgrndColor = dwg.BackgroundColor;
            Properties.Settings.Default.Save();//保存配置文件
        }
    }
}
﻿using System.Linq;
using Autodesk.AutoCAD.ApplicationServices;
using Autodesk.AutoCAD.Colors;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.EditorInput;
using Autodesk.AutoCAD.Runtime;
using DotNetARX;
namespace Tables
{
    public class Tables
    {
        [CommandMethod("Table2008")]
        public static void AddTable2008()
        {
            Document doc=Application.DocumentManager.MdiActiveDocument;
            Database db=doc.Database;
            Editor ed=doc.Editor;
            //对模型空间中的块参照进行统计
            var blocks=(from b in db.GetEntsInModelSpace<BlockReference>()
                        group b by b.Name into g //按块名进行分组
                        let id = g.First().BlockTableRecord //获取块参照所在的块表记录
                        orderby g.Count() descending //按块参照的个数降序排列
                        //返回分组结果，生成一个拥有块名、个数、块表记录Id的匿名类
                        select new { Name = g.Key, Number = g.Count(), Id = id }).ToList();
            //提示用户输入表格插入点
            PromptPointResult ppr=ed.GetPoint("\n请选择表格插入点:");
            if (ppr.Status != PromptStatus.OK) return;
            using (Transaction trans=db.TransactionManager.StartTransaction())
            {
                //添加一个名为ColorTable的表格样式
                ObjectId styleId=AddTableStyle("ColorTable");
                //新建一个表格
                Table table=new Table();
                table.TableStyle = styleId;//表格样式
                table.Position = ppr.Value;//表格位置
                table.SetSize(blocks.Count + 2, 4);//设置表格的行数和列数
                table.SetRowHeight(3); //表格行高为3
                table.SetColumnWidth(15);//表格列宽为15
                table.SetTextString(0, 0, "块统计情况表2008");//表格标题
                //表格表头
                table.SetTextString(1, 0, "序号");
                table.SetTextString(1, 1, "名字");
                table.SetTextString(1, 2, "数量");
                table.SetTextString(1, 3, "缩略图");
                int i=2;
                //将块参照的统计结果放入到表格中
                foreach (var block in blocks)
                {
                    table.SetTextString(i, 0, (i - 1).ToString());
                    table.SetTextString(i, 1, block.Name);
                    table.SetTextString(i, 2, block.Number.ToString());
                    //设置块预览图
                    table.SetBlockTableRecordId(i, 3, block.Id, true);
                    i++;
                }
                db.AddToModelSpace(table);//将表格添加到模型空间
                trans.Commit();
            }
        }
        [CommandMethod("Table2012")]
        public static void AddTable2012()
        {
            Document doc=Application.DocumentManager.MdiActiveDocument;
            Database db=doc.Database;
            Editor ed=doc.Editor;
            PromptPointResult ppr=ed.GetPoint("\n请选择表格插入点:");
            if (ppr.Status != PromptStatus.OK) return;
            var blocks = (from b in db.GetEntsInModelSpace<BlockReference>()
                        group b by b.Name into g
                        let id = g.First().BlockTableRecord
                        orderby g.Count() descending
                        select new { Name = g.Key, Number = g.Count(), Id = id }).ToList();
            using (Transaction trans=db.TransactionManager.StartTransaction())
            {
                ObjectId styleId=AddTableStyle("ColorTable");
                Table table=new Table();
                table.TableStyle = styleId;
                table.Position = ppr.Value;
                table.SetSize(blocks.Count + 2, 4);
                table.SetRowHeight(3);
                table.SetColumnWidth(15);
                table.Cells[0, 0].TextString = "块统计情况表2012";
                table.Cells[1, 0].TextString = "序号";
                table.Cells[1, 1].TextString = "名字";
                table.Cells[1, 2].TextString = "数量";
                table.Cells[1, 3].TextString = "缩略图";
                int i=2;
                foreach (var block in blocks)
                {
                    //设置单元格的文本内容
                    table.Cells[i, 0].TextString = (i - 1).ToString();
                    table.Cells[i, 1].TextString = block.Name;
                    table.Cells[i, 2].TextString = block.Number.ToString();
                    table.Cells[i, 3].Contents.Add(); //添加空白内容以添加下面的块参照
                    table.Cells[i, 3].Contents[0].BlockTableRecordId = block.Id;
                    i++;
                }
                db.AddToModelSpace(table);
                trans.Commit();
            }
        }

        //为当前图形添加一个新的表格样式
        public static ObjectId AddTableStyle(string style)
        {
            ObjectId styleId; // 存储表格样式的Id
            Database db=HostApplicationServices.WorkingDatabase;
            using (Transaction trans=db.TransactionManager.StartTransaction())
            {
                // 打开表格样式字典
                DBDictionary dict=(DBDictionary)db.TableStyleDictionaryId.GetObject(OpenMode.ForRead);
                if (dict.Contains(style)) // 如果存在指定的表格样式
                    styleId = dict.GetAt(style); // 获取表格样式的Id
                else
                {
                    TableStyle ts=new TableStyle(); // 新建一个表格样式
                    // 设置表格的标题行为灰色
                    ts.SetBackgroundColor(Color.FromColorIndex(ColorMethod.ByAci, 8), (int)RowType.TitleRow);
                    // 设置表格所有行的外边框的线宽为0.30mm
                    ts.SetGridLineWeight(LineWeight.LineWeight030, (int)GridLineType.OuterGridLines, TableTools.AllRows);
                    // 不加粗表格表头行的底部边框
                    ts.SetGridLineWeight(LineWeight.LineWeight000, (int)GridLineType.HorizontalBottom, (int)RowType.HeaderRow);
                    // 不加粗表格数据行的顶部边框
                    ts.SetGridLineWeight(LineWeight.LineWeight000, (int)GridLineType.HorizontalTop, (int)RowType.DataRow);
                    // 设置表格中所有行的文本高度为1
                    ts.SetTextHeight(1, TableTools.AllRows);
                    // 设置表格中所有行的对齐方式为正中
                    ts.SetAlignment(CellAlignment.MiddleCenter, TableTools.AllRows);
                    dict.UpgradeOpen();//切换表格样式字典为写的状态
                    // 将新的表格样式添加到样式字典并获取其Id
                    styleId = dict.SetAt(style, ts);
                    // 将新建的表格样式添加到事务处理中
                    trans.AddNewlyCreatedDBObject(ts, true);
                    trans.Commit();
                }
            }
            return styleId; // 返回表格样式的Id
        }
    }
}
﻿using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.Geometry;

namespace DotNetARX
{
    /// <summary>
    /// 表格操作类
    /// </summary>
    public static class TableTools
    {
        /// <summary>
        /// 所有行的标志位（包括标题行、数据行）
        /// </summary>
        public static int AllRows
        {
            get
            {
                return (int)(RowType.DataRow | RowType.HeaderRow | RowType.TitleRow);
            }
        }

        /// <summary>
        /// 创建表格
        /// </summary>
        /// <param name="db">数据库对象</param>
        /// <param name="position">表格位置</param>
        /// <param name="numRows">表格行数</param>
        /// <param name="numCols">表格列数</param>
        /// <returns>返回创建的表格的Id</returns>
        public static ObjectId CreateTable(this Database db, Point3d position, int numRows, int numCols)
        {
            ObjectId tableId;
            using (Transaction trans = db.TransactionManager.StartTransaction())
            {
                Table table = new Table();
                //设置表格的行数和列数
                table.SetSize(numRows, numCols);
                //设置表格放置的位置
                table.Position = position;
                //非常重要，根据当前样式更新表格，不加此句，会导致AutoCAD崩溃
                table.GenerateLayout();
                //表格添加到模型空间
                tableId = db.AddToModelSpace(table);
                trans.Commit();
            }
            return tableId;
        }

        /// <summary>
        /// 设置单元格中文本的高度
        /// </summary>
        /// <param name="table">表格对象</param>
        /// <param name="height">文本高度</param>
        /// <param name="rowType">行的标志位</param>
        public static void SetTextHeight(this Table table, double height, RowType rowType)
        {
            table.SetTextHeight(height, rowType);
        }

        /// <summary>
        /// 设置表格中所有单元格中文本为同一高度
        /// </summary>
        /// <param name="table">表格对象</param>
        /// <param name="height">文本高度</param>
        public static void SetTextHeight(this Table table, double height)
        {
            table.SetTextHeight(height, AllRows);
        }

        /// <summary>
        /// 设置单元格中文本的对齐方式
        /// </summary>
        /// <param name="table">表格对象</param>
        /// <param name="align">单元格对齐方式</param>
        /// <param name="rowType">行的标志位</param>
        public static void SetAlignment(this Table table, CellAlignment align, RowType rowType)
        {
            table.SetAlignment(align, (int)rowType);
        }

        /// <summary>
        /// 设置表格中所有单元格中文本为同一对齐方式
        /// </summary>
        /// <param name="table">表格对象</param>
        /// <param name="align">单元格对齐方式</param>
        public static void SetAlignment(this Table table, CellAlignment align)
        {
            table.SetAlignment(align, AllRows);
        }

        /// <summary>
        /// 一次性按行设置单元格文本
        /// </summary>
        /// <param name="table">表格对象</param>
        /// <param name="rowIndex">行号</param>
        /// <param name="data">文本内容</param>
        /// <returns>如果设置成功，则返回true，否则返回false</returns>
        public static bool SetRowTextString(this Table table, int rowIndex, params string[] data)
        {
            if (data.Length > table.NumColumns) return false;
            for (int j = 0; j < data.Length; j++)
            {
                table.SetTextString(rowIndex, j, data[j]);
            }
            return true;
        }

        /// <summary>
        /// 为图形添加一个新的表格样式
        /// </summary>
        /// <param name="db">数据库对象</param>
        /// <param name="styleName">表格样式的名称</param>
        /// <returns>返回表格样式的Id</returns>
        public static ObjectId AddTableStyle(this Database db, string styleName)
        {
            ObjectId styleId;
            using (Transaction trans = db.TransactionManager.StartTransaction())
            {
                //打开表格样式字典
                DBDictionary dict = (DBDictionary)trans.GetObject(db.TableStyleDictionaryId, OpenMode.ForRead);
                //判断是否存在指定的表格样式
                if (dict.Contains(styleName))
                    styleId = dict.GetAt(styleName);//如果存在则返回表格样式的Id
                else
                {
                    //新建一个表格样式
                    TableStyle style = new TableStyle();
                    dict.UpgradeOpen();//切换表格样式字典为写的状态
                    //将新的表格样式添加到样式字典并获取其 Id
                    styleId = dict.SetAt(styleName, style);
                    //将新建的表格样式添加到事务处理中
                    trans.AddNewlyCreatedDBObject(style, true);
                    trans.Commit();
                }
            }
            return styleId;//返回表格样式的Id
        }
    }
}
﻿using System.Collections.Generic;
using Autodesk.AutoCAD.ApplicationServices;
using Autodesk.AutoCAD.BoundaryRepresentation;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.EditorInput;
using Autodesk.AutoCAD.Geometry;
using Autodesk.AutoCAD.Runtime;
using AcBr = Autodesk.AutoCAD.BoundaryRepresentation;
using AcGe = Autodesk.AutoCAD.Geometry;

namespace BrepTest
{
    public class TestBrep
    {
        // 组合体、壳、面、边、顶点的数量及所有顶点的坐标
        [CommandMethod("BrepNum")]
        public void BrepNnmTest()
        {
            Editor ed = Application.DocumentManager.MdiActiveDocument.Editor;
            Database db = HostApplicationServices.WorkingDatabase;

            PromptEntityOptions opt = new PromptEntityOptions("\n选择三维实体或面域");
            opt.SetRejectMessage("您选择的不是三维实体和面域，请重新选择!");
            opt.AddAllowedClass(typeof(Solid3d), true);
            opt.AddAllowedClass(typeof(Region), true);
            PromptEntityResult res = ed.GetEntity(opt);
            if (res.Status != PromptStatus.OK)
            {
                return;
            }

            using (Transaction trans = db.TransactionManager.StartTransaction())
            {
                Entity ent = (Entity)trans.GetObject(res.ObjectId, OpenMode.ForRead);
                Brep brepEnt = new Brep(ent);

                int i = 0;
                // 组合体集合
                BrepComplexCollection complexCol = brepEnt.Complexes;
                // 组合体遍历器
                BrepComplexEnumerator complexEnumerator = complexCol.GetEnumerator();
                while (complexEnumerator.MoveNext())
                {
                    i++;
                }
                ed.WriteMessage("\n组合体(Complex)数: {0}", i);

                i = 0;
                // 壳集合
                BrepShellCollection shellCol = brepEnt.Shells;
                // 壳遍历器
                BrepShellEnumerator shellEnumerator = shellCol.GetEnumerator();
                while (shellEnumerator.MoveNext())
                {
                    i++;
                }
                ed.WriteMessage("\n壳(Shell)数: " + i);

                i = 0;
                // 面集合
                BrepFaceCollection faceCol = brepEnt.Faces;
                // 面遍历器
                BrepFaceEnumerator faceEnumerator = faceCol.GetEnumerator();
                while (faceEnumerator.MoveNext())
                {
                    i++;
                }
                ed.WriteMessage("\n面(Face)数: " + i);

                i = 0;
                try
                {
                    // 边集合
                    BrepEdgeCollection edgeCol = brepEnt.Edges;
                    // 边遍历器
                    BrepEdgeEnumerator edgeEnumerator = edgeCol.GetEnumerator();
                    while (edgeEnumerator.MoveNext())
                    {
                        i++;
                    }
                    ed.WriteMessage("\n边(Edge)数: " + i);
                }
                catch
                {
                    ed.WriteMessage("\n退化的拓扑结构, 边不存在!");
                }

                i = 0;
                List<Point3d> pts = new List<Point3d>();
                try
                {
                    // 顶点集合
                    BrepVertexCollection VertexCol = brepEnt.Vertices;
                    // 顶点遍历器
                    BrepVertexEnumerator vertexEnumerator = VertexCol.GetEnumerator();
                    while (vertexEnumerator.MoveNext())
                    {
                        i++;
                        // 得到顶点
                        AcBr.Vertex vertex = vertexEnumerator.Current;
                        // 得到顶点坐标
                        Point3d pt = vertex.Point;
                        pts.Add(pt);
                    }
                    ed.WriteMessage("\n顶点(Vertex)数: " + i);
                    ed.WriteMessage("\n");

                    for (int j = 0; j < pts.Count; j++)
                    {
                        ed.WriteMessage("\n第{0}个顶点(Vertex)坐标: {1},{2},{3}", j + 1,
                            pts[j].X, pts[j].Y, pts[j].Z);
                    }
                }
                catch
                {
                    ed.WriteMessage("\n退化的拓扑结构, 顶点不存在!");
                }
                trans.Commit();
            }
        }

        [CommandMethod("GetCylRadius")]
        public void GetCylRadiusTest()
        {
            Editor ed = Application.DocumentManager.MdiActiveDocument.Editor;
            Database db = HostApplicationServices.WorkingDatabase;

            // 选择三维实体的面
            PromptSelectionOptions pso = new PromptSelectionOptions();
            pso.MessageForAdding = "\n请选择三维实体的面";
            pso.SingleOnly = true;
            pso.ForceSubSelections = true;
            pso.SinglePickInSpace = true;

            PromptSelectionResult psr = ed.GetSelection(pso);
            if (psr.Status != PromptStatus.OK)
            {
                return;
            }

            SelectionSet sSet = psr.Value;
            SelectedSubObject[] sSubObjArr = psr.Value[0].GetSubentities();
            FullSubentityPath facePath = sSubObjArr[0].FullSubentityPath;
            SubentityId faceSubId = facePath.SubentId;

            if (faceSubId.Type != SubentityType.Face)
            {
                ed.WriteMessage("\n没有选择三维实体的面!");
                return;
            }

            AcBr.Face face = new AcBr.Face(facePath);
            AcGe.Surface surf = face.Surface;
            ExternalBoundedSurface ebSurf = surf as ExternalBoundedSurface;

            if (ebSurf != null && ebSurf.IsCylinder)
            {
                Cylinder cyl = ebSurf.BaseSurface as Cylinder;

                if (cyl != null)
                {
                    double radius = cyl.Radius;
                    ed.WriteMessage("\n圆柱面半径 = {0}", radius);
                }
            }
            else
            {
                ed.WriteMessage("\n选择的不是圆柱面!");
            }
        }

        [CommandMethod("GetAllCylRadius")]
        public void GetAllCylRadiusTest()
        {
            Editor ed = Application.DocumentManager.MdiActiveDocument.Editor;
            Database db = HostApplicationServices.WorkingDatabase;

            PromptEntityOptions opt = new PromptEntityOptions("\n选择三维实体");
            opt.SetRejectMessage("您选择的不是三维实体，请重新选择!");
            opt.AddAllowedClass(typeof(Solid3d), true);

            PromptEntityResult res = ed.GetEntity(opt);
            if (res.Status != PromptStatus.OK)
            {
                return;
            }

            using (Transaction trans = db.TransactionManager.StartTransaction())
            {
                Entity ent = (Entity)trans.GetObject(res.ObjectId, OpenMode.ForWrite);
                Brep brepEnt = new Brep(ent);

                int i = 0;
                BrepFaceEnumerator faceEnumerator = brepEnt.Faces.GetEnumerator();
                while (faceEnumerator.MoveNext())
                {
                    AcGe.Surface surf = faceEnumerator.Current.Surface;
                    ExternalBoundedSurface ebSurf = surf as ExternalBoundedSurface;

                    if (ebSurf != null && ebSurf.IsCylinder)
                    {
                        Cylinder cyl = ebSurf.BaseSurface as Cylinder;

                        if (cyl != null)
                        {
                            double radius = cyl.Radius;
                            ed.WriteMessage("\n圆柱面半径 = {0}", radius);
                        }
                    }
                    i++;
                }
            }
        }

        [CommandMethod("test2")]
        public void MyTest2()
        {
            Editor ed = Application.DocumentManager.MdiActiveDocument.Editor;
            Database db = HostApplicationServices.WorkingDatabase;

            PromptEntityOptions optEnt = new PromptEntityOptions("\n选择面域");
            optEnt.SetRejectMessage("您选择的不是面域，请重新选择!");
            optEnt.AddAllowedClass(typeof(Region), true);

            PromptEntityResult resEnt = ed.GetEntity(optEnt);
            if (resEnt.Status != PromptStatus.OK)
            {
                return;
            }
            ObjectId entId = resEnt.ObjectId;

            PromptPointOptions optPoint = new PromptPointOptions("\n请指定点");
            PromptPointResult resPoint = ed.GetPoint(optPoint);

            if (resPoint.Status != PromptStatus.OK)
            {
                return;
            }
            Point3d pt = resPoint.Value;

            using (Transaction trans = db.TransactionManager.StartTransaction())
            {
                Region regEnt = (Region)trans.GetObject(resEnt.ObjectId, OpenMode.ForRead);
                Brep brepEnt = new Brep(regEnt);

                BrepFaceEnumerator faceEnumerator = brepEnt.Faces.GetEnumerator();
                while (faceEnumerator.MoveNext())
                {
                    PointContainment containment;
                    faceEnumerator.Current.GetPointContainment(pt, out containment);

                    if (containment == PointContainment.Inside)
                    {
                        ed.WriteMessage("\n该点在面域的内部!");
                        return;
                    }

                    if (containment == PointContainment.OnBoundary)
                    {
                        ed.WriteMessage("\n该点在面域的边界上!");
                        return;
                    }
                } // end while
                ed.WriteMessage("\n该点在面域的外部!");
                trans.Commit();
            }
        }

        [CommandMethod("Test")]
        public void Test()
        {
            Database db = HostApplicationServices.WorkingDatabase;
            Editor ed = Application.DocumentManager.MdiActiveDocument.Editor;

            PromptEntityOptions opt1 = new PromptEntityOptions("\n请选择面域: ");
            opt1.SetRejectMessage("\n必须选择面域!");
            opt1.AddAllowedClass(typeof(Region), true);

            PromptEntityResult res1 = ed.GetEntity(opt1);
            if (res1.Status != PromptStatus.OK)
            {
                return;
            }
            ObjectId regId = res1.ObjectId;

            PromptEntityOptions opt2 = new PromptEntityOptions("\n请选择直线: ");
            opt2.SetRejectMessage("\n必须选择直线!");
            opt2.AddAllowedClass(typeof(Line), true);

            PromptEntityResult res2 = ed.GetEntity(opt2);
            if (res2.Status != PromptStatus.OK)
            {
                return;
            }
            ObjectId lineId = res2.ObjectId;

            using (Transaction trans = db.TransactionManager.StartTransaction())
            {
                Region regEnt = (Region)trans.GetObject(res1.ObjectId, OpenMode.ForRead);
                Line lineEnt = (Line)trans.GetObject(res2.ObjectId, OpenMode.ForRead);

                Brep brp = new Brep(regEnt);
                LineSegment3d ln = new LineSegment3d(lineEnt.StartPoint, lineEnt.EndPoint);
                int maxNum = 10;
                Hit[] hits = brp.GetLineContainment(ln, maxNum);
                if (hits != null && hits.Length > 0)
                {
                    foreach (Hit hit in hits)
                    {
                        ed.WriteMessage("\n面域和直线的交点坐标: {0}", hit.Point);
                    }
                }
                else
                {
                    ed.WriteMessage("\n面域和直线无交点!");
                }
                trans.Commit();
            }
        }

    }
}

﻿using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.Geometry;
using Autodesk.AutoCAD.Runtime;
using DotNetARX;
namespace Texts
{
    public class Texts
    {
        [CommandMethod("AddText")]
        public void AddText()
        {
            Database db=HostApplicationServices.WorkingDatabase;
            using (Transaction trans=db.TransactionManager.StartTransaction())
            {
                DBText textFirst=new DBText(); // 创建第一个单行文字
                textFirst.Position = new Point3d(50, 50, 0);//文字位置
                textFirst.Height = 5;//文字高度 
                //设置文字内容，特殊格式为≈、下划线和平方
                textFirst.TextString = "面积" + TextSpecialSymbol.AlmostEqual + TextSpecialSymbol.Underline + "2000" + TextSpecialSymbol.Underline + "m" + TextSpecialSymbol.Square;
                //设置文字的水平对齐方式为居中
                textFirst.HorizontalMode = TextHorizontalMode.TextCenter;
                //设置文字的垂直对齐方式为居中
                textFirst.VerticalMode = TextVerticalMode.TextVerticalMid;
                //设置文字的对齐点
                textFirst.AlignmentPoint = textFirst.Position;
                DBText textSecond=new DBText();// 创建第二个单行文字
                textSecond.Height = 5; //文字高度
                //设置文字内容，特殊格式为角度、希腊字母和度数
                textSecond.TextString = TextSpecialSymbol.Angle + TextSpecialSymbol.Belta + "=45" + TextSpecialSymbol.Degree;
                //设置文字的对齐方式为居中对齐
                textSecond.HorizontalMode = TextHorizontalMode.TextCenter;
                textSecond.VerticalMode = TextVerticalMode.TextVerticalMid;
                //设置文字的对齐点
                textSecond.AlignmentPoint = new Point3d(50, 40, 0);
                DBText textLast=new DBText();//创建第三个单行文字
                textLast.Height = 5;// 文字高度
                //设置文字的内容，特殊格式为直径和公差
                textLast.TextString = TextSpecialSymbol.Diameter + "30的直径偏差为" + TextSpecialSymbol.Tolerance + "0.01";
                //设置文字的对齐方式为居中对齐
                textLast.HorizontalMode = TextHorizontalMode.TextCenter;
                textLast.VerticalMode = TextVerticalMode.TextVerticalMid;
                //设置文字的对齐点
                textLast.AlignmentPoint = new Point3d(50, 30, 0);
                db.AddToModelSpace(textFirst, textSecond, textLast);//添加文本到模型空间
                trans.Commit();//提交事务处理
            }
        }

        [CommandMethod("AddStackText")]
        public void AddStackText()
        {
            Database db=HostApplicationServices.WorkingDatabase;
            using (Transaction trans=db.TransactionManager.StartTransaction())
            {
                MText mtext=new MText();//创建多行文本对象
                mtext.Location = new Point3d(100, 40, 0);//位置
                //创建水平分数形式的堆叠文字
                string firstLine=TextTools.StackText(TextSpecialSymbol.Diameter + "20", "H7", "P7", StackType.HorizontalFraction, 0.5);
                //创建斜分数形式的堆叠文字
                string secondLine=TextTools.StackText(TextSpecialSymbol.Diameter + "20", "H7", "P7", StackType.ItalicFraction, 0.5);
                //创建公差形式的堆叠文字
                string lastLine=TextTools.StackText(TextSpecialSymbol.Diameter + "20", "+0.020", "-0.010", StackType.Tolerance, 0.5);
                //将前面定义的堆叠文字合并，作为多行文本的内容
                mtext.Contents = firstLine + MText.ParagraphBreak + secondLine + "\n" + lastLine;
                mtext.TextHeight = 5;//文本高度
                mtext.Width = 0;//文本宽度，设为0表示不会自动换行
                //设置多行文字的对齐方式正中
                mtext.Attachment = AttachmentPoint.MiddleCenter;
                db.AddToModelSpace(mtext);//添加文本到模型空间中
                trans.Commit();//提交事务处理
            }
        }
    }
}
﻿using System;
using Autodesk.AutoCAD.ApplicationServices;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.EditorInput;
using Autodesk.AutoCAD.Runtime;
using DotNetARX;
namespace TextStyles
{
    public class TextStyles
    {
        [CommandMethod("NewStyle")]
        public void NewStyle()
        {
            Database db=HostApplicationServices.WorkingDatabase;
            Editor ed=Application.DocumentManager.MdiActiveDocument.Editor;
            using (Transaction trans=db.TransactionManager.StartTransaction())
            {
                //设置TrueType字体(仿宋体）
                ObjectId styleId=db.AddTextStyle("仿宋体", "simfang.ttf");
                DBText txt1=new DBText();
                txt1.TextString = "仿宋体";
                txt1.TextStyle = styleId;//文字样式
                //设置SHX字体(romans）
                styleId = db.AddTextStyle("罗马字体", "romans", "gbcbig");
                DBText txt2=new DBText();
                txt2.TextString = "罗马字体";
                txt2.TextStyle = styleId;//文字样式
                txt2.Position = txt1.Position.PolarPoint(Math.PI / 2, 5);
                //设置SHX字体(romans）
                styleId = db.AddTextStyle("垂直罗马字体", "romans", "gbcbig");
                //设置文字样式的各种属性
                styleId.SetTextStyleProp(2.0, 0.67, 15 * Math.PI / 180, true, true, true, AnnotativeStates.True, true);
                DBText txt3=new DBText();
                txt3.TextString = "垂直罗马字体";
                txt3.TextStyle = styleId;
                txt3.Position = txt1.Position.PolarPoint(0, 20);
                //设置TrueType字体(宋体）并且有加粗、倾斜效果
                styleId = db.AddTextStyle("加粗斜宋体", "宋体", true, true, 0, 0);
                DBText txt4=new DBText();
                txt4.TextString = "加粗斜宋体";
                txt4.TextStyle = styleId;
                txt4.Position = txt2.Position.PolarPoint(Math.PI / 2, 5);
                db.AddToModelSpace(txt1, txt2, txt3, txt4);
                txt3.SetFromTextStyle();//必须将文本加入到数据库后再匹配文字样式的属性                
                trans.Commit();
            }
        }
    }
}
﻿using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.GraphicsInterface;
namespace DotNetARX
{
    /// <summary>
    /// 字体字符集名称
    /// </summary>
    public enum FontCharSet
    {
        /// <summary>
        /// 英文
        /// </summary>
        Ansi = 0,
        /// <summary>
        /// 与当前操作系统语言有关，如为简体中文，则被设置为GB2312
        /// </summary>
        Default = 1,
        /// <summary>
        /// 简体中文
        /// </summary>
        GB2312 = 134,
        /// <summary>
        /// 繁体中文
        /// </summary>
        Big5 = 136,
        /// <summary>
        /// 与操作系统有关
        /// </summary>
        OEM = 255
    }

    /// <summary>
    /// 字体的字宽
    /// </summary>
    public enum FontPitch
    {
        /// <summary>
        /// 默认字宽
        /// </summary>
        Default = 0,
        /// <summary>
        /// 固定字宽
        /// </summary>
        Fixed = 1,
        /// <summary>
        /// 可变字宽
        /// </summary>
        Variable = 2
    }

    /// <summary>
    /// 字体的语系定义
    /// </summary>
    public enum FontFamily
    {
        /// <summary>
        /// 使用默认字体
        /// </summary>
        Dontcare = 0,
        /// <summary>
        /// 可变的笔划宽度，有衬线，如MS Serif字体
        /// </summary>
        Roman = 16,
        /// <summary>
        /// 可变的笔划宽度，无衬线，如MS Sans Serif字体 
        /// </summary>
        Swiss = 32,
        /// <summary>
        /// 固定笔划宽度，衬线可以有也可以没有,如Courier New字体
        /// </summary>
        Modern = 48,
        /// <summary>
        /// 手写体，如Cursive字体
        /// </summary>
        Script = 64,
        /// <summary>
        /// 小说字体，如旧式英语
        /// </summary>
        Decorative = 80
    }

    /// <summary>
    /// 文字样式操作类
    /// </summary>
    public static class TextStyleTools
    {
        /// <summary>
        /// 创建一个新的文字样式
        /// </summary>
        /// <param name="db">数据库对象</param>
        /// <param name="styleName">文字样式名</param>
        /// <param name="fontFilename">字体文件名</param>
        /// <param name="bigFontFilename">大字体文件名</param>
        /// <returns>返回添加的文字样式的Id</returns>
        public static ObjectId AddTextStyle(this Database db, string styleName, string fontFilename, string bigFontFilename)
        {
            //打开文字样式表
            TextStyleTable st=(TextStyleTable)db.TextStyleTableId.GetObject(OpenMode.ForRead);
            if (!st.Has(styleName))//如果不存在名为styleName的文字样式，则新建一个文字样式
            {
                //定义一个新的文字样式表记录
                TextStyleTableRecord str=new TextStyleTableRecord();
                str.Name = styleName;//设置文字样式名
                str.FileName = fontFilename;//设置字体文件名
                str.BigFontFileName = bigFontFilename;//设置大字体文件名
                st.UpgradeOpen();//切换文字样式表的状态为写以添加新的文字样式
                st.Add(str);//将文字样式表记录的信息添加到文字样式表中
                //把文字样式表记录添加到事务处理中
                db.TransactionManager.AddNewlyCreatedDBObject(str, true);
                st.DowngradeOpen();//为了安全，将文字样式表的状态切换为读
            }
            return st[styleName];//返回新添加的文字样式表记录的ObjectId
        }

        /// <summary>
        /// 创建一个新的文字样式
        /// </summary>
        /// <param name="db">数据库对象</param>
        /// <param name="styleName">文字样式名</param>
        /// <param name="fontFilename">字体文件名</param>
        /// <returns>返回添加的文字样式的Id</returns>
        public static ObjectId AddTextStyle(this Database db, string styleName, string fontFilename)
        {
            return db.AddTextStyle(styleName, fontFilename, "");
        }

        /// <summary>
        /// 创建一个新的文字样式
        /// </summary>
        /// <param name="db">数据库对象</param>
        /// <param name="styleName">文字样式名</param>
        /// <param name="fontName">字体文件名</param>
        /// <param name="bold">是否加粗</param>
        /// <param name="italic">是否倾斜</param>
        /// <param name="charset">字体的字符集</param>
        /// <param name="pitchAndFamily">字体的字宽和语系定义</param>
        /// <returns>返回添加的文字样式的Id</returns>
        public static ObjectId AddTextStyle(this Database db, string styleName, string fontName, bool bold, bool italic, int charset, int pitchAndFamily)
        {
            //打开文字样式表
            TextStyleTable st=(TextStyleTable)db.TextStyleTableId.GetObject(OpenMode.ForRead);
            if (!st.Has(styleName))//如果不存在名为styleName的文字样式，则新建一个文字样式
            {
                //定义一个新的的文字样式表记录
                TextStyleTableRecord str=new TextStyleTableRecord();
                str.Name = styleName;//设置的文字样式名
                //设置文字样式的字体
                str.Font = new FontDescriptor(fontName, bold, italic, charset, pitchAndFamily);
                st.UpgradeOpen();//切换的文字样式表的状态为写以添加新的的文字样式
                st.Add(str);//将新建的文字样式表记录的信息添加到文字样式表中
                //把的文字样式表记录添加到事务处理中
                db.TransactionManager.AddNewlyCreatedDBObject(str, true);
                st.DowngradeOpen();//为了安全，将文字样式表的状态切换为读
            }
            return st[styleName];//返回新添加的的文字样式表记录的ObjectId
        }

        /// <summary>
        /// 添加包含图案的形定义文件
        /// </summary>
        /// <param name="db">数据库对象</param>
        /// <param name="styleName">样式名</param>
        /// <param name="shapeFilename">形定义文件名</param>
        /// <returns>返回新添加的文字样式表记录的ObjectId</returns>
        public static ObjectId AddShapeTextStyle(this Database db, string styleName, string shapeFilename)
        {
            //打开文字样式表
            TextStyleTable st=(TextStyleTable)db.TextStyleTableId.GetObject(OpenMode.ForRead);
            if (!st.Has(styleName))//如果不存在名为styleName的文字样式，则新建一个文字样式
            {
                //定义一个新的的文字样式表记录
                TextStyleTableRecord tstr=new TextStyleTableRecord();
                tstr.Name = styleName;//设置的文字样式名
                tstr.FileName = shapeFilename;//设置字体文件名
                tstr.IsShapeFile = true;//文件为形定义文件
                st.UpgradeOpen();//切换的文字样式表的状态为写以添加新的的文字样式
                st.Add(tstr);//将新建的文字样式表记录的信息添加到文字样式表中
                //把的文字样式表记录添加到事务处理中
                db.TransactionManager.AddNewlyCreatedDBObject(tstr, true);
                st.DowngradeOpen();
            }
            return st[styleName];//返回新添加的文字样式表记录的ObjectId
        }

        /// <summary>
        /// 设置当前文字样式
        /// </summary>
        /// <param name="db">数据库对象</param>
        /// <param name="styleName">文字样式名</param>
        /// <returns>如果设置成功返回true，否则返回false</returns>
        public static bool SetCurrentTextStyle(this Database db, string styleName)
        {
            var trans=db.TransactionManager;
            //打开文字样式表
            TextStyleTable st=(TextStyleTable)trans.GetObject(db.TextStyleTableId, OpenMode.ForRead);
            //如果不存在名为styleName的文字样式，则返回
            if (!st.Has(styleName)) return false;
            //获取名为styleName的的文字样式表记录的Id
            ObjectId styleId=st[styleName];
            //如果指定的文字样式为当前文字样式，则返回
            if (db.Textstyle == styleId) return false;
            //指定当前文字样式
            db.Textstyle = styleId;
            return true;//指定当前文字样式成功
        }

        /// <summary>
        /// 删除文字样式
        /// </summary>
        /// <param name="db">数据库对象</param>
        /// <param name="styleName">文字样式名</param>
        /// <returns>如果删除成功返回true，否则返回false</returns>
        public static bool DeleteTextStyle(this Database db, string styleName)
        {
            var trans=db.TransactionManager;
            //打开文字样式表
            TextStyleTable st=(TextStyleTable)trans.GetObject(db.TextStyleTableId, OpenMode.ForRead);
            //如果不存在名为styleName的文字样式，则返回
            if (!st.Has(styleName)) return false;
            //获取名为styleName的文字样式表记录的Id
            ObjectId styleId=st[styleName];
            //如果要删除的文字样式为当前文字样式，则返回（不能删除当前文字样式）
            if (styleId == db.Textstyle) return false;
            //以写的方式打开名为styleName的文字样式表记录
            TextStyleTableRecord str=(TextStyleTableRecord)trans.GetObject(styleId, OpenMode.ForWrite);
            //删除名为styleName的文字样式
            str.Erase(true);
            return true;//删除文字样式成功
        }

        /// <summary>
        /// 设置文字样式的有关属性
        /// </summary>
        /// <param name="styleId">文字样式的Id</param>
        /// <param name="textSize">高度</param>
        /// <param name="xscale">宽度因子</param>
        /// <param name="obliquingAngle">倾斜角度</param>
        /// <param name="isVertical">是否垂直</param>
        /// <param name="upsideDown">是否上下颠倒</param>
        /// <param name="backwards">是否反向</param>
        /// <param name="annotative">是否具有注释性</param>
        /// <param name="paperOrientation">文字方向与布局是否匹配</param>
        public static void SetTextStyleProp(this ObjectId styleId, double textSize, double xscale, double obliquingAngle, bool isVertical, bool upsideDown, bool backwards, AnnotativeStates annotative, bool paperOrientation)
        {
            //打开文字样式表记录
            TextStyleTableRecord str=styleId.GetObject(OpenMode.ForWrite) as TextStyleTableRecord;
            if (str == null) return;////如果styleId表示是不是文字样式表记录，则返回            
            str.TextSize = textSize;//高度
            str.XScale = xscale;//宽度因子
            str.ObliquingAngle = obliquingAngle;//倾斜角度
            str.IsVertical = isVertical;//是否垂直
            str.FlagBits = (byte)0;
            str.FlagBits += upsideDown ? (byte)2 : (byte)0;//是否上下颠倒
            str.FlagBits += backwards ? (byte)4 : (byte)0;//是否反向
            str.Annotative = annotative;//是否具有注释性
            str.SetPaperOrientation(paperOrientation);//文字方向与布局是否匹配           
            str.DowngradeOpen();//为了安全切换为读的状态            
        }
    }
}
﻿using System;
using System.Text.RegularExpressions;
using Autodesk.AutoCAD.DatabaseServices;
namespace DotNetARX
{
    /// <summary>
    /// 多行文字堆叠方式
    /// </summary>
    public enum StackType
    {
        /// <summary>
        /// 水平分数(/)
        /// </summary>
        HorizontalFraction,
        /// <summary>
        /// 斜分数(#)
        /// </summary>
        ItalicFraction,
        /// <summary>
        /// 公差(^)
        /// </summary>
        Tolerance
    }
    /// <summary>
    /// 特殊字符
    /// </summary>
    public struct TextSpecialSymbol
    {
        #region 特殊字符
        /// <summary>
        /// 度符号(°)
        /// </summary>
        public static readonly string Degree=@"\U+00B0";
        /// <summary>
        /// 公差符号(±)
        /// </summary>
        public static readonly string Tolerance=@"\U+00B1";
        /// <summary>
        /// 直径符号(φ)
        /// </summary>
        public static readonly string Diameter=@"\U+2205";
        /// <summary>
        /// 几乎相等(≈)
        /// </summary>
        public static readonly string AlmostEqual=@"\U+2248";
        /// <summary>
        /// 角度(∠)
        /// </summary>
        public static readonly string Angle=@"\U+2220";
        /// <summary>
        /// 边界线
        /// </summary>
        public static readonly string LineBoundary=@"\U+E100";
        /// <summary>
        /// 中心线
        /// </summary>
        public static readonly string LineCenter=@"\U+2104";
        /// <summary>
        /// 增量(Δ)
        /// </summary>
        public static readonly string Delta=@"\U+0394";
        /// <summary>
        /// 电相位(φ)
        /// </summary>
        public static readonly string ElectricalPhase=@"\U+0278";
        /// <summary>
        /// 流线
        /// </summary>
        public static readonly string LineFlow=@"\U+E101";
        /// <summary>
        /// 标识
        /// </summary>
        public static readonly string Identity=@"\U+2261";
        /// <summary>
        /// 初始长度
        /// </summary>
        public static readonly string InitialLength=@"\U+E200";
        /// <summary>
        /// 界碑线
        /// </summary>
        public static readonly string LineMonument=@"\U+E102";
        /// <summary>
        /// 不相等(≠)
        /// </summary>
        public static readonly string Notequal=@"\U+2260";
        /// <summary>
        /// 欧姆
        /// </summary>
        public static readonly string Ohm=@"\U+2126";
        /// <summary>
        /// 欧米加(Ω)
        /// </summary>
        public static readonly string Omega=@"\U+03A9";
        /// <summary>
        /// 地界线
        /// </summary>
        public static readonly string LinePlate=@"\U+214A";
        /// <summary>
        /// 下标2
        /// </summary>
        public static readonly string Subscript2=@"\U+2082";
        /// <summary>
        /// 平方
        /// </summary>
        public static readonly string Square=@"\U+00B2";
        /// <summary>
        /// 立方
        /// </summary>
        public static readonly string Cube=@"\U+00B3";
        #endregion
        #region 单行文字上下划线
        /// <summary>
        /// 单行文字上划线
        /// </summary>
        public static readonly string Overline=@"%%o";
        /// <summary>
        /// 单行文字下划线
        /// </summary>
        public static readonly string Underline=@"%%u";
        #endregion
        #region 希腊字母
        /// <summary>
        /// α
        /// </summary>
        public static readonly string Alpha=@"\U+03B1";
        /// <summary>
        /// β
        /// </summary>
        public static readonly string Belta=@"\U+03B2";
        /// <summary>
        /// γ 
        /// </summary>
        public static readonly string Gamma=@"\U+03B3";
        #endregion
        #region 钢筋符号
        /// <summary>
        /// 一级钢筋符号
        /// </summary>
        public static readonly string SteelBar1=@"\U+0082";
        /// <summary>
        /// 二级钢筋符号
        /// </summary>
        public static readonly string SteelBar2=@"\U+0083";
        /// <summary>
        /// 三级钢筋符号
        /// </summary>
        public static readonly string SteelBar3=@"\U+0084";
        /// <summary>
        /// 四级钢筋符号
        /// </summary>
        public static readonly string SteelBar4=@"\U+0085";
        #endregion
    }
    /// <summary>
    /// 文字操作类
    /// </summary>
    public static class TextTools
    {
        /// <summary>
        /// 获取多行文字的真实内容
        /// </summary>
        /// <param name="mtext">多行文字对象</param>
        /// <returns>返回多行文字的真实内容</returns>
        public static string GetText(this MText mtext)
        {
            string content=mtext.Contents;//多行文本内容
            //将多行文本按“\\”进行分割
            string[] strs=content.Split(new string[] { @"\\" }, StringSplitOptions.None);
            //指定不区分大小写
            RegexOptions ignoreCase=RegexOptions.IgnoreCase;
            for (int i = 0; i < strs.Length; i++)
            {
                //删除段落缩进格式
                strs[i] = Regex.Replace(strs[i], @"\\pi(.[^;]*);", "", ignoreCase);
                //删除制表符格式
                strs[i] = Regex.Replace(strs[i], @"\\pt(.[^;]*);", "", ignoreCase);
                //删除堆迭格式
                strs[i] = Regex.Replace(strs[i], @"\\S(.[^;]*)(\^|#|\\)(.[^;]*);", @"$1$3", ignoreCase);
                strs[i] = Regex.Replace(strs[i], @"\\S(.[^;]*)(\^|#|\\);", "$1", ignoreCase);
                //删除字体、颜色、字高、字距、倾斜、字宽、对齐格式
                strs[i] = Regex.Replace(strs[i], @"(\\F|\\C|\\H|\\T|\\Q|\\W|\\A)(.[^;]*);", "", ignoreCase);
                //删除下划线、删除线格式
                strs[i] = Regex.Replace(strs[i], @"(\\L|\\O|\\l|\\o)", "", ignoreCase);
                //删除不间断空格格式
                strs[i] = Regex.Replace(strs[i], @"\\~", "", ignoreCase);
                //删除换行符格式
                strs[i] = Regex.Replace(strs[i], @"\\P", "\n", ignoreCase);
                //删除换行符格式(针对Shift+Enter格式)
                //strs[i] = Regex.Replace(strs[i], "\n", "", ignoreCase);
                //删除{}
                strs[i] = Regex.Replace(strs[i], @"({|})", "", ignoreCase);
                //替换回\\,\{,\}字符
                //strs[i] = Regex.Replace(strs[i], @"\x01", @"\", ignoreCase);
                //strs[i] = Regex.Replace(strs[i], @"\x02", @"{", ignoreCase);
                //strs[i] = Regex.Replace(strs[i], @"\x03", @"}", ignoreCase);
            }
            return string.Join("\\", strs);//将文本中的特殊字符去掉后重新连接成一个字符串
        }
        /// <summary>
        /// 堆叠多行文字
        /// </summary>
        /// <param name="text">堆叠分数前的文字</param>
        /// <param name="supText">堆叠分数的分子</param>
        /// <param name="subText">堆叠分数的分母</param>
        /// <param name="stackType">堆叠类型</param>
        /// <param name="scale">堆叠文字的缩放比例</param>
        /// <returns>返回堆叠好的文字</returns>
        public static string StackText(string text, string supText, string subText, StackType stackType, double scale)
        {
            //设置堆叠方式所代表的字符，用于将StackType枚举转换为对应的字符
            string[] strs=new string[] { "/", "#", "^" };
            //设置堆叠文字
            return string.Format(
                    "\\A1;{0}{1}\\H{2:0.#}x;\\S{3}{4}{5};{6}",
                    text, "{", scale, supText, strs[(int)stackType],
                    subText, "}");
        }

        /// <summary>
        /// 设置单行文本的属性为当前文字样式的属性
        /// </summary>
        /// <param name="txt">单行文本对象</param>
        public static void SetFromTextStyle(this DBText txt)
        {
            //打开文字样式表记录
            TextStyleTableRecord str=(TextStyleTableRecord)txt.TextStyleId.GetObject(OpenMode.ForRead);
            //必须保证文字为写的状态
            if (!txt.IsWriteEnabled)
                txt.UpgradeOpen();
            txt.Oblique = str.ObliquingAngle;//设置倾斜角(弧度)
            txt.Annotative = str.Annotative;//设置文字的注释性
            //文字方向与布局是否匹配
            txt.SetPaperOrientation(Convert.ToBoolean(str.PaperOrientation));
            txt.WidthFactor = str.XScale;//设置宽度比例
            txt.Height = str.TextSize;//设置高度
            if (str.FlagBits == 2)
            {
                txt.IsMirroredInX = true;//颠倒
            }
            else if (str.FlagBits == 4)
            {
                txt.IsMirroredInY = true;//反向
            }
            else if (str.FlagBits == 6)//颠倒并反向
            {
                txt.IsMirroredInX = txt.IsMirroredInY = true;
            }
            txt.DowngradeOpen();//为了安全切换为读的状态
        }

        /// <summary>
        /// 设置多行文本的属性为当前文字样式的属性
        /// </summary>
        /// <param name="mtxt">多行文本对象</param>
        public static void SetFromTextStyle(this MText mtxt)
        {
            Database db=mtxt.Database;
            var trans=db.TransactionManager;
            TextStyleTableRecord str=(TextStyleTableRecord)trans.GetObject(mtxt.TextStyleId, OpenMode.ForRead);
            if (!mtxt.IsWriteEnabled)
                mtxt.UpgradeOpen();
            mtxt.Rotation = str.ObliquingAngle;
            mtxt.Annotative = str.Annotative;
            mtxt.SetPaperOrientation(Convert.ToBoolean(str.PaperOrientation));
            mtxt.LineSpacingFactor = str.XScale;
            mtxt.TextHeight = str.TextSize;
        }
    }
}
﻿using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.Geometry;
using Autodesk.AutoCAD.GraphicsInterface;
using DotNetARX;
namespace CustomSnap
{
    //自定义对象捕捉靶框
    public class ThirdGlyph : Glyph
    {
        Point3d pt;//存储自定义对象捕捉靶框的位置
        public override void SetLocation(Point3d point)
        {
            pt = point;//设置自定义靶框的位置
        }
        public override void ViewportDraw(ViewportDraw vd)
        {
            //获取单位正方形内中心点的像素
            Point2d glyphSize = vd.Viewport.GetNumPixelsInUnitSquare(pt);
            //根据系统靶框的高度调整自定义靶框的高度
            double glyphHeight = CustomObjectSnapMode.GlyphSize / glyphSize.Y;
            //从DCS坐标系到WCS坐标系的转换矩阵
            Matrix3d d2w=vd.Viewport.EyeToWorldTransform;
            //创建一个由4点组成的数组，表示自定义靶框的矩形顶点，并将其从DCS坐标系转换到WCS坐标系
            Point3d[] pts={new Point3d(pt.X+glyphHeight,pt.Y,pt.Z).TransformBy(d2w),
        new Point3d(pt.X,pt.Y+glyphHeight,pt.Z).TransformBy(d2w),
        new Point3d(pt.X-glyphHeight,pt.Y,pt.Z).TransformBy(d2w),
        new Point3d(pt.X,pt.Y-glyphHeight,pt.Z).TransformBy(d2w)};
            //绘制表示自定义靶框的矩形
            vd.Geometry.Polygon(new Point3dCollection(pts));
            //在自定义靶框矩形的下方绘制文字,方向沿X方向
            vd.Geometry.Text(pts[3].PolarPoint(0, glyphHeight), Vector3d.ZAxis, Vector3d.XAxis, glyphHeight, 1.0, 0.0, "1/3");
        }
    }
}
﻿using System;
using System.Text.RegularExpressions;
using Autodesk.AutoCAD.ApplicationServices;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.EditorInput;
using Autodesk.AutoCAD.Geometry;
using Autodesk.AutoCAD.Runtime;
namespace DotNetARX
{
    /// <summary>
    /// 辅助操作类
    /// </summary>
    public static partial class Tools
    {
        /// <summary>
        /// 判断字符串是否为数字
        /// </summary>
        /// <param name="value">字符串</param>
        /// <returns>如果字符串为数字，返回true，否则返回false</returns>
        public static bool IsNumeric(this string value)
        {
            return Regex.IsMatch(value, @"^[+-]?\d*[.]?\d*$");
        }

        /// <summary>
        /// 判断字符串是否为整数
        /// </summary>
        /// <param name="value">字符串</param>
        /// <returns>如果字符串为整数，返回true，否则返回false</returns>
        public static bool IsInt(this string value)
        {
            return Regex.IsMatch(value, @"^[+-]?\d*$");
        }

        /// <summary>
        /// 获取当前.NET程序所在的目录
        /// </summary>
        /// <returns>返回当前.NET程序所在的目录</returns>
        public static string GetCurrentPath()
        {
            var moudle=System.Reflection.Assembly.GetExecutingAssembly().GetModules()[0];
            return System.IO.Path.GetDirectoryName(moudle.FullyQualifiedName);
        }

        /// <summary>
        /// 判断字符串是否为空或空白
        /// </summary>
        /// <param name="value">字符串</param>
        /// <returns>如果字符串为空或空白，返回true，否则返回false</returns>
        public static bool IsNullOrWhiteSpace(this string value)
        {
            if (value == null) return false;
            return string.IsNullOrEmpty(value.Trim());
        }

        /// <summary>
        /// 获取模型空间的ObjectId
        /// </summary>
        /// <param name="db">数据库对象</param>
        /// <returns>返回模型空间的ObjectId</returns>
        public static ObjectId GetModelSpaceId(this Database db)
        {
            return SymbolUtilityServices.GetBlockModelSpaceId(db);
        }

        /// <summary>
        /// 获取图纸空间的ObjectId
        /// </summary>
        /// <param name="db"></param>
        /// <returns>返回图纸空间的ObjectId</returns>
        public static ObjectId GetPaperSpaceId(this Database db)
        {
            return SymbolUtilityServices.GetBlockPaperSpaceId(db);
        }

        /// <summary>
        /// 将实体添加到模型空间
        /// </summary>
        /// <param name="db">数据库对象</param>
        /// <param name="ent">要添加的实体</param>
        /// <returns>返回添加到模型空间中的实体ObjectId</returns>
        public static ObjectId AddToModelSpace(this Database db, Entity ent)
        {
            ObjectId entId;//用于返回添加到模型空间中的实体ObjectId
            //定义一个指向当前数据库的事务处理，以添加直线
            using (Transaction trans=db.TransactionManager.StartTransaction())
            {
                //以读方式打开块表
                BlockTable bt=(BlockTable)trans.GetObject(db.BlockTableId, OpenMode.ForRead);
                //以写方式打开模型空间块表记录.
                BlockTableRecord btr=(BlockTableRecord)trans.GetObject(bt[BlockTableRecord.ModelSpace], OpenMode.ForWrite);
                entId = btr.AppendEntity(ent);//将图形对象的信息添加到块表记录中
                trans.AddNewlyCreatedDBObject(ent, true);//把对象添加到事务处理中
                trans.Commit();//提交事务处理
            }
            return entId; //返回实体的ObjectId
        }

        /// <summary>
        /// 将实体添加到模型空间
        /// </summary>
        /// <param name="db">数据库对象</param>
        /// <param name="ents">要添加的多个实体</param>
        /// <returns>返回添加到模型空间中的实体ObjectId集合</returns>
        public static ObjectIdCollection AddToModelSpace(this Database db, params Entity[] ents)
        {
            ObjectIdCollection ids=new ObjectIdCollection();
            var trans=db.TransactionManager;
            BlockTableRecord btr=(BlockTableRecord)trans.GetObject(SymbolUtilityServices.GetBlockModelSpaceId(db), OpenMode.ForWrite);
            foreach (var ent in ents)
            {
                ids.Add(btr.AppendEntity(ent));
                trans.AddNewlyCreatedDBObject(ent, true);
            }
            btr.DowngradeOpen();
            return ids;
        }

        /// <summary>
        /// 将实体添加到图纸空间
        /// </summary>
        /// <param name="db">数据库对象</param>
        /// <param name="ent">要添加的实体</param>
        /// <returns>返回添加到图纸空间中的实体ObjectId</returns>
        public static ObjectId AddToPaperSpace(this Database db, Entity ent)
        {
            var trans=db.TransactionManager;
            BlockTableRecord btr=(BlockTableRecord)trans.GetObject(SymbolUtilityServices.GetBlockPaperSpaceId(db), OpenMode.ForWrite);
            ObjectId id = btr.AppendEntity(ent);
            trans.AddNewlyCreatedDBObject(ent, true);
            btr.DowngradeOpen();
            return id;
        }

        /// <summary>
        /// 将实体添加到图纸空间
        /// </summary>
        /// <param name="db">数据库对象</param>
        /// <param name="ents">要添加的多个实体</param>
        /// <returns>返回添加到图纸空间中的实体ObjectId集合</returns>
        public static ObjectIdCollection AddToPaperSpace(this Database db, params Entity[] ents)
        {
            ObjectIdCollection ids=new ObjectIdCollection();
            var trans=db.TransactionManager;
            BlockTableRecord btr=(BlockTableRecord)trans.GetObject(SymbolUtilityServices.GetBlockPaperSpaceId(db), OpenMode.ForWrite);
            foreach (var ent in ents)
            {
                ids.Add(btr.AppendEntity(ent));
                trans.AddNewlyCreatedDBObject(ent, true);
            }
            btr.DowngradeOpen();
            return ids;
        }

        /// <summary>
        /// 将实体添加到当前空间
        /// </summary>
        /// <param name="db">数据库对象</param>
        /// <param name="ent">要添加的实体</param>
        /// <returns>返回添加到当前空间中的实体ObjectId</returns>
        public static ObjectId AddToCurrentSpace(this Database db, Entity ent)
        {
            var trans=db.TransactionManager;
            BlockTableRecord btr=(BlockTableRecord)trans.GetObject(db.CurrentSpaceId, OpenMode.ForWrite);
            ObjectId id = btr.AppendEntity(ent);
            trans.AddNewlyCreatedDBObject(ent, true);
            btr.DowngradeOpen();
            return id;
        }

        /// <summary>
        /// 将实体添加到当前空间
        /// </summary>
        /// <param name="db">数据库对象</param>
        /// <param name="ents">要添加的多个实体</param>
        /// <returns>返回添加到当前空间中的实体ObjectId集合</returns>
        public static ObjectIdCollection AddToCurrentSpace(this Database db, params Entity[] ents)
        {
            ObjectIdCollection ids=new ObjectIdCollection();
            var trans=db.TransactionManager;
            BlockTableRecord btr=(BlockTableRecord)trans.GetObject(db.CurrentSpaceId, OpenMode.ForWrite);
            foreach (var ent in ents)
            {
                ids.Add(btr.AppendEntity(ent));
                trans.AddNewlyCreatedDBObject(ent, true);
            }
            btr.DowngradeOpen();
            return ids;
        }

        /// <summary>
        /// 将字符串形式的句柄转化为ObjectId
        /// </summary>
        /// <param name="db">数据库对象</param>
        /// <param name="handleString">句柄字符串</param>
        /// <returns>返回实体的ObjectId</returns>
        public static ObjectId HandleToObjectId(this Database db, string handleString)
        {
            Handle handle=new Handle(Convert.ToInt64(handleString, 16));
            ObjectId id=db.GetObjectId(false, handle, 0);
            return id;
        }

        /// <summary>
        /// 亮显实体
        /// </summary>
        /// <param name="ids">要亮显的实体的Id集合</param>
        public static void HighlightEntities(this ObjectIdCollection ids)
        {
            if (ids.Count == 0) return;
            var trans=ids[0].Database.TransactionManager;
            foreach (ObjectId id in ids)
            {
                Entity ent=trans.GetObject(id, OpenMode.ForRead) as Entity;
                if (ent != null)
                {
                    ent.Highlight();
                }
            }
        }

        /// <summary>
        /// 亮显选择集中的实体
        /// </summary>
        /// <param name="selectionSet">选择集</param>
        public static void HighlightEntities(this SelectionSet selectionSet)
        {
            if (selectionSet == null) return;
            ObjectIdCollection ids=new ObjectIdCollection(selectionSet.GetObjectIds());
            ids.HighlightEntities();
        }

        /// <summary>
        /// 取消亮显实体
        /// </summary>
        /// <param name="ids">实体的Id集合</param>
        public static void UnHighlightEntities(this ObjectIdCollection ids)
        {
            if (ids.Count == 0) return;
            var trans=ids[0].Database.TransactionManager;
            foreach (ObjectId id in ids)
            {
                Entity ent=trans.GetObject(id, OpenMode.ForRead) as Entity;
                if (ent != null)
                {
                    ent.Unhighlight();
                }
            }
        }

        /// <summary>
        /// 将字符串格式的点转换为Point3d格式
        /// </summary>
        /// <param name="stringPoint">字符串格式的点</param>
        /// <returns>返回对应的Point3d</returns>
        public static Point3d StringToPoint3d(this string stringPoint)
        {
            string[] strPoint=stringPoint.Trim().Split(new char[] { '(', ',', ')' }, StringSplitOptions.RemoveEmptyEntries);
            double x=Convert.ToDouble(strPoint[0]);
            double y=Convert.ToDouble(strPoint[1]);
            double z=Convert.ToDouble(strPoint[2]);
            return new Point3d(x, y, z);
        }

        /// <summary>
        /// 获取数据库对应的文档对象
        /// </summary>
        /// <param name="db">数据库对象</param>
        /// <returns>返回数据库对应的文档对象</returns>
        public static Document GetDocument(this Database db)
        {
            return Application.DocumentManager.GetDocument(db);
        }

        /// <summary>
        /// 根据数据库获取命令行对象
        /// </summary>
        /// <param name="db">数据库对象</param>
        /// <returns>返回命令行对象</returns>
        public static Editor GetEditor(this Database db)
        {
            return Application.DocumentManager.GetDocument(db).Editor;
        }

        /// <summary>
        /// 在命令行输出信息
        /// </summary>
        /// <param name="ed">命令行对象</param>
        /// <param name="message">要输出的信息</param>
        public static void WriteMessage(this Editor ed, object message)
        {
            ed.WriteMessage(message.ToString());
        }

        /// <summary>
        /// 在命令行输出信息，信息显示在新行上
        /// </summary>
        /// <param name="ed">命令行对象</param>
        /// <param name="message">要输出的信息</param>
        public static void WriteMessageWithReturn(this Editor ed, object message)
        {
            ed.WriteMessage("\n" + message.ToString());
        }
    }
}
﻿using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using Autodesk.AutoCAD.Runtime;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.Geometry;
using Autodesk.AutoCAD.EditorInput;

namespace TranlateCoordinate
{
    public class TranlateCoordinate 
    {
        // 绘制矩形管道
        [CommandMethod("DrawRectPipe")]
        public void DrawRectPipe()
        {
            // 输入起点、终点
            Point3d startPoint = new Point3d();
            Point3d endPoint = new Point3d();
            if (GetPoint("\n输入起点:", out startPoint) && GetPoint("\n输入终点:", startPoint, out endPoint))
            {
                // 绘制管道
                DrawPipe(startPoint, endPoint, 100, 70);
            }            
        }

        // 绘制管道
        private void DrawPipe(Point3d startPoint, Point3d endPoint, double width, double height)
        {
            // 获得变换矩阵
            Vector3d inVector = endPoint - startPoint;      // 入口向量
            Vector3d normal = GetNormalByInVector(inVector);       // 法向量
            Matrix3d mat = GetTranslateMatrix(startPoint, inVector, normal);

            Database db = HostApplicationServices.WorkingDatabase;
            using (Transaction trans = db.TransactionManager.StartTransaction())
            {                
                BlockTable bt = (BlockTable)trans.GetObject(db.BlockTableId, OpenMode.ForRead);
                BlockTableRecord btr = (BlockTableRecord)trans.GetObject(bt[BlockTableRecord.ModelSpace], OpenMode.ForWrite);
                
                // 顶面
                double z = 0.5 * height;
                double length = startPoint.DistanceTo(endPoint);
                Face fTop = new Face(new Point3d(0, -0.5 * width, z), new Point3d(length, -0.5 * width, z), new Point3d(length, 0.5 * width, z), 
                    new Point3d(0, 0.5 * width, z), true, true, true, true);
                fTop.TransformBy(mat);
                btr.AppendEntity(fTop);
                trans.AddNewlyCreatedDBObject(fTop, true);

                // 底面
                z = -0.5 * height;
                Face fBottom = new Face(new Point3d(0, -0.5 * width, z), new Point3d(length, -0.5 * width, z), new Point3d(length, 0.5 * width, z),
                    new Point3d(0, 0.5 * width, z), true, true, true, true);
                fBottom.TransformBy(mat);
                btr.AppendEntity(fBottom);
                trans.AddNewlyCreatedDBObject(fBottom, true);

                // 左侧面
                double y = 0.5 * width;
                Face fLeftSide = new Face(new Point3d(0, y, 0.5 * height), new Point3d(length, y, 0.5 * height), new Point3d(length, y, -0.5 * height),
                    new Point3d(0, y, -0.5 * height), true, true, true, true);
                fLeftSide.TransformBy(mat);
                btr.AppendEntity(fLeftSide);
                trans.AddNewlyCreatedDBObject(fLeftSide, true);

                // 左侧面
                y = -0.5 * width;
                Face fRightSide = new Face(new Point3d(0, y, 0.5 * height), new Point3d(length, y, 0.5 * height), new Point3d(length, y, -0.5 * height),
                    new Point3d(0, y, -0.5 * height), true, true, true, true);
                fRightSide.TransformBy(mat);
                btr.AppendEntity(fRightSide);
                trans.AddNewlyCreatedDBObject(fRightSide, true);

                trans.Commit();
            }
        }

        // 根据入口向量、法向量获得变换矩阵
        Matrix3d GetTranslateMatrix(Point3d inPoint, Vector3d inVector, Vector3d normal)
        {
            Vector3d xAxis = inVector;
            xAxis = xAxis.GetNormal();
            Vector3d zAxis = normal;
            zAxis = zAxis.GetNormal();
            Vector3d yAxis = new Vector3d(xAxis.X, xAxis.Y, xAxis.Z);
            yAxis = yAxis.RotateBy(Math.PI * 0.5, zAxis);

            return Matrix3d.AlignCoordinateSystem(Point3d.Origin, Vector3d.XAxis, Vector3d.YAxis, Vector3d.ZAxis, inPoint, xAxis, yAxis, zAxis);
        }

        // 提示用户拾取点
        public bool GetPoint(string prompt, out Point3d pt)
        {
            Editor ed = Autodesk.AutoCAD.ApplicationServices.Application.DocumentManager.MdiActiveDocument.Editor;
            PromptPointResult ppr = ed.GetPoint(prompt);
            if (ppr.Status == PromptStatus.OK)
            {
                pt = ppr.Value;

                // 变换到世界坐标系
                Matrix3d mat = ed.CurrentUserCoordinateSystem;
                pt.TransformBy(mat);

                return true;
            }
            else
            {
                pt = new Point3d();
                return false;
            }
        }

        public bool GetPoint(string prompt, Point3d basePoint, out Point3d pt)
        {
            Editor ed = Autodesk.AutoCAD.ApplicationServices.Application.DocumentManager.MdiActiveDocument.Editor;
            PromptPointOptions ppo = new PromptPointOptions(prompt);
            ppo.BasePoint = basePoint;
            ppo.UseBasePoint = true;
            PromptPointResult ppr = ed.GetPoint(ppo);
            if (ppr.Status == PromptStatus.OK)
            {
                pt = ppr.Value;

                // 变换到世界坐标系
                Matrix3d mat = ed.CurrentUserCoordinateSystem;
                pt.TransformBy(mat);

                return true;
            }
            else
            {
                pt = new Point3d();
                return false;
            }
        }

        // 根据用户指定的入口点向量计算法向量
        private Vector3d GetNormalByInVector(Vector3d inVector)
        {
            double tol = 1.0E-7;
            if (Math.Abs(inVector.X) < tol && Math.Abs(inVector.Y) < tol)
            {
                if (inVector.Z >= 0)
                {
                    return new Vector3d(-1, 0, 0);
                }
                else
                {
                    return Vector3d.XAxis;
                }
            }
            else
            {
                Vector2d yAxis2d = new Vector2d(inVector.X, inVector.Y);
                yAxis2d = yAxis2d.RotateBy(Math.PI * 0.5);
                Vector3d yAxis = new Vector3d(yAxis2d.X, yAxis2d.Y, 0);
                Vector3d normal = yAxis;
                normal = normal.RotateBy(Math.PI * 0.5, inVector);
                return normal;
            }
        }
    }
}
using Autodesk.AutoCAD.ApplicationServices;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.EditorInput;
using Autodesk.AutoCAD.Geometry;
using Autodesk.AutoCAD.Runtime;
using System.Collections.Generic;

namespace PointOnCurveTest
{
  public class PtTransOverrule : TransformOverrule
  {
    // A static pointer to our overrule instance

    static public PtTransOverrule theOverrule =
      new PtTransOverrule();

    // A list of the curves that have had points
    // attached to

    static internal List<ObjectId> _curves =
      new List<ObjectId>();

    // A flag to indicate whether we're overruling

    static bool overruling = false;

    public PtTransOverrule() {}

    // Out primary overruled function

    public override void TransformBy(Entity e, Matrix3d mat)
    {
      // We only care about points

      DBPoint pt = e as DBPoint;
      if (pt != null)
      {
        Database db = HostApplicationServices.WorkingDatabase;

        // Work through the curves to find the closest to our
        // transformed point

        double min = 0.0;
        Point3d bestPt = Point3d.Origin;
        bool first = true;

        // We're using an Open/Close transaction, to avoid
        // problems with us using transactions in an event
        // handler

        OpenCloseTransaction tr =
          db.TransactionManager.StartOpenCloseTransaction();
        using (tr)
        {
          foreach (ObjectId curId in _curves)
          {
            DBObject obj =
              tr.GetObject(curId, OpenMode.ForRead);
            Curve cur = obj as Curve;
            if (cur != null)
            {
              Point3d ptLoc =
                pt.Position.TransformBy(mat);
              Point3d ptOnCurve =
                cur.GetClosestPointTo(ptLoc, false);
              Vector3d dist = ptOnCurve - ptLoc;

              if (first || dist.Length < min)
              {
                first = false;
                min = dist.Length;
                bestPt = ptOnCurve;
              }
            }
          }
          pt.Position = bestPt;
        }
      }
    }

    [CommandMethod("POC")]
    public void CreatePointOnCurve()
    {
      Document doc =
        Application.DocumentManager.MdiActiveDocument;
      Database db = doc.Database;
      Editor ed = doc.Editor;

    // Ask the user to select a curve

      PromptEntityOptions opts =
      new PromptEntityOptions(
        "\nSelect curve at the point to create: "
      );
      opts.SetRejectMessage(
        "\nEntity must be a curve."
      );
      opts.AddAllowedClass(typeof(Curve), false);

      PromptEntityResult per = ed.GetEntity(opts);
    
      ObjectId curId = per.ObjectId;
      if (curId != ObjectId.Null)
      {
      // Let's make sure we'll be able to see our point

      db.Pdmode = 97;  // square with a circle
      db.Pdsize = -10; // relative to the viewport size

        Transaction tr =
          doc.TransactionManager.StartTransaction();
        using (tr)
        {
          DBObject obj =
            tr.GetObject(curId, OpenMode.ForRead);
          Curve cur = obj as Curve;
          if (cur != null)
          {
          // Our initial point should be the closest point
          // on the curve to the one picked

            Point3d pos =
              cur.GetClosestPointTo(per.PickedPoint, false);
            DBPoint pt = new DBPoint(pos);

          // Add it to the same space as the curve

            BlockTableRecord btr =
              (BlockTableRecord)tr.GetObject(
                cur.BlockId,
                OpenMode.ForWrite
              );
            ObjectId ptId = btr.AppendEntity(pt);
            tr.AddNewlyCreatedDBObject(pt, true);
          }
          tr.Commit();
        
        // And add the curve to our central list
        
          _curves.Add(curId);
        }

      // Turn on the transform overrule if it isn't already

        if (!overruling)
        {
          ObjectOverrule.AddOverrule(
            RXClass.GetClass(typeof(DBPoint)),
          PtTransOverrule.theOverrule,
            true
          );
          overruling = true;
          TransformOverrule.Overruling = true;
        }
      }
    }
  }
}﻿using Autodesk.AutoCAD.ApplicationServices;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.Geometry;
using DotNetARX;
namespace TransformRule
{
public class TransformRule : TransformOverrule
{
    internal static ObjectId curveId;
    public override void TransformBy(Entity entity, Matrix3d transform)
    {
        bool found=false;//在曲线上是否能找到
        DBPoint pt=entity as DBPoint;// 点对象
        if (pt != null)
        {
            Database db=HostApplicationServices.WorkingDatabase;
            Document doc=db.GetDocument();
            using (OpenCloseTransaction trans=db.TransactionManager.StartOpenCloseTransaction())
            {
                Curve curve=trans.GetObject(curveId, OpenMode.ForRead) as Curve;
                if (curve != null)
                {
                    //将点的位置限制在曲线上
                    Point3d ptLoc=pt.Position.TransformBy(transform);
                    Point3d ptOnCurve=curve.GetClosestPointTo(ptLoc, false);
                    pt.Position = ptOnCurve;
                    found = true;//已经在曲线上找到点
                }
            }
        }
        if (!found) base.TransformBy(entity, transform);
    }
}
}
﻿using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Drawing;
using System.Data;
using System.Linq;
using System.Text;
using System.Windows.Forms;
using Autodesk.AutoCAD.Windows;
using AcadApp = Autodesk.AutoCAD.ApplicationServices.Application;
using Autodesk.AutoCAD.ApplicationServices;
namespace Palettes
{
    public partial class UCDockDrag : UserControl
    {
        public UCDockDrag()
        {
            InitializeComponent();
        }

        private void comboBoxDock_SelectedIndexChanged(object sender, EventArgs e)
        {
            //根据组合框选择的项目分别设置面板的停靠方式
            switch (this.comboBoxDock.SelectedIndex)
            {
                case 0://底部
                    Palettes.ps.Dock = DockSides.Bottom;
                    break;
                case 1://左侧
                    Palettes.ps.Dock = DockSides.Left;
                    break;
                case 2://右侧
                    Palettes.ps.Dock = DockSides.Right;
                    break;
                case 3://顶部
                    Palettes.ps.Dock = DockSides.Top;
                    break;
                case 4://浮动
                    Palettes.ps.Dock = DockSides.None;
                    break;
            }
        }

        private void comboBoxDock_DropDown(object sender, EventArgs e)
        {
            //处理组合框无法选择的问题，浮动面板除外
            if (Palettes.ps.Dock != DockSides.None)
            {
                Palettes.ps.KeepFocus = true;
            }
        }

        private void comboBoxDock_DropDownClosed(object sender, EventArgs e)
        {
            if (Palettes.ps.Dock != DockSides.None)
            {
                Palettes.ps.KeepFocus = false;
            }
        }

        private void textBoxDrag_MouseMove(object sender, MouseEventArgs e)
        {
            //只执行左键移动操作，以表示进行了拖放操作
            if (Control.MouseButtons.Equals(MouseButtons.Left))
            {
                //必须锁定文档，否则会出错
                using (DocumentLock loc=AcadApp.DocumentManager.MdiActiveDocument.LockDocument())
                {
                    //文本框对象触发拖放事件，调用拖放操作事件处理函数，并传入文本框对象的Text属性供事件处理函数进行判断
                    AcadApp.DoDragDrop(this, this.textBoxDrag.Text, DragDropEffects.All, new MyDropTarget());
                }
            }
        }
    }
}
﻿namespace Palettes
{
    partial class UCDockDrag
    {
        /// <summary> 
        /// 必需的设计器变量。
        /// </summary>
        private System.ComponentModel.IContainer components = null;

        /// <summary> 
        /// 清理所有正在使用的资源。
        /// </summary>
        /// <param name="disposing">如果应释放托管资源，为 true；否则为 false。</param>
        protected override void Dispose(bool disposing)
        {
            if (disposing && (components != null))
            {
                components.Dispose();
            }
            base.Dispose(disposing);
        }

        #region 组件设计器生成的代码

        /// <summary> 
        /// 设计器支持所需的方法 - 不要
        /// 使用代码编辑器修改此方法的内容。
        /// </summary>
        private void InitializeComponent()
        {
            this.comboBoxDock = new System.Windows.Forms.ComboBox();
            this.label1 = new System.Windows.Forms.Label();
            this.groupBox1 = new System.Windows.Forms.GroupBox();
            this.textBoxDrag = new System.Windows.Forms.TextBox();
            this.label2 = new System.Windows.Forms.Label();
            this.groupBox1.SuspendLayout();
            this.SuspendLayout();
            // 
            // comboBoxDock
            // 
            this.comboBoxDock.FormattingEnabled = true;
            this.comboBoxDock.Items.AddRange(new object[] {
            "底部",
            "左侧",
            "右侧",
            "顶部",
            "浮动"});
            this.comboBoxDock.Location = new System.Drawing.Point(69, 21);
            this.comboBoxDock.Name = "comboBoxDock";
            this.comboBoxDock.Size = new System.Drawing.Size(121, 20);
            this.comboBoxDock.TabIndex = 0;
            this.comboBoxDock.DropDown += new System.EventHandler(this.comboBoxDock_DropDown);
            this.comboBoxDock.SelectedIndexChanged += new System.EventHandler(this.comboBoxDock_SelectedIndexChanged);
            this.comboBoxDock.DropDownClosed += new System.EventHandler(this.comboBoxDock_DropDownClosed);
            // 
            // label1
            // 
            this.label1.AutoSize = true;
            this.label1.Location = new System.Drawing.Point(24, 24);
            this.label1.Name = "label1";
            this.label1.Size = new System.Drawing.Size(29, 12);
            this.label1.TabIndex = 1;
            this.label1.Text = "停靠";
            this.label1.UseMnemonic = false;
            // 
            // groupBox1
            // 
            this.groupBox1.Controls.Add(this.textBoxDrag);
            this.groupBox1.Controls.Add(this.label2);
            this.groupBox1.Location = new System.Drawing.Point(26, 71);
            this.groupBox1.Name = "groupBox1";
            this.groupBox1.Size = new System.Drawing.Size(164, 134);
            this.groupBox1.TabIndex = 2;
            this.groupBox1.TabStop = false;
            this.groupBox1.Text = "拖放演示";
            // 
            // textBoxDrag
            // 
            this.textBoxDrag.Location = new System.Drawing.Point(19, 62);
            this.textBoxDrag.Name = "textBoxDrag";
            this.textBoxDrag.Size = new System.Drawing.Size(139, 21);
            this.textBoxDrag.TabIndex = 1;
            this.textBoxDrag.MouseMove += new System.Windows.Forms.MouseEventHandler(this.textBoxDrag_MouseMove);
            // 
            // label2
            // 
            this.label2.AutoSize = true;
            this.label2.Location = new System.Drawing.Point(17, 35);
            this.label2.Name = "label2";
            this.label2.Size = new System.Drawing.Size(113, 12);
            this.label2.TabIndex = 0;
            this.label2.Text = "输入需要拖放的文字";
            // 
            // UCDockDrag
            // 
            this.AutoScaleDimensions = new System.Drawing.SizeF(6F, 12F);
            this.AutoScaleMode = System.Windows.Forms.AutoScaleMode.Font;
            this.Controls.Add(this.groupBox1);
            this.Controls.Add(this.label1);
            this.Controls.Add(this.comboBoxDock);
            this.Name = "UCDockDrag";
            this.Size = new System.Drawing.Size(217, 230);
            this.groupBox1.ResumeLayout(false);
            this.groupBox1.PerformLayout();
            this.ResumeLayout(false);
            this.PerformLayout();

        }

        #endregion

        private System.Windows.Forms.ComboBox comboBoxDock;
        private System.Windows.Forms.Label label1;
        private System.Windows.Forms.GroupBox groupBox1;
        private System.Windows.Forms.Label label2;
        internal System.Windows.Forms.TextBox textBoxDrag;
    }
}
﻿using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.EditorInput;
using Autodesk.AutoCAD.Geometry;
using Autodesk.AutoCAD.Runtime;
using DotNetARX;
namespace UCSTables
{
    public class UCSTables
    {
        [CommandMethod("NewUCS")]
        public void NewUCS()
        {
            Database db=HostApplicationServices.WorkingDatabase;
            Editor ed=db.GetEditor();
            using (Transaction trans=db.TransactionManager.StartTransaction())
            {
                ObjectId ucsId=db.AddUCS("NewUCS");//添加名为NewUCS的UCS
                db.SetCurrentUCS("NewUCS");//设置NewUCS为当前UCS
                trans.Commit();
            }
        }

        [CommandMethod("ModUCS")]
        public void ModUCS()
        {
            Database db=HostApplicationServices.WorkingDatabase;
            Editor ed=db.GetEditor();
            //提示用户输入UCS的新原点
            PromptPointOptions opt=new PromptPointOptions("请指定UCS的新原点");
            PromptPointResult result=ed.GetPoint(opt);
            if (result.Status != PromptStatus.OK) return;//若用户未输入有效点，则返回
            Point3d newOrigin=result.Value;//获取用户输入的点
            using (Transaction trans=db.TransactionManager.StartTransaction())
            {
                ObjectId ucsId=db.GetCurrentUCS();//获取当前UCS
                ucsId.SetUCSOrigin(newOrigin);//设置当前UCS的原点
                ucsId.RotateUCS(60, Vector3d.ZAxis);//将UCS绕Z轴旋转60度
                trans.Commit();
            }
        }

        [CommandMethod("UCSCir")]
        public void UCSCir()
        {
            Database db=HostApplicationServices.WorkingDatabase;
            Editor ed=db.GetEditor();
            //创建一个圆心坐标（WCS)为(0,0,0)，半径为50的小圆
            Circle cir1=new Circle(Point3d.Origin, Vector3d.ZAxis, 50);
            //创建一个圆心坐标（WCS)为(0,0,0)，半径为80的大圆
            Circle cir2=new Circle(Point3d.Origin, Vector3d.ZAxis, 80);
            var mt=ed.CurrentUserCoordinateSystem;//得到当前UCS矩阵
            cir2.TransformBy(mt);//对大圆实施矩阵变换
            using (Transaction trans=db.TransactionManager.StartTransaction())
            {
                db.AddToModelSpace(cir1, cir2);//将圆添加到模型空间
                trans.Commit();
            }
        }
    }
}
﻿using System;
using System.Runtime.InteropServices;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.EditorInput;
using Autodesk.AutoCAD.Geometry;

namespace DotNetARX
{
    /// <summary>
    /// UCS操作类
    /// </summary>
    public static class UCSTools
    {
        [DllImport("acad.exe", CallingConvention = CallingConvention.Cdecl, EntryPoint = "acedTrans")]
        private static extern int acedTrans(double[] point, IntPtr fromResbuf, IntPtr toResbuf, int displacement, double[] result);
        /// <summary>
        /// 坐标系的类型
        /// </summary>
        public enum CoordSystem
        {
            /// <summary>
            /// WCS
            /// </summary>
            WCS = 0,
            /// <summary>
            /// UCS
            /// </summary>
            UCS,
            /// <summary>
            /// DCS
            /// </summary>
            DCS,
            /// <summary>
            /// PSDCS
            /// </summary>
            PSDCS
        }

        /// <summary>
        /// 将点或矢量从一个坐标系转换到另一个坐标系
        /// </summary>
        /// <param name="pt">坐标，表示点或位移矢量</param>
        /// <param name="from">源坐标系</param>
        /// <param name="to">目标坐标系</param>
        /// <param name="disp">位移矢量标记，1表示位移矢量，0表示点</param>
        /// <returns>返回转化后的坐标</returns>
        public static Point3d TranslateCoordinates(this Point3d pt, CoordSystem from, CoordSystem to, int disp)
        {
            double[] result=new double[3];
            acedTrans(pt.ToArray(),
                new ResultBuffer(new TypedValue(5003, from)).UnmanagedObject,
                new ResultBuffer(new TypedValue(5003, to)).UnmanagedObject,
                disp, result);
            return new Point3d(result);
        }

        /// <summary>
        /// 将点从一个坐标系转换到另一个坐标系
        /// </summary>
        /// <param name="pt">点</param>
        /// <param name="from">源坐标系</param>
        /// <param name="to">目标坐标系</param>
        /// <returns>返回转化后的坐标</returns>
        public static Point3d TranslateCoordinates(this Point3d pt, CoordSystem from, CoordSystem to)
        {
            return pt.TranslateCoordinates(from, to, 0);
        }
 
        /// <summary>
        /// 创建一个新的UCS
        /// </summary>
        /// <param name="db">数据库对象</param>
        /// <param name="UCSName">要创建的UCS名称</param>
        /// <returns>返回创建的UCS的Id</returns>
        public static ObjectId AddUCS(this Database db, string UCSName)
        {
            var trans=db.TransactionManager;
            //打开UCS表
            UcsTable ut=(UcsTable)trans.GetObject(db.UcsTableId, OpenMode.ForRead);
            if (!ut.Has(UCSName))//如果不存在名为UCSName的UCS，则新建一个UCS
            {
                //定义一个新的UCS
                UcsTableRecord utr=new UcsTableRecord();
                utr.Name = UCSName;//设置UCS名
                ut.UpgradeOpen();//切换UCS表的状态为写以添加新的UCS
                //将UCS的信息添加到UCS表中
                ut.Add(utr);
                //把UCS添加到事务处理中
                trans.AddNewlyCreatedDBObject(utr, true);
                ut.DowngradeOpen();//为了安全，将UCS表的状态切换为读
            }
            return ut[UCSName];//返回新添加的UCS的ObjectId
        }

        /// <summary>
        /// 将UCS表中已经存在的一个UCS设置为当前UCS
        /// </summary>
        /// <param name="db">数据库对象</param>
        /// <param name="UCSName">UCS名称</param>
        /// <returns>如果设置成功返回true，否则返回false</returns>
        public static bool SetCurrentUCS(this Database db, string UCSName)
        {
            var trans=db.TransactionManager;
            Editor ed=db.GetEditor();
            //打开UCS表
            UcsTable ut=(UcsTable)trans.GetObject(db.UcsTableId, OpenMode.ForRead);
            //如果不存在名为UCSName的UCS，则返回
            if (!ut.Has(UCSName)) return false;
            //打开当前活动的视口为写的状态
            ViewportTableRecord vtr=(ViewportTableRecord)trans.GetObject(db.CurrentViewportTableRecordId(), OpenMode.ForWrite);
            //设置当前UCS
            vtr.SetUcs(ut[UCSName]);
            vtr.DowngradeOpen();
            //更新视口
            ed.UpdateTiledViewportsFromDatabase();
            return true;
        }

        /// <summary>
        /// 获取当前UCS
        /// </summary>
        /// <param name="db">数据库对象</param>
        /// <returns>返回当前UCS的Id</returns>
        public static ObjectId GetCurrentUCS(this Database db)
        {
            var trans=db.TransactionManager;
            Editor ed=db.GetEditor();
            //打开UCS表
            UcsTable ut=(UcsTable)trans.GetObject(db.UcsTableId, OpenMode.ForRead);
            //打开当前活动的视口
            ViewportTableRecord vtr=(ViewportTableRecord)trans.GetObject(db.CurrentViewportTableRecordId(), OpenMode.ForRead);
            //返回当前UCS的ObjectId
            return vtr.UcsName;
        }

        /// <summary>
        /// 设置UCS的原点
        /// </summary>
        /// <param name="ucsId">UCS的Id</param>
        /// <param name="pt">要设置的UCS原点坐标</param>
        public static void SetUCSOrigin(this ObjectId ucsId, Point3d pt)
        {
            Database db=ucsId.Database;
            var trans=db.TransactionManager;
            //打开UCS
            UcsTableRecord utr=trans.GetObject(ucsId, OpenMode.ForRead) as UcsTableRecord;
            if (utr == null) return;//若UCS不存在，则返回
            utr.UpgradeOpen();//切换UCS为写的状态
            utr.Origin = pt;//设置UCS的原点
            utr.DowngradeOpen();//为了安全，切换UCS为读的状态
        }

        /// <summary>
        /// 旋转UCS
        /// </summary>
        /// <param name="ucsId">UCS的Id</param>
        /// <param name="rotateAngle">旋转角度</param>
        /// <param name="rotateAxis">旋转轴</param>
        public static void RotateUCS(this ObjectId ucsId, double rotateAngle, Vector3d rotateAxis)
        {
            Database db=ucsId.Database;
            var trans=db.TransactionManager;
            //打开UCS
            UcsTableRecord utr=trans.GetObject(ucsId, OpenMode.ForRead) as UcsTableRecord;
            if (utr == null) return;//若UCS不存在，则返回
            utr.UpgradeOpen();//切换UCS为写的状态
            Vector3d xAxis=utr.XAxis;//UCS的X轴方向
            Vector3d yAxis=utr.YAxis;//UCS的Y轴方向
            //旋转UCS
            utr.XAxis = xAxis.RotateBy(rotateAngle * Math.PI / 180, rotateAxis);
            utr.YAxis = yAxis.RotateBy(rotateAngle * Math.PI / 180, rotateAxis);
            utr.DowngradeOpen();//为了安全，切换UCS为读的状态
        }
    }
}
﻿using System.Linq;
using System.Windows.Forms;
using Autodesk.AutoCAD.ApplicationServices;
using Autodesk.AutoCAD.DatabaseServices;
using DotNetARX;
using AcadApp = Autodesk.AutoCAD.ApplicationServices.Application;
namespace Palettes
{
    public partial class UCTreeView : UserControl
    {
        public UCTreeView()
        {
            InitializeComponent();
            this.treeViewEnts.ImageList = imageListNode;//设置TreeView使用的图像列表
        }
        private void treeViewEnts_AfterSelect(object sender, TreeViewEventArgs e)
        {
            //选中节点的根节点名称
            string rootName=findRoot(e.Node).Text;
            //如果根节点名称与活动文档的名称不相同，则需要切换活动文档
            if (rootName != AcadApp.DocumentManager.MdiActiveDocument.Name)
            {
                //查找文档名为选中节点名的文档
                var docs=from Document doc in AcadApp.DocumentManager
                         where doc.Name == rootName
                         select doc;
                if (docs.Count() == 1)//如果找到，则切换活动文档
                    AcadApp.DocumentManager.MdiActiveDocument = docs.First();
            }
            switch (e.Node.Text)//判断选中节点的标签文本
            {
                case "门":
                    GetBlocksFromDwg("Door");//统计Door块个数并填充DataGridView
                    break;
                case "窗":
                    GetBlocksFromDwg("Window");//统计Window块个数并填充DataGridView
                    break;
                default://其它的标签文本，DataGridView的内容设为空
                    this.dataGridViewEnts.DataSource = null;
                    break;
            }
        }
        private void GetBlocksFromDwg(string blockName)
        {
            Database db=HostApplicationServices.WorkingDatabase;
            using (Transaction trans=db.TransactionManager.StartTransaction())
            using (DocumentLock loc=db.GetDocument().LockDocument())
            {
                //查找当前文档中块名以blockName开头的块参照
                var blocks=from block in db.GetEntsInModelSpace<BlockReference>()
                           //条件：块参照的块名以blockName开头
                           where block.GetBlockName().StartsWith(blockName)
                           //设置一个中间变量，取值为块参照的SYM.属性（即门或窗的符号）
                           let SYM = block.ObjectId.GetAttributeInBlockReference("SYM.")
                           //根据符号对符合条件的块参照进行分组
                           group block by SYM into g
                           orderby g.Key //根据符号对组进行升序排序
                           select new    //创建一个新的匿名类型作为结果
                           {
                               符号 = g.Key,
                               宽度 = g.First().ObjectId.GetAttributeInBlockReference("WIDTH"),
                               高度 = g.First().ObjectId.GetAttributeInBlockReference("HEIGHT"),
                               个数 = g.Count()
                           };
                //设置DataGridView的数据源以显示块的分组统计信息
                this.dataGridViewEnts.DataSource = blocks.ToList();
                trans.Commit();
            }
        }
        TreeNode findRoot(TreeNode node)
        {
            if (node.Parent == null) return node;
            else return findRoot(node.Parent);
        }
    }
}
﻿namespace Palettes
{
    partial class UCTreeView
    {
        /// <summary> 
        /// 必需的设计器变量。
        /// </summary>
        private System.ComponentModel.IContainer components = null;

        /// <summary> 
        /// 清理所有正在使用的资源。
        /// </summary>
        /// <param name="disposing">如果应释放托管资源，为 true；否则为 false。</param>
        protected override void Dispose(bool disposing)
        {
            if (disposing && (components != null))
            {
                components.Dispose();
            }
            base.Dispose(disposing);
        }

        #region 组件设计器生成的代码

        /// <summary> 
        /// 设计器支持所需的方法 - 不要
        /// 使用代码编辑器修改此方法的内容。
        /// </summary>
        private void InitializeComponent()
        {
            this.components = new System.ComponentModel.Container();
            System.ComponentModel.ComponentResourceManager resources = new System.ComponentModel.ComponentResourceManager(typeof(UCTreeView));
            this.treeViewEnts = new System.Windows.Forms.TreeView();
            this.dataGridViewEnts = new System.Windows.Forms.DataGridView();
            this.imageListNode = new System.Windows.Forms.ImageList(this.components);
            ((System.ComponentModel.ISupportInitialize)(this.dataGridViewEnts)).BeginInit();
            this.SuspendLayout();
            // 
            // treeViewEnts
            // 
            this.treeViewEnts.Dock = System.Windows.Forms.DockStyle.Top;
            this.treeViewEnts.Location = new System.Drawing.Point(0, 0);
            this.treeViewEnts.Name = "treeViewEnts";
            this.treeViewEnts.ShowNodeToolTips = true;
            this.treeViewEnts.Size = new System.Drawing.Size(322, 177);
            this.treeViewEnts.TabIndex = 0;
            this.treeViewEnts.AfterSelect += new System.Windows.Forms.TreeViewEventHandler(this.treeViewEnts_AfterSelect);
            // 
            // dataGridViewEnts
            // 
            this.dataGridViewEnts.AutoSizeColumnsMode = System.Windows.Forms.DataGridViewAutoSizeColumnsMode.AllCells;
            this.dataGridViewEnts.ColumnHeadersHeightSizeMode = System.Windows.Forms.DataGridViewColumnHeadersHeightSizeMode.AutoSize;
            this.dataGridViewEnts.Dock = System.Windows.Forms.DockStyle.Top;
            this.dataGridViewEnts.Location = new System.Drawing.Point(0, 177);
            this.dataGridViewEnts.Name = "dataGridViewEnts";
            this.dataGridViewEnts.RowTemplate.Height = 23;
            this.dataGridViewEnts.Size = new System.Drawing.Size(322, 208);
            this.dataGridViewEnts.TabIndex = 1;
            // 
            // imageListNode
            // 
            this.imageListNode.ImageStream = ((System.Windows.Forms.ImageListStreamer)(resources.GetObject("imageListNode.ImageStream")));
            this.imageListNode.TransparentColor = System.Drawing.Color.Transparent;
            this.imageListNode.Images.SetKeyName(0, "acad.ico");
            this.imageListNode.Images.SetKeyName(1, "door.ico");
            this.imageListNode.Images.SetKeyName(2, "window.ico");
            // 
            // UCTreeView
            // 
            this.AutoScaleDimensions = new System.Drawing.SizeF(6F, 12F);
            this.AutoScaleMode = System.Windows.Forms.AutoScaleMode.Font;
            this.Controls.Add(this.dataGridViewEnts);
            this.Controls.Add(this.treeViewEnts);
            this.Name = "UCTreeView";
            this.Size = new System.Drawing.Size(322, 391);
            ((System.ComponentModel.ISupportInitialize)(this.dataGridViewEnts)).EndInit();
            this.ResumeLayout(false);

        }

        #endregion

        internal System.Windows.Forms.TreeView treeViewEnts;
        internal System.Windows.Forms.DataGridView dataGridViewEnts;
        internal System.Windows.Forms.ImageList imageListNode;

    }
}
﻿using System;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.EditorInput;
using Autodesk.AutoCAD.Geometry;
using Autodesk.AutoCAD.Runtime;

namespace UsefulGeometryClass
{
    public class UsefulGeometryClass
    {
        // 书中测试代码部分
        [CommandMethod("TestGeometry")]
        public void TestGeometry()
        {
            // 判断点是否相等
            Point2d point1 = new Point2d();
            Point2d point2 = new Point2d();
            Tolerance tol = new Tolerance(1.0e-4, 1.0E-4);
            if (point1.IsEqualTo(point2, tol))
            {
                Editor ed = Autodesk.AutoCAD.ApplicationServices.Application.DocumentManager.MdiActiveDocument.Editor;
                ed.WriteMessage("\n两点重合.");
            }

            // 点和矢量相加
            Point2d point = new Point2d(0, 0);
            Vector2d vec = new Vector2d(10, 5);
            Point2d pt = point + vec;

            // 计算两个点之间的夹角
            Point2d startPoint = new Point2d(0, 0);
            Point2d endPoint = new Point2d(10, 10);
            Vector2d vec2 = endPoint - startPoint;
            double angle = vec2.Angle;
        }

        // 计算直线和圆弧的交点
        [CommandMethod("IntersectWith")]
        public void IntersectWith()
        {
            // 创建所要计算交点的几何类对象
            CircularArc2d geArc = new CircularArc2d(Point2d.Origin, 50, 0, 6, Vector2d.XAxis, false);
            Line2d geLine = new Line2d(Point2d.Origin, new Point2d(10, 10));

            // 计算并输出交点
            Point2d[] intPoints = geArc.IntersectWith(geLine);
            Editor ed = Autodesk.AutoCAD.ApplicationServices.Application.DocumentManager.MdiActiveDocument.Editor;
            ed.WriteMessage("\n直线和圆弧有{0}个交点.", intPoints.Length);
            for (int i = 0; i < intPoints.Length; i++)
            {
                ed.WriteMessage("\n交点{0}坐标: ({1}, {2})", i + 1, intPoints[i].X, intPoints[i].Y);
            }
        }

        // 计算两条曲线相交之后形成的边界线
        [CommandMethod("CurveBoolean")]
        public void CurveBoolean()
        {
            // 提示用户选择所要计算距离的两条直线
            ObjectIdCollection polyIds = new ObjectIdCollection();
            if (PromptSelectEnts("\n选择两条多段线:", "LWPOLYLINE", ref polyIds))
            {
                Editor ed = Autodesk.AutoCAD.ApplicationServices.Application.DocumentManager.MdiActiveDocument.Editor;
                if (polyIds.Count != 2)
                {
                    ed.WriteMessage("\n必须选择两条多段线进行操作.");
                    return;
                }

                Database db = HostApplicationServices.WorkingDatabase;
                using (Transaction trans = db.TransactionManager.StartTransaction())
                {
                    // 获得两条曲线的交点
                    Polyline poly1 = (Polyline)trans.GetObject(polyIds[0], OpenMode.ForRead);
                    Polyline poly2 = (Polyline)trans.GetObject(polyIds[1], OpenMode.ForRead);
                    Point3dCollection intPoints = new Point3dCollection();
                    poly1.IntersectWith(poly2, Intersect.OnBothOperands, intPoints, 0, 0);
                    if (intPoints.Count < 2)
                    {
                        ed.WriteMessage("\n曲线交点少于2个, 无法进行计算.");
                    }

                    // 根据交点和参数值获得交点之间的曲线
                    BlockTable bt = (BlockTable)trans.GetObject(db.BlockTableId, OpenMode.ForRead);
                    BlockTableRecord btr = (BlockTableRecord)trans.GetObject(bt[BlockTableRecord.ModelSpace], OpenMode.ForWrite);
                    GetCurveBetweenIntPoints(trans, btr, poly1, intPoints);
                    GetCurveBetweenIntPoints(trans, btr, poly2, intPoints);

                    trans.Commit();
                }
            }
        }

        // 计算多段线和直线的交点，任意设置容差
        [CommandMethod("PolyIntersect")]
        public void PolyIntersect()
        {
            // 提示用户输入误差范围
            Editor ed = Autodesk.AutoCAD.ApplicationServices.Application.DocumentManager.MdiActiveDocument.Editor;
            PromptDoubleOptions pdo = new PromptDoubleOptions("\n输入判断容差<0.0001>:");
            pdo.DefaultValue = 0.0001;
            pdo.AllowNone = true;
            PromptDoubleResult pdr = ed.GetDouble(pdo);
            if (pdr.Status == PromptStatus.OK)
            {
                // 提示用户选择多段线
                ObjectId polyId = new ObjectId();
                if (PromptSelectEntity("\n选择多段线:", out polyId))
                {
                    Database db = HostApplicationServices.WorkingDatabase;
                    using (Transaction trans = db.TransactionManager.StartTransaction())
                    {
                        Polyline poly = (Polyline)trans.GetObject(polyId, OpenMode.ForRead);
                        if (poly != null)
                        {
                            // 提示用户选择直线
                            ObjectId lineId = new ObjectId();
                            if (PromptSelectEntity("\n选择直线:", out lineId))
                            {
                                Line line = (Line)trans.GetObject(lineId, OpenMode.ForRead);

                                // 进行相交判断
                                if (line != null)
                                {
                                    Point3dCollection intPoints = new Point3dCollection();
                                    PolyIntersectWithLine(poly, line, pdr.Value, ref intPoints);
                                    ed.WriteMessage("\n两个实体交点数量:{0}", intPoints.Count);
                                    for (int i = 0; i < intPoints.Count; i++)
                                    {
                                        ed.WriteMessage("\n交点{0}: ({1},{2})", i + 1, intPoints[i].X, intPoints[i].Y);
                                    }
                                }
                                else
                                {
                                    ed.WriteMessage("\n选择的实体不是直线.");
                                }
                            }
                        }
                        else
                        {
                            ed.WriteMessage("\n选择的实体不是多段线.");
                        }
                    }
                }
            }
        }

        // 提示用户选择一组实体
        public static bool PromptSelectEnts(string prompt, string entTypeFilter, ref ObjectIdCollection entIds)
        {
            Editor ed = Autodesk.AutoCAD.ApplicationServices.Application.DocumentManager.MdiActiveDocument.Editor;
            PromptSelectionOptions pso = new PromptSelectionOptions();
            pso.MessageForAdding = prompt;
            SelectionFilter sf = new SelectionFilter(new TypedValue[] { new TypedValue((int)DxfCode.Start, entTypeFilter) });
            PromptSelectionResult psr = ed.GetSelection(pso, sf);
            SelectionSet ss = psr.Value;
            if (ss != null)
            {
                entIds = new ObjectIdCollection(ss.GetObjectIds());
                return entIds.Count > 0;
            }
            else
            {
                return false;
            }
        }

        // 提示用户选择一个实体
        public static bool PromptSelectEntity(string prompt, out ObjectId entId)
        {
            Editor ed = Autodesk.AutoCAD.ApplicationServices.Application.DocumentManager.MdiActiveDocument.Editor;
            PromptEntityOptions peo = new PromptEntityOptions(prompt);
            peo.AllowObjectOnLockedLayer = true;
            PromptEntityResult per = ed.GetEntity(peo);
            if (per.Status == PromptStatus.OK)
            {
                entId = per.ObjectId;
                return true;
            }
            else
            {
                entId = new ObjectId();
                return false;
            }
        }

        // 获得多段线多个交点之间的子曲线，首尾两端删除
        private void GetCurveBetweenIntPoints(Transaction trans, BlockTableRecord btr, Polyline poly, Point3dCollection points)
        {
            DBObjectCollection curves = poly.GetSplitCurves(points);
            for (int i = 0; i < curves.Count; i++)
            {
                if (i > 0 && i < curves.Count - 1)
                {
                    Entity ent = curves[i] as Entity;
                    ent.ColorIndex = 1;
                    btr.AppendEntity(ent);
                    trans.AddNewlyCreatedDBObject(ent, true);
                }
                else
                {
                    curves[i].Dispose();
                }
            }
        }

        // 多段线和直线求交点
        private void PolyIntersectWithLine(Polyline poly, Line line, double tol, ref Point3dCollection points)
        {
            Point2dCollection intPoints2d = new Point2dCollection();

            // 获得直线对应的几何类
            LineSegment2d geLine = new LineSegment2d(ToPoint2d(line.StartPoint), ToPoint2d(line.EndPoint));

            // 每一段分别计算交点
            Tolerance tolerance = new Tolerance(tol, tol);
            for (int i = 0; i < poly.NumberOfVertices; i++)
            {
                if (i < poly.NumberOfVertices - 1 || poly.Closed)
                {
                    SegmentType st = poly.GetSegmentType(i);
                    if (st == SegmentType.Line)
                    {
                        LineSegment2d geLineSeg = poly.GetLineSegment2dAt(i);
                        Point2d[] pts = geLineSeg.IntersectWith(geLine, tolerance);
                        if (pts != null)
                        {
                            for (int j = 0; j < pts.Length; j++)
                            {
                                if (FindPointIn(intPoints2d, pts[j], tol) < 0)
                                {
                                    intPoints2d.Add(pts[j]);
                                }
                            }
                        }
                    }
                    else if (st == SegmentType.Arc)
                    {
                        CircularArc2d geArcSeg = poly.GetArcSegment2dAt(i);
                        Point2d[] pts = geArcSeg.IntersectWith(geLine, tolerance);
                        if (pts != null)
                        {
                            for (int j = 0; j < pts.Length; j++)
                            {
                                if (FindPointIn(intPoints2d, pts[j], tol) < 0)
                                {
                                    intPoints2d.Add(pts[j]);
                                }
                            }
                        }
                    }
                }
            }

            for (int i = 0; i < intPoints2d.Count; i++)
            {
                points.Add(ToPoint3d(intPoints2d[i]));
            }
        }

        // 点是否在集合中
        private int FindPointIn(Point2dCollection points, Point2d pt, double tol)
        {
            for (int i = 0; i < points.Count; i++)
            {
                if (Math.Abs(points[i].X - pt.X) < tol && Math.Abs(points[i].Y - pt.Y) < tol)
                {
                    return i;
                }
            }

            return -1;
        }

        // 三维点转二维点
        private static Point2d ToPoint2d(Point3d point3d)
        {
            return new Point2d(point3d.X, point3d.Y);
        }

        // 二维点转三维点
        private static Point3d ToPoint3d(Point2d point2d)
        {
            return new Point3d(point2d.X, point2d.Y, 0);
        }

        private static Point3d ToPoint3d(Point2d point2d, double elevation)
        {
            return new Point3d(point2d.X, point2d.Y, elevation);
        }
    }
}
﻿#pragma checksum "..\..\..\UserControl1.xaml" "{406ea660-64cf-4c82-b6f0-42d48172a799}" "C79E35F2A6CA003F21BC41E3888DF5DF"
//------------------------------------------------------------------------------
// <auto-generated>
//     此代码由工具生成。
//     运行时版本:4.0.30319.488
//
//     对此文件的更改可能会导致不正确的行为，并且如果
//     重新生成代码，这些更改将会丢失。
// </auto-generated>
//------------------------------------------------------------------------------

using System;
using System.Diagnostics;
using System.Windows;
using System.Windows.Automation;
using System.Windows.Controls;
using System.Windows.Controls.Primitives;
using System.Windows.Data;
using System.Windows.Documents;
using System.Windows.Forms.Integration;
using System.Windows.Ink;
using System.Windows.Input;
using System.Windows.Markup;
using System.Windows.Media;
using System.Windows.Media.Animation;
using System.Windows.Media.Effects;
using System.Windows.Media.Imaging;
using System.Windows.Media.Media3D;
using System.Windows.Media.TextFormatting;
using System.Windows.Navigation;
using System.Windows.Shapes;
using System.Windows.Shell;


namespace Wpfs {
    
    
    /// <summary>
    /// UserControl1
    /// </summary>
    [System.CodeDom.Compiler.GeneratedCodeAttribute("PresentationBuildTasks", "4.0.0.0")]
    public partial class UserControl1 : System.Windows.Controls.UserControl, System.Windows.Markup.IComponentConnector {
        
        private bool _contentLoaded;
        
        /// <summary>
        /// InitializeComponent
        /// </summary>
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        public void InitializeComponent() {
            if (_contentLoaded) {
                return;
            }
            _contentLoaded = true;
            System.Uri resourceLocater = new System.Uri("/Wpfs;component/usercontrol1.xaml", System.UriKind.Relative);
            
            #line 1 "..\..\..\UserControl1.xaml"
            System.Windows.Application.LoadComponent(this, resourceLocater);
            
            #line default
            #line hidden
        }
        
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [System.ComponentModel.EditorBrowsableAttribute(System.ComponentModel.EditorBrowsableState.Never)]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Design", "CA1033:InterfaceMethodsShouldBeCallableByChildTypes")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Maintainability", "CA1502:AvoidExcessiveComplexity")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1800:DoNotCastUnnecessarily")]
        void System.Windows.Markup.IComponentConnector.Connect(int connectionId, object target) {
            this._contentLoaded = true;
        }
    }
}

﻿#pragma checksum "..\..\..\UserControl2.xaml" "{406ea660-64cf-4c82-b6f0-42d48172a799}" "CDB9808161ED48ED44328A61FA836D30"
//------------------------------------------------------------------------------
// <auto-generated>
//     此代码由工具生成。
//     运行时版本:4.0.30319.488
//
//     对此文件的更改可能会导致不正确的行为，并且如果
//     重新生成代码，这些更改将会丢失。
// </auto-generated>
//------------------------------------------------------------------------------

using System;
using System.Diagnostics;
using System.Windows;
using System.Windows.Automation;
using System.Windows.Controls;
using System.Windows.Controls.Primitives;
using System.Windows.Data;
using System.Windows.Documents;
using System.Windows.Forms.Integration;
using System.Windows.Ink;
using System.Windows.Input;
using System.Windows.Markup;
using System.Windows.Media;
using System.Windows.Media.Animation;
using System.Windows.Media.Effects;
using System.Windows.Media.Imaging;
using System.Windows.Media.Media3D;
using System.Windows.Media.TextFormatting;
using System.Windows.Navigation;
using System.Windows.Shapes;
using System.Windows.Shell;


namespace Wpfs {
    
    
    /// <summary>
    /// BindingPanel
    /// </summary>
    [System.CodeDom.Compiler.GeneratedCodeAttribute("PresentationBuildTasks", "4.0.0.0")]
    public partial class BindingPanel : System.Windows.Controls.UserControl, System.Windows.Markup.IComponentConnector {
        
        private bool _contentLoaded;
        
        /// <summary>
        /// InitializeComponent
        /// </summary>
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        public void InitializeComponent() {
            if (_contentLoaded) {
                return;
            }
            _contentLoaded = true;
            System.Uri resourceLocater = new System.Uri("/Wpfs;component/usercontrol2.xaml", System.UriKind.Relative);
            
            #line 1 "..\..\..\UserControl2.xaml"
            System.Windows.Application.LoadComponent(this, resourceLocater);
            
            #line default
            #line hidden
        }
        
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [System.ComponentModel.EditorBrowsableAttribute(System.ComponentModel.EditorBrowsableState.Never)]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Design", "CA1033:InterfaceMethodsShouldBeCallableByChildTypes")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Maintainability", "CA1502:AvoidExcessiveComplexity")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1800:DoNotCastUnnecessarily")]
        void System.Windows.Markup.IComponentConnector.Connect(int connectionId, object target) {
            this._contentLoaded = true;
        }
    }
}

﻿using System;
using System.Linq;
using Autodesk.AutoCAD.ApplicationServices;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.EditorInput;
using Autodesk.AutoCAD.Geometry;
using Autodesk.AutoCAD.Runtime;
using DotNetARX;
namespace Viewports
{
    public class Viewports
    {
        [CommandMethod("CreateVP")]
        public void CreateVP()
        {
            Document doc=Application.DocumentManager.MdiActiveDocument;
            Database db=doc.Database;
            Editor ed=doc.Editor;
            using (Transaction trans=db.TransactionManager.StartTransaction())
            {
                //将活动空间切换到图纸空间
                db.TileMode = false;
                ed.SwitchToPaperSpace();
                //新建一个常规矩形视口
                Viewport vport=new Viewport();
                //设置视口的中点
                vport.CenterPoint = new Point3d(100, 50, 0);
                vport.Width = 120;//视口的宽度
                vport.Height = 80;//视口的高度                
                db.AddToPaperSpace(vport);//将视口添加到图纸空间 
                //修改视口的观察方向
                vport.ViewDirection = new Vector3d(1, 1, 1);
                vport.On = true;//启用新建的视口  
                ed.SwitchToModelSpace();//切换到模型空间              
                ed.SetCurrentVPort(vport);//将新视口置为当前
                trans.Commit();
            }
        }
        [CommandMethod("CreateCirVP")]
        public void CreateCirVP()
        {
            Document doc=Application.DocumentManager.MdiActiveDocument;
            Database db=doc.Database;
            Editor ed=doc.Editor;
            using (Transaction trans=db.TransactionManager.StartTransaction())
            {
                db.TileMode = false;
                ed.SwitchToPaperSpace();
                //在图纸空间中创建一个圆用来表示视口的范围
                Circle cir=new Circle(new Point3d(5, 2, 0), Vector3d.ZAxis, 1);
                db.AddToPaperSpace(cir);
                //圆形视口
                Viewport vportCir=new Viewport();
                db.AddToPaperSpace(vportCir);//将视口添加到图纸空间
                //设置非矩形视口的边界对象
                vportCir.NonRectClipEntityId = cir.ObjectId;
                vportCir.NonRectClipOn = true;//启用非矩形视口
                vportCir.On = true;//启用新建的圆形视口
                ed.SetCurrentVPort(vportCir);//将新视口置为当前
                trans.Commit();
            }
        }
        [CommandMethod("Create4VPorts")]
        public void Create4VPorts()
        {
            Document doc=Application.DocumentManager.MdiActiveDocument;
            Database db=doc.Database;
            using (Transaction trans=db.TransactionManager.StartTransaction())
            {
                //打开视口表
                ViewportTable vt=(ViewportTable)trans.GetObject(db.ViewportTableId, OpenMode.ForRead);
                string vname="4VP";//视口名称
                if (vt.Has(vname)) return; //如果已经存在名为4VP的视口，则返回
                vt.UpgradeOpen(); //切换视口表为写的状态
                //新建视口表记录数组
                ViewportTableRecord[] vtrs=new ViewportTableRecord[4];
                for (int i = 0; i < vtrs.Count(); i++)
                {
                    vtrs[i] = new ViewportTableRecord();//新建视口表记录
                    vtrs[i].Name = vname;//设置视口表记录的名称
                    vt.Add(vtrs[i]);//将视口表记录添加到视口表
                    //把视口表记录添加到事务处理中
                    trans.AddNewlyCreatedDBObject(vtrs[i], true);
                }
                //设置视口表记录的角点
                vtrs[0].LowerLeftCorner = new Point2d(0, 0);
                vtrs[0].UpperRightCorner = new Point2d(0.5, 0.5);
                vtrs[1].LowerLeftCorner = new Point2d(0.5, 0);
                vtrs[1].UpperRightCorner = new Point2d(1, 0.5);
                vtrs[2].LowerLeftCorner = new Point2d(0, 0.5);
                vtrs[2].UpperRightCorner = new Point2d(0.5, 1);
                vtrs[3].LowerLeftCorner = new Point2d(0.5, 0.5);
                vtrs[3].UpperRightCorner = new Point2d(1, 1);
                //分析当前空间是模型空间还是图纸空间
                if (db.TileMode == true) //模型空间
                    doc.SendStringToExecute("-VPORTS 4 ", false, false, false);
                else //图纸空间
                    doc.SendStringToExecute("-VPORTS 4  ", false, false, false);
                trans.Commit();
            }
        }

        [CommandMethod("ToggleSpace")]
        public void ToggleSpace()
        {
            Document doc=Application.DocumentManager.MdiActiveDocument;
            Database db=doc.Database;
            Editor ed=doc.Editor;
            //获取CVPORT系统变量的值
            int cvport=Convert.ToInt32(Application.GetSystemVariable("CVPORT"));
            if (db.TileMode == false)//图纸空间
            {
                //CVPORT=2，表示模型状态被激活
                if (cvport == 2)
                    ed.SwitchToPaperSpace();//切换到图纸状态
                else//CVPORT不为2，表示模型状态未被激活
                    ed.SwitchToModelSpace();//切换到模型状态
            }
            else//模型空间
                db.TileMode = false;
        }
    }
}
﻿using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Runtime.InteropServices;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.EditorInput;

namespace DotNetARX
{
    /// <summary>
    /// 视口操作类
    /// </summary>
    public static class ViewportTools
    {
        [DllImport("acad.exe", CallingConvention = CallingConvention.Cdecl, EntryPoint = "?acedSetCurrentVPort@@YA?AW4ErrorStatus@Acad@@PBVAcDbViewport@@@Z")]
        extern static private int acedSetCurrentVPort(IntPtr AcDbVport);
        [DllImport("acad.exe", CallingConvention = CallingConvention.Cdecl, EntryPoint = "?acedSetCurrentVPort@@YA?AW4ErrorStatus@Acad@@H@Z")]
        extern static private int acedSetCurrentVPort(int vpnumber);
        /// <summary>
        /// 将视口置为当前
        /// </summary>
        /// <param name="editor">命令行对象</param>
        /// <param name="vport">视口对象</param>
        public static void SetCurrentVPort(this Editor editor, Viewport vport)
        {
            acedSetCurrentVPort(vport.UnmanagedObject);
        }

        /// <summary>
        /// 将视口置为当前
        /// </summary>
        /// <param name="editor">命令行对象</param>
        /// <param name="vportNumber">视口编号</param>
        public static void SetCurrentVPort(this Editor editor, int vportNumber)
        {
            acedSetCurrentVPort(vportNumber);
        }

        /// <summary>
        /// 获取当前活动视口
        /// </summary>
        /// <param name="db">数据库对象</param>
        /// <returns>返回当前活动视口的Id</returns>
        public static ObjectId CurrentViewportTableRecordId(this Database db)
        {
            ObjectId vtrId=ObjectId.Null;
            ViewportTable vt=(ViewportTable)db.ViewportTableId.GetObject(OpenMode.ForRead);
            foreach (ObjectId id in vt)
            {
                if (!id.IsErased)
                {
                    vtrId = id;
                    break;
                }
            }
            return vtrId;
        }
    }
}
﻿using Autodesk.AutoCAD.ApplicationServices;
using Autodesk.AutoCAD.EditorInput;
using Autodesk.AutoCAD.Runtime;
using DotNetARX;
using Autodesk.AutoCAD.Geometry;
namespace Views
{
    public class Views
    {
        [CommandMethod("ZoomScaled")]
        public void ZoomScaled()
        {
            Editor ed=Application.DocumentManager.MdiActiveDocument.Editor;
            ed.ZoomScaled(2);//放大视图为2倍
        }
        [CommandMethod("ZoomWindow")]
        public void ZoomWindow()
        {
            Editor ed=Application.DocumentManager.MdiActiveDocument.Editor;
            //提示用户选择定义缩放窗口的两个角点
            PromptPointResult pt1Result=ed.GetPoint("输入第一个角点");
            if (pt1Result.Status != PromptStatus.OK) return;
            PromptPointResult pt2Result=ed.GetPoint("输入第二个角点");
            if (pt2Result.Status != PromptStatus.OK) return;
            //缩放视图为由两个角点构成的区域
            ed.ZoomWindow(pt1Result.Value, pt2Result.Value);
            //下面一行调用Zoom函数，与上一行的代码效果相同
            //ed.Zoom(pt1Result.Value, pt2Result.Value, Point3d.Origin, 1);
        }
        [CommandMethod("ZoomObject")]
        public void ZoomObject()
        {
            Editor ed=Application.DocumentManager.MdiActiveDocument.Editor;
            //提示用户选择对象
            PromptEntityResult result=ed.GetEntity("请选择对象");
            if (result.Status != PromptStatus.OK) return;
            //根据对象的范围显示视图
            ed.ZoomObject(result.ObjectId);
        }
        [CommandMethod("ZoomExt")]
        public void ZoomExt()
        {
            Editor ed=Application.DocumentManager.MdiActiveDocument.Editor;
            ed.ZoomExtents();
            //下面一行调用Zoom函数，与上一行的代码效果相同
            //ed.Zoom(Point3d.Origin, Point3d.Origin, Point3d.Origin, 1);
        }
    }
}
﻿using System;
using Autodesk.AutoCAD.ApplicationServices;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.EditorInput;
using Autodesk.AutoCAD.Geometry;

namespace DotNetARX
{
    /// <summary>
    /// 视图操作类
    /// </summary>
    public static class ViewTableTools
    {
        /// <summary>
        /// 获取WCS到DCS的转换矩阵
        /// </summary>
        /// <param name="vtr">视图（ViewTableRecord）或视口（ViewportTableRecord）</param>
        /// <returns></returns>
        public static Matrix3d Wcs2Dcs(this AbstractViewTableRecord vtr)
        {
            //获取视图或视口平面到世界坐标系转换矩阵
            Matrix3d mat = Matrix3d.PlaneToWorld(vtr.ViewDirection);
            //将平移过的视口或视图回复到原始状态所需要的矩阵
            mat = Matrix3d.Displacement(vtr.Target - Point3d.Origin) * mat;
            //将旋转过的视口或视图回复到原始状态所需要的矩阵
            mat = Matrix3d.Rotation(-vtr.ViewTwist, vtr.ViewDirection, vtr.Target) * mat;
            return mat.Inverse();//将矩阵进行转置
        }

        /// <summary>
        /// 视图缩放
        /// </summary>
        /// <param name="ed">命令行对象</param>
        /// <param name="ptMin">要显示区域的左下角点</param>
        /// <param name="ptMax">要显示区域的右上角点</param>
        /// <param name="ptCenter">要显示区域的中心点</param>
        /// <param name="factor">缩放比例</param>
        public static void Zoom(this Editor ed, Point3d ptMin, Point3d ptMax, Point3d ptCenter, double factor)
        {
            Extents3d extents;
            Document doc = ed.Document;
            Database db = doc.Database;
            int cvport = Convert.ToInt32(Application.GetSystemVariable("CVPORT"));
            if (db.TileMode == true)
            {
                if (ptMin.Equals(Point3d.Origin) == true && ptMax.Equals(Point3d.Origin) == true)
                {
                    ptMin = db.Extmin;
                    ptMax = db.Extmax;
                }
            }
            else
            {
                if (cvport == 1)
                {
                    if (ptMin.Equals(Point3d.Origin) == true && ptMax.Equals(Point3d.Origin) == true)
                    {
                        ptMin = db.Pextmin;
                        ptMax = db.Pextmax;
                    }
                }
                else
                {
                    if (ptMin.Equals(Point3d.Origin) == true && ptMax.Equals(Point3d.Origin) == true)
                    {
                        ptMin = db.Extmin;
                        ptMax = db.Extmax;
                    }
                }
            }
            using (Transaction trans = db.TransactionManager.StartTransaction())
            {
                ViewTableRecord view = ed.GetCurrentView();
                Matrix3d matWCS2DCS = view.Wcs2Dcs();
                if (ptCenter.DistanceTo(Point3d.Origin) != 0)
                {
                    ptMin = new Point3d(ptCenter.X - view.Width / 2, ptCenter.Y - view.Height / 2, 0);
                    ptMax = new Point3d(ptCenter.X + view.Width / 2, ptCenter.Y + view.Height / 2, 0);
                }
                using (Line line = new Line(ptMin, ptMax))
                {
                    extents = new Extents3d(line.GeometricExtents.MinPoint, line.GeometricExtents.MaxPoint);
                }
                double viewRatio = view.Width / view.Height;
                extents.TransformBy(matWCS2DCS);
                double width, height;
                Point2d newCenter;
                if (ptCenter.DistanceTo(Point3d.Origin) != 0)
                {
                    width = view.Width;
                    height = view.Height;
                    if (factor == 0)
                    {
                        ptCenter = ptCenter.TransformBy(matWCS2DCS);
                    }
                    newCenter = new Point2d(ptCenter.X, ptCenter.Y);
                }
                else
                {
                    width = extents.MaxPoint.X - extents.MinPoint.X;
                    height = extents.MaxPoint.Y - extents.MinPoint.Y;
                    newCenter = new Point2d((extents.MaxPoint.X + extents.MinPoint.X) * 0.5, (extents.MaxPoint.Y + extents.MinPoint.Y) * 0.5);
                }
                if (width > height * viewRatio) height = width / viewRatio;
                if (factor != 0)
                {
                    view.Height = height * factor;
                    view.Width = width * factor;
                }
                view.CenterPoint = newCenter;
                ed.SetCurrentView(view);
                trans.Commit();
            }
        }

        /// <summary>
        /// 比例缩放视图
        /// </summary>
        /// <param name="ed">命令行对象</param>
        /// <param name="scale">缩放比例</param>
        public static void ZoomScaled(this Editor ed, double scale)
        {
            //得到当前视图
            ViewTableRecord view = ed.GetCurrentView();
            //修改视图的宽度和高度
            view.Width /= scale;
            view.Height /= scale;
            ed.SetCurrentView(view);//更新当前视图
        }

        /// <summary>
        /// 窗口缩放视图
        /// </summary>
        /// <param name="ed">命令行对象</param>
        /// <param name="pt1">窗口的角点</param>
        /// <param name="pt2">窗口的角点</param>
        public static void ZoomWindow(this Editor ed, Point3d pt1, Point3d pt2)
        {
            //创建一临时的直线用于获取两点表示的范围
            using (Line line = new Line(pt1, pt2))
            {
                //获取两点表示的范围
                Extents3d extents = new Extents3d(line.GeometricExtents.MinPoint, line.GeometricExtents.MaxPoint);
                //获取范围内的最小值点及最大值点
                Point2d minPt = new Point2d(extents.MinPoint.X, extents.MinPoint.Y);
                Point2d maxPt = new Point2d(extents.MaxPoint.X, extents.MaxPoint.Y);
                //得到当前视图
                ViewTableRecord view = ed.GetCurrentView();
                //设置视图的中心点、高度和宽度
                view.CenterPoint = minPt + (maxPt - minPt) / 2;
                view.Height = maxPt.Y - minPt.Y;
                view.Width = maxPt.X - minPt.X;
                ed.SetCurrentView(view);//更新当前视图
            }
        }

        /// <summary>
        /// 根据图形边界显示视图
        /// </summary>
        /// <param name="ed">命令行对象</param>
        public static void ZoomExtents(this Editor ed)
        {
            Database db = ed.Document.Database;
            db.UpdateExt(true);//更新当前模型空间的范围
            //根据当前图形的界限范围对视图进行缩放
            if (db.Extmax.X < db.Extmin.X)
            {
                Plane plane = new Plane();
                Point3d pt1 = new Point3d(plane, db.Limmin);
                Point3d pt2 = new Point3d(plane, db.Limmax);
                ed.ZoomWindow(pt1, pt2);
            }
            else
            {
                ed.ZoomWindow(db.Extmin, db.Extmax);
            }
        }

        /// <summary>
        /// 根据对象的范围显示视图
        /// </summary>
        /// <param name="ed">命令行对象</param>
        /// <param name="entId">对象的Id</param>
        public static void ZoomObject(this Editor ed, ObjectId entId)
        {
            Database db = ed.Document.Database;
            using (Transaction trans = db.TransactionManager.StartTransaction())
            {
                //获取实体对象
                Entity ent = trans.GetObject(entId, OpenMode.ForRead) as Entity;
                if (ent == null) return;
                //根据实体的范围对视图进行缩放
                Extents3d ext = ent.GeometricExtents;
                ext.TransformBy(ed.CurrentUserCoordinateSystem.Inverse());
                ed.ZoomWindow(ext.MinPoint, ext.MaxPoint);
                trans.Commit();
            }
        }

        /// <summary>
        /// 居中显示视图
        /// </summary>
        /// <param name="ed">命令行对象</param>
        /// <param name="center">居中的点</param>
        public static void ZoomCenter(this Editor ed, Point3d center)
        {
            ed.Zoom(Point3d.Origin, Point3d.Origin, center, 1);
        }
    }
}
﻿using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using System.Text;
using System.Windows.Forms;
using Autodesk.AutoCAD.ApplicationServices;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.EditorInput;
using Autodesk.AutoCAD.Runtime;
using DotNetARX;
using AcadApp = Autodesk.AutoCAD.ApplicationServices.Application;
namespace WBlockTest
{
    public class WBlockTest
    {
        [CommandMethod("CopyEntities")]
        public void CopyEntities()
        {
            Editor ed = AcadApp.DocumentManager.MdiActiveDocument.Editor;
            //新建一个数据库对象
            Database db = new Database(false, true);
            //获取当前数据库对象
            Database curdb = HostApplicationServices.WorkingDatabase;
            //下面的操作选择要复制到新建数据库中的实体
            PromptSelectionOptions opts = new PromptSelectionOptions();
            opts.MessageForAdding = "请输入复制到新文件的实体";
            SelectionSet ss = ed.GetSelection(opts).Value;
            //获取所选实体的ObjectId集合
            ObjectIdCollection ids = new ObjectIdCollection(ss.GetObjectIds());
            //把当前数据库中所选择的实体复制到新建的数据库中，并指定插入点为当前数据库的基点
            db = curdb.Wblock(ids, curdb.Ucsorg);
            //以2004格式保存数据库为Dwg文件
            db.SaveAs(@"C:\test.dwg", DwgVersion.AC1800);
        }

        [CommandMethod("GetBlocksFromDwgs")]
        public void GetBlocksFromDwgs()
        {
            Database curdb=HostApplicationServices.WorkingDatabase;//获取当前数据库对象
            FolderBrowserDialog dlg=new FolderBrowserDialog();//文件夹浏览对话框
            DialogResult result=dlg.ShowDialog();//显示对话框
            if (result == DialogResult.OK)//用户选择了“确定”按钮
            {
                string pathName=dlg.SelectedPath;//用户选择的文件夹
                //获取所选文件夹中的所有文件
                string[] fileNames=Directory.GetFiles(pathName, "*.dwg", SearchOption.AllDirectories);
                using (Transaction trans=curdb.TransactionManager.StartTransaction())
                {
                    foreach (string fileName in fileNames)//遍历文件夹中的文件
                    {
                        //获取去除扩展名后的文件名（不含目录）
                        string destName=SymbolUtilityServices.GetSymbolNameFromPathName(fileName, "dwg");
                        //上一句不一定能得到有效的文件名，必须对于无效的名称进行修正
                        destName = SymbolUtilityServices.RepairSymbolName(destName, false);
                        using (Database db=new Database(false, true))
                        {
                            //读入Dwg文件
                            db.ReadDwgFile(fileName, FileShare.Read, true, null);
                            //为了让插入块的函数在多个图形文件打开的情况下起作用，你必须使用下面的函数把Dwg文件关闭
                            db.CloseInput(true);
                            bool isAnno=db.AnnotativeDwg();//判断文件是否包含可缩放块
                            //把源数据库模型空间中的实体插入到当前数据库的一个新的块表记录中
                            ObjectId btrId=curdb.Insert(destName, db, false);
                            if (isAnno)//如果包含可缩放块，则设置可缩放属性
                            {
                                BlockTableRecord btr=(BlockTableRecord)trans.GetObject(btrId, OpenMode.ForWrite);
                                btr.Annotative = AnnotativeStates.True;
                            }
                        }
                    }
                    trans.Commit();
                }
            }
        }
    }
}
﻿#pragma checksum "..\..\..\WPFBinding.xaml" "{406ea660-64cf-4c82-b6f0-42d48172a799}" "7BDC0CD85F39CA212F03EF7ACFC60631"
//------------------------------------------------------------------------------
// <auto-generated>
//     此代码由工具生成。
//     运行时版本:4.0.30319.488
//
//     对此文件的更改可能会导致不正确的行为，并且如果
//     重新生成代码，这些更改将会丢失。
// </auto-generated>
//------------------------------------------------------------------------------

using System;
using System.Diagnostics;
using System.Windows;
using System.Windows.Automation;
using System.Windows.Controls;
using System.Windows.Controls.Primitives;
using System.Windows.Data;
using System.Windows.Documents;
using System.Windows.Forms.Integration;
using System.Windows.Ink;
using System.Windows.Input;
using System.Windows.Markup;
using System.Windows.Media;
using System.Windows.Media.Animation;
using System.Windows.Media.Effects;
using System.Windows.Media.Imaging;
using System.Windows.Media.Media3D;
using System.Windows.Media.TextFormatting;
using System.Windows.Navigation;
using System.Windows.Shapes;
using System.Windows.Shell;


namespace Wpfs {
    
    
    /// <summary>
    /// WPFBinding
    /// </summary>
    [System.CodeDom.Compiler.GeneratedCodeAttribute("PresentationBuildTasks", "4.0.0.0")]
    public partial class WPFBinding : System.Windows.Controls.UserControl, System.Windows.Markup.IComponentConnector {
        
        
        #line 10 "..\..\..\WPFBinding.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.ComboBox comboBoxDoors;
        
        #line default
        #line hidden
        
        
        #line 20 "..\..\..\WPFBinding.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.ListView listViewBlocks;
        
        #line default
        #line hidden
        
        private bool _contentLoaded;
        
        /// <summary>
        /// InitializeComponent
        /// </summary>
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        public void InitializeComponent() {
            if (_contentLoaded) {
                return;
            }
            _contentLoaded = true;
            System.Uri resourceLocater = new System.Uri("/Wpfs;component/wpfbinding.xaml", System.UriKind.Relative);
            
            #line 1 "..\..\..\WPFBinding.xaml"
            System.Windows.Application.LoadComponent(this, resourceLocater);
            
            #line default
            #line hidden
        }
        
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [System.ComponentModel.EditorBrowsableAttribute(System.ComponentModel.EditorBrowsableState.Never)]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Design", "CA1033:InterfaceMethodsShouldBeCallableByChildTypes")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Maintainability", "CA1502:AvoidExcessiveComplexity")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1800:DoNotCastUnnecessarily")]
        void System.Windows.Markup.IComponentConnector.Connect(int connectionId, object target) {
            switch (connectionId)
            {
            case 1:
            
            #line 8 "..\..\..\WPFBinding.xaml"
            ((System.Windows.Controls.Grid)(target)).Loaded += new System.Windows.RoutedEventHandler(this.Grid_Loaded);
            
            #line default
            #line hidden
            return;
            case 2:
            this.comboBoxDoors = ((System.Windows.Controls.ComboBox)(target));
            
            #line 10 "..\..\..\WPFBinding.xaml"
            this.comboBoxDoors.DropDownClosed += new System.EventHandler(this.comboBoxDoors_DropDownClosed);
            
            #line default
            #line hidden
            return;
            case 3:
            this.listViewBlocks = ((System.Windows.Controls.ListView)(target));
            return;
            }
            this._contentLoaded = true;
        }
    }
}

﻿#pragma checksum "..\..\..\WpfPanel.xaml" "{406ea660-64cf-4c82-b6f0-42d48172a799}" "FFD88F8F0B2260C6661A543CBDA5444D"
//------------------------------------------------------------------------------
// <auto-generated>
//     此代码由工具生成。
//     运行时版本:4.0.30319.488
//
//     对此文件的更改可能会导致不正确的行为，并且如果
//     重新生成代码，这些更改将会丢失。
// </auto-generated>
//------------------------------------------------------------------------------

using System;
using System.Diagnostics;
using System.Windows;
using System.Windows.Automation;
using System.Windows.Controls;
using System.Windows.Controls.Primitives;
using System.Windows.Data;
using System.Windows.Documents;
using System.Windows.Forms.Integration;
using System.Windows.Ink;
using System.Windows.Input;
using System.Windows.Markup;
using System.Windows.Media;
using System.Windows.Media.Animation;
using System.Windows.Media.Effects;
using System.Windows.Media.Imaging;
using System.Windows.Media.Media3D;
using System.Windows.Media.TextFormatting;
using System.Windows.Navigation;
using System.Windows.Shapes;
using System.Windows.Shell;


namespace Wpfs {
    
    
    /// <summary>
    /// WpfPanel
    /// </summary>
    [System.CodeDom.Compiler.GeneratedCodeAttribute("PresentationBuildTasks", "4.0.0.0")]
    public partial class WpfPanel : System.Windows.Controls.UserControl, System.Windows.Markup.IComponentConnector, System.Windows.Markup.IStyleConnector {
        
        
        #line 20 "..\..\..\WpfPanel.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.Button buttonLine;
        
        #line default
        #line hidden
        
        
        #line 24 "..\..\..\WpfPanel.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.Button buttonPolyline;
        
        #line default
        #line hidden
        
        
        #line 28 "..\..\..\WpfPanel.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.Button buttonRectangle;
        
        #line default
        #line hidden
        
        
        #line 32 "..\..\..\WpfPanel.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.Button buttonCircle;
        
        #line default
        #line hidden
        
        
        #line 40 "..\..\..\WpfPanel.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.Button buttonCopy;
        
        #line default
        #line hidden
        
        
        #line 44 "..\..\..\WpfPanel.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.Button buttonErase;
        
        #line default
        #line hidden
        
        
        #line 48 "..\..\..\WpfPanel.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.Button buttonMove;
        
        #line default
        #line hidden
        
        
        #line 52 "..\..\..\WpfPanel.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.Button buttonRotate;
        
        #line default
        #line hidden
        
        private bool _contentLoaded;
        
        /// <summary>
        /// InitializeComponent
        /// </summary>
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        public void InitializeComponent() {
            if (_contentLoaded) {
                return;
            }
            _contentLoaded = true;
            System.Uri resourceLocater = new System.Uri("/Wpfs;component/wpfpanel.xaml", System.UriKind.Relative);
            
            #line 1 "..\..\..\WpfPanel.xaml"
            System.Windows.Application.LoadComponent(this, resourceLocater);
            
            #line default
            #line hidden
        }
        
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [System.ComponentModel.EditorBrowsableAttribute(System.ComponentModel.EditorBrowsableState.Never)]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Design", "CA1033:InterfaceMethodsShouldBeCallableByChildTypes")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Maintainability", "CA1502:AvoidExcessiveComplexity")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1800:DoNotCastUnnecessarily")]
        void System.Windows.Markup.IComponentConnector.Connect(int connectionId, object target) {
            switch (connectionId)
            {
            case 2:
            this.buttonLine = ((System.Windows.Controls.Button)(target));
            return;
            case 3:
            this.buttonPolyline = ((System.Windows.Controls.Button)(target));
            return;
            case 4:
            this.buttonRectangle = ((System.Windows.Controls.Button)(target));
            return;
            case 5:
            this.buttonCircle = ((System.Windows.Controls.Button)(target));
            return;
            case 6:
            this.buttonCopy = ((System.Windows.Controls.Button)(target));
            return;
            case 7:
            this.buttonErase = ((System.Windows.Controls.Button)(target));
            return;
            case 8:
            this.buttonMove = ((System.Windows.Controls.Button)(target));
            return;
            case 9:
            this.buttonRotate = ((System.Windows.Controls.Button)(target));
            return;
            }
            this._contentLoaded = true;
        }
        
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [System.ComponentModel.EditorBrowsableAttribute(System.ComponentModel.EditorBrowsableState.Never)]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Design", "CA1033:InterfaceMethodsShouldBeCallableByChildTypes")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1800:DoNotCastUnnecessarily")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Maintainability", "CA1502:AvoidExcessiveComplexity")]
        void System.Windows.Markup.IStyleConnector.Connect(int connectionId, object target) {
            System.Windows.EventSetter eventSetter;
            switch (connectionId)
            {
            case 1:
            eventSetter = new System.Windows.EventSetter();
            eventSetter.Event = System.Windows.Controls.Primitives.ButtonBase.ClickEvent;
            
            #line 11 "..\..\..\WpfPanel.xaml"
            eventSetter.Handler = new System.Windows.RoutedEventHandler(this.executeCommand);
            
            #line default
            #line hidden
            ((System.Windows.Style)(target)).Setters.Add(eventSetter);
            break;
            }
        }
    }
}

﻿#pragma checksum "..\..\..\WpfTreeView.xaml" "{406ea660-64cf-4c82-b6f0-42d48172a799}" "ED86E59FDE127D4CF35BF4F484C252FB"
//------------------------------------------------------------------------------
// <auto-generated>
//     此代码由工具生成。
//     运行时版本:4.0.30319.488
//
//     对此文件的更改可能会导致不正确的行为，并且如果
//     重新生成代码，这些更改将会丢失。
// </auto-generated>
//------------------------------------------------------------------------------

using System;
using System.Diagnostics;
using System.Windows;
using System.Windows.Automation;
using System.Windows.Controls;
using System.Windows.Controls.Primitives;
using System.Windows.Data;
using System.Windows.Documents;
using System.Windows.Ink;
using System.Windows.Input;
using System.Windows.Markup;
using System.Windows.Media;
using System.Windows.Media.Animation;
using System.Windows.Media.Effects;
using System.Windows.Media.Imaging;
using System.Windows.Media.Media3D;
using System.Windows.Media.TextFormatting;
using System.Windows.Navigation;
using System.Windows.Shapes;
using System.Windows.Shell;


namespace Wpfs {
    
    
    /// <summary>
    /// WpfTreeView
    /// </summary>
    [System.CodeDom.Compiler.GeneratedCodeAttribute("PresentationBuildTasks", "4.0.0.0")]
    public partial class WpfTreeView : System.Windows.Controls.UserControl, System.Windows.Markup.IComponentConnector {
        
        private bool _contentLoaded;
        
        /// <summary>
        /// InitializeComponent
        /// </summary>
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        public void InitializeComponent() {
            if (_contentLoaded) {
                return;
            }
            _contentLoaded = true;
            System.Uri resourceLocater = new System.Uri("/Wpfs2;component/wpftreeview.xaml", System.UriKind.Relative);
            
            #line 1 "..\..\..\WpfTreeView.xaml"
            System.Windows.Application.LoadComponent(this, resourceLocater);
            
            #line default
            #line hidden
        }
        
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [System.ComponentModel.EditorBrowsableAttribute(System.ComponentModel.EditorBrowsableState.Never)]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Design", "CA1033:InterfaceMethodsShouldBeCallableByChildTypes")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Maintainability", "CA1502:AvoidExcessiveComplexity")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1800:DoNotCastUnnecessarily")]
        void System.Windows.Markup.IComponentConnector.Connect(int connectionId, object target) {
            this._contentLoaded = true;
        }
    }
}

﻿using ahlzl;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.Geometry;
using Autodesk.AutoCAD.Runtime;

namespace WrapperTest
{
    public class WrapperTest
    {
        [CommandMethod("DrawLine")]
        public void DrawLineTest()
        {
            ObjectId entId = Tools.CreateLine
                (new Point3d(0.0, 0.0, 0.0), new Point3d(8.0, 3.0, 0.0));
        }
    }
}
﻿using Autodesk.AutoCAD.DatabaseServices;

namespace DotNetARX
{
    /// <summary>
    /// 扩展数据操作类
    /// </summary>
    public static class XDataTools
    {
        /// <summary>
        /// 为对象添加扩展数据
        /// </summary>
        /// <param name="id">对象的Id</param>
        /// <param name="regAppName">注册应用程序名</param>
        /// <param name="values">要添加的扩展数据项列表</param>
        public static void AddXData(this ObjectId id, string regAppName, TypedValueList values)
        {
            Database db=id.Database;//获取实体所属的数据库
            //获取数据库的注册应用程序表
            RegAppTable regTable=(RegAppTable)db.RegAppTableId.GetObject(OpenMode.ForWrite);
            //如里不存在名为regAppName的记录，则创建新的注册应用程序表记录
            if (!regTable.Has(regAppName))
            {
                //创建一个注册应用程序表记录用来表示扩展数据
                RegAppTableRecord regRecord=new RegAppTableRecord();
                regRecord.Name = regAppName;//设置扩展数据的名字
                //在注册应用程序表加入扩展数据，并通知事务处理
                regTable.Add(regRecord);
                db.TransactionManager.AddNewlyCreatedDBObject(regRecord, true);
            }
            //以写的方式打开要添加扩展数据的实体
            DBObject obj=id.GetObject(OpenMode.ForWrite);
            //将扩展数据的应用程序名添加到扩展数据项列表的第一项
            values.Insert(0, new TypedValue((int)DxfCode.ExtendedDataRegAppName, regAppName));
            obj.XData = values;//将新建的扩展数据附加到实体中 
            regTable.DowngradeOpen();//为了安全，将应用程序注册表切换为读的状态
        }

        /// <summary>
        /// 获取对象的扩展数据
        /// </summary>
        /// <param name="id">对象的Id</param>
        /// <param name="regAppName">注册应用程序名</param>
        /// <returns>返回获得的扩展数据</returns>
        public static TypedValueList GetXData(this ObjectId id, string regAppName)
        {
            TypedValueList values=new TypedValueList();
            //打开对象
            DBObject obj=id.GetObject(OpenMode.ForRead);
            //获取对象中名为regAppName的扩展数据
            values = obj.GetXDataForApplication(regAppName);
            return values;//返回获得的扩展数据
        }

        /// <summary>
        /// 修改扩展数据
        /// </summary>
        /// <param name="id">对象的Id</param>
        /// <param name="regAppName">注册应用程序名</param>
        /// <param name="code">扩展数据的类型</param>
        /// <param name="oldValue">原来的扩展数据值</param>
        /// <param name="newValue">新的扩展数据值</param>
        public static void ModXData(this ObjectId id, string regAppName, DxfCode code, object oldValue, object newValue)
        {
            // 以写的方式打开对象
            DBObject obj=id.GetObject(OpenMode.ForWrite);
            // 获取regAppName注册应用程序下的扩展数据列表
            TypedValueList xdata=obj.GetXDataForApplication(regAppName);
            for (int i = 0; i < xdata.Count; i++)// 遍历扩展数据列表
            {
                TypedValue tv=xdata[i]; //扩展数据
                //判断扩展数据的类型和值是否满足条件
                if (tv.TypeCode == (short)code && tv.Value.Equals(oldValue))
                {
                    // 设置新的扩展数据值
                    xdata[i] = new TypedValue(tv.TypeCode, newValue);
                    break; //要修改的数据已找到，跳出循环
                }
            }
            obj.XData = xdata; // 覆盖原来的扩展数据，达到修改的目的
            obj.DowngradeOpen();// 为了安全，切换对象为读的状态
        }

        /// <summary>
        /// 删除指定注册应用程序下的扩展数据
        /// </summary>
        /// <param name="id">对象的Id</param>
        /// <param name="regAppName">注册应用程序名</param>
        public static void RemoveXData(this ObjectId id, string regAppName)
        {
            // 以写的方式打开对象
            DBObject obj=id.GetObject(OpenMode.ForWrite);
            // 获取regAppName注册应用程序下的扩展数据列表
            TypedValueList xdata=obj.GetXDataForApplication(regAppName);
            if (xdata != null)// 如果有扩展数据
            {
                // 新建一个TypedValue列表，并只添加注册应用程序名扩展数据项
                TypedValueList newValues=new TypedValueList();
                newValues.Add(DxfCode.ExtendedDataRegAppName, regAppName);
                obj.XData = newValues; //为对象的XData属性重新赋值，从而删除扩展数据 
            }
            obj.DowngradeOpen();// 为了安全，切换对象为读的状态
        }
    }
}
﻿using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using Autodesk.AutoCAD.Runtime;
using Autodesk.AutoCAD.ApplicationServices;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.EditorInput;
using DotNetARX;
using Autodesk.AutoCAD.Geometry;

namespace Xrecords
{
    public class Xrecords
    {
        [CommandMethod("AddXrec")]
        public void AddXrec()
        {
            Document doc=Application.DocumentManager.MdiActiveDocument;
            Database db=doc.Database;
            Editor ed=doc.Editor;

            using (Transaction trans=db.TransactionManager.StartTransaction())
            {
                ed.WriteMessage("\n请选择表示房间、椅子的块及员工姓名文本");
                List<Entity> ents=db.GetSelection();
                //LINQ过滤只块
                var blocks=from ent in ents
                           where ent is BlockReference
                           select ent;
                //过滤房间块
                var room=(from BlockReference b in blocks
                          where b.Name == "RMNUM"
                          select b).FirstOrDefault();
                //过滤椅子块并返回椅子数
                var chairs=(from BlockReference b in blocks
                            where b.Name == "CHAIR7"
                            select b).Count();
                //过滤表示员工姓名的多行文本
                var txt=(from ent in ents
                         where ent is MText
                         select ent).FirstOrDefault();
                //必须同时选中房间和椅子块
                if (room == null && txt == null) return;
                //获取表示房间号的块属性
                string roomNum=room.ObjectId.GetAttributeInBlockReference("NUMBER");
                //设置员工类型：房间中椅子数大于1的为管理人员，否则为普通员工
                string employeeType = chairs > 1 ? "管理人员" : "普通员工";
                //为所选文本添加员工类型和房间号的扩展记录
                TypedValueList values=new TypedValueList();
                values.Add(DxfCode.Text, employeeType);
                values.Add(DxfCode.Text, roomNum);
                txt.ObjectId.AddXrecord("员工", values);
                trans.Commit();
            }
        }

        [CommandMethod("AddDict")]
        public static void AddDict()
        {
            Database db=HostApplicationServices.WorkingDatabase;
            using (Transaction trans=db.TransactionManager.StartTransaction())
            {
                //为图形添加命名对象字典：管理人员
                ObjectId id=db.AddNamedDictionary("管理人员");
                if (id.IsNull)//如果没有创建成功，则返回
                {
                    Application.ShowAlertDialog("已经有管理人员记录了");
                    return;
                }
                //向管理人员字典添加一条表示年薪的扩展记录
                TypedValueList values=new TypedValueList();
                values.Add(DxfCode.Real, 500000.0);
                id.AddXrecord("年薪", values);
                //为图形添加命名对象字典：普通员工员
                id = db.AddNamedDictionary("普通员工");
                if (id.IsNull)//如果没有创建成功，则返回
                {
                    Application.ShowAlertDialog("已经有普通员工记录了");
                    return;
                }
                //向普通员工字典添加一条表示年薪的扩展记录
                values.Clear();
                values.Add(DxfCode.Real, 100000.0);
                id.AddXrecord("年薪", values);
                trans.Commit();
            }
        }

        [CommandMethod("ListXrec")]
        public void ListXrec()
        {
            Document doc=Application.DocumentManager.MdiActiveDocument;
            Database db=doc.Database;
            Editor ed=doc.Editor;
            //提示用户选择放置表格的位置
            PromptPointResult pointResult = ed.GetPoint("\n请选择表放置的位置: ");
            if (pointResult.Status != PromptStatus.OK) return;
            using (Transaction trans=db.TransactionManager.StartTransaction())
            {
                //获取有名对象字典
                DBDictionary dicts=(DBDictionary)trans.GetObject(db.NamedObjectsDictionaryId, OpenMode.ForRead);
                //获取模型空间中所有的多行文本
                var mtexts=(from m in db.GetEntsInModelSpace<MText>()
                            let xrecord = m.ObjectId.GetXrecord("员工")//获取名为员工的扩展记录
                            where xrecord != null //只选择有员工扩展记录的文本
                            let Position = xrecord[0].Value.ToString() //获取表示员工职位的扩展记录项
                            let RoomNumber = xrecord[1].Value.ToString()//获取表示员工房间的扩展记录项
                            let Name = m.Text.Replace("\r\n", " ")//对文本表示的人名去除回车换行符
                            //通过表示职位的有名对象字典获取职位对应的年薪
                            let Salary = string.Format("{0:C0}", dicts.GetAt(Position).GetXrecord("年薪").First().Value)
                            orderby RoomNumber //按房间号排序
                            //生成一个包含房间号、职位、姓名和年薪的匿名类，并转化为列表
                            select new { RoomNumber, Position, Name, Salary }).ToList();
                //添加表格表头
                mtexts.Insert(0, new { RoomNumber = "员工明细表", Position = "", Name = "", Salary = "" });
                //添加表格标题
                mtexts.Insert(1, new { RoomNumber = "房间号", Position = "职位", Name = "姓名", Salary = "年薪" });
                Table tb = new Table();//新建表格对象
                tb.TableStyle = db.Tablestyle;//设置表格的样式为数据库缺省样式
                //获取表格的行数和列数
                tb.NumRows = mtexts.Count();
                tb.NumColumns = 4;
                tb.SetRowHeight(3);//行高
                tb.SetColumnWidth(15);//列宽
                tb.SetTextHeight(1);//文本高度
                //设置数据单元格的对奇方式为居中
                tb.SetAlignment(CellAlignment.MiddleCenter, RowType.DataRow);
                //将表格放置到用户选择的点
                tb.Position = pointResult.Value;
                //遍历多行文本集合，按行设置表格的内容
                for (int i = 0; i < mtexts.Count; i++)
                {
                    var mtext=mtexts[i];
                    tb.SetRowTextString(i, mtext.RoomNumber, mtext.Name, mtext.Position, mtext.Salary);
                }
                tb.GenerateLayout();//根据当前表格样式更新表格
                db.AddToModelSpace(tb);//添加表格到模型空间
                trans.Commit();
            }
        }
    }
}
﻿using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using Autodesk.AutoCAD.ApplicationServices;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.EditorInput;
using Autodesk.AutoCAD.Geometry;
using Autodesk.AutoCAD.Runtime;
using DotNetARX;
namespace XRefs
{
    public class XRefs
    {
        [CommandMethod("AttachExternalReference")]
        public void AttachExternalReference()
        {
            Database db=HostApplicationServices.WorkingDatabase;
            Editor ed = Application.DocumentManager.MdiActiveDocument.Editor;
            //获取文档管理器对象以打开Dwg文件
            DocumentCollection docs = Application.DocumentManager;
            //设置打开文件对话框的有关选项
            PromptOpenFileOptions opt = new PromptOpenFileOptions("\n请输入文件名：");
            opt.Filter = "图形(*.dwg)|*.dwg|图形(*.dxf)|*.dxf";
            opt.FilterIndex = 0;
            //根据打开文件对话框中用户的选择，获取文件名
            string filename = ed.GetFileNameForOpen(opt).StringResult;
            Point3d pt=Point3d.Origin;//外部参照的插入点
            //提示用户输入外部参照的类型，“A”为附着型，“O”为覆盖型
            PromptKeywordOptions keyOpt=new PromptKeywordOptions("\n请输入外部参照的类型[附着(A)/覆盖(O)]<A>");
            keyOpt.Keywords.Add("A", "A", "A", false, true);
            keyOpt.Keywords.Add("O", "O", "O", false, true);
            keyOpt.Keywords.Default = "A";//缺省为附着型
            PromptResult keyResult=ed.GetKeywords(keyOpt);
            bool isOverlay=keyResult.StringResult == "A" ? false : true;
            using (Transaction trans=db.TransactionManager.StartTransaction())
            {
                //将外部参照插入到当前图形并在模型空间添加参照块
                ObjectId xrefId = db.AttachXref(filename, System.IO.Path.GetFileNameWithoutExtension(filename), pt, new Scale3d(1, 1, 1), 0, isOverlay);
                trans.Commit();
            }
        }
        [CommandMethod("UnloadExternalReference")]
        public void UnloadExternalReference()
        {
            Database db=HostApplicationServices.WorkingDatabase;
            using (Transaction trans=db.TransactionManager.StartTransaction())
            {
                BlockTable bt=(BlockTable)trans.GetObject(db.BlockTableId, OpenMode.ForRead);
                foreach (ObjectId id in bt)//遍历块表
                {
                    BlockTableRecord btr=(BlockTableRecord)trans.GetObject(id, OpenMode.ForRead);
                    //如果是名为“Annotation - Metric”的外部参照，则进行卸载
                    if (btr.IsFromExternalReference && btr.Name == "Annotation - Metric")
                    {
                        db.UnloadXrefs(new ObjectIdList(id));
                        break;//完成卸载指定的外部参照，跳出循环
                    }
                }
                trans.Commit();
            }
        }

        [CommandMethod("ListXrefs")]
        public static void ListXrefs()
        {
            Database db=HostApplicationServices.WorkingDatabase;
            //获取XrefGraph对象，该对象包含当前文档中的所有外部参照节点
            XrefGraph xgraph=db.GetHostDwgXrefGraph(true);
            //创建一个节点集合对象，用来保存当前XrefGraph中的节点
            using (var nodes=new GraphNodeCollection())
            {
                //遍历XrefGraph中的节点，并将其添加到节点集合中
                for (int i = 0; i < xgraph.NumNodes; i++)
                    nodes.Add(xgraph.GetXrefNode(i));
                //第一个为当前文档本身，不属于外部参照，跳过
                for (int i = 1; i < xgraph.NumNodes; i++)
                {
                    //获取外部参照节点对象
                    XrefGraphNode node=xgraph.GetXrefNode(i);
                    //如果为嵌套节点，则访问其子节点
                    if (!node.IsNested)
                        getNestedNodes(xgraph, node, nodes, string.Empty);
                }
            }
        }
        private static void getNestedNodes(XrefGraph xgraph, XrefGraphNode node, GraphNodeCollection nodes, string parent)
        {
            Document doc=Application.DocumentManager.MdiActiveDocument;
            //输出外部参照节点的名称（含其父节点名称）和状态
            doc.Editor.WriteMessage("\n{0}({1}）", parent + node.Name, node.XrefStatus);
            //递归调用，以完成对嵌套节点的访问
            for (int i = 0; i < node.NumOut; i++)
            {
                getNestedNodes(xgraph, xgraph.GetXrefNode(nodes.IndexOf(node.Out(i))), nodes, parent + node.Name + "|");
            }
        }
        [CommandMethod("AttachImage")]
        public void AttachImage()
        {
            Database db=HostApplicationServices.WorkingDatabase;
            Point3d pt=Point3d.Origin;//图像插入点
            //图像文件路径
            string fileName=Tools.GetCurrentPath() + "\\child.jpg";
            using (Transaction trans=db.TransactionManager.StartTransaction())
            {
                //访问当前文档的图像目录Id
                ObjectId dictId=RasterImageDef.GetImageDictionary(db);
                //如果图像目录不存在，则新建
                if (dictId.IsNull) dictId = RasterImageDef.CreateImageDictionary(db);
                //获取图像目录，它是一个字典对象
                DBDictionary dict=(DBDictionary)trans.GetObject(dictId, OpenMode.ForRead);
                RasterImageDef def=new RasterImageDef();//新建一个光栅图像定义对象
                def.SourceFileName = fileName;//光栅图像的文件名
                def.Load();//装载光栅图像定义对象
                dict.UpgradeOpen();//切换图像目录对象为写的状态
                //将光栅图像定义添加到图像目录
                ObjectId defId=dict.SetAt("child", def);
                trans.AddNewlyCreatedDBObject(def, true);//通知事务处理
                RasterImage image=new RasterImage();//新建光栅图像
                image.ImageDefId = defId;//设置光栅图像的定义
                image.ShowImage = true;//显示光栅图像
                //将光栅图像放置在原点，大小为图像的原尺寸
                image.Orientation = new CoordinateSystem3d(
                    Point3d.Origin, new Vector3d(image.Width, 0, 0), new Vector3d(0, image.Height, 0));
                db.AddToModelSpace(image);//将光栅图像添加到模型空间
                //在光栅图像和光栅图像定义之间创建联系，防止在外部参照管理器中图像的状态为“未参照”
                RasterImage.EnableReactors(true);
                image.AssociateRasterDef(def);
                trans.Commit();//提交事务处理
            }
        }
    }
}
﻿using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using Autodesk.AutoCAD.DatabaseServices;
using Autodesk.AutoCAD.Geometry;

namespace DotNetARX
{
    /// <summary>
    /// 外部参照操作类
    /// </summary>
    public static class XrefTools
    {
        /// <summary>
        /// 将外部参照插入到图形
        /// </summary>
        /// <param name="db">数据库对象</param>
        /// <param name="fileName">包含完整路径的外部参照文件名</param>
        /// <param name="blockName">参照名</param>
        /// <param name="insertionPoint">外部参照块的插入点</param>
        /// <param name="scaleFactors">外部参照块的缩放因子</param>
        /// <param name="rotation">外部参照块的旋转角度，以弧度表示</param>
        /// <param name="isOverlay">外部参照块的类型，为true时表示覆盖，为false时表示附着</param>
        /// <returns></returns>
        public static ObjectId AttachXref(this Database db, string fileName, string blockName, Point3d insertionPoint, Scale3d scaleFactors, double rotation, bool isOverlay)
        {
            ObjectId xrefId=ObjectId.Null;//外部参照的Id
            //选择以覆盖的方式插入外部参照
            if (isOverlay) xrefId = db.OverlayXref(fileName, blockName);
            //选择以附着的方式插入外部参照
            else xrefId = db.AttachXref(fileName, blockName);
            //根据外部参照创建一个块参照，并指定其插入点
            BlockReference bref=new BlockReference(insertionPoint, xrefId);
            bref.ScaleFactors = scaleFactors;//外部参照块的缩放因子
            bref.Rotation = rotation;//外部参照块的旋转角度
            db.AddToModelSpace(bref);//将外部参照块添加到模型空间
            return xrefId;//返回外部参照的Id
        }
    }
}
